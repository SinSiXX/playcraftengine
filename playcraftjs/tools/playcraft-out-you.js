function printStackTrace(d){d=d||{guess:!0};var b=d.e||null,f=!!d.guess,c=new printStackTrace.implementation,a=c.run(b);return f?c.guessAnonymousFunctions(a):a}function Vector(){}function Matrix(){}function Line(){}function Plane(){}pc.Hashtable=gamecore.Hashtable,pc.Base=gamecore.Base("pc.Base",{},{}),pc.Pool=gamecore.Pool.extend("pc.Pool",{},{}),pc.Pooled=gamecore.Pooled.extend("pc.Pooled",{},{}),pc.LinkedList=gamecore.LinkedList.extend("pc.LinkedList",{},{}),pc.HashList=gamecore.HashList.extend("pc.HashList",{},{}),Function.prototype.bind||(Function.prototype.bind=function(d){if(typeof this!="function"){throw new TypeError("Function.prototype.bind - what is trying to be fBound is not callable")}var b=Array.prototype.slice.call(arguments,1),f=this,c=function(){},a=function(){return f.apply(this instanceof c?this:d||window,b.concat(Array.prototype.slice.call(arguments)))};return c.prototype=this.prototype,a.prototype=new c,a}),Array.prototype.indexOf||(Array.prototype.indexOf=function(d){if(this==null){throw new TypeError}var b=Object(this),f=b.length>>>0;if(f===0){return -1}var c=0;arguments.length>0&&(c=Number(arguments[1]),c!=c?c=0:c!=0&&c!=Infinity&&c!=-Infinity&&(c=(c>0||-1)*Math.floor(Math.abs(c))));if(c>=f){return -1}var a=c>=0?c:Math.max(f-Math.abs(c),0);for(;a<f;a++){if(a in b&&b[a]===d){return a}}return -1}),pc.Collision=pc.Pooled("pc.Collision",{TILE_TYPE:0,ENTITY_TYPE:1,create:function(b,a){var c=this._super();return c.xMove=b,c.yMove=a,c.current=!0,c.type=-1,c}},{xMove:0,yMove:0,type:-1,current:!0,init:function(){this._super()},toString:function(){return" xMove: "+this.xMove+" yMove: "+this.yMove+" current:"+this.current}}),pc.EntityCollision=pc.Collision("pc.EntityCollision",{create:function(c,a,d){var b=this._super(a,d);return b.entity=c,b.type=pc.Collision.ENTITY_TYPE,b}},{entity:null,toString:function(){return this._super()+" With: "+this.entity.uniqueId}}),pc.TileCollision=pc.Collision("pc.TileCollision",{create:function(f,b,h,d,a,c){var g=this._super();return g.tileX=f,g.tileY=b,g.xAxis=h,g.yAxis=d,g.xMove=a,g.yMove=c,g.type=pc.Collision.TILE_TYPE,g}},{xAxis:!1,yAxis:!1,xMove:0,yMove:0,tileX:0,tileY:0,toString:function(){return this._super()+" xAxis: "+this.xAxis+" yAxis: "+this.yAxis+" xMove: "+this.xMove+" yMove: "+this.yMove+" tileX: "+this.tileX+" tileY: "+this.tileY}}),pc.Color=pc.Pooled.extend("pc.Color",{create:function(b){var a=this._super();return a.config(b),a}},{rgb:[],color:null,init:function(a){a!=undefined&&this.config(a)},config:function(a){if(Array.isArray(a)){this.rgb=a}else{if(a.charAt(0)!=="#"){throw"Invalid color: use either array [r,g,b] or '#RRGGBB'"}this.rgb[0]=parseInt(a.substring(1,3),16),this.rgb[1]=parseInt(a.substring(3,5),16),this.rgb[2]=parseInt(a.substring(5,7),16)}this._updateColorCache()},set:function(a){this.config(a)},setRed:function(a){this.rgb[0]=pc.Math.limit(a,0,255),this._updateColorCache()},addRed:function(a){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],a,0,255),this._updateColorCache()},subRed:function(a){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],-a,0,255),this._updateColorCache()},setGreen:function(a){this.rgb[1]=pc.Math.limit(a,0,255),this._updateColorCache()},addGreen:function(a){this.rgb[1]=pc.Math.limitAdd(this.rgb[0],a,0,255),this._updateColorCache()},subGreen:function(a){this.rgb[1]=pc.Math.limitAdd(this.rgb[0],-a,0,255),this._updateColorCache()},setBlue:function(a){this.rgb[2]=pc.Math.limit(a,0,255),this._updateColorCache()},addBlue:function(a){this.rgb[2]=pc.Math.limitAdd(this.rgb[0],a,0,255),this._updateColorCache()},subBlue:function(a){this.rgb[2]=pc.Math.limitAdd(this.rgb[0],-a,0,255),this._updateColorCache()},darken:function(a){this.subRed(a),this.subGreen(a),this.subBlue(a)},lighten:function(a){this.addRed(a),this.addGreen(a),this.addBlue(a)},_updateColorCache:function(){this.color="rgb("+this.rgb[0]+","+this.rgb[1]+","+this.rgb[2]+")"}}),pc.components.Activator=pc.components.Component.extend("pc.components.Activator",{create:function(b){var a=this._super();return a.config(b),a}},{tag:null,layer:null,_cacheLayer:null,range:0,stayActive:!1,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){if(!a.tag){throw"Activator requires an entity to track against"}this.tag=a.tag,this.layer=pc.checked(a.layer,null),this.range=pc.checked(a.range,300),this.stayActive=pc.checked(a.stayActive,!1)}}),pc.components.Alpha=pc.components.Component.extend("pc.components.Alpha",{create:function(b){var a=this._super();return a.config(b),a}},{level:1,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){this.level=pc.checked(a.level,1)},setAlpha:function(a){this.level=a,this._fix(this.level)},addAlpha:function(a){this.level+=a,this._fix(this.level)},subAlpha:function(a){this.level-=a,this._fix(this.level)},_fix:function(a){if(a>1){return 1}if(a<0){return 0}this.level=a}}),pc.components.Clip=pc.components.Component.extend("pc.components.Clip",{create:function(b){var a=this._super();return a.config(b),a}},{entity:null,x:0,y:0,w:0,h:0,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){this.entity=pc.checked(a.entity,null),this.x=pc.checked(a.x,0),this.y=pc.checked(a.y,0),this.w=pc.checked(a.w,0),this.h=pc.checked(a.h,0)}}),pc.components={},pc.components.Component=pc.Pooled.extend("pc.components.Component",{create:function(){return this._super()}},{_type:null,init:function(a){this._super(),this._type=a},getType:function(){return this._type.toLowerCase()},setType:function(a){this._type=a},onBeforeRemoved:function(){}}),pc.components.DebugInfo=pc.components.Component.extend("pc.components.DebugInfo",{create:function(b){var a=this._super();return a.config(b),a}},{init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){}}),pc.components.Rect=pc.components.Component.extend("pc.components.Rect",{create:function(b){var a=this._super();return a.config(b),a}},{color:null,strokeColor:null,lineWidth:0,cornerRadius:0,init:function(a){this._super(this.Class.shortName),this.color=pc.Color.create("#ffffff"),this.strokeColor=pc.Color.create("#888888"),pc.valid(a)&&this.config(a)},config:function(a){a.color?this.color.set(pc.checked(a.color,"#ffffff")):this.color.set("#ffffff"),a.strokeColor?this.strokeColor.set(pc.checked(a.strokeColor,"#888888")):this.strokeColor.set("#ffffff"),this.lineWidth=pc.checked(a.lineWidth,0),this.cornerRadius=pc.checked(a.cornerRadius,0)},release:function(){this._super(),this.color.release(),this.strokeColor&&this.strokeColor.release()}}),pc.components.Text=pc.components.Component.extend("pc.components.Text",{create:function(b){var a=this._super();return a.config(b),a}},{color:null,strokeColor:null,font:null,fontHeight:0,text:null,lineWidth:0,offset:null,_fontCache:null,init:function(a){this._super(this.Class.shortName),this.color=pc.Color.create("#ffffff"),this.strokeColor=pc.Color.create("#888888"),this.text=[],this.font="Calibri",this.fontHeight=20,this.offset=pc.Dim.create(0,0),this._fontCache="",pc.valid(a)&&this.config(a)},config:function(a){this.color.set(pc.checked(a.color,"#ffffff")),this.strokeColor.set(pc.checked(a.strokeColor,"#888888")),this.lineWidth=pc.checked(a.lineWidth,0),this.text=pc.checked(a.text,[""]),this.font=pc.checked(a.font,"Arial"),this.fontHeight=pc.checked(a.fontHeight,20),pc.valid(a.offset)&&(this.offset.x=pc.checked(a.offset.x),this.offset.y=pc.checked(a.offset.y)),this._updateFont()},setHeight:function(a){this.fontHeight=a,this._updateFont()},setFont:function(a){this.font=a,this._updateFont()},_updateFont:function(){this._fontCache=""+this.fontHeight+"px "+this.font}}),pc.components.Expiry=pc.components.Component.extend("pc.components.Expiry",{create:function(b){var a=this._super();return a.config(b),a}},{lifetime:0,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){this.lifetime=pc.checked(a.lifetime,1000)},decrease:function(a){this.lifetime-=a},hasExpired:function(){return this.lifetime<=0}}),pc.components.Fade=pc.components.Component.extend("pc.components.Fade",{create:function(b){var a=this._super();return a.config(b),a}},{startDelay:0,fadeInTime:0,fadeOutTime:0,holdTime:0,startTime:0,timeLimit:0,state:0,loops:1,loopsSoFar:0,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){this.startDelay=pc.checked(a.startDelay,0),this.fadeInTime=pc.checked(a.fadeInTime,0),this.fadeOutTime=pc.checked(a.fadeOutTime,0),this.holdTime=pc.checked(a.holdTime,0),this.loops=pc.checked(a.loops,1),this.timeLimit=0,this.state=0,this.loopsSoFar=0}}),pc.components.Input=pc.components.Component.extend("pc.components.Input",{create:function(b){var a=this._super();return a.config(b),a}},{states:null,actions:null,_bound:!1,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){if(!a.states&&!a.actions){throw"Input requires at least an action or state set"}this.states=a.states,this.actions=a.actions}}),pc.JointType={WELD:0,REVOLUTE:1,DISTANCE:2},pc.components.Joint=pc.components.Component.extend("pc.components.Joint",{create:function(b){var a=this._super();return a.config(b),a}},{attachTo:null,offset:null,attachmentOffset:null,distance:0,type:0,frequency:0,dampingRatio:0,angle:0,lowerAngleLimit:0,upperAngleLimit:0,enableLimit:!1,maxMotorTorque:0,enableMotor:0,motorSpeed:0,_joint:null,init:function(a){this._super(this.Class.shortName),this.offset=pc.Point.create(0,0),this.attachmentOffset=pc.Point.create(0,0),pc.valid(a)&&this.config(a)},config:function(a){this.attachTo=pc.checked(a.attachedTo,null),a.offset&&this.offset.setXY(pc.checked(a.offset.x,0),pc.checked(a.offset.y,0)),a.attachmentOffset&&this.attachmentOffset.setXY(pc.checked(a.attachmentOffset.x,0),pc.checked(a.attachmentOffset.y,0)),this.distance=pc.checked(a.distance,0),this.type=pc.checked(a.type,pc.JointType.WELD),this.dampingRatio=pc.checked(a.dampingRatio,0),this.lowerAngleLimit=pc.checked(a.lowerAngleLimit,0),this.upperAngleLimit=pc.checked(a.upperAngleLimit,359),this.enableLimit=pc.checked(a.enableLimit,!1),this.maxMotorTorque=pc.checked(a.maxMotorTorque,100),this.enableMotor=pc.checked(a.enableMotor,!1),this.motorSpeed=pc.checked(a.motorSpeed,0),this.angle=pc.checked(a.angle,0),this._joint=null},getAngle:function(){return pc.Math.radToDeg(this._joint.GetJointAngle())},getSpeed:function(){return this._joint.GetJointSpeed()},setMotorSpeed:function(a){this.motorSpeed=a,this._joint.SetMotorSpeed(a)},getMotorTorque:function(){return this._joint.GetMotorTorque()},isLimitEnabled:function(){return this.enableLimit},isMotorEnabled:function(){return this.enableMotor},setMaxMotorTorque:function(a){this.maxMotorTorque=a,this._joint.SetMaxMotorTorque(a)},getMaxMotorTorque:function(){return this.maxMotorTorque}}),pc.components.Layout=pc.components.Component.extend("pc.components.Layout",{create:function(b){var a=this._super();return a.config(b),a}},{vertical:null,horizontal:null,margin:null,init:function(a){this._super(this.Class.shortName),this.margin={},pc.valid(a)&&this.config(a)},config:function(a){this.anchor=pc.checked(a.anchor),pc.checked(a.margin)?(this.margin.left=pc.checked(a.margin.left,0),this.margin.right=pc.checked(a.margin.right,0),this.margin.top=pc.checked(a.margin.top,0),this.margin.bottom=pc.checked(a.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0),this.horizontal=pc.checked(a.horizontal,"left"),this.vertical=pc.checked(a.vertical,"top")}}),pc.components.OriginShifter=pc.components.Component.extend("pc.components.OriginShifter",{create:function(b){var a=this._super();return a.config(b),a}},{ratio:1,_offsetX:0,_offsetY:0,init:function(a){this._super(this.Class.shortName),pc.valid(a)&&this.config(a)},config:function(a){this.ratio=pc.checked(a.ratio,1)}}),pc.components.Overlay=pc.components.Component.extend("pc.components.Overlay",{create:function(b){var a=this._super();return a.config(b),a}},{lifetime:0,sprite:null,init:function(a){this._super(this.Class.shortName),this.sprite=pc.Sprite.create(),pc.valid(a)&&this.config(a)},config:function(c){this.lifetime=pc.checked(c.lifetime,1000);var a=pc.checked(c.spriteSheet,null);if(a==null){throw this.getUniqueId()+": no spritesheet specified"}this.sprite.setSpriteSheet(a);var d=pc.checked(c.animationStart,null),b=pc.checked(c.animationStartDelay,0);d!=null&&this.sprite.setAnimation(d,b)},decrease:function(a){this.lifetime-=a},hasExpired:function(){return this.lifetime<=0}}),pc.components.ParticleEmitter=pc.components.Component.extend("pc.components.ParticleEmitter",{create:function(b){var a=this._super();return a.config(b),a}},{active:!0,emitting:!0,scaleXMin:0,scaleXMax:0,scaleYMin:0,scaleYMax:0,fadeInTime:0,fadeOutTime:0,angleMin:0,angleMax:0,thrustMin:0,thrustMax:0,thrustTime:0,spinMin:0,spinMax:0,rangeX:1,rangeY:1,burst:1,delay:25,spriteSheet:null,lifeMin:0,lifeMax:0,rotateSprite:!1,offsetX:null,offsetY:null,compositeOperation:null,relativeAngle:!0,shots:0,alphaMin:1,alphaMax:1,alphaDelay:0,_particles:null,_lastEmitTime:0,_shotCount:0,init:function(a){this._super("emitter"),pc.valid(a)&&this.config(a)},reset:function(){this._shotCount=0,this._lastEmitTime=0},config:function(a){this._lastEmitTime=0,this._shotCount=0,this.active=pc.checked(a.active,!0),this.emitting=pc.checked(a.emitting,!0),this.scaleXMin=pc.checked(a.scaleXMin,0),this.scaleXMax=pc.checked(a.scaleXMax,this.scaleXMin),this.scaleYMin=pc.checked(a.scaleYMin,0),this.scaleYMax=pc.checked(a.scaleYMax,this.scaleYMin),this.compositeOperation=pc.checked(a.compositeOperation,null),this.alphaMin=pc.checked(a.alphaMin,1),this.alphaMax=pc.checked(a.alphaMax,this.alphaMin),this.alphaDelay=pc.checked(a.alphaDelay,50),this.shots=pc.checked(a.shots,0),this.relativeAngle=pc.checked(a.relativeAngle,!0),this.rangeX=pc.checked(a.rangeX,1),this.rangeY=pc.checked(a.rangeY,1),this.fadeInTime=pc.checked(a.fadeInTime,0),this.fadeOutTime=pc.checked(a.fadeOutTime,0),this.angleMin=pc.checked(a.angleMin,0),this.angleMax=pc.checked(a.angleMax,359),this.thrustMin=pc.checked(a.thrustMin,1),this.thrustMax=pc.checked(a.thrustMax,this.thrustMin),this.thrustTime=pc.checked(a.thrustTime,100),this.burst=pc.checked(a.burst,1),this.delay=pc.checked(a.delay,25),this.lifeMin=pc.checked(a.lifeMin,100),this.lifeMax=pc.checked(a.lifeMin,this.lifeMin),this.rotateSprite=pc.checked(a.rotateSprite,!1),this.spinMin=pc.checked(a.spinMin,0),this.spinMax=pc.checked(a.spinMax,this.spinMin),this.offsetX=pc.checked(a.offsetX,0),this.offsetY=pc.checked(a.offsetY,0),this.gravityX=pc.checked(a.gravityX,0),this.gravityY=pc.checked(a.gravityY,0),this.maxVelX=pc.checked(a.maxVelX,50),this.maxVelY=pc.checked(a.maxVelY,50);if(!pc.valid(a.spriteSheet)){throw"A spritesheet is required for the emitter"}this.spriteSheet=a.spriteSheet,Array.isArray(this._particles)?this._particles.clear():this._particles=new pc.LinkedList},onBeforeRemoved:function(){var a=this._particles.first;while(a){a.obj.release(),a=a.next()}}}),pc.components.Physics=pc.components.Component.extend("pc.components.Physics",{create:function(b){var a=this._super();return a.config(b),a}},{maxSpeed:null,bounce:0.5,faceVel:!1,density:0,mass:-1,friction:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,collisionGroup:0,collisionCategory:0,collisionMask:0,sensorOnly:!1,immovable:!1,centerOfMass:null,gravity:null,shapes:null,_body:null,_fixtures:null,force:0,turn:0,torque:0,init:function(a){this._super(this.Class.shortName),this.centerOfMass=pc.Point.create(0,0),this.margin={x:0,y:0},pc.valid(a)&&this.config(a),this._velReturn=pc.Dim.create(0,0),this.gravity={}},config:function(b){this._body=null,this._fixtures?this._fixtures.length=0:this._fixtures=[],this.collisionGroup=pc.checked(b.collisionGroup,0),this.collisionCategory=pc.checked(b.collisionCategory,0),this.collisionMask=pc.checked(b.collisionMask,0),this.sensorOnly=pc.checked(b.sensorOnly,!1),!pc.valid(b.shapes)&&!Array.isArray(b.shapes)&&(b.shapes=[{}],b.shapes[0].shape=pc.CollisionShape.RECT);for(var a=0;a<b.shapes.length;a++){var c=b.shapes[a];c.offset||(c.offset={}),c.offset.x=pc.checked(c.offset.x,0),c.offset.y=pc.checked(c.offset.y,0),c.offset.w=pc.checked(c.offset.w,0),c.offset.h=pc.checked(c.offset.h,0),c.type=pc.checked(c.type,0),c.shape=pc.checked(c.shape,pc.CollisionShape.RECT),c.sensorOnly=pc.checked(c.sensorOnly,this.sensorOnly),c.collisionGroup=pc.checked(c.collisionGroup,this.collisionGroup),c.collisionCategory=pc.checked(c.collisionCategory,this.collisionCategory),c.collisionMask=pc.checked(c.collisionMask,this.collisionMask)}this.shapes=b.shapes,this.maxSpeed||(this.maxSpeed={}),b.maxSpeed?(this.maxSpeed.x=pc.checked(b.maxSpeed.x,0),this.maxSpeed.y=pc.checked(b.maxSpeed.y,0)):(this.maxSpeed.x=0,this.maxSpeed.y=0),b.gravity?(this.gravity.x=b.gravity.x,this.gravity.y=b.gravity.y):(this.gravity.x=undefined,this.gravity.y=undefined),this.mass=pc.checked(b.mass,-1),this.fixedRotation=pc.checked(b.fixedRotation,!1),this.thrust=pc.checked(b.thrust,0),this.bounce=pc.checked(b.bounce,0.5),this.faceVel=pc.checked(b.faceVel,0),this.shape=pc.checked(b.shape,pc.CollisionShape.RECT),this.immovable=pc.checked(b.immovable,!1),this.density=pc.checked(b.density,1),this.friction=pc.checked(b.friction,0.2),this.linearDamping=pc.checked(b.linearDamping,0),this.angularDamping=pc.checked(b.angularDamping,0),this.bullet=pc.checked(b.bullet,!1),this.torque=pc.checked(b.torque,0),this.impulse=pc.checked(b.impulse,0),this.turn=pc.checked(b.turn,0),this.force=pc.checked(b.force,0),pc.valid(b.centerOfMass)&&(this.centerOfMass.x=pc.checked(b.centerOfMass.x),this.centerOfMass.y=pc.checked(b.centerOfMass.y))},setPos:function(b,a){this._body&&this._body.SetPosition({x:pc.systems.Physics.toP(b),y:pc.systems.Physics.toP(a)})},applyTurn:function(a){this._body?(this._body.SetAngularVelocity(pc.Math.degToRad(a)),this._body.SetAwake(!0)):this._pendingDir=a},clearGravity:function(){this.setGravity()},setGravity:function(b,a){this.gravity.x=b,this.gravity.y=a;if(this._body){if(this.gravity.x!=undefined||this._body._pc_gravityX!=undefined){this._body._pc_gravityX=this.gravity.x}if(this.gravity.y!=undefined||this._body._pc_gravityY!=undefined){this._body._pc_gravityY=this.gravity.y}}},setDir:function(a){this._body?(this._body.SetAngle(pc.Math.degToRad(a)),this._body.SetAwake(!0)):this.dir=a},getDir:function(){return this._body?pc.Math.radToDeg(this._body.GetAngle()):0},applyForce:function(b,a){if(this._body){var c=this._body.GetAngle();pc.valid(a)&&(c=pc.Math.degToRad(a)),this._body.ApplyForce(Box2D.Common.Math.b2Vec2.Get(Math.cos(c)*b,Math.sin(c)*b),this._body.GetWorldCenter())}else{this.force=b}},applyImpulse:function(b,a){if(this._body){var c=this._body.GetAngle();pc.valid(a)&&(c=pc.Math.degToRad(a)),this._body.ApplyImpulse(Box2D.Common.Math.b2Vec2.Get(Math.cos(c)*b,Math.sin(c)*b),this._body.GetWorldCenter())}else{this.impulse=b}},applyTorque:function(a){this._body?this._body.ApplyTorque(pc.Math.degToRad(a)):this.torque=a},setCenterOfMass:function(b,a){if(this._body){var c=new Box2D.Collision.Shapes.b2MassData;c.center=Box2D.Common.Math.b2Vec2.Get(pc.systems.Physics.toP(b),pc.systems.Physics.toP(a)),this._body.SetMassData(c)}else{this.centerOfMass.x=b,this.centerOfMass.y=a}},getSpeed:function(){return this._body?this._body.GetLinearVelocity().Length()/pc.systems.Physics.SCALE:0},setLinearVelocity:function(b,a){this._body&&this._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(b*pc.systems.Physics.SCALE,a*pc.systems.Physics.SCALE))},_velReturn:null,getLinearVelocity:function(){if(this._body){var a=this._body.GetLinearVelocity();this._velReturn.setXY(pc.systems.Physics.fromP(a.x),pc.systems.Physics.fromP(a.y))}return this._velReturn},getVelocityAngle:function(){return pc.Math.angleFromVector(this._body.GetLinearVelocity().x,this._body.GetLinearVelocity().y)},setAngularVelocity:function(a){this._body&&this._body.SetAngularVelocity(a)},setCollisionCategory:function(b){if(!this._fixtures.length){return}this.collisionCategory=b;for(var a=0;a<this._fixtures.length;a++){var c=this._fixtures[a].GetFilterData();c.collisionCategory=b,this._fixtures[a].SetFilterData(c),this._fixtures[a].GetFilterData().categoryBits=b}},setCollisionGroup:function(b){if(!this._fixtures.length){return}this.collisionGroup=b;for(var a=0;a<this._fixtures.length;a++){var c=this._fixtures[a].GetFilterData();c.groupIndex=b,this._fixtures[a].SetFilterData(c)}},setCollisionMask:function(b){if(!this._fixtures.length){return}this.collisionMask=b;for(var a=0;a<this._fixtures.length;a++){var c=this._fixtures[a].GetFilterData();c.maskBits=b,this._fixtures[a].SetFilterData(c)}},setIsSensor:function(b,a){if(!this._fixtures.length){return}this._fixtures[a].isSensor=b}}),pc.components.Spatial=pc.components.Component.extend("pc.components.Spatial",{create:function(b){var a=this._super();return a.config(b),a}},{lastMove:null,pos:null,dim:null,dir:0,_centerPos:null,init:function(a){this._super(this.Class.shortName),this.pos=pc.Point.create(0,0),this.dim=pc.Dim.create(0,0),this._centerPos=pc.Point.create(0,0),this.lastMove=pc.Dim.create(0,0),pc.valid(a)&&this.config(a)},config:function(a){this.pos.x=pc.checked(a.x,0),this.pos.y=pc.checked(a.y,0),this.dir=pc.checked(a.dir,0),this.dim.x=pc.checked(a.w,0),this.dim.y=pc.checked(a.h,0),this._centerPos.x=0,this._centerPos.y=0,this.lastMove.x=0,this.lastMove.y=0},getPos:function(){return this.pos},getDir:function(){return this.dir},getDim:function(){return this.dim},getCenterPos:function(){return this._centerPos.x=this.pos.x+this.dim.x/2,this._centerPos.y=this.pos.y+this.dim.y/2,this._centerPos},toString:function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z+" dir: "+this.dir}}),pc.components.Sprite=pc.components.Component.extend("pc.components.Sprite",{create:function(b){var a=this._super();return a.config(b),a}},{init:function(a){this._super(this.Class.shortName),this.sprite=pc.Sprite.create(),this.offset=pc.Point.create(0,0),pc.valid(a)&&this.config(a)},sprite:null,offset:null,config:function(c){var a=pc.checked(c.spriteSheet,null);if(a==null){throw this.getUniqueId()+": no spritesheet specified"}this.sprite.setSpriteSheet(a),pc.valid(c.offset)?(this.offset.x=pc.checked(c.offset.x,0),this.offset.y=pc.checked(c.offset.y,0)):(this.offset.x=0,this.offset.y=0);var d=pc.checked(c.animationStart,null),b=pc.checked(c.animationStartDelay,0);d!=null&&this.sprite.setAnimation(d,b),this.sprite.currentFrame=pc.checked(c.currentFrame,0)}}),pc.DataResource=pc.Base.extend("pc.DataResource",{},{data:null,request:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,init:function(c,a,d,b){this._super(),this.src=pc.device.loader.makeUrl(a),this.name=c,this.onLoadCallback=d,this.onErrorCallback=b,this.request=new XMLHttpRequest,this.request.onreadystatechange=this.onReadyStateChange.bind(this),this.request.onload=this.onReadyStateChange.bind(this),this.request.onloadend=this.onReadyStateChange.bind(this),this.load()},load:function(b,a){this.onLoadCallback=b,this.onErrorCallback=a,this.request.open("get",this.src),this.request.send(null)},reload:function(){this.loaded=!1,this.load()},onReadyStateChange:function(){if(this.loaded){return}this.request.readyState==4&&(this.request.status==200?(this.loaded=!0,this.data=this.request.responseText,this.onLoadCallback&&this.onLoadCallback(this)):this.request.status==404&&(this.warn("resource "+this.src+" error "+this.request.status),this.onErrorCallback&&this.onErrorCallback(this)))}}),pc.DebugPanel=pc.Base("pc.DebugPanel",{},{x:0,y:0,panelHeight:0,panelWidth:0,canvas:null,ctx:null,statusText:null,active:!1,timeGraph:null,memGraph:null,entityGraph:null,poolGraph:null,currentMem:0,lastMem:0,init:function(){this._super()},onReady:function(){this.attach("debug")},attach:function(b){this.canvas=document.getElementById(b);if(this.canvas==null){this.warn('Showing debug requires a div with an id of "debug" to be added to your dom.'),pc.device.showDebug=!1;return}this.panelElement=this.canvas.parentNode,this.ctx=this.canvas.getContext("2d"),this.onResize();var a=4;this.timeGraph=new pc.CanvasLineGraph(this.ctx,"Performance","",10,[{name:"process (ms)",color:"#f55"},{name:"render (ms)",color:"#5f5"}],10,10,this.panelWidth/a-10,this.panelHeight-20),typeof console.memory=="undefined"||console.memory.totalJSHeapSize==0?this.memGraph=new pc.CanvasLineGraph(this.ctx,"Memory","Memory profiling not available",0,[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/a+10,10,this.panelWidth/a-10,this.panelHeight-20):this.memGraph=new pc.CanvasLineGraph(this.ctx,"Memory","",console.memory.totalJSHeapSize/1024/1024*1.2,[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/a+10,10,this.panelWidth/a-10,this.panelHeight-20),this.poolGraph=new pc.CanvasLineGraph(this.ctx,"Pool Size","",100,[{name:"pooled",color:"#5b1654"}],this.panelWidth-this.panelWidth/a*2+10,10,this.panelWidth/a-20,this.panelHeight-20),this.entityGraph=new pc.CanvasLineGraph(this.ctx,"Entities","",100,[{name:"drawn (total)",color:"#f9f007"}],this.panelWidth-this.panelWidth/a+10,10,this.panelWidth/a-20,this.panelHeight-20),this.active=!0},onResize:function(){if(this.canvas==null){return}this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight,this.panelWidth=this.panelElement.offsetWidth,this.panelHeight=this.panelElement.offsetHeight,this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.panelWidth,this.panelHeight);var a=4;this.timeGraph!=null&&this.timeGraph.resize(10,10,this.panelWidth/a-10,this.panelHeight-20),this.memGraph!=null&&this.memGraph.resize(this.panelWidth/a+10,10,this.panelWidth/a-10,this.panelHeight-20),this.poolGraph!=null&&this.poolGraph.resize(this.panelWidth-this.panelWidth/a*2+20,10,this.panelWidth/a-20,this.panelHeight-20),this.entityGraph!=null&&this.entityGraph.resize(this.panelWidth-this.panelWidth/a+10,10,this.panelWidth/a-20,this.panelHeight-20)},_timeSince:0,update:function(a){if(!this.active){return}this._timeSince+=a,this._timeSince>30&&(this._timeSince=0,this.timeGraph!=null&&this.timeGraph.addLine2(pc.device.lastProcessMS,pc.device.lastDrawMS),this.entityGraph!=null&&this.entityGraph.addLine1(pc.device.elementsDrawn),this.memGraph!=null&&typeof console.memory!="undefined"&&console.memory.totalJSHeapSize!=0&&this.memGraph.addLine1(window.performance.memory.usedJSHeapSize/1024/1024),this.poolGraph!=null&&this.poolGraph.addLine1(gamecore.Pool.totalPooled))},draw:function(){if(!this.active){return}this.timeGraph!=null&&this.timeGraph.draw(),this.entityGraph!=null&&this.entityGraph.draw(),this.memGraph!=null&&this.memGraph.draw(),this.poolGraph!=null&&this.poolGraph.draw()}}),pc.CanvasLineGraph=pc.Base.extend("pc.CanvasLineGraph",{height:0,width:0,ctx:null,data:null,maxY:0,x:0,y:0,labels:null,graphName:null,bgCanvas:null,graphCanvas:null,message:null,cursor:0,init:function(g,l,d,b,f,m,c,k,h){this._super(),this.ctx=g,this.message=d,this.graphName=l,this.maxY=b,this.x=m,this.y=c,this.width=k,this.height=h,this.labels=f,this.graphX=this.x+this.graphLeftMargin,this.graphY=this.y+20,this.cursor=0,this.graphCanvas=document.createElement("canvas"),this.bgCanvas=document.createElement("canvas"),this.resize(m,c,k,h)},resize:function(c,a,d,b){this.width>d&&(this.data=this.data.slice(this.width-d,d)),this.width=d,this.height=b,this.x=c,this.y=a,this.graphHeight=this.height-40,this.graphWidth=this.width-(this.graphLeftMargin+this.graphRightMargin),this.graphX=this.graphLeftMargin,this.graphY=20,this.bgCanvas.width=this.width,this.bgCanvas.height=this.height,this.graphCanvas.width=this.graphWidth,this.graphCanvas.height=this.graphHeight,this.resizeDataArray(this.graphWidth,this.labels.length),this.renderBackground()},resizeDataArray:function(c,a){var d=0;if(c<=0){return}if(this.data==null){this.data=[]}else{if(!(c>this.data.length)){this.data.splice(0,c-this.data.length),this.cursor>this.data.length-1&&(this.cursor=this.data.length-1);return}d=this.data.length-1}for(var b=d;b<c;b++){this.data.push(new Array(a))}},_totalAdded:0,linesSinceLastPeak:0,lastPeak:0,_total:0,addLine2:function(b,a){if(!this.data){return}this._totalAdded++,this._total=b+a,this.checkMaxRange(this._total),this.data[this.cursor][0]=b,this.data[this.cursor][1]=a,this._updateGraph(this._total)},addLine1:function(a){if(!this.data){return}this._totalAdded++,this._total=a,this.checkMaxRange(this._total),this.data[this.cursor][0]=a,this._updateGraph(a)},checkMaxRange:function(a){a>this.maxY&&(this.maxY=a*1.4,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.renderBackground(),this.renderGraph(!0))},_updateGraph:function(a){this.linesSinceLastPeak++,this.linesSinceLastPeak>this.width*1.5&&(this.linesSinceLastPeak++,this.maxY=a*1.4,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.lastPeak=a*1.4,this.renderBackground(),this.linesSinceLastPeak=0),a>this.lastPeak&&(this.lastPeak=a*1.4),this.cursor++,this.cursor>this.data.length-1&&(this.cursor=0)},margin:20,linePixelSize:0,yline:0,unit:0,gridY:0,i:0,n:0,graphLeftMargin:30,graphRightMargin:15,graphHeight:0,graphWidth:0,graphX:0,graphY:0,gridLineInc:15,renderBackground:function(){var g=this.bgCanvas.getContext("2d");g.fillStyle="#000",g.fillRect(0,0,this.width,this.height),g.fillStyle="#aaa",g.font="11px sans-serif",g.fillText(this.graphName,this.graphX,this.graphY-6),g.strokeStyle="#111",g.strokeRect(this.graphX+0.5,this.graphY+0.5,this.graphWidth,this.graphHeight),this.unit=this.graphHeight/this.maxY;var c=(this.graphHeight+this.gridLineInc)/this.gridLineInc,k=this.maxY/c,f=0,b=0;for(this.gridY=this.graphHeight+this.graphY;this.gridY>this.graphY+1;this.gridY-=this.gridLineInc){b++,g.textAlign="right",b%2==0?g.fillStyle="#111":g.fillStyle="#000";var d=this.gridLineInc;this.gridY-d<this.graphY?(d=this.gridY-this.graphY,g.fillRect(this.graphX+1,this.graphY+1,this.graphWidth-2,d-1)):g.fillRect(this.graphX+1,this.gridY-d-1,this.graphWidth-2,d),f=Math.round(k*b),g.fillStyle="#777",g.fillText(""+f,this.graphX-5,this.gridY)}g.globalAlpha=1,g.textAlign="left";var h=this.height-13,a=this.graphLeftMargin+3;for(this.n=0;this.n<this.labels.length;this.n++){g.fillStyle=this.labels[this.n].color,g.fillRect(a,h,5,5),g.fillStyle="#888",g.fillText(this.labels[this.n].name,a+8,h+6),a+=g.measureText(this.labels[this.n].name).width+18}this.renderGraph(!0)},renderGraph:function(d){if(!this.data){return}var b=this.graphCanvas.getContext("2d");d?(b.fillStyle="#000",b.fillRect(0,0,this.graphWidth,this.graphHeight)):this._totalAdded>this.graphWidth&&b.drawImage(this.graphCanvas,-1,0);var f=0;d?(f=this.data.length-1,this.dx=1):(this._totalAdded<this.graphWidth?this.dx=this.cursor:this.dx=this.graphWidth-1,f=this.dx+1);if(f==0){return}var c=this.cursor-1;c<0&&(c=this.data.length-1);for(;this.dx<f;this.dx++){c>this.data.length-1&&(c=0),b.fillStyle="#000",b.fillRect(this.dx,0,1,this.graphHeight),this.yline=this.graphHeight;for(this.i=0;this.i<this.data[c].length;this.i++){this.linePixelSize=this.data[c][this.i]*this.unit,b.strokeStyle=this.labels[this.i].color,b.beginPath(),b.moveTo(this.dx,this.yline);var a=this.yline-this.linePixelSize;a<0&&(a=0),b.lineTo(this.dx,a),b.closePath(),b.stroke(),this.yline-=this.linePixelSize}c++}},draw:function(){this.ctx.save(),this.ctx.drawImage(this.bgCanvas,this.x,this.y),this.renderGraph(!1),this.ctx.globalAlpha=0.4,this.ctx.drawImage(this.graphCanvas,this.x+this.graphX,this.y+this.graphY),this.message&&(this.ctx.font="13px sans-serif",this.ctx.fillStyle="#333",this.ctx.textAlign="center",this.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2-9)),this.ctx.restore()}}),pc.Device=pc.Base.extend("pc.Device",{},{canvasId:null,canvas:null,canvasWidth:0,canvasHeight:0,loader:null,timer:null,ctx:null,started:!1,fps:0,currentFPS:0,tick:0,requestAnim:null,running:!0,scale:1,xmlParser:null,debugPanel:null,showDebug:!0,devMode:!0,debugCollisions:!1,enablePooling:!0,soundEnabled:!0,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,screen:null,pixelRatio:1,isiPhone:!1,isiPhone4:!1,isiPad:!1,isAndroid:!1,isAppMobi:!1,isTouch:!1,requestAnimFrame:null,input:null,gameClass:null,game:null,elapsed:0,lastFrame:0,now:Date.now(),boot:function(b,a){this.info("Playcraft Engine v"+pc.VERSION+" starting."),this.canvasId=b,this.gameClass=a,this.fps=60,this.tick=1000/this.fps,this.debugPanel=new pc.DebugPanel,this.input=new pc.Input,this.loader=new pc.Loader,this.isAppMobi=typeof AppMobi!="undefined",this.pixelRatio=gamecore.Device.pixelRatio,this.isiPhone=gamecore.Device.isiPhone,this.isiPhone4=gamecore.Device.isiPhone4,this.isiPad=gamecore.Device.isiPad,this.isAndroid=gamecore.Device.isAndroid,this.isTouch=gamecore.Device.isTouch,this.device=gamecore.Device,this.requestAnimFrame=gamecore.Device.requestAnimFrame,this.requestAnimFrame=function(){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(f,d){window.setTimeout(f,1000/this.fps)};return function(d,e){c.apply(window,[d,e])}}(),window.onresize=this.onResize(),this.onReady()},canPlay:function(a){return gamecore.Device.canPlay(a)},onReadyAppMobi:function(){AppMobi.display.useViewport(document.body.offsetWidth,document.body.offsetHeight),AppMobi.device.setRotateOrientation("landscape"),AppMobi.device.setAutoRotate(!1),AppMobi.device.managePower(!0,!1),AppMobi.device.hideSplashScreen(),this.onReady()},_calcScreenSize:function(){this.isAppMobi?(this.screen!=null&&this.screen.release(),this.screen=pc.Dim.create(document.body.offsetWidth,document.body.offsetHeight),this.canvas.width=this.screen.x,this.canvas.height=this.screen.y,this.canvas.innerWidth=this.screen.x,this.canvas.innerHeight=this.screen.y,this.canvasWidth=this.screen.x,this.canvasHeight=this.screen.y):(this.isiPad||this.isiPhone?(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight):this.panelElement&&(this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.screen=pc.Dim.create(this.canvasWidth,this.canvasHeight))},onReady:function(){this.isiPad&&(this.showDebug=!1,this.soundEnabled=!1);if(this.started){return}this.game=eval("new "+this.gameClass+"()");if(!this.game){throw"Invalid game class"}this.canvas=document.getElementById(this.canvasId);if(!this.canvas){throw"Abort! Could not attach to a canvas element using the id ["+this.canvasId+']. Add a canvas element to your HTML, such as <canvas id="pcGameCanvas"></canvas>'}this.input.onReady(),this.ctx=this.canvas.getContext("2d"),this.panelElement=this.canvas.parentNode,this.onResize(),this.showDebug&&this.debugPanel.onReady(),this.lastFrame=Date.now(),this.game.onReady(),this.requestAnimFrame(this.cycle.bind(this)),this.started=!0},startTime:0,cycle:function(a){this.running!==!1&&(this.now=Date.now(),this.elapsed=this.now-this.lastFrame,this.lastDrawMS=0,this.currentFPS=Math.round(1000/this.elapsed),this.elementsDrawn=0,this.startTime=Date.now(),this.elapsed<200&&(this.running=this.game.process()),this.lastProcessMS=Date.now()-this.startTime-this.lastDrawMS,pc.device.input.process(),this.showDebug&&(this.debugPanel.update(this.elapsed),this.debugPanel.draw(this.ctx)),this.lastFrame=this.now,this.requestAnimFrame(this.cycle.bind(this)))},resize:function(b,a){this.canvas.width=b,this.canvas.height=a,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize(this.canvasWidth,this.canvasHeight)},onResize:function(){if(this.canvas==null){return}this._calcScreenSize(),this.isiPhone||this.isiPad;var b=!1;typeof window.orientation!="undefined"&&window.orientation!=0&&(b=!0),typeof AppMobi!="undefined"&&AppMobi.device.orientation!="0"&&(b=!0),this.isiPad&&(b=!0);if(b){var a=this.canvas.width;this.canvas.width=this.canvas.height,this.canvas.height=a}this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize()},isOnScreen:function(c,a,d,b){return pc.Math.isRectColliding(c,a,d,b,0,0,this.canvasWidth,this.canvasHeight)},parseXML:function(b){if(window.DOMParser){return this.xmlParser||(this.xmlParser=new DOMParser),this.xmlParser.parseFromString(b,"text/xml")}var a=new ActiveXObject("Microsoft.XMLDOM");return a.loadXML(b),a}}),pc.device=new pc.Device,pc.Entity=pc.Pooled.extend("pc.Entity",{create:function(b){var a=this._super();return pc.assert(b,"Entity requires a valid layer to be placed on"),a.config(b),a}},{layer:null,tags:[],active:!0,_componentCache:null,init:function(a){this._super(),this._componentCache=new pc.Hashmap,pc.valid(a)&&this.config(a)},config:function(a){this.layer=a,this.active=!0,a.entityManager.add(this)},release:function(){this.tags.length=0,this.active=!1,this._componentCache.clear(),this._super()},addTag:function(a){this.layer.entityManager.addTag(this,a)},hasTag:function(b){for(var a=0;a<this.tags.length;a++){if(this.tags[a].toLowerCase()===b.toLowerCase()){return !0}}return !1},removeTag:function(a){this.layer.entityManager.removeTag(this,a)},addComponent:function(a){return this.layer.entityManager.addComponent(this,a)},removeComponent:function(a){this.layer.entityManager.removeComponent(this,a)},removeComponentByType:function(a){this.removeComponent(this._componentCache.get(a))},getComponent:function(a){return this._componentCache.get(a)},getAllComponents:function(){return this._componentCache},getComponentTypes:function(){return this._componentCache.keys()},hasComponentOfType:function(a){return this._componentCache.hasKey(a)},remove:function(){this.layer.entityManager.remove(this)},_handleComponentRemoved:function(a){this._componentCache.remove(a.getType())},_handleComponentAdded:function(a){this._componentCache.put(a.getType(),a)}}),pc.EntityFactory=pc.Base.extend("pc.EntityFactory",{},{createEntity:function(f,b,h,d,a,c,g){}}),pc.EntityManager=pc.Base.extend("pc.EntityManager",{},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,systemManager:null,layer:null,init:function(a){this.systemManager=a,this.entitiesByTag=new pc.HashList,this.entities=new pc.LinkedList,this.componentsByEntity=new pc.Hashmap,this.componentsByEntityPlusType=new pc.Hashmap,this.entitySuicides=new pc.LinkedList},cleanup:function(){var a=this.entitySuicides.first;while(a){this._doRemoveEntity(a.object()),a=a.next()}this.entitySuicides.clear()},add:function(d,b){this.entities.add(d),b!=undefined&&this.entitiesByTag.add(b,d);var f=d.getAllComponents();if(f!=null){var c=f.values();for(var a=0;a<c.length;a++){this._addToComponentMap(d,c[a])}}this.systemManager._handleEntityAdded(d)},remove:function(a){this.entitySuicides.has(a)||(this.entitySuicides.add(a),a.active=!1)},removeComponent:function(b,a){this._removeFromComponentMap(b,a),this.systemManager._handleComponentRemoved(b,a),b._handleComponentRemoved(a)},addTag:function(b,a){if(b.tags.indexOf(a.toLowerCase())!=-1){return}this.entitiesByTag.add(a.toLowerCase(),b),b.tags.push(a.toLowerCase())},removeTag:function(b,a){this.entitiesByTag.remove(a.toLowerCase(),b),b.tags.remove(a.toLowerCase())},getTagged:function(a){return this.entitiesByTag.get(a.toLowerCase())},activate:function(a){if(a.active){return}this.systemManager._handleEntityAdded(a),a.active=!0},deactivate:function(a){if(!a.active){return}this.systemManager._handleEntityRemoved(a),a.active=!1},_doRemoveEntity:function(d){this.entities.remove(d);var b=d.getAllComponents();if(b!=null){var f=b.values();for(var c=0;c<f.length;c++){this._removeFromComponentMap(d,f[c])}}for(var a=0;a<d.tags.length;a++){this.entitiesByTag.remove(d.tags[a],d)}this.systemManager._handleEntityRemoved(d),d.release()},addComponent:function(b,a){return this._addToComponentMap(b,a),b._handleComponentAdded(a),this.systemManager._handleComponentAdded(b,a),a},getComponent:function(b,a){return this.componentsByEntityPlusType.get(b.objectId+":"+a)},getComponents:function(a){return this.componentsByEntity.get(a.objectId)},hasComponentOfType:function(b,a){return this.componentsByEntityPlusType.containsKey(b.objectId+":"+a)},_addToComponentMap:function(b,a){if(this.componentsByEntityPlusType.get(b.objectId+":"+a.getType())){throw"adding component "+a.getType()+" to entity "+b+" when it already has one of that type"}this.componentsByEntityPlusType.put(b.objectId+":"+a.getType(),a),this.componentsByEntity.put(b.objectId,a)},_removeFromComponentMap:function(b,a){a.onBeforeRemoved(),this.componentsByEntityPlusType.remove(b.objectId+":"+a.getType()),this.componentsByEntity.remove(b.objectId),a.release()}}),pc.SystemManager=pc.Base.extend("pc.SystemManager",{},{systems:null,systemsByComponentType:null,layer:null,init:function(){this.systems=new pc.LinkedList,this.systemsByComponentType=new pc.Hashtable},add:function(f,b){f.layer=this.layer,f.systemManager=this,this.systems.add(f);if(!pc.valid(f.componentTypes)){throw"Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)"}for(var g=0;g<f.componentTypes.length;g++){var d=f.componentTypes[g].toLowerCase(),a=this.systemsByComponentType.get(d);a==null&&(a=new pc.LinkedList,this.systemsByComponentType.put(d,a)),a.has(f)||a.add(f)}var c=b.entities.first;while(c){this._handleEntityAdded(c.object()),c=c.next()}f.onAddedToLayer(this.layer)},remove:function(b){b.onRemovedFromLayer(b.layer),this.systems.remove(b);for(var a=0;a<b.componentTypes;a++){var c=this.systemsByComponentType.get(b.componentTypes[a].toLowerCase());assert(c!=null,"Oops, trying to remove a system and it's not in the by type list"),b.systemManager=null,c.remove(b)}},getByComponentType:function(a){return this.systemsByComponentType.get(a)},onOriginChange:function(b,a){var c=this.systems.first;while(c){c.object().onOriginChange(b,a),c=c.next()}},_handleEntityAdded:function(d){var b=d.getComponentTypes();for(var f=0;f<b.length;f++){var c=this.systemsByComponentType.get(b[f].toLowerCase());if(c){var a=c.first;while(a){a.obj.add(d),a=a.next()}}}},_handleEntityRemoved:function(f){var b=f.getAllComponents();if(b==null){return}var g=b.keys();for(var d=0;d<g.length;d++){var a=this.systemsByComponentType.get(g[d].toLowerCase());if(a){var c=a.first;while(c){c.obj.remove(f),c=c.next()}}}},_handleComponentAdded:function(c,a){var d=this.systemsByComponentType.get(a.getType());if(d==null){return}var b=d.first;while(b){b.obj.add(c),b.obj.onComponentAdded(c,a),b=b.next()}},_handleComponentRemoved:function(c,a){var d=this.systemsByComponentType.get(a.getType());if(d==null){return}var b=d.first;while(b){b.obj.removeIfNotMatched(c),b.obj.onComponentRemoved(c,a),b=b.next()}},processAll:function(){var a=this.systems.first;while(a){if(a.obj.delay==0||pc.device.now-a.obj._lastRun>a.obj.delay){a.obj.processAll(),a.obj.delay!=0&&(a.obj._lastRun=pc.device.now)}a=a.next()}},onResize:function(b,a){var c=this.systems.first;while(c){c.obj.onResize(b,a),c=c.next()}}});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(k){var p="",d,b,g,q,c,m,l,h=0;k=Base64._utf8_encode(k);while(h<k.length){d=k.charCodeAt(h++),b=k.charCodeAt(h++),g=k.charCodeAt(h++),q=d>>2,c=(d&3)<<4|b>>4,m=(b&15)<<2|g>>6,l=g&63,isNaN(b)?m=l=64:isNaN(g)&&(l=64),p=p+this._keyStr.charAt(q)+this._keyStr.charAt(c)+this._keyStr.charAt(m)+this._keyStr.charAt(l)}return p},decode:function(k){var p=[],d,b,g,q,c,m,l,h=0;k=k.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(h<k.length){q=this._keyStr.indexOf(k.charAt(h++)),c=this._keyStr.indexOf(k.charAt(h++)),m=this._keyStr.indexOf(k.charAt(h++)),l=this._keyStr.indexOf(k.charAt(h++)),d=q<<2|c>>4,b=(c&15)<<4|m>>2,g=(m&3)<<6|l,p.push(String.fromCharCode(d)),m!=64&&p.push(String.fromCharCode(b)),l!=64&&p.push(String.fromCharCode(g))}return p.join(""),p},_utf8_encode:function(c){c=c.replace(/\r\n/g,"\n");var a="";for(var d=0;d<c.length;d++){var b=c.charCodeAt(d);b<128?a+=String.fromCharCode(b):b>127&&b<2048?(a+=String.fromCharCode(b>>6|192),a+=String.fromCharCode(b&63|128)):(a+=String.fromCharCode(b>>12|224),a+=String.fromCharCode(b>>6&63|128),a+=String.fromCharCode(b&63|128))}return a},_utf8_decode:function(c){var a="",d=0,b=c1=c2=0;while(d<c.length){b=c.charCodeAt(d),b<128?(a+=String.fromCharCode(b),d++):b>191&&b<224?(c2=c.charCodeAt(d+1),a+=String.fromCharCode((b&31)<<6|c2&63),d+=2):(c2=c.charCodeAt(d+1),c3=c.charCodeAt(d+2),a+=String.fromCharCode((b&15)<<12|(c2&63)<<6|c3&63),d+=3)}return a}};goog={inherits:function(b,a){function c(){}c.prototype=a.prototype,b.superClass_=a.prototype,b.prototype=new c,b.prototype.constructor=b}},goog.debug={},goog.debug.Error=function(a){this.stack=Error().stack||"",a&&(this.message=""+a)},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.string={},goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(b,a){return 0==b.lastIndexOf(a,0)},goog.string.endsWith=function(b,a){var c=b.length-a.length;return 0<=c&&b.indexOf(a,c)==c},goog.string.caseInsensitiveStartsWith=function(b,a){return 0==goog.string.caseInsensitiveCompare(a,b.substr(0,a.length))},goog.string.caseInsensitiveEndsWith=function(b,a){return 0==goog.string.caseInsensitiveCompare(a,b.substr(b.length-a.length,a.length))},goog.string.subs=function(c,a){for(var d=1;d<arguments.length;d++){var b=(""+arguments[d]).replace(/\$/g,"$$$$"),c=c.replace(/\%s/,b)}return c},goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmpty=function(a){return/^[\s\xa0]*$/.test(a)},goog.string.isEmptySafe=function(a){return goog.string.isEmpty(goog.string.makeSafe(a))},goog.string.isBreakingWhitespace=function(a){return !/[^\t\n\r ]/.test(a)},goog.string.isAlpha=function(a){return !/[^a-zA-Z]/.test(a)},goog.string.isNumeric=function(a){return !/[^0-9]/.test(a)},goog.string.isAlphaNumeric=function(a){return !/[^a-zA-Z0-9]/.test(a)},goog.string.isSpace=function(a){return" "==a},goog.string.isUnicodeChar=function(a){return 1==a.length&&" "<=a&&"~">=a||""<=a&&"�">=a},goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(c,a){var d=(""+c).toLowerCase(),b=(""+a).toLowerCase();return d<b?-1:d==b?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(g,c){if(g==c){return 0}if(!g){return -1}if(!c){return 1}for(var k=g.toLowerCase().match(goog.string.numerateCompareRegExp_),f=c.toLowerCase().match(goog.string.numerateCompareRegExp_),b=Math.min(k.length,f.length),d=0;d<b;d++){var h=k[d],a=f[d];if(h!=a){return k=parseInt(h,10),!isNaN(k)&&(f=parseInt(a,10),!isNaN(f)&&k-f)?k-f:h<a?-1:1}}return k.length!=f.length?k.length-f.length:g<c?-1:1},goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/,goog.string.urlEncode=function(a){return a=""+a,goog.string.encodeUriRegExp_.test(a)?a:encodeURIComponent(a)},goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))},goog.string.newLineToBr=function(b,a){return b.replace(/(\r\n|\r|\n)/g,a?"<br />":"<br>")},goog.string.htmlEscape=function(b,a){return a?b.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;"):goog.string.allRe_.test(b)?(-1!=b.indexOf("&")&&(b=b.replace(goog.string.amperRe_,"&amp;")),-1!=b.indexOf("<")&&(b=b.replace(goog.string.ltRe_,"&lt;")),-1!=b.indexOf(">")&&(b=b.replace(goog.string.gtRe_,"&gt;")),-1!=b.indexOf('"')&&(b=b.replace(goog.string.quotRe_,"&quot;")),b):b},goog.string.amperRe_=/&/g,goog.string.ltRe_=/</g,goog.string.gtRe_=/>/g,goog.string.quotRe_=/\"/g,goog.string.allRe_=/[&<>\"]/,goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?"document" in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a},goog.string.unescapeEntitiesUsingDom_=function(b){var a={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},c=document.createElement("div");return b.replace(goog.string.HTML_ENTITY_PATTERN_,function(h,g){var d=a[h];if(d){return d}if("#"==g.charAt(0)){var f=Number("0"+g.substr(1));isNaN(f)||(d=String.fromCharCode(f))}return d||(c.innerHTML=h+" ",d=c.firstChild.nodeValue.slice(0,-1)),a[h]=d})},goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(c,b){switch(b){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==b.charAt(0)){var d=Number("0"+b.substr(1));if(!isNaN(d)){return String.fromCharCode(d)}}return c}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(b,a){return goog.string.newLineToBr(b.replace(/  /g," &#160;"),a)},goog.string.stripQuotes=function(d,b){for(var f=b.length,c=0;c<f;c++){var a=1==f?b:b.charAt(c);if(d.charAt(0)==a&&d.charAt(d.length-1)==a){return d.substring(1,d.length-1)}}return d},goog.string.truncate=function(b,a,c){return c&&(b=goog.string.unescapeEntities(b)),b.length>a&&(b=b.substring(0,a-3)+"..."),c&&(b=goog.string.htmlEscape(b)),b},goog.string.truncateMiddle=function(d,b,f,c){f&&(d=goog.string.unescapeEntities(d));if(c&&d.length>b){c>b&&(c=b);var a=d.length-c,d=d.substring(0,b-c)+"..."+d.substring(a)}else{d.length>b&&(c=Math.floor(b/2),a=d.length-c,d=d.substring(0,c+b%2)+"..."+d.substring(a))}return f&&(d=goog.string.htmlEscape(d)),d},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(d){d=""+d;if(d.quote){return d.quote()}for(var b=['"'],f=0;f<d.length;f++){var c=d.charAt(f),a=c.charCodeAt(0);b[f+1]=goog.string.specialEscapeChars_[c]||(31<a&&127>a?c:goog.string.escapeChar(c))}return b.push('"'),b.join("")},goog.string.escapeString=function(b){for(var a=[],c=0;c<b.length;c++){a[c]=goog.string.escapeChar(b.charAt(c))}return a.join("")},goog.string.escapeChar=function(b){if(b in goog.string.jsEscapeCache_){return goog.string.jsEscapeCache_[b]}if(b in goog.string.specialEscapeChars_){return goog.string.jsEscapeCache_[b]=goog.string.specialEscapeChars_[b]}var a=b,c=b.charCodeAt(0);if(31<c&&127>c){a=b}else{if(256>c){if(a="\\x",16>c||256<c){a+="0"}}else{a="\\u",4096>c&&(a+="0")}a+=c.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[b]=a},goog.string.toMap=function(b){for(var a={},c=0;c<b.length;c++){a[b.charAt(c)]=!0}return a},goog.string.contains=function(b,a){return -1!=b.indexOf(a)},goog.string.removeAt=function(c,a,d){var b=c;return 0<=a&&a<c.length&&0<d&&(b=c.substr(0,a)+c.substr(a+d,c.length-a-d)),b},goog.string.remove=function(b,a){var c=RegExp(goog.string.regExpEscape(a),"");return b.replace(c,"")},goog.string.removeAll=function(b,a){var c=RegExp(goog.string.regExpEscape(a),"g");return b.replace(c,"")},goog.string.regExpEscape=function(a){return(""+a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(b,a){return Array(a+1).join(b)},goog.string.padNumber=function(b,a,c){return b=goog.isDef(c)?b.toFixed(c):""+b,c=b.indexOf("."),-1==c&&(c=b.length),goog.string.repeat("0",Math.max(0,a-c))+b},goog.string.makeSafe=function(a){return null==a?"":""+a},goog.string.buildString=function(a){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=function(x,B){for(var k=0,b=goog.string.trim(""+x).split("."),q=goog.string.trim(""+B).split("."),C=Math.max(b.length,q.length),g=0;0==k&&g<C;g++){var A=b[g]||"",z=q[g]||"",w=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var y=w.exec(A)||["","",""],v=m.exec(z)||["","",""];if(0==y[0].length&&0==v[0].length){break}var k=0==y[1].length?0:parseInt(y[1],10),d=0==v[1].length?0:parseInt(v[1],10),k=goog.string.compareElements_(k,d)||goog.string.compareElements_(0==y[2].length,0==v[2].length)||goog.string.compareElements_(y[2],v[2])}while(0==k)}return k},goog.string.compareElements_=function(b,a){return b<a?-1:b>a?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(b){for(var a=0,c=0;c<b.length;++c){a=31*a+b.charCodeAt(c),a%=goog.string.HASHCODE_MAX_}return a},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(b){var a=Number(b);return 0==a&&goog.string.isEmpty(b)?NaN:a},goog.string.toCamelCaseCache_={},goog.string.toCamelCase=function(a){return goog.string.toCamelCaseCache_[a]||(goog.string.toCamelCaseCache_[a]=(""+a).replace(/\-([a-z])/g,function(c,b){return b.toUpperCase()}))},goog.string.toSelectorCaseCache_={},goog.string.toSelectorCase=function(a){return goog.string.toSelectorCaseCache_[a]||(goog.string.toSelectorCaseCache_[a]=(""+a).replace(/([A-Z])/g,"-$1").toLowerCase())},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=!0,goog.array.peek=function(a){return a[a.length-1]},goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(b,a,c){return goog.array.ARRAY_PROTOTYPE_.indexOf.call(b,a,c)}:function(b,a,c){c=null==c?0:0>c?Math.max(0,b.length+c):c;if(goog.isString(b)){return !goog.isString(a)||1!=a.length?-1:b.indexOf(a,c)}for(;c<b.length;c++){if(c in b&&b[c]===a){return c}}return -1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(b,a,c){return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(b,a,null==c?b.length-1:c)}:function(b,a,c){c=null==c?b.length-1:c,0>c&&(c=Math.max(0,b.length+c));if(goog.isString(b)){return !goog.isString(a)||1!=a.length?-1:b.lastIndexOf(a,c)}for(;0<=c;c--){if(c in b&&b[c]===a){return c}}return -1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(b,a,c){goog.array.ARRAY_PROTOTYPE_.forEach.call(b,a,c)}:function(f,b,g){for(var d=f.length,a=goog.isString(f)?f.split(""):f,c=0;c<d;c++){c in a&&b.call(g,a[c],c,f)}},goog.array.forEachRight=function(d,b,f){for(var c=d.length,a=goog.isString(d)?d.split(""):d,c=c-1;0<=c;--c){c in a&&b.call(f,a[c],c,d)}},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(b,a,c){return goog.array.ARRAY_PROTOTYPE_.filter.call(b,a,c)}:function(g,l,d){for(var b=g.length,f=[],m=0,c=goog.isString(g)?g.split(""):g,k=0;k<b;k++){if(k in c){var h=c[k];l.call(d,h,k,g)&&(f[m++]=h)}}return f},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(b,a,c){return goog.array.ARRAY_PROTOTYPE_.map.call(b,a,c)}:function(f,b,h){for(var d=f.length,a=Array(d),c=goog.isString(f)?f.split(""):f,g=0;g<d;g++){g in c&&(a[g]=b.call(h,c[g],g,f))}return a},goog.array.reduce=function(d,b,f,c){if(d.reduce){return c?d.reduce(goog.bind(b,c),f):d.reduce(b,f)}var a=f;return goog.array.forEach(d,function(g,e){a=b.call(c,a,g,e,d)}),a},goog.array.reduceRight=function(d,b,f,c){if(d.reduceRight){return c?d.reduceRight(goog.bind(b,c),f):d.reduceRight(b,f)}var a=f;return goog.array.forEachRight(d,function(g,e){a=b.call(c,a,g,e,d)}),a},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(b,a,c){return goog.array.ARRAY_PROTOTYPE_.some.call(b,a,c)}:function(f,b,g){for(var d=f.length,a=goog.isString(f)?f.split(""):f,c=0;c<d;c++){if(c in a&&b.call(g,a[c],c,f)){return !0}}return !1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(b,a,c){return goog.array.ARRAY_PROTOTYPE_.every.call(b,a,c)}:function(f,b,g){for(var d=f.length,a=goog.isString(f)?f.split(""):f,c=0;c<d;c++){if(c in a&&!b.call(g,a[c],c,f)){return !1}}return !0},goog.array.find=function(b,a,c){return a=goog.array.findIndex(b,a,c),0>a?null:goog.isString(b)?b.charAt(a):b[a]},goog.array.findIndex=function(f,b,g){for(var d=f.length,a=goog.isString(f)?f.split(""):f,c=0;c<d;c++){if(c in a&&b.call(g,a[c],c,f)){return c}}return -1},goog.array.findRight=function(b,a,c){return a=goog.array.findIndexRight(b,a,c),0>a?null:goog.isString(b)?b.charAt(a):b[a]},goog.array.findIndexRight=function(d,b,f){for(var c=d.length,a=goog.isString(d)?d.split(""):d,c=c-1;0<=c;c--){if(c in a&&b.call(f,a[c],c,d)){return c}}return -1},goog.array.contains=function(b,a){return 0<=goog.array.indexOf(b,a)},goog.array.isEmpty=function(a){return 0==a.length},goog.array.clear=function(b){if(!goog.isArray(b)){for(var a=b.length-1;0<=a;a--){delete b[a]}}b.length=0},goog.array.insert=function(b,a){goog.array.contains(b,a)||b.push(a)},goog.array.insertAt=function(b,a,c){goog.array.splice(b,c,0,a)},goog.array.insertArrayAt=function(b,a,c){goog.partial(goog.array.splice,b,c,0).apply(null,a)},goog.array.insertBefore=function(c,a,d){var b;2==arguments.length||0>(b=goog.array.indexOf(c,d))?c.push(a):goog.array.insertAt(c,a,b)},goog.array.remove=function(c,a){var d=goog.array.indexOf(c,a),b;return(b=0<=d)&&goog.array.removeAt(c,d),b},goog.array.removeAt=function(b,a){return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(b,a,1).length},goog.array.removeIf=function(b,a,c){return a=goog.array.findIndex(b,a,c),0<=a?(goog.array.removeAt(b,a),!0):!1},goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.clone=function(c){if(goog.isArray(c)){return goog.array.concat(c)}for(var a=[],d=0,b=c.length;d<b;d++){a[d]=c[d]}return a},goog.array.toArray=function(a){return goog.isArray(a)?goog.array.concat(a):goog.array.clone(a)},goog.array.extend=function(g,c){for(var k=1;k<arguments.length;k++){var f=arguments[k],b;if(goog.isArray(f)||(b=goog.isArrayLike(f))&&f.hasOwnProperty("callee")){g.push.apply(g,f)}else{if(b){for(var d=g.length,h=f.length,a=0;a<h;a++){g[d+a]=f[a]}}else{g.push(f)}}}},goog.array.splice=function(c,a,d,b){return goog.array.ARRAY_PROTOTYPE_.splice.apply(c,goog.array.slice(arguments,1))},goog.array.slice=function(b,a,c){return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(b,a):goog.array.ARRAY_PROTOTYPE_.slice.call(b,a,c)},goog.array.removeDuplicates=function(g,c){for(var k=c||g,f={},b=0,d=0;d<g.length;){var h=g[d++],a=goog.isObject(h)?"o"+goog.getUid(h):(typeof h).charAt(0)+h;Object.prototype.hasOwnProperty.call(f,a)||(f[a]=!0,k[b++]=h)}k.length=b},goog.array.binarySearch=function(b,a,c){return goog.array.binarySearch_(b,c||goog.array.defaultCompare,!1,a)},goog.array.binarySelect=function(b,a,c){return goog.array.binarySearch_(b,a,!0,void 0,c)},goog.array.binarySearch_=function(k,p,d,b,g){for(var q=0,c=k.length,m;q<c;){var l=q+c>>1,h;h=d?p.call(g,k[l],l,k):p(b,k[l]),0<h?q=l+1:(c=l,m=!h)}return m?q:~q},goog.array.sort=function(b,a){goog.array.ARRAY_PROTOTYPE_.sort.call(b,a||goog.array.defaultCompare)},goog.array.stableSort=function(c,a){for(var d=0;d<c.length;d++){c[d]={index:d,value:c[d]}}var b=a||goog.array.defaultCompare;goog.array.sort(c,function(g,f){return b(g.value,f.value)||g.index-f.index});for(d=0;d<c.length;d++){c[d]=c[d].value}},goog.array.sortObjectsByKey=function(c,a,d){var b=d||goog.array.defaultCompare;goog.array.sort(c,function(f,g){return b(f[a],g[a])})},goog.array.isSorted=function(d,b,f){for(var b=b||goog.array.defaultCompare,c=1;c<d.length;c++){var a=b(d[c-1],d[c]);if(0<a||0==a&&f){return !1}}return !0},goog.array.equals=function(d,b,f){if(!goog.isArrayLike(d)||!goog.isArrayLike(b)||d.length!=b.length){return !1}for(var c=d.length,f=f||goog.array.defaultCompareEquality,a=0;a<c;a++){if(!f(d[a],b[a])){return !1}}return !0},goog.array.compare=function(b,a,c){return goog.array.equals(b,a,c)},goog.array.compare3=function(f,b,g){for(var g=g||goog.array.defaultCompare,d=Math.min(f.length,b.length),a=0;a<d;a++){var c=g(f[a],b[a]);if(0!=c){return c}}return goog.array.defaultCompare(f.length,b.length)},goog.array.defaultCompare=function(b,a){return b>a?1:b<a?-1:0},goog.array.defaultCompareEquality=function(b,a){return b===a},goog.array.binaryInsert=function(b,a,c){return c=goog.array.binarySearch(b,a,c),0>c?(goog.array.insertAt(b,a,-(c+1)),!0):!1},goog.array.binaryRemove=function(b,a,c){return a=goog.array.binarySearch(b,a,c),0<=a?goog.array.removeAt(b,a):!1},goog.array.bucket=function(f,b){for(var g={},d=0;d<f.length;d++){var a=f[d],c=b(a,d,f);goog.isDef(c)&&(g[c]||(g[c]=[])).push(a)}return g},goog.array.repeat=function(c,a){for(var d=[],b=0;b<a;b++){d[b]=c}return d},goog.array.flatten=function(c){for(var a=[],d=0;d<arguments.length;d++){var b=arguments[d];goog.isArray(b)?a.push.apply(a,goog.array.flatten.apply(null,b)):a.push(b)}return a},goog.array.rotate=function(b,a){return b.length&&(a%=b.length,0<a?goog.array.ARRAY_PROTOTYPE_.unshift.apply(b,b.splice(-a,a)):0>a&&goog.array.ARRAY_PROTOTYPE_.push.apply(b,b.splice(0,-a))),b},goog.array.zip=function(f){if(!arguments.length){return[]}for(var b=[],g=0;;g++){for(var d=[],a=0;a<arguments.length;a++){var c=arguments[a];if(g>=c.length){return b}d.push(c[g])}b.push(d)}},goog.array.shuffle=function(f,b){for(var g=b||Math.random,d=f.length-1;0<d;d--){var a=Math.floor(g()*(d+1)),c=f[d];f[d]=f[a],f[a]=c}},goog.structs={},goog.structs.Queue=function(){this.elements_=[]},goog.structs.Queue.prototype.head_=0,goog.structs.Queue.prototype.tail_=0,goog.structs.Queue.prototype.enqueue=function(a){this.elements_[this.tail_++]=a},goog.structs.Queue.prototype.dequeue=function(){if(this.head_!=this.tail_){var a=this.elements_[this.head_];return delete this.elements_[this.head_],this.head_++,a}},goog.structs.Queue.prototype.peek=function(){return this.head_==this.tail_?void 0:this.elements_[this.head_]},goog.structs.Queue.prototype.getCount=function(){return this.tail_-this.head_},goog.structs.Queue.prototype.isEmpty=function(){return 0==this.tail_-this.head_},goog.structs.Queue.prototype.clear=function(){this.tail_=this.head_=this.elements_.length=0},goog.structs.Queue.prototype.contains=function(a){return goog.array.contains(this.elements_,a)},goog.structs.Queue.prototype.remove=function(a){return a=goog.array.indexOf(this.elements_,a),0>a?!1:(a==this.head_?this.dequeue():(goog.array.removeAt(this.elements_,a),this.tail_--),!0)},goog.structs.Queue.prototype.getValues=function(){return this.elements_.slice(this.head_,this.tail_)};var Box2D={Common:{}};Box2D.Common.Math={},Box2D.Common.Math.b2Vec2=function(b,a){this.x=b,this.y=a},Box2D.Common.Math.b2Vec2._freeCache=[],Box2D.Common.Math.b2Vec2.Get=function(b,a){if(0<Box2D.Common.Math.b2Vec2._freeCache.length){var c=Box2D.Common.Math.b2Vec2._freeCache.pop();return c.Set(b,a),c}return new Box2D.Common.Math.b2Vec2(b,a)},Box2D.Common.Math.b2Vec2.Free=function(a){null!=a&&Box2D.Common.Math.b2Vec2._freeCache.push(a)},Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.y=this.x=0},Box2D.Common.Math.b2Vec2.prototype.Set=function(b,a){this.x=b,this.y=a},Box2D.Common.Math.b2Vec2.prototype.SetV=function(a){this.x=a.x,this.y=a.y},Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)},Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)},Box2D.Common.Math.b2Vec2.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},Box2D.Common.Math.b2Vec2.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},Box2D.Common.Math.b2Vec2.prototype.Multiply=function(a){this.x*=a,this.y*=a},Box2D.Common.Math.b2Vec2.prototype.MulM=function(b){var a=this.x;this.x=b.col1.x*a+b.col2.x*this.y,this.y=b.col1.y*a+b.col2.y*this.y},Box2D.Common.Math.b2Vec2.prototype.MulTM=function(b){var a=this.x*b.col1.x+this.y*b.col1.y;this.y=this.x*b.col2.x+this.y*b.col2.y,this.x=a},Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(b){var a=this.x;this.x=b*this.y,this.y=-b*a},Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(b){var a=this.x;this.x=-b*this.y,this.y=b*a},Box2D.Common.Math.b2Vec2.prototype.MinV=function(a){this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y)},Box2D.Common.Math.b2Vec2.prototype.MaxV=function(a){this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y)},Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())},Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var b=this.Length();if(b<Number.MIN_VALUE){return 0}var a=1/b;return this.x*=a,this.y*=a,b},Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},Box2D.Common.b2Settings={},Box2D.Common.b2Settings.b2MixFriction=function(b,a){return Math.sqrt(b*a)},Box2D.Common.b2Settings.b2MixRestitution=function(b,a){return b>a?b:a},Box2D.Common.b2Settings.b2Assert=function(a){if(!a){throw"Assertion Failed"}},Box2D.Common.b2Settings.VERSION="2.1a-playcraft",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=0.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=0.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI,Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=0.5*Math.PI,Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=0.2,Box2D.Common.b2Settings.b2_timeToSleep=0.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=0.01,Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI,Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance,Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0),this.col2=Box2D.Common.Math.b2Vec2.Get(0,0),this.SetIdentity()},Box2D.Common.Math.b2Mat22._freeCache=[],Box2D.Common.Math.b2Mat22.Get=function(){if(0<Box2D.Common.Math.b2Mat22._freeCache.length){var a=Box2D.Common.Math.b2Mat22._freeCache.pop();return a.SetZero(),a}return new Box2D.Common.Math.b2Mat22},Box2D.Common.Math.b2Mat22.Free=function(a){null!=a&&Box2D.Common.Math.b2Mat22._freeCache.push(a)},Box2D.Common.Math.b2Mat22.FromAngle=function(b){var a=Box2D.Common.Math.b2Mat22.Get();return a.Set(b),a},Box2D.Common.Math.b2Mat22.FromVV=function(b,a){var c=Box2D.Common.Math.b2Mat22.Get();return c.SetVV(b,a),c},Box2D.Common.Math.b2Mat22.prototype.Set=function(b){var a=Math.cos(b),b=Math.sin(b);this.col1.Set(a,b),this.col2.Set(-b,a)},Box2D.Common.Math.b2Mat22.prototype.SetVV=function(b,a){this.col1.SetV(b),this.col2.SetV(a)},Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var a=Box2D.Common.Math.b2Mat22.Get();return a.SetM(this),a},Box2D.Common.Math.b2Mat22.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},Box2D.Common.Math.b2Mat22.prototype.AddM=function(a){this.col1.Add(a.col1),this.col2.Add(a.col2)},Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0),this.col2.Set(0,1)},Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0),this.col2.Set(0,0)},Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(b){var a=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==a&&(a=1/a),b.col1.x=a*this.col2.y,b.col2.x=-a*this.col2.x,b.col1.y=-a*this.col1.y,b.col2.y=a*this.col1.x,b},Box2D.Common.Math.b2Mat22.prototype.Solve=function(c,a,d){var b=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==b&&(b=1/b),c.x=b*(this.col2.y*a-this.col2.x*d),c.y=b*(this.col1.x*d-this.col1.y*a),c},Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},Box2D.Common.Math.b2Math={},Box2D.Common.Math.b2Math.Dot=function(b,a){return b.x*a.x+b.y*a.y},Box2D.Common.Math.b2Math.CrossVV=function(b,a){return b.x*a.y-b.y*a.x},Box2D.Common.Math.b2Math.CrossVF=function(b,a){return Box2D.Common.Math.b2Vec2.Get(a*b.y,-a*b.x)},Box2D.Common.Math.b2Math.CrossFV=function(b,a){return Box2D.Common.Math.b2Vec2.Get(-b*a.y,b*a.x)},Box2D.Common.Math.b2Math.MulMV=function(b,a){return Box2D.Common.Math.b2Vec2.Get(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y)},Box2D.Common.Math.b2Math.MulTMV=function(b,a){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(a,b.col1),Box2D.Common.Math.b2Math.Dot(a,b.col2))},Box2D.Common.Math.b2Math.MulX=function(b,a){var c=Box2D.Common.Math.b2Math.MulMV(b.R,a);return c.x+=b.position.x,c.y+=b.position.y,c},Box2D.Common.Math.b2Math.MulXT=function(c,a){var d=Box2D.Common.Math.b2Math.SubtractVV(a,c.position),b=d.x*c.R.col1.x+d.y*c.R.col1.y;return d.y=d.x*c.R.col2.x+d.y*c.R.col2.y,d.x=b,d},Box2D.Common.Math.b2Math.AddVV=function(b,a){return Box2D.Common.Math.b2Vec2.Get(b.x+a.x,b.y+a.y)},Box2D.Common.Math.b2Math.SubtractVV=function(b,a){return Box2D.Common.Math.b2Vec2.Get(b.x-a.x,b.y-a.y)},Box2D.Common.Math.b2Math.Distance=function(b,a){return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(b,a))},Box2D.Common.Math.b2Math.DistanceSquared=function(c,a){var d=c.x-a.x,b=c.y-a.y;return d*d+b*b},Box2D.Common.Math.b2Math.MulFV=function(b,a){return Box2D.Common.Math.b2Vec2.Get(b*a.x,b*a.y)},Box2D.Common.Math.b2Math.AddMM=function(d,b){var f=Box2D.Common.Math.b2Math.AddVV(d.col1,b.col1),c=Box2D.Common.Math.b2Math.AddVV(d.col2,b.col2),a=Box2D.Common.Math.b2Mat22.FromVV(f,c);return Box2D.Common.Math.b2Vec2.Free(f),Box2D.Common.Math.b2Vec2.Free(c),a},Box2D.Common.Math.b2Math.MulMM=function(d,b){var f=Box2D.Common.Math.b2Math.MulMV(d,b.col1),c=Box2D.Common.Math.b2Math.MulMV(d,b.col2),a=Box2D.Common.Math.b2Mat22.FromVV(f,c);return Box2D.Common.Math.b2Vec2.Free(f),Box2D.Common.Math.b2Vec2.Free(c),a},Box2D.Common.Math.b2Math.MulTMM=function(d,b){var f=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(d.col1,b.col1),Box2D.Common.Math.b2Math.Dot(d.col2,b.col1)),c=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(d.col1,b.col2),Box2D.Common.Math.b2Math.Dot(d.col2,b.col2)),a=Box2D.Common.Math.b2Mat22.FromVV(f,c);return Box2D.Common.Math.b2Vec2.Free(f),Box2D.Common.Math.b2Vec2.Free(c),a},Box2D.Common.Math.b2Math.AbsV=function(a){return Box2D.Common.Math.b2Vec2.Get(Math.abs(a.x),Math.abs(a.y))},Box2D.Common.Math.b2Math.AbsM=function(b){var a=Box2D.Common.Math.b2Math.AbsV(b.col1),b=Box2D.Common.Math.b2Math.AbsV(b.col2),c=Box2D.Common.Math.b2Mat22.FromVV(a,b);return Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(b),c},Box2D.Common.Math.b2Math.Clamp=function(b,a,c){return b<a?a:b>c?c:b},Box2D.Common.Math.b2Math.ClampV=function(c,a,d){var b=Box2D.Common.Math.b2Math.Clamp(c.x,a.x,d.x),c=Box2D.Common.Math.b2Math.Clamp(c.y,a.y,d.y);return Box2D.Common.Math.b2Vec2.Get(b,c)},Box2D.Dynamics={},Box2D.Dynamics.Joints={},Box2D.Dynamics.Joints.b2JointEdge=function(){},Box2D.Dynamics.Joints.b2Joint=function(a){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge,this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge,this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Common.b2Settings.b2Assert(a.bodyA!=a.bodyB),this.m_type=a.type,this.m_next=this.m_prev=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected},Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Box2D.Dynamics.Joints.b2Joint.Create=function(a){return a.Create()},Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(){return !1},Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3,Box2D.Dynamics.Joints.b2LineJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat22,this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var c=this.m_bodyA,a=this.m_bodyB,d=c.GetWorldPoint(this.m_localAnchor1),b=a.GetWorldPoint(this.m_localAnchor2),a=b.x-d.x,d=b.y-d.y,c=c.GetWorldVector(this.m_localXAxis1);return c.x*a+c.y*d},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var m=this.m_bodyA,v=this.m_bodyB,d;d=m.m_xf.R;var b=this.m_localAnchor1.x-m.m_sweep.localCenter.x,h=this.m_localAnchor1.y-m.m_sweep.localCenter.y,w=d.col1.x*b+d.col2.x*h,h=d.col1.y*b+d.col2.y*h,b=w;d=v.m_xf.R;var c=this.m_localAnchor2.x-v.m_sweep.localCenter.x,q=this.m_localAnchor2.y-v.m_sweep.localCenter.y,w=d.col1.x*c+d.col2.x*q,q=d.col1.y*c+d.col2.y*q,c=w;d=v.m_sweep.c.x+c-(m.m_sweep.c.x+b);var w=v.m_sweep.c.y+q-(m.m_sweep.c.y+h),p=m.GetWorldVector(this.m_localXAxis1),k=m.m_linearVelocity,g=v.m_linearVelocity,m=m.m_angularVelocity,v=v.m_angularVelocity;return d*-m*p.y+w*m*p.x+(p.x*(g.x+-v*q-k.x- -m*h)+p.y*(g.y+v*c-k.y-m*b))},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(b,a){void 0===b&&(b=0),void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=b,this.m_upperTranslation=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(k){var p=this.m_bodyA,d=this.m_bodyB,b,g=0;this.m_localCenterA.SetV(p.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());var q=p.GetTransform();d.GetTransform(),b=p.m_xf.R;var c=this.m_localAnchor1.x-this.m_localCenterA.x,m=this.m_localAnchor1.y-this.m_localCenterA.y,g=b.col1.x*c+b.col2.x*m,m=b.col1.y*c+b.col2.y*m,c=g;b=d.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y,g=b.col1.x*l+b.col2.x*h,h=b.col1.y*l+b.col2.y*h,l=g;b=d.m_sweep.c.x+l-p.m_sweep.c.x-c,g=d.m_sweep.c.y+h-p.m_sweep.c.y-m,this.m_invMassA=p.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=p.m_invI,this.m_invIB=d.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(q.R,this.m_localXAxis1)),this.m_a1=(b+c)*this.m_axis.y-(g+m)*this.m_axis.x,this.m_a2=l*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(q.R,this.m_localYAxis1)),this.m_s1=(b+c)*this.m_perp.y-(g+m)*this.m_perp.x,this.m_s2=l*this.m_perp.y-h*this.m_perp.x,q=this.m_invMassA,c=this.m_invMassB,m=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=q+c+m*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=m*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=q+c+m*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*b+this.m_axis.y*g,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):b>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),k.warmStarting?(this.m_impulse.x*=k.dtRatio,this.m_impulse.y*=k.dtRatio,this.m_motorImpulse*=k.dtRatio,k=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,g=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,q=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,p.m_linearVelocity.x-=this.m_invMassA*k,p.m_linearVelocity.y-=this.m_invMassA*b,p.m_angularVelocity-=this.m_invIA*g,d.m_linearVelocity.x+=this.m_invMassB*k,d.m_linearVelocity.y+=this.m_invMassB*b,d.m_angularVelocity+=this.m_invIB*q):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(m){var v=this.m_bodyA,d=this.m_bodyB,b=v.m_linearVelocity,h=v.m_angularVelocity,w=d.m_linearVelocity,c=d.m_angularVelocity,q=0,p=0,k=0,g=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(g=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(w.x-b.x)+this.m_axis.y*(w.y-b.y)+this.m_a2*c-this.m_a1*h)),q=this.m_motorImpulse,m=m.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+g,-m,m),g=this.m_motorImpulse-q,q=g*this.m_axis.x,p=g*this.m_axis.y,k=g*this.m_a1,g*=this.m_a2,b.x-=this.m_invMassA*q,b.y-=this.m_invMassA*p,h-=this.m_invIA*k,w.x+=this.m_invMassB*q,w.y+=this.m_invMassB*p,c+=this.m_invIB*g),p=this.m_perp.x*(w.x-b.x)+this.m_perp.y*(w.y-b.y)+this.m_s2*c-this.m_s1*h,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(m=this.m_axis.x*(w.x-b.x)+this.m_axis.y*(w.y-b.y)+this.m_a2*c-this.m_a1*h,q=this.m_impulse.Copy(),k=Box2D.Common.Math.b2Vec2.Get(0,0),m=this.m_K.Solve(k,-p,-m),Box2D.Common.Math.b2Vec2.Free(k),this.m_impulse.Add(m),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0)),p=-p-(this.m_impulse.y-q.y)*this.m_K.col2.x,k=0,k=0!=this.m_K.col1.x?p/this.m_K.col1.x+q.x:q.x,this.m_impulse.x=k,m.x=this.m_impulse.x-q.x,m.y=this.m_impulse.y-q.y,Box2D.Common.Math.b2Vec2.Free(q),q=m.x*this.m_perp.x+m.y*this.m_axis.x,p=m.x*this.m_perp.y+m.y*this.m_axis.y,k=m.x*this.m_s1+m.y*this.m_a1,g=m.x*this.m_s2+m.y*this.m_a2):(m=0,m=0!=this.m_K.col1.x?-p/this.m_K.col1.x:0,this.m_impulse.x+=m,q=m*this.m_perp.x,p=m*this.m_perp.y,k=m*this.m_s1,g=m*this.m_s2),b.x-=this.m_invMassA*q,b.y-=this.m_invMassA*p,h-=this.m_invIA*k,w.x+=this.m_invMassB*q,w.y+=this.m_invMassB*p,c+=this.m_invIB*g,v.m_linearVelocity.SetV(b),v.m_angularVelocity=h,d.m_linearVelocity.SetV(w),d.m_angularVelocity=c},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(){var B=this.m_bodyA,H=this.m_bodyB,q=B.m_sweep.c,b=B.m_sweep.a,y=H.m_sweep.c,I=H.m_sweep.a,k,G=0,E=0,A=0,x=0,D=k=0,z=0,E=!1,g=0,C=Box2D.Common.Math.b2Mat22.FromAngle(b),A=Box2D.Common.Math.b2Mat22.FromAngle(I);k=C;var z=this.m_localAnchor1.x-this.m_localCenterA.x,F=this.m_localAnchor1.y-this.m_localCenterA.y,G=k.col1.x*z+k.col2.x*F,F=k.col1.y*z+k.col2.y*F,z=G;k=A,A=this.m_localAnchor2.x-this.m_localCenterB.x,x=this.m_localAnchor2.y-this.m_localCenterB.y,G=k.col1.x*A+k.col2.x*x,x=k.col1.y*A+k.col2.y*x,A=G,k=y.x+A-q.x-z,G=y.y+x-q.y-F;if(this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(C,this.m_localXAxis1),this.m_a1=(k+z)*this.m_axis.y-(G+F)*this.m_axis.x,this.m_a2=A*this.m_axis.y-x*this.m_axis.x;var w=this.m_axis.x*k+this.m_axis.y*G;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(g=Box2D.Common.Math.b2Math.Clamp(w,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),D=Math.abs(w),E=!0):w<=this.m_lowerTranslation?(g=Box2D.Common.Math.b2Math.Clamp(w-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),D=this.m_lowerTranslation-w,E=!0):w>=this.m_upperTranslation&&(g=Box2D.Common.Math.b2Math.Clamp(w-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),D=w-this.m_upperTranslation,E=!0)}return this.m_perp=Box2D.Common.Math.b2Math.MulMV(C,this.m_localYAxis1),this.m_s1=(k+z)*this.m_perp.y-(G+F)*this.m_perp.x,this.m_s2=A*this.m_perp.y-x*this.m_perp.x,C=Box2D.Common.Math.b2Vec2.Get(0,0),F=this.m_perp.x*k+this.m_perp.y*G,D=Math.max(D,Math.abs(F)),z=0,E?(E=this.m_invMassA,A=this.m_invMassB,x=this.m_invIA,k=this.m_invIB,this.m_K.col1.x=E+A+x*this.m_s1*this.m_s1+k*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1*this.m_a1+k*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=E+A+x*this.m_a1*this.m_a1+k*this.m_a2*this.m_a2,this.m_K.Solve(C,-F,-g)):(E=this.m_invMassA,A=this.m_invMassB,x=this.m_invIA,k=this.m_invIB,g=E+A+x*this.m_s1*this.m_s1+k*this.m_s2*this.m_s2,C.x=0!=g?-F/g:0,C.y=0),g=C.x*this.m_perp.x+C.y*this.m_axis.x,E=C.x*this.m_perp.y+C.y*this.m_axis.y,F=C.x*this.m_s1+C.y*this.m_a1,C=C.x*this.m_s2+C.y*this.m_a2,q.x-=this.m_invMassA*g,q.y-=this.m_invMassA*E,b-=this.m_invIA*F,y.x+=this.m_invMassB*g,y.y+=this.m_invMassB*E,I+=this.m_invIB*C,B.m_sweep.a=b,H.m_sweep.a=I,B.SynchronizeTransform(),H.SynchronizeTransform(),D<=Box2D.Common.b2Settings.b2_linearSlop&&z<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint,this.bodyB=this.bodyA=null,this.collideConnected=!1},Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(c,a,d,b){this.bodyA=c,this.bodyB=a,this.localAnchorA=this.bodyA.GetLocalPoint(d),this.localAnchorB=this.bodyB.GetLocalPoint(d),this.localAxisA=this.bodyA.GetLocalVector(b)},Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)},Box2D.Collision={},Box2D.Collision.b2DistanceProxy=function(){this.m_radius=this.m_count=0,this.m_vertices=[]},Box2D.Collision.b2DistanceProxy.prototype.SetValues=function(b,a,c){this.m_count=b,this.m_radius=a,this.m_vertices=c},Box2D.Collision.b2DistanceProxy.prototype.Set=function(a){a.SetDistanceProxy(this)},Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(d){for(var b=0,f=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,c=1;c<this.m_count;c++){var a=this.m_vertices[c].x*d.x+this.m_vertices[c].y*d.y;a>f&&(b=c,f=a)}return b},Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(a){return this.m_vertices[this.GetSupport(a)]},Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(a){return void 0===a&&(a=0),Box2D.Common.b2Settings.b2Assert(0<=a&&a<this.m_count),this.m_vertices[a]},Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0),this.c0=Box2D.Common.Math.b2Vec2.Get(0,0),this.c=Box2D.Common.Math.b2Vec2.Get(0,0),this.t0=this.a=this.a0=null},Box2D.Common.Math.b2Sweep.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var a=new Box2D.Common.Math.b2Sweep;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(b,a){void 0===a&&(a=0),b.position.x=(1-a)*this.c0.x+a*this.c.x,b.position.y=(1-a)*this.c0.y+a*this.c.y,b.R.Set((1-a)*this.a0+a*this.a);var c=b.R;b.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y,b.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y},Box2D.Common.Math.b2Sweep.prototype.Advance=function(b){void 0===b&&(b=0);if(this.t0<b&&1-this.t0>Number.MIN_VALUE){var a=(b-this.t0)/(1-this.t0);this.c0.x=(1-a)*this.c0.x+a*this.c.x,this.c0.y=(1-a)*this.c0.y+a*this.c.y,this.a0=(1-a)*this.a0+a*this.a,this.t0=b}},Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy,this.proxyB=new Box2D.Collision.b2DistanceProxy,this.sweepA=new Box2D.Common.Math.b2Sweep,this.sweepB=new Box2D.Common.Math.b2Sweep},Box2D.Common.Math.b2Vec3=function(b,a,c){this.x=b,this.y=a,this.z=c},Box2D.Common.Math.b2Vec3._freeCache=[],Box2D.Common.Math.b2Vec3.Get=function(c,a,d){if(0<Box2D.Common.Math.b2Vec3._freeCache.length){var b=Box2D.Common.Math.b2Vec3._freeCache.pop();return b.Set(c,a,d),b}return new Box2D.Common.Math.b2Vec3(c,a,d)},Box2D.Common.Math.b2Vec3.Free=function(a){null!=a&&Box2D.Common.Math.b2Vec3._freeCache.push(a)},Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.z=this.y=this.x=0},Box2D.Common.Math.b2Vec3.prototype.Set=function(b,a,c){this.x=b,this.y=a,this.z=c},Box2D.Common.Math.b2Vec3.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec3.Get(-this.x,-this.y,-this.z)},Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return Box2D.Common.Math.b2Vec3.Get(this.x,this.y,this.z)},Box2D.Common.Math.b2Vec3.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},Box2D.Common.Math.b2Vec3.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},Box2D.Common.Math.b2Vec3.prototype.Multiply=function(a){this.x*=a,this.y*=a,this.z*=a},Box2D.Common.Math.b2Mat33=function(b,a,c){this.col1=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col2=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col3=Box2D.Common.Math.b2Vec3.Get(0,0,0),b&&this.col1.SetV(b),a&&this.col2.SetV(a),c&&this.col3.SetV(c)},Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(b,a,c){this.col1.SetV(b),this.col2.SetV(a),this.col3.SetV(c)},Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)},Box2D.Common.Math.b2Mat33.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},Box2D.Common.Math.b2Mat33.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0),this.col2.Set(0,1,0),this.col3.Set(0,0,1)},Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0),this.col2.Set(0,0,0),this.col3.Set(0,0,0)},Box2D.Common.Math.b2Mat33.prototype.Solve22=function(g,c,k){var f=this.col1.x,b=this.col2.x,d=this.col1.y,h=this.col2.y,a=f*h-b*d;return 0!=a&&(a=1/a),g.x=a*(h*c-b*k),g.y=a*(f*k-d*c),g},Box2D.Common.Math.b2Mat33.prototype.Solve33=function(x,B,k,b){var q=this.col1.x,C=this.col1.y,g=this.col1.z,A=this.col2.x,z=this.col2.y,w=this.col2.z,m=this.col3.x,y=this.col3.y,v=this.col3.z,d=q*(z*v-w*y)+C*(w*m-A*v)+g*(A*y-z*m);return 0!=d&&(d=1/d),x.x=d*(B*(z*v-w*y)+k*(w*m-A*v)+b*(A*y-z*m)),x.y=d*(q*(k*v-b*y)+C*(b*m-B*v)+g*(B*y-k*m)),x.z=d*(q*(z*b-w*k)+C*(w*B-A*b)+g*(A*k-z*B)),x},Box2D.Dynamics.Joints.b2PrismaticJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat33,this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var d=this.m_bodyA,b=this.m_bodyB,f=d.GetWorldPoint(this.m_localAnchor1),c=b.GetWorldPoint(this.m_localAnchor2),b=c.x-f.x,a=c.y-f.y;return Box2D.Common.Math.b2Vec2.Free(f),Box2D.Common.Math.b2Vec2.Free(c),d=d.GetWorldVector(this.m_localXAxis1),f=d.x*b+d.y*a,Box2D.Common.Math.b2Vec2.Free(d),f},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var m=this.m_bodyA,v=this.m_bodyB,d;d=m.m_xf.R;var b=this.m_localAnchor1.x-m.m_sweep.localCenter.x,h=this.m_localAnchor1.y-m.m_sweep.localCenter.y,w=d.col1.x*b+d.col2.x*h,h=d.col1.y*b+d.col2.y*h,b=w;d=v.m_xf.R;var c=this.m_localAnchor2.x-v.m_sweep.localCenter.x,q=this.m_localAnchor2.y-v.m_sweep.localCenter.y,w=d.col1.x*c+d.col2.x*q,q=d.col1.y*c+d.col2.y*q,c=w,w=v.m_sweep.c.x+c-(m.m_sweep.c.x+b),p=v.m_sweep.c.y+q-(m.m_sweep.c.y+h);d=m.GetWorldVector(this.m_localXAxis1);var k=m.m_linearVelocity,g=v.m_linearVelocity,m=m.m_angularVelocity,v=v.m_angularVelocity,b=w*-m*d.y+p*m*d.x+(d.x*(g.x+-v*q-k.x- -m*h)+d.y*(g.y+v*c-k.y-m*b));return Box2D.Common.Math.b2Vec2.Free(d),b},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(b,a){void 0===b&&(b=0),void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=b,this.m_upperTranslation=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(m){var v=this.m_bodyA,d=this.m_bodyB,b,h=0;this.m_localCenterA.SetV(v.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());var w=v.GetTransform();b=v.m_xf.R;var c=this.m_localAnchor1.x-this.m_localCenterA.x,q=this.m_localAnchor1.y-this.m_localCenterA.y,h=b.col1.x*c+b.col2.x*q,q=b.col1.y*c+b.col2.y*q,c=h;b=d.m_xf.R;var p=this.m_localAnchor2.x-this.m_localCenterB.x,k=this.m_localAnchor2.y-this.m_localCenterB.y,h=b.col1.x*p+b.col2.x*k,k=b.col1.y*p+b.col2.y*k,p=h;b=d.m_sweep.c.x+p-v.m_sweep.c.x-c,h=d.m_sweep.c.y+k-v.m_sweep.c.y-q,this.m_invMassA=v.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=v.m_invI,this.m_invIB=d.m_invI;var g=Box2D.Common.Math.b2Math.MulMV(w.R,this.m_localXAxis1);this.m_axis.SetV(g),Box2D.Common.Math.b2Vec2.Free(g),this.m_a1=(b+c)*this.m_axis.y-(h+q)*this.m_axis.x,this.m_a2=p*this.m_axis.y-k*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),w=Box2D.Common.Math.b2Math.MulMV(w.R,this.m_localYAxis1),this.m_perp.SetV(w),Box2D.Common.Math.b2Vec2.Free(w),this.m_s1=(b+c)*this.m_perp.y-(h+q)*this.m_perp.x,this.m_s2=p*this.m_perp.y-k*this.m_perp.x,c=this.m_invMassA,q=this.m_invMassB,p=this.m_invIA,k=this.m_invIB,this.m_K.col1.x=c+q+p*this.m_s1*this.m_s1+k*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1+k*this.m_s2,this.m_K.col1.z=p*this.m_s1*this.m_a1+k*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+k,this.m_K.col2.z=p*this.m_a1+k*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=c+q+p*this.m_a1*this.m_a1+k*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*b+this.m_axis.y*h,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),m.warmStarting?(this.m_impulse.x*=m.dtRatio,this.m_impulse.y*=m.dtRatio,this.m_motorImpulse*=m.dtRatio,m=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,h=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,c=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,v.m_linearVelocity.x-=this.m_invMassA*m,v.m_linearVelocity.y-=this.m_invMassA*b,v.m_angularVelocity-=this.m_invIA*h,d.m_linearVelocity.x+=this.m_invMassB*m,d.m_linearVelocity.y+=this.m_invMassB*b,d.m_angularVelocity+=this.m_invIB*c):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(m){var v=this.m_bodyA,d=this.m_bodyB,b=v.m_linearVelocity,h=v.m_angularVelocity,w=d.m_linearVelocity,c=d.m_angularVelocity,q=0,p=0,k=0,g=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(g=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(w.x-b.x)+this.m_axis.y*(w.y-b.y)+this.m_a2*c-this.m_a1*h)),q=this.m_motorImpulse,m=m.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+g,-m,m),g=this.m_motorImpulse-q,q=g*this.m_axis.x,p=g*this.m_axis.y,k=g*this.m_a1,g*=this.m_a2,b.x-=this.m_invMassA*q,b.y-=this.m_invMassA*p,h-=this.m_invIA*k,w.x+=this.m_invMassB*q,w.y+=this.m_invMassB*p,c+=this.m_invIB*g),k=this.m_perp.x*(w.x-b.x)+this.m_perp.y*(w.y-b.y)+this.m_s2*c-this.m_s1*h,p=c-h,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(g=this.m_axis.x*(w.x-b.x)+this.m_axis.y*(w.y-b.y)+this.m_a2*c-this.m_a1*h,q=this.m_impulse.Copy(),m=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_K.Solve33(m,-k,-p,-g),this.m_impulse.Add(m),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0)),k=-k-(this.m_impulse.z-q.z)*this.m_K.col3.x,p=-p-(this.m_impulse.z-q.z)*this.m_K.col3.y,g=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(g,k,p),g.x+=q.x,g.y+=q.y,this.m_impulse.x=g.x,this.m_impulse.y=g.y,Box2D.Common.Math.b2Vec2.Free(g),m.x=this.m_impulse.x-q.x,m.y=this.m_impulse.y-q.y,m.z=this.m_impulse.z-q.z,q=m.x*this.m_perp.x+m.z*this.m_axis.x,p=m.x*this.m_perp.y+m.z*this.m_axis.y,k=m.x*this.m_s1+m.y+m.z*this.m_a1,g=m.x*this.m_s2+m.y+m.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(m)):(m=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(m,-k,-p),this.m_impulse.x+=m.x,this.m_impulse.y+=m.y,q=m.x*this.m_perp.x,p=m.x*this.m_perp.y,k=m.x*this.m_s1+m.y,g=m.x*this.m_s2+m.y,Box2D.Common.Math.b2Vec2.Free(m)),b.x-=this.m_invMassA*q,b.y-=this.m_invMassA*p,h-=this.m_invIA*k,w.x+=this.m_invMassB*q,w.y+=this.m_invMassB*p,c+=this.m_invIB*g,v.m_linearVelocity.SetV(b),v.m_angularVelocity=h,d.m_linearVelocity.SetV(w),d.m_angularVelocity=c},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var B=this.m_bodyA,H=this.m_bodyB,q=B.m_sweep.c,b=B.m_sweep.a,y=H.m_sweep.c,I=H.m_sweep.a,k=0,G=0,E=0,A=k=0,x=0,D=0,G=!1,z=0,g=Box2D.Common.Math.b2Mat22.FromAngle(b),D=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y,k=g.col1.x*D+g.col2.x*C,C=g.col1.y*D+g.col2.y*C;Box2D.Common.Math.b2Mat22.Free(g);var D=k,A=Box2D.Common.Math.b2Mat22.FromAngle(I),F=this.m_localAnchor2.x-this.m_localCenterB.x,E=this.m_localAnchor2.y-this.m_localCenterB.y,k=A.col1.x*F+A.col2.x*E,E=A.col1.y*F+A.col2.y*E;Box2D.Common.Math.b2Mat22.Free(A),F=k,k=y.x+F-q.x-D,A=y.y+E-q.y-C;if(this.m_enableLimit){Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.MulMV(g,this.m_localXAxis1),this.m_a1=(k+D)*this.m_axis.y-(A+C)*this.m_axis.x,this.m_a2=F*this.m_axis.y-E*this.m_axis.x;var w=this.m_axis.x*k+this.m_axis.y*A;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(z=Box2D.Common.Math.b2Math.Clamp(w,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),x=Math.abs(w),G=!0):w<=this.m_lowerTranslation?(z=Box2D.Common.Math.b2Math.Clamp(w-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),x=this.m_lowerTranslation-w,G=!0):w>=this.m_upperTranslation&&(z=Box2D.Common.Math.b2Math.Clamp(w-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),x=w-this.m_upperTranslation,G=!0)}return Box2D.Common.Math.b2Vec2.Free(this.m_perp),this.m_perp=Box2D.Common.Math.b2Math.MulMV(g,this.m_localYAxis1),this.m_s1=(k+D)*this.m_perp.y-(A+C)*this.m_perp.x,this.m_s2=F*this.m_perp.y-E*this.m_perp.x,g=Box2D.Common.Math.b2Vec3.Get(0,0,0),C=this.m_perp.x*k+this.m_perp.y*A,F=I-b-this.m_refAngle,x=Math.max(x,Math.abs(C)),D=Math.abs(F),G?(G=this.m_invMassA,E=this.m_invMassB,k=this.m_invIA,A=this.m_invIB,this.m_K.col1.x=G+E+k*this.m_s1*this.m_s1+A*this.m_s2*this.m_s2,this.m_K.col1.y=k*this.m_s1+A*this.m_s2,this.m_K.col1.z=k*this.m_s1*this.m_a1+A*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=k+A,this.m_K.col2.z=k*this.m_a1+A*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=G+E+k*this.m_a1*this.m_a1+A*this.m_a2*this.m_a2,this.m_K.Solve33(g,-C,-F,-z)):(G=this.m_invMassA,E=this.m_invMassB,k=this.m_invIA,A=this.m_invIB,z=k*this.m_s1+A*this.m_s2,w=k+A,this.m_K.col1.Set(G+E+k*this.m_s1*this.m_s1+A*this.m_s2*this.m_s2,z,0),this.m_K.col2.Set(z,w,0),z=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(z,-C,-F),g.x=z.x,g.y=z.y,Box2D.Common.Math.b2Vec2.Free(z),g.z=0),z=g.x*this.m_perp.x+g.z*this.m_axis.x,G=g.x*this.m_perp.y+g.z*this.m_axis.y,C=g.x*this.m_s1+g.y+g.z*this.m_a1,F=g.x*this.m_s2+g.y+g.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(g),q.x-=this.m_invMassA*z,q.y-=this.m_invMassA*G,b-=this.m_invIA*C,y.x+=this.m_invMassB*z,y.y+=this.m_invMassB*G,I+=this.m_invIB*F,B.m_sweep.a=b,H.m_sweep.a=I,B.SynchronizeTransform(),H.SynchronizeTransform(),x<=Box2D.Common.b2Settings.b2_linearSlop&&D<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(c,a,d,b){this.bodyA=c,this.bodyB=a,this.localAnchorA=this.bodyA.GetLocalPoint(d),this.localAnchorB=this.bodyB.GetLocalPoint(d),this.localAxisA=this.bodyA.GetLocalVector(b),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)},Box2D.Dynamics.Joints.b2WeldJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle},goog.inherits(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(a){return Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse.x,a*this.m_impulse.y)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(m){var v,d=0,b=this.m_bodyA,h=this.m_bodyB;v=b.m_xf.R;var w=this.m_localAnchorA.x-b.m_sweep.localCenter.x,c=this.m_localAnchorA.y-b.m_sweep.localCenter.y,d=v.col1.x*w+v.col2.x*c,c=v.col1.y*w+v.col2.y*c,w=d;v=h.m_xf.R;var q=this.m_localAnchorB.x-h.m_sweep.localCenter.x,p=this.m_localAnchorB.y-h.m_sweep.localCenter.y,d=v.col1.x*q+v.col2.x*p,p=v.col1.y*q+v.col2.y*p,q=d;v=b.m_invMass;var d=h.m_invMass,k=b.m_invI,g=h.m_invI;this.m_mass.col1.x=v+d+c*c*k+p*p*g,this.m_mass.col2.x=-c*w*k-p*q*g,this.m_mass.col3.x=-c*k-p*g,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=v+d+w*w*k+q*q*g,this.m_mass.col3.y=w*k+q*g,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=k+g,m.warmStarting?(this.m_impulse.x*=m.dtRatio,this.m_impulse.y*=m.dtRatio,this.m_impulse.z*=m.dtRatio,b.m_linearVelocity.x-=v*this.m_impulse.x,b.m_linearVelocity.y-=v*this.m_impulse.y,b.m_angularVelocity-=k*(w*this.m_impulse.y-c*this.m_impulse.x+this.m_impulse.z),h.m_linearVelocity.x+=d*this.m_impulse.x,h.m_linearVelocity.y+=d*this.m_impulse.y,h.m_angularVelocity+=g*(q*this.m_impulse.y-p*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(){var H,q=0,A=this.m_bodyA,x=this.m_bodyB,D=A.m_linearVelocity,w=A.m_angularVelocity,z=x.m_linearVelocity,k=x.m_angularVelocity,K=A.m_invMass,G=x.m_invMass,C=A.m_invI,J=x.m_invI;H=A.m_xf.R;var E=this.m_localAnchorA.x-A.m_sweep.localCenter.x,y=this.m_localAnchorA.y-A.m_sweep.localCenter.y,q=H.col1.x*E+H.col2.x*y,y=H.col1.y*E+H.col2.y*y,E=q;H=x.m_xf.R;var I=this.m_localAnchorB.x-x.m_sweep.localCenter.x,b=this.m_localAnchorB.y-x.m_sweep.localCenter.y,q=H.col1.x*I+H.col2.x*b,b=H.col1.y*I+H.col2.y*b,I=q;H=z.x-k*b-D.x+w*y;var q=z.y+k*I-D.y-w*E,B=k-w,F=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass.Solve33(F,-H,-q,-B),this.m_impulse.Add(F),D.x-=K*F.x,D.y-=K*F.y,w-=C*(E*F.y-y*F.x+F.z),z.x+=G*F.x,z.y+=G*F.y,k+=J*(I*F.y-b*F.x+F.z),Box2D.Common.Math.b2Vec3.Free(F),A.m_angularVelocity=w,x.m_angularVelocity=k},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(){var z,F=0,m=this.m_bodyA,b=this.m_bodyB;z=m.m_xf.R;var w=this.m_localAnchorA.x-m.m_sweep.localCenter.x,G=this.m_localAnchorA.y-m.m_sweep.localCenter.y,F=z.col1.x*w+z.col2.x*G,G=z.col1.y*w+z.col2.y*G,w=F;z=b.m_xf.R;var k=this.m_localAnchorB.x-b.m_sweep.localCenter.x,E=this.m_localAnchorB.y-b.m_sweep.localCenter.y,F=z.col1.x*k+z.col2.x*E,E=z.col1.y*k+z.col2.y*E,k=F;z=m.m_invMass;var F=b.m_invMass,C=m.m_invI,y=b.m_invI,q=b.m_sweep.c.x+k-m.m_sweep.c.x-w,B=b.m_sweep.c.y+E-m.m_sweep.c.y-G,x=b.m_sweep.a-m.m_sweep.a-this.m_referenceAngle,g=10*Box2D.Common.b2Settings.b2_linearSlop,A=Math.sqrt(q*q+B*B),D=Math.abs(x);return A>g&&(C*=1,y*=1),this.m_mass.col1.x=z+F+G*G*C+E*E*y,this.m_mass.col2.x=-G*w*C-E*k*y,this.m_mass.col3.x=-G*C-E*y,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=z+F+w*w*C+k*k*y,this.m_mass.col3.y=w*C+k*y,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=C+y,g=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass.Solve33(g,-q,-B,-x),m.m_sweep.c.x-=z*g.x,m.m_sweep.c.y-=z*g.y,m.m_sweep.a-=C*(w*g.y-G*g.x+g.z),b.m_sweep.c.x+=F*g.x,b.m_sweep.c.y+=F*g.y,b.m_sweep.a+=y*(k*g.y-E*g.x+g.z),Box2D.Common.Math.b2Vec3.Free(g),m.SynchronizeTransform(),b.SynchronizeTransform(),A<=Box2D.Common.b2Settings.b2_linearSlop&&D<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint,this.referenceAngle=0},goog.inherits(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(b,a,c){this.bodyA=b,this.bodyB=a,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)},Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0),this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0),this.distance=0},Box2D.Collision.b2SimplexVertex=function(){this.wA=Box2D.Common.Math.b2Vec2.Get(0,0),this.wB=Box2D.Common.Math.b2Vec2.Get(0,0),this.w=Box2D.Common.Math.b2Vec2.Get(0,0),this.indexB=this.indexA=this.a=0},Box2D.Collision.b2SimplexVertex.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex,this.m_v2=new Box2D.Collision.b2SimplexVertex,this.m_v3=new Box2D.Collision.b2SimplexVertex,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Box2D.Collision.b2Simplex._freeCache=[],Box2D.Collision.b2Simplex.Get=function(){if(0<Box2D.Collision.b2Simplex._freeCache.length){for(var b=Box2D.Collision.b2Simplex._freeCache.pop(),a=0;a<b.m_vertices.length;a++){var c=b.m_vertices[a];null!=c.wA&&c.wA.Set(0,0),null!=c.wB&&c.wB.Set(0,0),null!=c.w&&c.w.Set(0,0),c.indexA=0,c.indexB=0,c.a=0}return b}return new Box2D.Collision.b2Simplex},Box2D.Collision.b2Simplex.Free=function(a){null!=a&&Box2D.Collision.b2Simplex._freeCache.push(a)},Box2D.Collision.b2Simplex.prototype.ReadCache=function(k,p,d,b,g){Box2D.Common.b2Settings.b2Assert(0<=k.count&&3>=k.count);var q,c;this.m_count=k.count;for(var m=this.m_vertices,l=0;l<this.m_count;l++){var h=m[l];h.indexA=k.indexA[l],h.indexB=k.indexB[l],q=p.GetVertex(h.indexA),c=b.GetVertex(h.indexB),Box2D.Common.Math.b2Vec2.Free(h.wA),Box2D.Common.Math.b2Vec2.Free(h.wB),Box2D.Common.Math.b2Vec2.Free(h.w),h.wA=Box2D.Common.Math.b2Math.MulX(d,q),h.wB=Box2D.Common.Math.b2Math.MulX(g,c),h.w=Box2D.Common.Math.b2Math.SubtractVV(h.wB,h.wA),h.a=0}1<this.m_count&&(k=k.metric,q=this.GetMetric(),q<0.5*k||2*k<q||q<Number.MIN_VALUE)&&(this.m_count=0),0==this.m_count&&(h=m[0],h.indexA=0,h.indexB=0,q=p.GetVertex(0),c=b.GetVertex(0),Box2D.Common.Math.b2Vec2.Free(h.wA),Box2D.Common.Math.b2Vec2.Free(h.wB),Box2D.Common.Math.b2Vec2.Free(h.w),h.wA=Box2D.Common.Math.b2Math.MulX(d,q),h.wB=Box2D.Common.Math.b2Math.MulX(g,c),h.w=Box2D.Common.Math.b2Math.SubtractVV(h.wB,h.wA),this.m_count=1)},Box2D.Collision.b2Simplex.prototype.WriteCache=function(b){b.metric=this.GetMetric(),b.count=this.m_count;for(var a=this.m_vertices,c=0;c<this.m_count;c++){b.indexA[c]=a[c].indexA,b.indexB[c]=a[c].indexB}},Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count){return this.m_v1.w.GetNegative()}if(2==this.m_count){var b=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),a=this.m_v1.w.GetNegative(),c=Box2D.Common.Math.b2Math.CrossVV(b,a);return Box2D.Common.Math.b2Vec2.Free(a),a=null,a=0<c?Box2D.Common.Math.b2Math.CrossFV(1,b):Box2D.Common.Math.b2Math.CrossVF(b,1),Box2D.Common.Math.b2Vec2.Free(b),a}return Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){return 1==this.m_count?this.m_v1.w:2==this.m_count?Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):(Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0))},Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(b,a){1==this.m_count?(b.SetV(this.m_v1.wA),a.SetV(this.m_v1.wB)):2==this.m_count?(b.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,b.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,a.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,a.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count?(a.x=b.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,a.y=b.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y):Box2D.Common.b2Settings.b2Assert(!1)},Box2D.Collision.b2Simplex.prototype.GetMetric=function(){if(1==this.m_count){return 0}if(2==this.m_count){var b=Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w),a=b.Length();return Box2D.Common.Math.b2Vec2.Free(b),a}if(3==this.m_count){var b=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),c=Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w),a=Box2D.Common.Math.b2Math.CrossVV(b,c);return Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c),a}return Box2D.Common.b2Settings.b2Assert(!1),0},Box2D.Collision.b2Simplex.prototype.Solve2=function(){var b=this.m_v1.w,a=this.m_v2.w,c=Box2D.Common.Math.b2Math.SubtractVV(a,b),b=-(b.x*c.x+b.y*c.y);0>=b?(Box2D.Common.Math.b2Vec2.Free(c),this.m_count=this.m_v1.a=1):(a=a.x*c.x+a.y*c.y,Box2D.Common.Math.b2Vec2.Free(c),0>=a?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(c=1/(a+b),this.m_v1.a=a*c,this.m_v2.a=b*c,this.m_count=2))},Box2D.Collision.b2Simplex.prototype.Solve3=function(){var m=this.m_v1.w,v=this.m_v2.w,d=this.m_v3.w,b=Box2D.Common.Math.b2Math.SubtractVV(v,m),h=Box2D.Common.Math.b2Math.Dot(m,b),w=Box2D.Common.Math.b2Math.Dot(v,b),h=-h,c=Box2D.Common.Math.b2Math.SubtractVV(d,m),q=Box2D.Common.Math.b2Math.Dot(m,c),p=Box2D.Common.Math.b2Math.Dot(d,c),k=Box2D.Common.Math.b2Math.CrossVV(b,c);Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c);var b=-q,q=Box2D.Common.Math.b2Math.SubtractVV(d,v),g=Box2D.Common.Math.b2Math.Dot(v,q),c=Box2D.Common.Math.b2Math.Dot(d,q);Box2D.Common.Math.b2Vec2.Free(q),q=-g,g=k*Box2D.Common.Math.b2Math.CrossVV(v,d),d=k*Box2D.Common.Math.b2Math.CrossVV(d,m),m=k*Box2D.Common.Math.b2Math.CrossVV(m,v),0>=h&&0>=b?this.m_count=this.m_v1.a=1:0<w&&0<h&&0>=m?(p=1/(w+h),this.m_v1.a=w*p,this.m_v2.a=h*p,this.m_count=2):0<p&&0<b&&0>=d?(w=1/(p+b),this.m_v1.a=p*w,this.m_v3.a=b*w,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=w&&0>=q?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=p&&0>=c?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<c&&0<q&&0>=g?(w=1/(c+q),this.m_v2.a=c*w,this.m_v3.a=q*w,this.m_count=2,this.m_v1.Set(this.m_v3)):(w=1/(g+d+m),this.m_v1.a=g*w,this.m_v2.a=d*w,this.m_v3.a=m*w,this.m_count=3)},Box2D.Collision.b2Distance={},Box2D.Collision.b2Distance.Distance=function(g,l,d){var b=Box2D.Collision.b2Simplex.Get();b.ReadCache(l,d.proxyA,d.transformA,d.proxyB,d.transformB),(1>b.m_count||3<b.m_count)&&Box2D.Common.b2Settings.b2Assert(!1);for(var f=0;20>f;){for(var m=[],c=0;c<b.m_count;c++){m[c]={},m[c].indexA=b.m_vertices[c].indexA,m[c].indexB=b.m_vertices[c].indexB}2==b.m_count?b.Solve2():3==b.m_count&&b.Solve3();if(3==b.m_count){break}c=b.GetSearchDirection();if(c.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED){Box2D.Common.Math.b2Vec2.Free(c);break}Box2D.Common.Math.b2Vec2.Free(b.m_vertices[b.m_count].wA),Box2D.Common.Math.b2Vec2.Free(b.m_vertices[b.m_count].wB),Box2D.Common.Math.b2Vec2.Free(b.m_vertices[b.m_count].w);var k=c.GetNegative(),h=Box2D.Common.Math.b2Math.MulTMV(d.transformA.R,k);Box2D.Common.Math.b2Vec2.Free(k),b.m_vertices[b.m_count].indexA=d.proxyA.GetSupport(h),Box2D.Common.Math.b2Vec2.Free(h),b.m_vertices[b.m_count].wA=Box2D.Common.Math.b2Math.MulX(d.transformA,d.proxyA.GetVertex(b.m_vertices[b.m_count].indexA)),k=Box2D.Common.Math.b2Math.MulTMV(d.transformB.R,c),Box2D.Common.Math.b2Vec2.Free(c),b.m_vertices[b.m_count].indexB=d.proxyB.GetSupport(k),Box2D.Common.Math.b2Vec2.Free(k),b.m_vertices[b.m_count].wB=Box2D.Common.Math.b2Math.MulX(d.transformB,d.proxyB.GetVertex(b.m_vertices[b.m_count].indexB)),b.m_vertices[b.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(b.m_vertices[b.m_count].wB,b.m_vertices[b.m_count].wA),f++,k=!1;for(c=0;c<m.length;c++){if(b.m_vertices[b.m_count].indexA==m[c].indexA&&b.m_vertices[b.m_count].indexB==m[c].indexB){k=!0;break}}if(k){break}b.m_count++}b.GetWitnessPoints(g.pointA,g.pointB),f=Box2D.Common.Math.b2Math.SubtractVV(g.pointA,g.pointB),g.distance=f.Length(),Box2D.Common.Math.b2Vec2.Free(f),b.WriteCache(l),Box2D.Collision.b2Simplex.Free(b),d.useRadii&&(l=d.proxyA.m_radius,d=d.proxyB.m_radius,g.distance>l+d&&g.distance>Number.MIN_VALUE?(g.distance-=l+d,b=Box2D.Common.Math.b2Math.SubtractVV(g.pointB,g.pointA),b.Normalize(),g.pointA.x+=l*b.x,g.pointA.y+=l*b.y,g.pointB.x-=d*b.x,g.pointB.y-=d*b.y,Box2D.Common.Math.b2Vec2.Free(b)):(d=Box2D.Common.Math.b2Vec2.Get(0,0),d.x=0.5*(g.pointA.x+g.pointB.x),d.y=0.5*(g.pointA.y+g.pointB.y),g.pointA.x=g.pointB.x=d.x,g.pointA.y=g.pointB.y=d.y,g.distance=0,Box2D.Common.Math.b2Vec2.Free(d)))},Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Box2D.Collision.b2DistanceInput=function(){this.useRadii=!1,this.transformB=this.transformA=this.proxyB=this.proxyA=null},Box2D.Collision.Shapes={},Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop},Box2D.Collision.Shapes.b2Shape.prototype.Set=function(a){this.m_radius=a.m_radius},Box2D.Collision.Shapes.b2Shape.TestOverlap=function(d,b,f,c){var a=new Box2D.Collision.b2DistanceInput;return a.proxyA=new Box2D.Collision.b2DistanceProxy,a.proxyA.Set(d),a.proxyB=new Box2D.Collision.b2DistanceProxy,a.proxyB.Set(f),a.transformA=b,a.transformB=c,a.useRadii=!0,d=new Box2D.Collision.b2SimplexCache,d.count=0,b=new Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2Distance.Distance(b,d,a),Box2D.Common.Math.b2Vec2.Free(b.pointA),Box2D.Common.Math.b2Vec2.Free(b.pointB),b.distance<10*Number.MIN_VALUE},Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2CircleShape=function(a){Box2D.Collision.Shapes.b2Shape.call(this),this.m_radius=a,this.m_radiusSquared=a*a,this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[this.m_p]},goog.inherits(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME},Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var a=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);return a.Set(this),a},Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(a){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,a),a instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(a.m_p)},Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(c,a){var d=a.x-(c.position.x+(c.R.col1.x*this.m_p.x+c.R.col2.x*this.m_p.y)),b=a.y-(c.position.y+(c.R.col1.y*this.m_p.x+c.R.col2.y*this.m_p.y));return d*d+b*b<=this.m_radiusSquared},Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(g,l,d){var b=d.R,f=l.p1.x-(d.position.x+(b.col1.x*this.m_p.x+b.col2.x*this.m_p.y)),d=l.p1.y-(d.position.y+(b.col1.y*this.m_p.x+b.col2.y*this.m_p.y)),b=l.p2.x-l.p1.x,m=l.p2.y-l.p1.y,c=f*b+d*m,k=b*b+m*m,h=c*c-k*(f*f+d*d-this.m_radiusSquared);return 0>h||k<Number.MIN_VALUE?!1:(c=-(c+Math.sqrt(h)),0<=c&&c<=l.maxFraction*k?(c/=k,g.fraction=c,g.normal.x=f+c*b,g.normal.y=d+c*m,g.normal.Normalize(),!0):!1)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(c,a){var d=a.R,b=a.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),d=a.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y);c.lowerBound.Set(b-this.m_radius,d-this.m_radius),c.upperBound.Set(b+this.m_radius,d+this.m_radius)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(b,a){var c=a*Math.PI*this.m_radiusSquared;b.SetV(c,this.m_p,c*(0.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y)))},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(d,b,f,c){var f=Box2D.Common.Math.b2Math.MulX(f,this.m_p),a=-(Box2D.Common.Math.b2Math.Dot(d,f)-b);return a<-this.m_radius+Number.MIN_VALUE?(Box2D.Common.Math.b2Vec2.Free(f),0):a>this.m_radius?(Box2D.Common.Math.b2Vec2.Free(f),c.SetV(f),Math.PI*this.m_radiusSquared):(b=a*a,a=this.m_radiusSquared*(Math.asin(a/this.m_radius)+Math.PI/2)+a*Math.sqrt(this.m_radiusSquared-b),b=-2/3*Math.pow(this.m_radiusSquared-b,1.5)/a,c.x=f.x+d.x*b,c.y=f.y+d.y*b,Box2D.Common.Math.b2Vec2.Free(f),a)},Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(a){a.SetValues(1,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(a){this.m_radius=a,this.m_radiusSquared=a*a},Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape",Box2D.Consts={},Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Collision.b2AABB=function(){this.lowerBound=Box2D.Common.Math.b2Vec2.Get(0,0),this.upperBound=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2AABB._freeCache=[],Box2D.Collision.b2AABB.Get=function(){if(0<Box2D.Collision.b2AABB._freeCache.length){var a=Box2D.Collision.b2AABB._freeCache.pop();return a.SetZero(),a}return new Box2D.Collision.b2AABB},Box2D.Collision.b2AABB.Free=function(a){null!=a&&Box2D.Collision.b2AABB._freeCache.push(a)},Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound.Set(0,0),this.upperBound.Set(0,0)},Box2D.Collision.b2AABB.prototype.IsValid=function(){return 0>this.upperBound.x-this.lowerBound.x||0>this.upperBound.y-this.lowerBound.y?!1:this.lowerBound.IsValid()&&this.upperBound.IsValid()},Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},Box2D.Collision.b2AABB.prototype.SetCenter=function(b){var a=this.GetCenter();this.lowerBound.Subtract(a),this.upperBound.Subtract(a),this.lowerBound.Add(b),this.upperBound.Add(b),Box2D.Common.Math.b2Vec2.Free(a)},Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},Box2D.Collision.b2AABB.prototype.Contains=function(b){var a;return a=(a=(a=(a=this.lowerBound.x<=b.lowerBound.x)&&this.lowerBound.y<=b.lowerBound.y)&&b.upperBound.x<=this.upperBound.x)&&b.upperBound.y<=this.upperBound.y},Box2D.Collision.b2AABB.prototype.RayCast=function(f,b){var h=-Number.MAX_VALUE,d=Number.MAX_VALUE,a=b.p2.x-b.p1.x;if(Math.abs(a)<Number.MIN_VALUE){if(b.p1.x<this.lowerBound.x||this.upperBound.x<b.p1.x){return !1}}else{var c=1/a,a=(this.lowerBound.x-b.p1.x)*c,c=(this.upperBound.x-b.p1.x)*c,g=-1;a>c&&(g=a,a=c,c=g,g=1),a>h&&(f.normal.x=g,f.normal.y=0,h=a),d=Math.min(d,c);if(h>d){return !1}}a=b.p2.y-b.p1.y;if(Math.abs(a)<Number.MIN_VALUE){if(b.p1.y<this.lowerBound.y||this.upperBound.y<b.p1.y){return !1}}else{if(c=1/a,a=(this.lowerBound.y-b.p1.y)*c,c*=this.upperBound.y-b.p1.y,g=-1,a>c&&(g=a,a=c,c=g,g=1),a>h&&(f.normal.y=g,f.normal.x=0,h=a),d=Math.min(d,c),h>d){return !1}}return f.fraction=h,!0},Box2D.Collision.b2AABB.prototype.TestOverlap=function(a){return 0<a.lowerBound.x-this.upperBound.x||0<a.lowerBound.y-this.upperBound.y||0<this.lowerBound.x-a.upperBound.x||0<this.lowerBound.y-a.upperBound.y?!1:!0},Box2D.Collision.b2AABB.Combine=function(b,a){var c=Box2D.Collision.b2AABB.Get();return c.Combine(b,a),c},Box2D.Collision.b2AABB.prototype.Combine=function(b,a){this.lowerBound.x=Math.min(b.lowerBound.x,a.lowerBound.x),this.lowerBound.y=Math.min(b.lowerBound.y,a.lowerBound.y),this.upperBound.x=Math.max(b.upperBound.x,a.upperBound.x),this.upperBound.y=Math.max(b.upperBound.y,a.upperBound.y)},Box2D.Dynamics.b2FixtureListNode=function(a){this.fixture=a,this.previous=this.next=null},Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Collision.b2ContactID=function(){this._incidentVertex=this._incidentEdge=this._referenceEdge=this._key=0},Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key},Box2D.Collision.b2ContactID.prototype.SetKey=function(a){this._key=a,this._referenceEdge=this._key&255,this._incidentEdge=(this._key&65280)>>8&255,this._incidentVertex=(this._key&16711680)>>16&255,this._flip=(this._key&4278190080)>>24&255},Box2D.Collision.b2ContactID.prototype.Set=function(a){this.SetKey(a._key)},Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(a){this._referenceEdge=a,this._key=this._key&4294967040|this._referenceEdge&255},Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(a){this._incidentEdge=a,this._key=this._key&4294902015|this._incidentEdge<<8&65280},Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(a){this._incidentVertex=a,this._key=this._key&4278255615|this._incidentVertex<<16&16711680},Box2D.Collision.b2ContactID.prototype.SetFlip=function(a){this._flip=a,this._key=this._key&16777215|this._flip<<24&4278190080},Box2D.Collision.b2ContactID.prototype.Copy=function(){var a=new Box2D.Collision.b2ContactID;return a.Set(this),a},Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_id=new Box2D.Collision.b2ContactID,this.m_tangentImpulse=this.m_normalImpulse=0},Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.SetKey(0)},Box2D.Collision.b2ManifoldPoint.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},Box2D.Collision.b2DynamicTreeNode=function(a){this.aabb=Box2D.Collision.b2AABB.Get(),this.parent=this.child2=this.child1=null,this.fixture=a},Box2D.Collision.b2DynamicTreeNode._freeCache=[],Box2D.Collision.b2DynamicTreeNode.Get=function(b){"undefined"==typeof b&&(b=null);if(0<Box2D.Collision.b2DynamicTreeNode._freeCache.length){var a=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();return a.fixture=b,a.aabb.SetZero(),a}return new Box2D.Collision.b2DynamicTreeNode(b)},Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.fixture=this.parent=this.child2=this.child1=null,Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)},Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1},Box2D.Collision.b2RayCastInput=function(b,a,c){this.p1=Box2D.Common.Math.b2Vec2.Get(b.x,b.y),this.p2=Box2D.Common.Math.b2Vec2.Get(a.x,a.y),this.maxFraction=c},Box2D.Collision.b2DynamicTree=function(){this.m_root=null,this.m_insertionCount=this.m_path=0},Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(d,b){var f=Box2D.Collision.b2DynamicTreeNode.Get(b),c=Box2D.Common.b2Settings.b2_aabbExtension,a=Box2D.Common.b2Settings.b2_aabbExtension;return f.aabb.lowerBound.x=d.lowerBound.x-c,f.aabb.lowerBound.y=d.lowerBound.y-a,f.aabb.upperBound.x=d.upperBound.x+c,f.aabb.upperBound.y=d.upperBound.y+a,this.InsertLeaf(f),f},Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),a.Destroy()},Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(c,a,d){Box2D.Common.b2Settings.b2Assert(c.IsLeaf());if(c.aabb.Contains(a)){return !1}this.RemoveLeaf(c);var b=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(d.x),d=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(d.y);return c.aabb.lowerBound.x=a.lowerBound.x-b,c.aabb.lowerBound.y=a.lowerBound.y-d,c.aabb.upperBound.x=a.upperBound.x+b,c.aabb.upperBound.y=a.upperBound.y+d,this.InsertLeaf(c),!0},Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(c){if(null!==this.m_root){for(var a=0;a<c;a++){for(var d=this.m_root,b=0;!d.IsLeaf();){d=this.m_path>>b&1?d.child2:d.child1,b=b+1&31}this.m_path++,this.RemoveLeaf(d),this.InsertLeaf(d)}}},Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(a){return a.aabb},Box2D.Collision.b2DynamicTree.prototype.Query=function(d,b,f){if(null!==this.m_root){var c=[];for(c.push(this.m_root);0<c.length;){var a=c.pop();if(a.aabb.TestOverlap(b)){if(a.IsLeaf()){if(!d.call(f,a.fixture)){break}}else{c.push(a.child1),c.push(a.child2)}}}}},Box2D.Collision.b2DynamicTree.prototype.RayCast=function(k,p){if(null!==this.m_root){var d=Box2D.Common.Math.b2Math.SubtractVV(p.p1,p.p2);d.Normalize();var b=Box2D.Common.Math.b2Math.CrossFV(1,d);Box2D.Common.Math.b2Vec2.Free(d);var d=Box2D.Common.Math.b2Math.AbsV(b),g=p.maxFraction,q=p.p1.x+g*(p.p2.x-p.p1.x),g=p.p1.y+g*(p.p2.y-p.p1.y),c=Box2D.Collision.b2AABB.Get();c.lowerBound.x=Math.min(p.p1.x,q),c.lowerBound.y=Math.min(p.p1.y,g),c.upperBound.x=Math.max(p.p1.x,q),c.upperBound.y=Math.max(p.p1.y,g);var m=[];for(m.push(this.m_root);0<m.length;){if(q=m.pop(),q.aabb.TestOverlap(c)){var g=q.aabb.GetCenter(),l=q.aabb.GetExtents(),h=Math.abs(b.x*(p.p1.x-g.x)+b.y*(p.p1.y-g.y))-d.x*l.x-d.y*l.y;Box2D.Common.Math.b2Vec2.Free(g),Box2D.Common.Math.b2Vec2.Free(l);if(!(0<h)){if(q.IsLeaf()){new Box2D.Collision.b2RayCastInput(p.p1,p.p2,p.maxFraction),g=k(p,q.fixture);if(0==g){break}0<g&&(q=p.p1.x+g*(p.p2.x-p.p1.x),g=p.p1.y+g*(p.p2.y-p.p1.y),c.lowerBound.x=Math.min(p.p1.x,q),c.lowerBound.y=Math.min(p.p1.y,g),c.upperBound.x=Math.max(p.p1.x,q),c.upperBound.y=Math.max(p.p1.y,g))}else{m.push(q.child1),m.push(q.child2)}}}}Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(d),Box2D.Collision.b2AABB.Free(c)}},Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(c){this.m_insertionCount++;if(null===this.m_root){this.m_root=c,this.m_root.parent=null}else{var a=this.GetBestSibling(c),d=a.parent,b=Box2D.Collision.b2DynamicTreeNode.Get();b.parent=d,b.aabb.Combine(c.aabb,a.aabb);if(d){a.parent.child1==a?d.child1=b:d.child2=b,b.child1=a,b.child2=c,a.parent=b;for(c.parent=b;d&&!d.aabb.Contains(b.aabb);){d.aabb.Combine(d.child1.aabb,d.child2.aabb),b=d,d=d.parent}}else{b.child1=a,b.child2=c,a.parent=b,this.m_root=c.parent=b}}},Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(d){for(var d=d.aabb.GetCenter(),b=this.m_root;!b.IsLeaf();){var f=b.child1,b=b.child2,c=Math.abs((f.aabb.lowerBound.x+f.aabb.upperBound.x)/2-d.x)+Math.abs((f.aabb.lowerBound.y+f.aabb.upperBound.y)/2-d.y),a=Math.abs((b.aabb.lowerBound.x+b.aabb.upperBound.x)/2-d.x)+Math.abs((b.aabb.lowerBound.y+b.aabb.upperBound.y)/2-d.y),b=c<a?f:b}return Box2D.Common.Math.b2Vec2.Free(d),b},Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(b){if(b==this.m_root){this.m_root=null}else{var a=b.parent,c=a.parent,b=a.child1==b?a.child2:a.child1;if(c){c.child1==a?c.child1=b:c.child2=b;for(b.parent=c;c;){b=c.aabb,c.aabb.Combine(c.child1.aabb,c.child2.aabb);if(b.Contains(c.aabb)){break}c=c.parent}}else{this.m_root=b,b.parent=null}a.Destroy()}},Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.ClipVertex.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},Box2D.Collision.b2Manifold=function(){this.m_type=this.m_pointCount=0,this.m_points=[];for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++){this.m_points[a]=new Box2D.Collision.b2ManifoldPoint}this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++){this.m_points[a].Reset()}this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},Box2D.Collision.b2Manifold.prototype.Set=function(b){this.m_pointCount=b.m_pointCount;for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++){this.m_points[a].Set(b.m_points[a])}this.m_localPlaneNormal.SetV(b.m_localPlaneNormal),this.m_localPoint.SetV(b.m_localPoint),this.m_type=b.m_type},Box2D.Collision.b2Manifold.prototype.Copy=function(){var a=new Box2D.Collision.b2Manifold;return a.Set(this),a},Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4,Box2D.Collision.b2Collision={},Box2D.Collision.b2Collision.ClipSegmentToLine=function(g,c,k,f){var b=0,d=c[0].v,h=c[1].v,a=k.x*d.x+k.y*d.y-f,k=k.x*h.x+k.y*h.y-f;return 0>=a&&g[b++].Set(c[0]),0>=k&&g[b++].Set(c[1]),0>a*k&&(k=a/(a-k),f=g[b].v,f.x=d.x+k*(h.x-d.x),f.y=d.y+k*(h.y-d.y),g[b].id=0<a?c[0].id:c[1].id,b++),b},Box2D.Collision.b2Collision.EdgeSeparation=function(v,z,g,b,m){for(var A=z.R.col1.x*v.m_normals[g].x+z.R.col2.x*v.m_normals[g].y,d=z.R.col1.y*v.m_normals[g].x+z.R.col2.y*v.m_normals[g].y,y=m.R.col1.x*A+m.R.col1.y*d,x=m.R.col2.x*A+m.R.col2.y*d,q=0,k=Number.MAX_VALUE,w=0;w<b.m_vertexCount;w++){var p=b.m_vertices[w].x*y+b.m_vertices[w].y*x;p<k&&(k=p,q=w)}return(m.position.x+(m.R.col1.x*b.m_vertices[q].x+m.R.col2.x*b.m_vertices[q].y)-(z.position.x+(z.R.col1.x*v.m_vertices[g].x+z.R.col2.x*v.m_vertices[g].y)))*A+(m.position.y+(m.R.col1.y*b.m_vertices[q].x+m.R.col2.y*b.m_vertices[q].y)-(z.position.y+(z.R.col1.y*v.m_vertices[g].x+z.R.col2.y*v.m_vertices[g].y)))*d},Box2D.Collision.b2Collision.FindMaxSeparation=function(p,x,g,b){for(var k=b.position.x+(b.R.col1.x*g.m_centroid.x+b.R.col2.x*g.m_centroid.y),y=b.position.y+(b.R.col1.y*g.m_centroid.x+b.R.col2.y*g.m_centroid.y),k=k-(x.position.x+(x.R.col1.x*p.m_centroid.x+x.R.col2.x*p.m_centroid.y)),y=y-(x.position.y+(x.R.col1.y*p.m_centroid.x+x.R.col2.y*p.m_centroid.y)),d=k*x.R.col1.x+y*x.R.col1.y,y=k*x.R.col2.x+y*x.R.col2.y,k=0,w=-Number.MAX_VALUE,v=0;v<p.m_vertexCount;++v){var m=p.m_normals[v].x*d+p.m_normals[v].y*y;m>w&&(w=m,k=v)}d=Box2D.Collision.b2Collision.EdgeSeparation(p,x,k,g,b),y=k-1,0>y&&(y=p.m_vertexCount-1),w=Box2D.Collision.b2Collision.EdgeSeparation(p,x,y,g,b),v=k+1,v>=p.m_vertexCount&&(v=0);var m=Box2D.Collision.b2Collision.EdgeSeparation(p,x,v,g,b),h=0,q=0;if(w>d&&w>m){h=y;for(q=w;;){if(k=h-1,0>k&&(k=p.m_vertexCount-1),d=Box2D.Collision.b2Collision.EdgeSeparation(p,x,k,g,b),!(d>q)){break}h=k,q=d}}else{if(m>d){h=v;for(q=m;;){if(k=h+1,k>=p.m_vertexCount&&(k=0),d=Box2D.Collision.b2Collision.EdgeSeparation(p,x,k,g,b),!(d>q)){break}h=k,q=d}}else{h=k,q=d}}return{bestEdge:h,separation:q}},Box2D.Collision.b2Collision.FindIncidentEdge=function(k,p,d,b,g,q){for(var c=d.R.col1.x*p.m_normals[b].x+d.R.col2.x*p.m_normals[b].y,p=d.R.col1.y*p.m_normals[b].x+d.R.col2.y*p.m_normals[b].y,d=q.R.col1.x*c+q.R.col1.y*p,p=q.R.col2.x*c+q.R.col2.y*p,c=d,d=0,m=Number.MAX_VALUE,l=0;l<g.m_vertexCount;l++){var h=c*g.m_normals[l].x+p*g.m_normals[l].y;h<m&&(m=h,d=l)}c=d+1,c>=g.m_vertexCount&&(c=0),k[0].v.x=q.position.x+(q.R.col1.x*g.m_vertices[d].x+q.R.col2.x*g.m_vertices[d].y),k[0].v.y=q.position.y+(q.R.col1.y*g.m_vertices[d].x+q.R.col2.y*g.m_vertices[d].y),k[0].id.SetReferenceEdge(b),k[0].id.SetIncidentEdge(d),k[0].id.SetIncidentVertex(0),k[1].v.x=q.position.x+(q.R.col1.x*g.m_vertices[c].x+q.R.col2.x*g.m_vertices[c].y),k[1].v.y=q.position.y+(q.R.col1.y*g.m_vertices[c].x+q.R.col2.y*g.m_vertices[c].y),k[1].id.SetReferenceEdge(b),k[1].id.SetIncidentEdge(c),k[1].id.SetIncidentVertex(1)},Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]},Box2D.Collision.b2Collision.CollidePolygons=function(x,B,k,b,q){x.m_pointCount=0;var C=B.m_radius+b.m_radius,g=Box2D.Collision.b2Collision.FindMaxSeparation(B,k,b,q);if(!(g.separation>C)){var A=Box2D.Collision.b2Collision.FindMaxSeparation(b,q,B,k);if(!(A.separation>C)){var z=B,w=b,m=k,y=q,v=0,d=g.bestEdge;x.m_type=Box2D.Collision.b2Manifold.e_faceA,A.separation>0.98*g.separation+0.001&&(z=b,w=B,m=q,y=k,d=A.bestEdge,x.m_type=Box2D.Collision.b2Manifold.e_faceB,v=1),B=Box2D.Collision.b2Collision.s_incidentEdge,Box2D.Collision.b2Collision.FindIncidentEdge(B,z,m,d,w,y),w=z.m_vertices[d],z=d+1<z.m_vertexCount?z.m_vertices[d+1]:z.m_vertices[0],Box2D.Collision.b2Collision.s_localTangent.Set(z.x-w.x,z.y-w.y),Box2D.Collision.b2Collision.s_localTangent.Normalize(),Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x,Box2D.Collision.b2Collision.s_planePoint.Set(0.5*(w.x+z.x),0.5*(w.y+z.y)),Box2D.Collision.b2Collision.s_tangent.x=m.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+m.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent.y=m.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+m.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_v11.x=m.position.x+(m.R.col1.x*w.x+m.R.col2.x*w.y),Box2D.Collision.b2Collision.s_v11.y=m.position.y+(m.R.col1.y*w.x+m.R.col2.y*w.y),Box2D.Collision.b2Collision.s_v12.x=m.position.x+(m.R.col1.x*z.x+m.R.col2.x*z.y),Box2D.Collision.b2Collision.s_v12.y=m.position.y+(m.R.col1.y*z.x+m.R.col2.y*z.y);if(!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,B,Box2D.Collision.b2Collision.s_tangent2,-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+C))&&!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+C))){x.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal),x.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint),m=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y;for(d=z=0;d<Box2D.Common.b2Settings.b2_maxManifoldPoints;++d){Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[d].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[d].v.y-m<=C&&(w=Box2D.Collision.b2Collision.s_clipPoints2[d].v.x-y.position.x,B=Box2D.Collision.b2Collision.s_clipPoints2[d].v.y-y.position.y,x.m_points[z].m_localPoint.x=w*y.R.col1.x+B*y.R.col1.y,x.m_points[z].m_localPoint.y=w*y.R.col2.x+B*y.R.col2.y,x.m_points[z].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[d].id),x.m_points[z].m_id.SetFlip(v),z++)}x.m_pointCount=z}}}},Box2D.Collision.b2Collision.CollideCircles=function(f,b,g,d,a){f.m_pointCount=0;var c=a.position.x+(a.R.col1.x*d.m_p.x+a.R.col2.x*d.m_p.y)-(g.position.x+(g.R.col1.x*b.m_p.x+g.R.col2.x*b.m_p.y)),g=a.position.y+(a.R.col1.y*d.m_p.x+a.R.col2.y*d.m_p.y)-(g.position.y+(g.R.col1.y*b.m_p.x+g.R.col2.y*b.m_p.y)),a=b.m_radius+d.m_radius;c*c+g*g>a*a||(f.m_type=Box2D.Collision.b2Manifold.e_circles,f.m_localPoint.SetV(b.m_p),f.m_localPlaneNormal.SetZero(),f.m_pointCount=1,f.m_points[0].m_localPoint.SetV(d.m_p),f.m_points[0].m_id.SetKey(0))},Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(m,v,d,b,h){m.m_pointCount=0;for(var w=h.position.x+(h.R.col1.x*b.m_p.x+h.R.col2.x*b.m_p.y)-d.position.x,c=h.position.y+(h.R.col1.y*b.m_p.x+h.R.col2.y*b.m_p.y)-d.position.y,h=w*d.R.col1.x+c*d.R.col1.y,d=w*d.R.col2.x+c*d.R.col2.y,w=0,c=-Number.MAX_VALUE,q=v.m_radius+b.m_radius,p=0;p<v.m_vertexCount;++p){var k=v.m_normals[p].x*(h-v.m_vertices[p].x)+v.m_normals[p].y*(d-v.m_vertices[p].y);if(k>q){return}k>c&&(c=k,w=p)}k=w+1,k>=v.m_vertexCount&&(k=0);var p=v.m_vertices[w],g=v.m_vertices[k];c<Number.MIN_VALUE?(m.m_pointCount=1,m.m_type=Box2D.Collision.b2Manifold.e_faceA,m.m_localPlaneNormal.SetV(v.m_normals[w]),m.m_localPoint.x=0.5*(p.x+g.x),m.m_localPoint.y=0.5*(p.y+g.y),m.m_points[0].m_localPoint.SetV(b.m_p),m.m_points[0].m_id.SetKey(0)):0>=(h-p.x)*(g.x-p.x)+(d-p.y)*(g.y-p.y)?(h-p.x)*(h-p.x)+(d-p.y)*(d-p.y)>q*q||(m.m_pointCount=1,m.m_type=Box2D.Collision.b2Manifold.e_faceA,m.m_localPlaneNormal.x=h-p.x,m.m_localPlaneNormal.y=d-p.y,m.m_localPlaneNormal.Normalize(),m.m_localPoint.SetV(p),m.m_points[0].m_localPoint.SetV(b.m_p),m.m_points[0].m_id.SetKey(0)):0>=(h-g.x)*(p.x-g.x)+(d-g.y)*(p.y-g.y)?(h-g.x)*(h-g.x)+(d-g.y)*(d-g.y)>q*q||(m.m_pointCount=1,m.m_type=Box2D.Collision.b2Manifold.e_faceA,m.m_localPlaneNormal.x=h-g.x,m.m_localPlaneNormal.y=d-g.y,m.m_localPlaneNormal.Normalize(),m.m_localPoint.SetV(g),m.m_points[0].m_localPoint.SetV(b.m_p),m.m_points[0].m_id.SetKey(0)):(k=0.5*(p.x+g.x),p=0.5*(p.y+g.y),c=(h-k)*v.m_normals[w].x+(d-p)*v.m_normals[w].y,c>q||(m.m_pointCount=1,m.m_type=Box2D.Collision.b2Manifold.e_faceA,m.m_localPlaneNormal.x=v.m_normals[w].x,m.m_localPlaneNormal.y=v.m_normals[w].y,m.m_localPlaneNormal.Normalize(),m.m_localPoint.Set(k,p),m.m_points[0].m_localPoint.SetV(b.m_p),m.m_points[0].m_id.SetKey(0)))},Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_proxyB=this.m_proxyA=null},Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(p,x,g,b,k){this.m_proxyA=x,this.m_proxyB=b;var y=p.count;Box2D.Common.b2Settings.b2Assert(0<y&&3>y);var d,w,v=w=d=0,m=0,b=x=0,h,q,v=0;1==y?(this.m_type=Box2D.Collision.b2SeparationFunction.e_points,y=this.m_proxyA.GetVertex(p.indexA[0]),p=this.m_proxyB.GetVertex(p.indexB[0]),q=y,h=g.R,d=g.position.x+(h.col1.x*q.x+h.col2.x*q.y),w=g.position.y+(h.col1.y*q.x+h.col2.y*q.y),q=p,h=k.R,v=k.position.x+(h.col1.x*q.x+h.col2.x*q.y),m=k.position.y+(h.col1.y*q.x+h.col2.y*q.y),this.m_axis.x=v-d,this.m_axis.y=m-w,this.m_axis.Normalize()):p.indexB[0]==p.indexB[1]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,x=this.m_proxyA.GetVertex(p.indexA[0]),b=this.m_proxyA.GetVertex(p.indexA[1]),p=this.m_proxyB.GetVertex(p.indexB[0]),this.m_localPoint.x=0.5*(x.x+b.x),this.m_localPoint.y=0.5*(x.y+b.y),m=Box2D.Common.Math.b2Math.SubtractVV(b,x),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_axis.Normalize(),q=this.m_axis,h=g.R,x=h.col1.x*q.x+h.col2.x*q.y,b=h.col1.y*q.x+h.col2.y*q.y,q=this.m_localPoint,h=g.R,d=g.position.x+(h.col1.x*q.x+h.col2.x*q.y),w=g.position.y+(h.col1.y*q.x+h.col2.y*q.y),q=p,h=k.R,v=k.position.x+(h.col1.x*q.x+h.col2.x*q.y),m=k.position.y+(h.col1.y*q.x+h.col2.y*q.y),0>(v-d)*x+(m-w)*b&&this.m_axis.NegativeSelf()):p.indexA[0]==p.indexA[0]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,d=this.m_proxyB.GetVertex(p.indexB[0]),w=this.m_proxyB.GetVertex(p.indexB[1]),y=this.m_proxyA.GetVertex(p.indexA[0]),this.m_localPoint.x=0.5*(d.x+w.x),this.m_localPoint.y=0.5*(d.y+w.y),m=Box2D.Common.Math.b2Math.SubtractVV(w,d),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_axis.Normalize(),q=this.m_axis,h=k.R,x=h.col1.x*q.x+h.col2.x*q.y,b=h.col1.y*q.x+h.col2.y*q.y,q=this.m_localPoint,h=k.R,v=k.position.x+(h.col1.x*q.x+h.col2.x*q.y),m=k.position.y+(h.col1.y*q.x+h.col2.y*q.y),q=y,h=g.R,d=g.position.x+(h.col1.x*q.x+h.col2.x*q.y),w=g.position.y+(h.col1.y*q.x+h.col2.y*q.y),0>(d-v)*x+(w-m)*b&&this.m_axis.NegativeSelf()):(x=this.m_proxyA.GetVertex(p.indexA[0]),b=this.m_proxyA.GetVertex(p.indexA[1]),d=this.m_proxyB.GetVertex(p.indexB[0]),w=this.m_proxyB.GetVertex(p.indexB[1]),m=Box2D.Common.Math.b2Math.SubtractVV(b,x),v=Box2D.Common.Math.b2Math.MulMV(g.R,m),Box2D.Common.Math.b2Vec2.Free(m),m=Box2D.Common.Math.b2Math.SubtractVV(w,d),h=Box2D.Common.Math.b2Math.MulMV(k.R,m),Box2D.Common.Math.b2Vec2.Free(m),k=v.x*v.x+v.y*v.y,g=h.x*h.x+h.y*h.y,m=Box2D.Common.Math.b2Math.SubtractVV(h,v),p=v.x*m.x+v.y*m.y,y=h.x*m.x+h.y*m.y,Box2D.Common.Math.b2Vec2.Free(m),m=v.x*h.x+v.y*h.y,h=k*g-m*m,v=0,0!=h&&(v=Box2D.Common.Math.b2Math.Clamp((m*y-p*g)/h,0,1)),0>(m*v+y)/g&&(v=Box2D.Common.Math.b2Math.Clamp((m-p)/k,0,1)),y=Box2D.Common.Math.b2Vec2.Get(0,0),y.x=x.x+v*(b.x-x.x),y.y=x.y+v*(b.y-x.y),p=Box2D.Common.Math.b2Vec2.Get(0,0),p.x=d.x+v*(w.x-d.x),p.y=d.y+v*(w.y-d.y),0==v||1==v?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,m=Box2D.Common.Math.b2Math.SubtractVV(w,d),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_axis.Normalize(),this.m_localPoint=p):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,m=Box2D.Common.Math.b2Math.SubtractVV(b,x),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_localPoint=y),0>v&&this.m_axis.NegativeSelf(),Box2D.Common.Math.b2Vec2.Free(y),Box2D.Common.Math.b2Vec2.Free(p))},Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(f,b){var g=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:var g=Box2D.Common.Math.b2Math.MulTMV(f.R,this.m_axis),d=this.m_axis.GetNegative(),a=Box2D.Common.Math.b2Math.MulTMV(b.R,d);Box2D.Common.Math.b2Vec2.Free(d);var c=this.m_proxyA.GetSupportVertex(g);Box2D.Common.Math.b2Vec2.Free(g),g=this.m_proxyB.GetSupportVertex(a),Box2D.Common.Math.b2Vec2.Free(a),a=Box2D.Common.Math.b2Math.MulX(f,c),c=Box2D.Common.Math.b2Math.MulX(b,g),g=(c.x-a.x)*this.m_axis.x+(c.y-a.y)*this.m_axis.y,Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(c);break;case Box2D.Collision.b2SeparationFunction.e_faceA:d=Box2D.Common.Math.b2Math.MulMV(f.R,this.m_axis),c=d.GetNegative(),a=Box2D.Common.Math.b2Math.MulTMV(b.R,c),Box2D.Common.Math.b2Vec2.Free(c),g=this.m_proxyB.GetSupportVertex(a),Box2D.Common.Math.b2Vec2.Free(a),a=Box2D.Common.Math.b2Math.MulX(f,this.m_localPoint),c=Box2D.Common.Math.b2Math.MulX(b,g),g=(c.x-a.x)*d.x+(c.y-a.y)*d.y,Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(c);break;case Box2D.Collision.b2SeparationFunction.e_faceB:d=Box2D.Common.Math.b2Math.MulMV(b.R,this.m_axis),c=d.GetNegative(),g=Box2D.Common.Math.b2Math.MulTMV(f.R,c),Box2D.Common.Math.b2Vec2.Free(c),c=this.m_proxyA.GetSupportVertex(g),Box2D.Common.Math.b2Vec2.Free(g),a=Box2D.Common.Math.b2Math.MulX(f,c),c=Box2D.Common.Math.b2Math.MulX(b,this.m_localPoint),g=(a.x-c.x)*d.x+(a.y-c.y)*d.y,Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(c);break;default:Box2D.Common.b2Settings.b2Assert(!1)}return g},Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4,Box2D.Common.Math.b2Transform=function(b,a){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.R=new Box2D.Common.Math.b2Mat22,b&&this.position.SetV(b),a&&this.R.SetM(a)},Box2D.Common.Math.b2Transform.prototype.Initialize=function(b,a){this.position.SetV(b),this.R.SetM(a)},Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},Box2D.Common.Math.b2Transform.prototype.Set=function(a){this.position.SetV(a.position),this.R.SetM(a.R)},Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},Box2D.Collision.b2TimeOfImpact={},Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(B){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var H=B.proxyA,q=B.proxyB,b=B.sweepA,y=B.sweepB;Box2D.Common.b2Settings.b2Assert(b.t0==y.t0),Box2D.Common.b2Settings.b2Assert(1-b.t0>Number.MIN_VALUE);var I=H.m_radius+q.m_radius,B=B.tolerance,k=0,G=0,E=0;Box2D.Collision.b2TimeOfImpact.s_cache.count=0;for(Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){b.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,k),y.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,k),Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=H,Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=q,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB,Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput);if(0>=Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance){k=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,H,Box2D.Collision.b2TimeOfImpact.s_xfA,q,Box2D.Collision.b2TimeOfImpact.s_xfB);var A=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(0>=A){k=1;break}0==G&&(E=A>I?Math.max(I-B,0.75*I):Math.max(A-B,0.02*I));if(A-E<0.5*B){if(0==G){k=1;break}break}var x=k,D=k,z=1;b.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,z),y.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,z);var g=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(g>=E){k=1;break}for(var C=0;;){var F=0,F=C&1?D+(E-A)*(z-D)/(g-A):0.5*(D+z);b.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,F),y.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,F);var w=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(w-E)<0.025*B){x=F;break}w>E?(D=F,A=w):(z=F,g=w),C++,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++;if(50==C){break}}Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,C);if(x<(1+100*Number.MIN_VALUE)*k){break}k=x,G++,Box2D.Collision.b2TimeOfImpact.b2_toiIters++;if(1000==G){break}}return Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,G),k},Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput,Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=this.angle=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,this.active=!0,this.inertiaScale=1},Box2D.Dynamics.b2BodyDef.b2_staticBody=0,Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1,Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2,Box2D.Dynamics.Contacts={},Box2D.Dynamics.Contacts.b2Contact=function(c,a){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++,this.m_manifold=new Box2D.Collision.b2Manifold,this.m_oldManifold=new Box2D.Collision.b2Manifold,this.touching=!1;var d=c.GetBody(),b=a.GetBody();this.continuous=d.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||d.IsBullet()||b.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||b.IsBullet(),this.sensor=c.IsSensor()||a.IsSensor(),this.filtering=!1,this.m_fixtureA=c,this.m_fixtureB=a,this.enabled=!0,this.bodyAList=d.GetContactList(),this.bodyBList=b.GetContactList(),this.worldList=b.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(c,a){this.m_manifold.Reset(),this.m_oldManifold.Reset(),this.touching=!1;var d=c.GetBody(),b=a.GetBody();this.continuous=d.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||d.IsBullet()||b.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||b.IsBullet(),this.sensor=c.IsSensor()||a.IsSensor(),this.filtering=!1,this.m_fixtureA=c,this.m_fixtureB=a,this.enabled=!0,this.bodyAList=d.GetContactList(),this.bodyBList=b.GetContactList(),this.worldList=b.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this),this.bodyBList.AddContact(this),this.worldList.AddContact(this),this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var b=!1,a=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(b=!0),this.IsContinuous()&&(a=!0)),this.bodyAList.UpdateContact(this,b,a),this.bodyBList.UpdateContact(this,b,a),this.worldList.UpdateContact(this,b,a)},Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this),this.bodyBList.RemoveContact(this),this.worldList.RemoveContact(this)},Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold},Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(d){var b=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody(),c=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape();d.Initialize(this.m_manifold,b.GetTransform(),c.m_radius,f.GetTransform(),a.m_radius)},Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching},Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous},Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(a){this.sensor=a,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor},Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(a){this.enabled=a,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled},Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(b){var a=this.m_fixtureA.GetBody();return a!=b?a:this.m_fixtureB.GetBody()},Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0},Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1},Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering},Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(g){var l=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=l,this.enabled=!0;var l=!1,d=this.IsTouching(),b=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody(),m=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor){m&&(l=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),b.GetTransform(),this.m_fixtureB.GetShape(),f.GetTransform())),this.m_manifold.m_pointCount=0}else{this.continuous=b.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||b.IsBullet()||f.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||f.IsBullet()?!0:!1;if(m){this.Evaluate(),l=0<this.m_manifold.m_pointCount;for(m=0;m<this.m_manifold.m_pointCount;m++){var c=this.m_manifold.m_points[m];c.m_normalImpulse=0;for(var k=c.m_tangentImpulse=0;k<this.m_oldManifold.m_pointCount;k++){var h=this.m_oldManifold.m_points[k];if(h.m_id.GetKey()==c.m_id.GetKey()){c.m_normalImpulse=h.m_normalImpulse,c.m_tangentImpulse=h.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}l!=d&&(b.SetAwake(!0),f.SetAwake(!0))}this.touching=l,l!=d&&this.UpdateLists(),!d&&l&&g.BeginContact(this),d&&!l&&g.EndContact(this),this.sensor||g.PreSolve(this,this.m_oldManifold)},Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){},Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(b,a){return Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=b,Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=a,Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop,Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)},Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0,Box2D.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=Box2D.Common.Math.b2Vec2.Get(0,0),this.I=0},Box2D.Collision.Shapes.b2MassData._freeCache=[],Box2D.Collision.Shapes.b2MassData.Get=function(){if(0<Box2D.Collision.Shapes.b2MassData._freeCache.length){var a=Box2D.Collision.Shapes.b2MassData._freeCache.pop();return a.mass=0,a.center.SetZero(),a.I=0,a}return new Box2D.Collision.Shapes.b2MassData},Box2D.Collision.Shapes.b2MassData.Free=function(a){null!=a&&Box2D.Collision.Shapes.b2MassData._freeCache.push(a)},Box2D.Collision.Shapes.b2MassData.prototype.SetV=function(b,a,c){this.mass=b,this.center.SetV(a),this.I=c},Box2D.Collision.Shapes.b2MassData.prototype.Set=function(c,a,d,b){this.mass=c,this.center.Set(a,d),this.I=b},Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this),this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[],this.m_normals=[]},goog.inherits(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME},Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var a=new Box2D.Collision.Shapes.b2PolygonShape;return a.Set(this),a},Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(b){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,b);if(b instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(b.m_centroid),this.m_vertexCount=b.m_vertexCount,this.Reserve(this.m_vertexCount);for(var a=0;a<this.m_vertexCount;a++){this.m_vertices[a].SetV(b.m_vertices[a]),this.m_normals[a].SetV(b.m_normals[a])}}},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(a){this.SetAsVector(a)},Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(b){var a=new Box2D.Collision.Shapes.b2PolygonShape;return a.SetAsArray(b),a},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(b){var a=b.length;Box2D.Common.b2Settings.b2Assert(2<=a),this.m_vertexCount=a,this.Reserve(a);for(a=a=0;a<this.m_vertexCount;a++){this.m_vertices[a].SetV(b[a])}for(a=0;a<this.m_vertexCount;++a){b=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[a+1<this.m_vertexCount?a+1:0],this.m_vertices[a]),Box2D.Common.b2Settings.b2Assert(b.LengthSquared()>Number.MIN_VALUE);var c=Box2D.Common.Math.b2Math.CrossVF(b,1);Box2D.Common.Math.b2Vec2.Free(b),this.m_normals[a].SetV(c),Box2D.Common.Math.b2Vec2.Free(c),this.m_normals[a].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(b){var a=new Box2D.Collision.Shapes.b2PolygonShape;return a.SetAsVector(b),a},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(b,a){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-b,-a),this.m_vertices[1].Set(b,-a),this.m_vertices[2].Set(b,a),this.m_vertices[3].Set(-b,a),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(b,a){var c=new Box2D.Collision.Shapes.b2PolygonShape;return c.SetAsBox(b,a),c},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(c,a,d,b){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-c,-a),this.m_vertices[1].Set(c,-a),this.m_vertices[2].Set(c,a),this.m_vertices[3].Set(-c,a),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=d,c=new Box2D.Common.Math.b2Mat22,c.Set(b),d=new Box2D.Common.Math.b2Transform(d,c);for(b=0;b<this.m_vertexCount;++b){this.m_vertices[b]=Box2D.Common.Math.b2Math.MulX(d,this.m_vertices[b]),this.m_normals[b]=Box2D.Common.Math.b2Math.MulMV(d.R,this.m_normals[b])}},Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(d,b,f,c){var a=new Box2D.Collision.Shapes.b2PolygonShape;return a.SetAsOrientedBox(d,b,f,c),a},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(c,a){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(c),this.m_vertices[1].SetV(a),this.m_centroid.x=0.5*(c.x+a.x),this.m_centroid.y=0.5*(c.y+a.y);var d=Box2D.Common.Math.b2Math.SubtractVV(a,c),b=Box2D.Common.Math.b2Math.CrossVF(d,1);Box2D.Common.Math.b2Vec2.Free(d),this.m_normals[0]=b,Box2D.Common.Math.b2Vec2.Free(b),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(b,a){var c=new Box2D.Collision.Shapes.b2PolygonShape;return c.SetAsEdge(b,a),c},Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(g,c){var k;k=g.R;for(var f=c.x-g.position.x,b=c.y-g.position.y,d=f*k.col1.x+b*k.col1.y,h=f*k.col2.x+b*k.col2.y,a=0;a<this.m_vertexCount;++a){if(k=this.m_vertices[a],f=d-k.x,b=h-k.y,k=this.m_normals[a],0<k.x*f+k.y*b){return !1}}return !0},Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(v,z,g){var b=0,m=z.maxFraction,A=0,d=0,y,x,A=z.p1.x-g.position.x,d=z.p1.y-g.position.y;y=g.R;var q=A*y.col1.x+d*y.col1.y,k=A*y.col2.x+d*y.col2.y,A=z.p2.x-g.position.x,d=z.p2.y-g.position.y;y=g.R,z=A*y.col1.x+d*y.col1.y-q,y=A*y.col2.x+d*y.col2.y-k;for(var w=-1,p=0;p<this.m_vertexCount;++p){x=this.m_vertices[p],A=x.x-q,d=x.y-k,x=this.m_normals[p],A=x.x*A+x.y*d,d=x.x*z+x.y*y;if(0==d){if(0>A){return !1}}else{0>d&&A<b*d?(b=A/d,w=p):0<d&&A<m*d&&(m=A/d)}if(m<b-Number.MIN_VALUE){return !1}}return 0<=w?(v.fraction=b,y=g.R,x=this.m_normals[w],v.normal.x=y.col1.x*x.x+y.col2.x*x.y,v.normal.y=y.col1.y*x.x+y.col2.y*x.y,!0):!1},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(k,p){for(var d=p.R,b=this.m_vertices[0],g=p.position.x+(d.col1.x*b.x+d.col2.x*b.y),q=p.position.y+(d.col1.y*b.x+d.col2.y*b.y),c=g,m=q,l=1;l<this.m_vertexCount;++l){var b=this.m_vertices[l],h=p.position.x+(d.col1.x*b.x+d.col2.x*b.y),b=p.position.y+(d.col1.y*b.x+d.col2.y*b.y),g=g<h?g:h,q=q<b?q:b,c=c>h?c:h,m=m>b?m:b}k.lowerBound.x=g-this.m_radius,k.lowerBound.y=q-this.m_radius,k.upperBound.x=c+this.m_radius,k.upperBound.y=m+this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(z,F){if(2==this.m_vertexCount){z.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),z.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y),z.mass=0,z.I=0}else{for(var m=0,b=0,w=0,G=0,k=1/3,E=0;E<this.m_vertexCount;++E){var C=this.m_vertices[E],y=E+1<this.m_vertexCount?this.m_vertices[E+1]:this.m_vertices[0],q=C.x-0,B=C.y-0,x=y.x-0,g=y.y-0,A=q*g-B*x,D=0.5*A,w=w+D,m=m+D*k*(0+C.x+y.x),b=b+D*k*(0+C.y+y.y),C=q,G=G+A*(k*(0.25*(C*C+x*C+x*x)+(0*C+0*x))+0+(k*(0.25*(B*B+g*B+g*g)+(0*B+0*g))+0))}z.Set(F*w,m*(1/w),b*(1/w),F*G)}},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(m,v,d,b){for(var h=Box2D.Common.Math.b2Math.MulTMV(d.R,m),w=v-Box2D.Common.Math.b2Math.Dot(m,d.position),c=[],q=0,p=-1,v=-1,k=!1,m=m=0;m<this.m_vertexCount;++m){c[m]=Box2D.Common.Math.b2Math.Dot(h,this.m_vertices[m])-w;var g=c[m]<-Number.MIN_VALUE;0<m&&(g?k||(p=m-1,q++):k&&(v=m-1,q++)),k=g}Box2D.Common.Math.b2Vec2.Free(h);switch(q){case 0:return k?(m=Box2D.Collision.Shapes.b2MassData.Get(),this.ComputeMass(m,1),d=Box2D.Common.Math.b2Math.MulX(d,m.center),b.SetV(d),Box2D.Common.Math.b2Vec2.Free(d),b=m.mass,Box2D.Collision.Shapes.b2MassData.Free(m),b):0;case 1:-1==p?p=this.m_vertexCount-1:v=this.m_vertexCount-1}m=(p+1)%this.m_vertexCount,h=(v+1)%this.m_vertexCount,w=(0-c[p])/(c[m]-c[p]),c=(0-c[v])/(c[h]-c[v]),p=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[p].x*(1-w)+this.m_vertices[m].x*w,this.m_vertices[p].y*(1-w)+this.m_vertices[m].y*w),w=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[v].x*(1-c)+this.m_vertices[h].x*c,this.m_vertices[v].y*(1-c)+this.m_vertices[h].y*c),v=0,c=Box2D.Common.Math.b2Vec2.Get(0,0);for(q=this.m_vertices[m];m!=h;){m=(m+1)%this.m_vertexCount,k=m==h?w:this.m_vertices[m],g=0.5*((q.x-p.x)*(k.y-p.y)-(q.y-p.y)*(k.x-p.x)),v+=g,c.x+=g*(p.x+q.x+k.x)/3,c.y+=g*(p.y+q.y+k.y)/3,q=k}return Box2D.Common.Math.b2Vec2.Free(p),Box2D.Common.Math.b2Vec2.Free(w),c.Multiply(1/v),d=Box2D.Common.Math.b2Math.MulX(d,c),Box2D.Common.Math.b2Vec2.Free(c),b.SetV(d),Box2D.Common.Math.b2Vec2.Free(d),v},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(a){a.SetValues(this.m_vertexCount,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(d){for(var b=0,f=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,c=1;c<this.m_vertexCount;++c){var a=this.m_vertices[c].x*d.x+this.m_vertices[c].y*d.y;a>f&&(b=c,f=a)}return b},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(d){for(var b=0,f=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,c=1;c<this.m_vertexCount;++c){var a=this.m_vertices[c].x*d.x+this.m_vertices[c].y*d.y;a>f&&(b=c,f=a)}return this.m_vertices[b]},Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(b){for(var a=0;a<this.m_vertices.length;a++){Box2D.Common.Math.b2Vec2.Free(this.m_vertices[a]),Box2D.Common.Math.b2Vec2.Free(this.m_normals[a])}this.m_vertices=[],this.m_normals=[];for(a=0;a<b;a++){this.m_vertices[a]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[a]=Box2D.Common.Math.b2Vec2.Get(0,0)}},Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(g,l){for(var d=Box2D.Common.Math.b2Vec2.Get(0,0),b=0,f=1/3,m=0;m<l;++m){var c=g[m],k=m+1<l?g[m+1]:g[0],h=0.5*((c.x-0)*(k.y-0)-(c.y-0)*(k.x-0)),b=b+h;d.x+=h*f*(0+c.x+k.x),d.y+=h*f*(0+c.y+k.y)}return d.x*=1/b,d.y*=1/b,d},Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22,Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape",Box2D.Collision.Shapes.b2EdgeShape=function(b,a){Box2D.Collision.Shapes.b2Shape.call(this),this.m_nextEdge=this.m_prevEdge=null,this.m_v1=b,this.m_v2=a,this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x),this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y),this.m_cornerConvex2=this.m_cornerConvex1=!1},goog.inherits(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME},Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(){return !1},Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(m,v,d){var b=v.p2.x-v.p1.x,h=v.p2.y-v.p1.y,w=d.R,c=d.position.x+(w.col1.x*this.m_v1.x+w.col2.x*this.m_v1.y),q=d.position.y+(w.col1.y*this.m_v1.x+w.col2.y*this.m_v1.y),p=d.position.y+(w.col1.y*this.m_v2.x+w.col2.y*this.m_v2.y)-q,d=-(d.position.x+(w.col1.x*this.m_v2.x+w.col2.x*this.m_v2.y)-c),w=100*Number.MIN_VALUE,k=-(b*p+h*d);if(k>w){var c=v.p1.x-c,g=v.p1.y-q,q=c*p+g*d;if(0<=q&&q<=v.maxFraction*k&&(v=-b*g+h*c,-w*k<=v&&v<=k*(1+w))){return m.fraction=q/k,v=Math.sqrt(p*p+d*d),m.normal.x=p/v,m.normal.y=d/v,!0}}return !1},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(f,b){var g=b.R,d=b.position.x+(g.col1.x*this.m_v1.x+g.col2.x*this.m_v1.y),a=b.position.y+(g.col1.y*this.m_v1.x+g.col2.y*this.m_v1.y),c=b.position.x+(g.col1.x*this.m_v2.x+g.col2.x*this.m_v2.y),g=b.position.y+(g.col1.y*this.m_v2.x+g.col2.y*this.m_v2.y);d<c?(f.lowerBound.x=d,f.upperBound.x=c):(f.lowerBound.x=c,f.upperBound.x=d),a<g?(f.lowerBound.y=a,f.upperBound.y=g):(f.lowerBound.y=g,f.upperBound.y=a)},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(a){a.mass=0,a.center.SetV(this.m_v1),a.I=0},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(f,b,h,d){void 0===b&&(b=0);var a=Box2D.Common.Math.b2Vec2.Get(f.x*b,f.y*b),c=Box2D.Common.Math.b2Math.MulX(h,this.m_v1),h=Box2D.Common.Math.b2Math.MulX(h,this.m_v2),g=Box2D.Common.Math.b2Math.Dot(f,c)-b,f=Box2D.Common.Math.b2Math.Dot(f,h)-b;if(0<g){if(0<f){return 0}c.x=-f/(g-f)*c.x+g/(g-f)*h.x,c.y=-f/(g-f)*c.y+g/(g-f)*h.y}else{0<f&&(h.x=-f/(g-f)*c.x+g/(g-f)*h.x,h.y=-f/(g-f)*c.y+g/(g-f)*h.y)}return d.x=(a.x+c.x+h.x)/3,d.y=(a.y+c.y+h.y)/3,0.5*((c.x-a.x)*(h.y-a.y)-(c.y-a.y)*(h.x-a.x))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(b){var a=b.R;return Box2D.Common.Math.b2Vec2.Get(b.position.x+(a.col1.x*this.m_coreV1.x+a.col2.x*this.m_coreV1.y),b.position.y+(a.col1.y*this.m_coreV1.x+a.col2.y*this.m_coreV1.y))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(f,b,h){var d=f.R,a=f.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),c=f.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=f.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),f=f.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return a*b+c*h>g*b+f*h?Box2D.Common.Math.b2Vec2.Get(a,c):Box2D.Common.Math.b2Vec2.Get(g,f)},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(c,a,d,b){this.m_prevEdge=c,this.m_coreV1=a,this.m_cornerDir1=d,this.m_cornerConvex1=b},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(c,a,d,b){this.m_nextEdge=c,this.m_coreV2=a,this.m_cornerDir2=d,this.m_cornerConvex2=b},Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape",Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(b,a){Box2D.Common.b2Settings.b2Assert(b.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(a.GetShape() instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.call(this,b,a)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(b,a){Box2D.Common.b2Settings.b2Assert(b.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(a.GetShape() instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,b,a)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},Box2D.Dynamics.b2TimeStep=function(d,b,f,c,a){this.Reset(d,b,f,c,a)},Box2D.Dynamics.b2TimeStep.prototype.Reset=function(f,b,g,d,a){this.dt=f;var c=0;0<f&&(c=1/f),this.inv_dt=c,this.dtRatio=b,this.positionIterations=g,this.velocityIterations=d,this.warmStarting=a},Box2D.Dynamics.Joints.b2FrictionJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_linearMass=new Box2D.Common.Math.b2Mat22,this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new Box2D.Common.Math.b2Vec2.Get(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_angularImpulse},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(a){void 0===a&&(a=0),this.m_maxTorque=a},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(p){var x,g=0,b=this.m_bodyA,k=this.m_bodyB;x=b.m_xf.R;var y=this.m_localAnchorA.x-b.m_sweep.localCenter.x,d=this.m_localAnchorA.y-b.m_sweep.localCenter.y,g=x.col1.x*y+x.col2.x*d,d=x.col1.y*y+x.col2.y*d,y=g;x=k.m_xf.R;var w=this.m_localAnchorB.x-k.m_sweep.localCenter.x,v=this.m_localAnchorB.y-k.m_sweep.localCenter.y,g=x.col1.x*w+x.col2.x*v,v=x.col1.y*w+x.col2.y*v,w=g;x=b.m_invMass;var g=k.m_invMass,m=b.m_invI,h=k.m_invI,q=new b2Mat22;q.col1.x=x+g,q.col2.x=0,q.col1.y=0,q.col2.y=x+g,q.col1.x+=m*d*d,q.col2.x+=-m*y*d,q.col1.y+=-m*y*d,q.col2.y+=m*y*y,q.col1.x+=h*v*v,q.col2.x+=-h*w*v,q.col1.y+=-h*w*v,q.col2.y+=h*w*w,q.GetInverse(this.m_linearMass),this.m_angularMass=m+h,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),p.warmStarting?(this.m_linearImpulse.x*=p.dtRatio,this.m_linearImpulse.y*=p.dtRatio,this.m_angularImpulse*=p.dtRatio,p=this.m_linearImpulse,b.m_linearVelocity.x-=x*p.x,b.m_linearVelocity.y-=x*p.y,b.m_angularVelocity-=m*(y*p.y-d*p.x+this.m_angularImpulse),k.m_linearVelocity.x+=g*p.x,k.m_linearVelocity.y+=g*p.y,k.m_angularVelocity+=h*(w*p.y-v*p.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(H){var q,A=0,x=this.m_bodyA,D=this.m_bodyB,w=x.m_linearVelocity,z=x.m_angularVelocity,k=D.m_linearVelocity,K=D.m_angularVelocity,G=x.m_invMass,C=D.m_invMass,J=x.m_invI,E=D.m_invI;q=x.m_xf.R;var y=this.m_localAnchorA.x-x.m_sweep.localCenter.x,I=this.m_localAnchorA.y-x.m_sweep.localCenter.y,A=q.col1.x*y+q.col2.x*I,I=q.col1.y*y+q.col2.y*I,y=A;q=D.m_xf.R;var b=this.m_localAnchorB.x-D.m_sweep.localCenter.x,B=this.m_localAnchorB.y-D.m_sweep.localCenter.y,A=q.col1.x*b+q.col2.x*B,B=q.col1.y*b+q.col2.y*B,b=A;q=0;var A=-this.m_angularMass*(K-z),F=this.m_angularImpulse;q=H.dt*this.m_maxTorque,this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+A,-q,q),A=this.m_angularImpulse-F,z-=J*A,K+=E*A,q=Box2D.Common.Math.b2Vec2.Get(-(k.x-K*B-w.x+z*I),-(k.y+K*b-w.y-z*y)),q.MulM(this.m_linearMass),A=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(q),Box2D.Common.Math.b2Vec2.Free(q),q=H.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>q*q&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(q)),q=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,A),Box2D.Common.Math.b2Vec2.Free(A),w.x-=G*q.x,w.y-=G*q.y,z-=J*(y*q.y-I*q.x),k.x+=C*q.x,k.y+=C*q.y,K+=E*(b*q.y-B*q.x),Box2D.Common.Math.b2Vec2.Free(q),x.m_angularVelocity=z,D.m_angularVelocity=K},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return !0},Box2D.Dynamics.b2DestructionListener=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(){},Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var a=new Box2D.Dynamics.b2FilterData;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},Box2D.Dynamics.b2Fixture=function(b,a,c){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++,this.m_filter=c.filter.Copy(),this.m_aabb=Box2D.Collision.b2AABB.Get(),this.m_aabb_temp=Box2D.Collision.b2AABB.Get(),this.m_body=b,this.m_shape=c.shape.Copy(),this.m_density=c.density,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_isSensor=c.isSensor},Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape},Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(b){if(this.m_isSensor!=b&&(this.m_isSensor=b,null!=this.m_body)){for(b=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);b;b=b.GetNextNode()){var a=b.contact.GetFixtureA(),c=b.contact.GetFixtureB();(a==this||c==this)&&b.contact.SetSensor(a.IsSensor()||c.IsSensor())}}},Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(null!=this.m_body){for(a=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){(a.contact.GetFixtureA()==this||a.contact.GetFixtureB()==this)&&a.contact.FlagForFiltering()}}},Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body},Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},Box2D.Dynamics.b2Fixture.prototype.RayCast=function(b,a){return this.m_shape.RayCast(b,a,this.m_body.GetTransform())},Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(a){return a||(a=Box2D.Collision.Shapes.b2MassData.Get()),this.m_shape.ComputeMass(a,this.m_density),a},Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(a){this.m_density=a},Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density},Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction},Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(a){this.m_friction=a},Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(a){this.m_restitution=a},Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb},Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)},Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(b,a){this.m_shape.ComputeAABB(this.m_aabb,a),this.m_proxy=b.CreateProxy(this.m_aabb,this)},Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(b,a,c){this.m_proxy&&(this.m_shape.ComputeAABB(this.m_aabb,a),this.m_shape.ComputeAABB(this.m_aabb_temp,c),this.m_aabb.Combine(this.m_aabb,this.m_aabb_temp),a=Box2D.Common.Math.b2Math.SubtractVV(c.position,a.position),b.MoveProxy(this.m_proxy,this.m_aabb,a),Box2D.Common.Math.b2Vec2.Free(a))},Box2D.Dynamics.b2Fixture.NEXT_ID=0,Box2D.Dynamics.iContactListener=function(){},Box2D.Dynamics.iContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.iContactListener.prototype.EndContact=function(){},Box2D.Dynamics.iContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.iContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.Contacts.b2CircleContact=function(b,a){Box2D.Dynamics.Contacts.b2Contact.call(this,b,a)},goog.inherits(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(b,a){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,b,a)},Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){var b=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,b,this.m_fixtureA.GetBody().m_xf,a,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(b,a){Box2D.Dynamics.Contacts.b2Contact.call(this,b,a)},goog.inherits(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(b,a){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,b,a)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody(),this.m_fixtureB.GetBody(),this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(b,a,c){this.bodyA=b,this.bodyB=a,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)},Box2D.Dynamics.Joints.b2RevoluteJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.K3=new Box2D.Common.Math.b2Mat22,this.impulse3=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0),this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_motorMass=0},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse.x,a*this.m_impulse.y)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.z},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(b,a){void 0===b&&(b=0),void 0===a&&(a=0),this.m_lowerAngle=b,this.m_upperAngle=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0),this.m_maxMotorTorque=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(z){var F=this.m_bodyA,m=this.m_bodyB,b,w=0;b=F.m_xf.R;var G=this.m_localAnchor1.x-F.m_sweep.localCenter.x,k=this.m_localAnchor1.y-F.m_sweep.localCenter.y;w=b.col1.x*G+b.col2.x*k,k=b.col1.y*G+b.col2.y*k,G=w,b=m.m_xf.R;var E=this.m_localAnchor2.x-m.m_sweep.localCenter.x,C=this.m_localAnchor2.y-m.m_sweep.localCenter.y;w=b.col1.x*E+b.col2.x*C,C=b.col1.y*E+b.col2.y*C,E=w;var y=F.m_invMass,q=m.m_invMass,B=F.m_invI,x=m.m_invI;this.m_mass.col1.x=y+q+k*k*B+C*C*x,this.m_mass.col2.x=-k*G*B-C*E*x,this.m_mass.col3.x=-k*B-C*x,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=y+q+G*G*B+E*E*x,this.m_mass.col3.y=G*B+E*x,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=B+x,B+x==0?this.m_motorMass=0:this.m_motorMass=0.01,this.m_enableMotor||(this.m_motorImpulse=0);if(this.m_enableLimit){var g=m.m_sweep.a-F.m_sweep.a-this.m_referenceAngle;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:g<=this.m_lowerAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit):g>=this.m_upperAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else{this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit}if(z.warmStarting){this.m_impulse.x*=z.dtRatio,this.m_impulse.y*=z.dtRatio,this.m_motorImpulse*=z.dtRatio;var A=this.m_impulse.x,D=this.m_impulse.y;F.m_linearVelocity.x-=y*A,F.m_linearVelocity.y-=y*D,F.m_angularVelocity-=B*(G*D-k*A+this.m_motorImpulse+this.m_impulse.z),m.m_linearVelocity.x+=q*A,m.m_linearVelocity.y+=q*D,m.m_angularVelocity+=x*(E*D-C*A+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero(),this.m_motorImpulse=0}},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(B){var H=this.m_bodyA,q=this.m_bodyB,b=0,y=b=0,I=0,k=0,G=0,E=H.m_linearVelocity,A=H.m_angularVelocity,x=q.m_linearVelocity,D=q.m_angularVelocity,z=H.m_invMass,g=q.m_invMass,C=H.m_invI,F=q.m_invI;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(y=this.m_motorMass*-(D-A-this.m_motorSpeed),I=this.m_motorImpulse,k=B.dt*this.m_maxMotorTorque,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+y,-k,k),y=this.m_motorImpulse-I,A-=C*y,D+=F*y);if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var B=H.m_xf.R,y=this.m_localAnchor1.x-H.m_sweep.localCenter.x,I=this.m_localAnchor1.y-H.m_sweep.localCenter.y,b=B.col1.x*y+B.col2.x*I,I=B.col1.y*y+B.col2.y*I,y=b,B=q.m_xf.R,k=this.m_localAnchor2.x-q.m_sweep.localCenter.x,G=this.m_localAnchor2.y-q.m_sweep.localCenter.y,b=B.col1.x*k+B.col2.x*G,G=B.col1.y*k+B.col2.y*G,k=b,B=x.x+-D*G-E.x- -A*I,w=x.y+D*k-E.y-A*y;this.m_mass.Solve33(this.impulse3,-B,-w,-(D-A)),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(b=this.m_impulse.z+this.impulse3.z,0>b&&(this.m_mass.Solve22(this.reduced,-B,-w),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(b=this.m_impulse.z+this.impulse3.z,0<b&&(this.m_mass.Solve22(this.reduced,-B,-w),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),E.x-=z*this.impulse3.x,E.y-=z*this.impulse3.y,A-=C*(y*this.impulse3.y-I*this.impulse3.x+this.impulse3.z),x.x+=g*this.impulse3.x,x.y+=g*this.impulse3.y,D+=F*(k*this.impulse3.y-G*this.impulse3.x+this.impulse3.z)}else{B=H.m_xf.R,y=this.m_localAnchor1.x-H.m_sweep.localCenter.x,I=this.m_localAnchor1.y-H.m_sweep.localCenter.y,b=B.col1.x*y+B.col2.x*I,I=B.col1.y*y+B.col2.y*I,y=b,B=q.m_xf.R,k=this.m_localAnchor2.x-q.m_sweep.localCenter.x,G=this.m_localAnchor2.y-q.m_sweep.localCenter.y,b=B.col1.x*k+B.col2.x*G,G=B.col1.y*k+B.col2.y*G,k=b,this.m_mass.Solve22(this.impulse2,-(x.x+-D*G-E.x- -A*I),-(x.y+D*k-E.y-A*y)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,E.x-=z*this.impulse2.x,E.y-=z*this.impulse2.y,A-=C*(y*this.impulse2.y-I*this.impulse2.x),x.x+=g*this.impulse2.x,x.y+=g*this.impulse2.y,D+=F*(k*this.impulse2.y-G*this.impulse2.x)}H.m_linearVelocity.SetV(E),H.m_angularVelocity=A,q.m_linearVelocity.SetV(x),q.m_angularVelocity=D},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var z=0,F,m=this.m_bodyA,b=this.m_bodyB,w=0,G=F=0,k=0,E=0;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var z=b.m_sweep.a-m.m_sweep.a-this.m_referenceAngle,C=0;this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(z=Box2D.Common.Math.b2Math.Clamp(z-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),C=-this.m_motorMass*z,w=Math.abs(z)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(z-=this.m_lowerAngle,w=-z,z=Box2D.Common.Math.b2Math.Clamp(z+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),C=-this.m_motorMass*z):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(w=z-=this.m_upperAngle,z=Box2D.Common.Math.b2Math.Clamp(z-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),C=-this.m_motorMass*z),m.m_sweep.a-=m.m_invI*C,b.m_sweep.a+=b.m_invI*C,m.SynchronizeTransform(),b.SynchronizeTransform()}F=m.m_xf.R,C=this.m_localAnchor1.x-m.m_sweep.localCenter.x,z=this.m_localAnchor1.y-m.m_sweep.localCenter.y,G=F.col1.x*C+F.col2.x*z,z=F.col1.y*C+F.col2.y*z,C=G,F=b.m_xf.R;var y=this.m_localAnchor2.x-b.m_sweep.localCenter.x,q=this.m_localAnchor2.y-b.m_sweep.localCenter.y,G=F.col1.x*y+F.col2.x*q,q=F.col1.y*y+F.col2.y*q,y=G,k=b.m_sweep.c.x+y-m.m_sweep.c.x-C,E=b.m_sweep.c.y+q-m.m_sweep.c.y-z,B=k*k+E*E;F=Math.sqrt(B);var G=m.m_invMass,x=b.m_invMass,g=m.m_invI,A=b.m_invI,D=10*Box2D.Common.b2Settings.b2_linearSlop;return B>D*D&&(B=1/(G+x),k=B*-k,E=B*-E,m.m_sweep.c.x-=0.5*G*k,m.m_sweep.c.y-=0.5*G*E,b.m_sweep.c.x+=0.5*x*k,b.m_sweep.c.y+=0.5*x*E,k=b.m_sweep.c.x+y-m.m_sweep.c.x-C,E=b.m_sweep.c.y+q-m.m_sweep.c.y-z),this.K1.col1.x=G+x,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=G+x,this.K2.col1.x=g*z*z,this.K2.col2.x=-g*C*z,this.K2.col1.y=-g*C*z,this.K2.col2.y=g*C*C,this.K3.col1.x=A*q*q,this.K3.col2.x=-A*y*q,this.K3.col1.y=-A*y*q,this.K3.col2.y=A*y*y,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-k,-E),k=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x,E=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y,m.m_sweep.c.x-=m.m_invMass*k,m.m_sweep.c.y-=m.m_invMass*E,m.m_sweep.a-=m.m_invI*(C*E-z*k),b.m_sweep.c.x+=b.m_invMass*k,b.m_sweep.c.y+=b.m_invMass*E,b.m_sweep.a+=b.m_invI*(y*E-q*k),m.SynchronizeTransform(),b.SynchronizeTransform(),F<=Box2D.Common.b2Settings.b2_linearSlop&&w<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint,this.localAnchorA.SetZero(),this.localAnchorB.SetZero(),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(b,a,c){this.bodyA=b,this.bodyB=a,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_separations=[],this.m_points=[];for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++){this.m_points[a]=Box2D.Common.Math.b2Vec2.Get(0,0)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(a){Box2D.Common.b2Settings.b2Assert(0<a.pointCount);switch(a.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(a);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(a);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(a)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(g){var c=g.bodyA.m_xf.R,k=g.localPoint,f=g.bodyA.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y),b=g.bodyA.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y),c=g.bodyB.m_xf.R,k=g.points[0].localPoint,d=g.bodyB.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y),c=g.bodyB.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y),k=d-f,h=c-b,a=k*k+h*h;a>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(a=Math.sqrt(a),this.m_normal.x=k/a,this.m_normal.y=h/a):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=0.5*(f+d),this.m_points[0].y=0.5*(b+c),this.m_separations[0]=k*this.m_normal.x+h*this.m_normal.y-g.radius},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(f){this.m_normal.x=f.bodyA.m_xf.R.col1.x*f.localPlaneNormal.x+f.bodyA.m_xf.R.col2.x*f.localPlaneNormal.y,this.m_normal.y=f.bodyA.m_xf.R.col1.y*f.localPlaneNormal.x+f.bodyA.m_xf.R.col2.y*f.localPlaneNormal.y;for(var b=f.bodyA.m_xf.position.x+(f.bodyA.m_xf.R.col1.x*f.localPoint.x+f.bodyA.m_xf.R.col2.x*f.localPoint.y),g=f.bodyA.m_xf.position.y+(f.bodyA.m_xf.R.col1.y*f.localPoint.x+f.bodyA.m_xf.R.col2.y*f.localPoint.y),d=0;d<f.pointCount;d++){var a=f.bodyB.m_xf.position.x+(f.bodyB.m_xf.R.col1.x*f.points[d].localPoint.x+f.bodyB.m_xf.R.col2.x*f.points[d].localPoint.y),c=f.bodyB.m_xf.position.y+(f.bodyB.m_xf.R.col1.y*f.points[d].localPoint.x+f.bodyB.m_xf.R.col2.y*f.points[d].localPoint.y);this.m_separations[d]=(a-b)*this.m_normal.x+(c-g)*this.m_normal.y-f.radius,this.m_points[d].x=a,this.m_points[d].y=c}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(f){this.m_normal.x=f.bodyB.m_xf.R.col1.x*f.localPlaneNormal.x+f.bodyB.m_xf.R.col2.x*f.localPlaneNormal.y,this.m_normal.y=f.bodyB.m_xf.R.col1.y*f.localPlaneNormal.x+f.bodyB.m_xf.R.col2.y*f.localPlaneNormal.y;for(var b=f.bodyB.m_xf.position.x+(f.bodyB.m_xf.R.col1.x*f.localPoint.x+f.bodyB.m_xf.R.col2.x*f.localPoint.y),g=f.bodyB.m_xf.position.y+(f.bodyB.m_xf.R.col1.y*f.localPoint.x+f.bodyB.m_xf.R.col2.y*f.localPoint.y),d=0;d<f.pointCount;d++){var a=f.bodyA.m_xf.position.x+(f.bodyA.m_xf.R.col1.x*f.points[d].localPoint.x+f.bodyA.m_xf.R.col2.x*f.points[d].localPoint.y),c=f.bodyA.m_xf.position.y+(f.bodyA.m_xf.R.col1.y*f.points[d].localPoint.x+f.bodyA.m_xf.R.col2.y*f.points[d].localPoint.y);this.m_separations[d]=(a-b)*this.m_normal.x+(c-g)*this.m_normal.y-f.radius,this.m_points[d].Set(a,c)}this.m_normal.x*=-1,this.m_normal.y*=-1},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(b,a){Box2D.Common.b2Settings.b2Assert(b.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(a.GetShape() instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.call(this,b,a)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(b,a){Box2D.Common.b2Settings.b2Assert(b.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(a.GetShape() instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,b,a)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){var b=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,b,this.m_fixtureA.GetBody().m_xf,a,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.rA=Box2D.Common.Math.b2Vec2.Get(0,0),this.rB=Box2D.Common.Math.b2Vec2.Get(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0),this.rA.Set(0,0),this.rB.Set(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.normalMass=new Box2D.Common.Math.b2Mat22,this.K=new Box2D.Common.Math.b2Mat22,this.points=[];for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++){this.points[a]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint}},Box2D.Dynamics.b2FixtureList=function(){this.fixtureLastNode=this.fixtureFirstNode=null,this.fixtureNodeLookup={},this.fixtureCount=0},Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode},Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(b){var a=b.ID;if(null==this.fixtureNodeLookup[a]){var b=new Box2D.Dynamics.b2FixtureListNode(b),c=this.fixtureLastNode;null!=c?c.SetNextNode(b):this.fixtureFirstNode=b,b.SetPreviousNode(c),this.fixtureLastNode=b,this.fixtureNodeLookup[a]=b,this.fixtureCount++}},Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(b){var b=b.ID,a=this.fixtureNodeLookup[b];if(null!=a){var c=a.GetPreviousNode(),a=a.GetNextNode();null==c?this.fixtureFirstNode=a:c.SetNextNode(a),null==a?this.fixtureLastNode=c:a.SetPreviousNode(c),delete this.fixtureNodeLookup[b],this.fixtureCount--}},Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount},Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(c,a,d,b){void 0===a&&(a=0),void 0===b&&(b=0),this.linearA.SetV(c),this.angularA=a,this.linearB.SetV(d),this.angularB=b},Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(c,a,d,b){return void 0===a&&(a=0),void 0===b&&(b=0),this.linearA.x*c.x+this.linearA.y*c.y+this.angularA*a+(this.linearB.x*d.x+this.linearB.y*d.y)+this.angularB*b},Box2D.Dynamics.Joints.b2GearJoint=function(d){Box2D.Dynamics.Joints.b2Joint.call(this,d),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var b=d.joint1.m_type,f=d.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var c=0,a=0;this.m_ground1=d.joint1.GetBodyA(),this.m_bodyA=d.joint1.GetBodyB(),b==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=d.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),c=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=d.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),c=this.m_prismatic1.GetJointTranslation()),this.m_ground2=d.joint2.GetBodyA(),this.m_bodyB=d.joint2.GetBodyB(),f==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=d.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),a=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=d.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),a=this.m_prismatic2.GetJointTranslation()),this.m_ratio=d.ratio,this.m_constant=c+this.m_ratio*a,this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(d){void 0===d&&(d=0);var b=this.m_bodyB.m_xf.R,f=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,c=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,a=b.col1.x*f+b.col2.x*c,c=b.col1.y*f+b.col2.y*c;return d*(this.m_impulse*this.m_J.angularB-a*this.m_impulse*this.m_J.linearB.y+c*this.m_impulse*this.m_J.linearB.x)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(a){void 0===a&&(a=0),this.m_ratio=a},Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(m){var v=this.m_ground1,d=this.m_ground2,b=this.m_bodyA,h=this.m_bodyB,w=0,c=0,q=0,p=0,k=q=0,g=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,g+=b.m_invI):(v=v.m_xf.R,c=this.m_prismatic1.m_localXAxis1,w=v.col1.x*c.x+v.col2.x*c.y,c=v.col1.y*c.x+v.col2.y*c.y,v=b.m_xf.R,q=this.m_localAnchor1.x-b.m_sweep.localCenter.x,p=this.m_localAnchor1.y-b.m_sweep.localCenter.y,k=v.col1.x*q+v.col2.x*p,p=v.col1.y*q+v.col2.y*p,q=k*c-p*w,this.m_J.linearA.Set(-w,-c),this.m_J.angularA=-q,g+=b.m_invMass+b.m_invI*q*q),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,g+=this.m_ratio*this.m_ratio*h.m_invI):(v=d.m_xf.R,c=this.m_prismatic2.m_localXAxis1,w=v.col1.x*c.x+v.col2.x*c.y,c=v.col1.y*c.x+v.col2.y*c.y,v=h.m_xf.R,q=this.m_localAnchor2.x-h.m_sweep.localCenter.x,p=this.m_localAnchor2.y-h.m_sweep.localCenter.y,k=v.col1.x*q+v.col2.x*p,p=v.col1.y*q+v.col2.y*p,q=k*c-p*w,this.m_J.linearB.Set(-this.m_ratio*w,-this.m_ratio*c),this.m_J.angularB=-this.m_ratio*q,g+=this.m_ratio*this.m_ratio*(h.m_invMass+h.m_invI*q*q)),this.m_mass=0<g?1/g:0,m.warmStarting?(b.m_linearVelocity.x+=b.m_invMass*this.m_impulse*this.m_J.linearA.x,b.m_linearVelocity.y+=b.m_invMass*this.m_impulse*this.m_J.linearA.y,b.m_angularVelocity+=b.m_invI*this.m_impulse*this.m_J.angularA,h.m_linearVelocity.x+=h.m_invMass*this.m_impulse*this.m_J.linearB.x,h.m_linearVelocity.y+=h.m_invMass*this.m_impulse*this.m_J.linearB.y,h.m_angularVelocity+=h.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(){var b=this.m_bodyA,a=this.m_bodyB,c=-this.m_mass*this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,a.m_linearVelocity,a.m_angularVelocity);this.m_impulse+=c,b.m_linearVelocity.x+=b.m_invMass*c*this.m_J.linearA.x,b.m_linearVelocity.y+=b.m_invMass*c*this.m_J.linearA.y,b.m_angularVelocity+=b.m_invI*c*this.m_J.angularA,a.m_linearVelocity.x+=a.m_invMass*c*this.m_J.linearB.x,a.m_linearVelocity.y+=a.m_invMass*c*this.m_J.linearB.y,a.m_angularVelocity+=a.m_invI*c*this.m_J.angularB},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(){var c=this.m_bodyA,a=this.m_bodyB,d=0,b=0,d=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),b=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),d=-this.m_mass*(this.m_constant-(d+this.m_ratio*b));return c.m_sweep.c.x+=c.m_invMass*d*this.m_J.linearA.x,c.m_sweep.c.y+=c.m_invMass*d*this.m_J.linearA.y,c.m_sweep.a+=c.m_invI*d*this.m_J.angularA,a.m_sweep.c.x+=a.m_invMass*d*this.m_J.linearB.x,a.m_sweep.c.y+=a.m_invMass*d*this.m_J.linearB.y,a.m_sweep.a+=a.m_invI*d*this.m_J.angularB,c.SynchronizeTransform(),a.SynchronizeTransform(),0<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},goog.inherits(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(b,a,c){this.joint1=b,this.bodyA=b.GetBodyA(),this.joint2=a,this.bodyB=a.GetBodyA(),this.ratio=c},Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)},Box2D.Dynamics.Joints.b2PulleyJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=Math.min(a.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=Math.min(a.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var b=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),a=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(a*a+b*b)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var b=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),a=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(a*a+b*b)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(m){var v=this.m_bodyA,d=this.m_bodyB,b;b=v.m_xf.R;var h=this.m_localAnchor1.x-v.m_sweep.localCenter.x,w=this.m_localAnchor1.y-v.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*w,w=b.col1.y*h+b.col2.y*w,h=c;b=d.m_xf.R;var q=this.m_localAnchor2.x-d.m_sweep.localCenter.x,p=this.m_localAnchor2.y-d.m_sweep.localCenter.y,c=b.col1.x*q+b.col2.x*p,p=b.col1.y*q+b.col2.y*p,q=c;b=d.m_sweep.c.x+q;var c=d.m_sweep.c.y+p,k=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(v.m_sweep.c.x+h-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),v.m_sweep.c.y+w-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(b-k,c-g),b=this.m_u1.Length(),c=this.m_u2.Length(),b>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),c>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/c):this.m_u2.SetZero(),0<this.m_constant-b-this.m_ratio*c?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,b<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,c<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,b=h*this.m_u1.y-w*this.m_u1.x,c=q*this.m_u2.y-p*this.m_u2.x,this.m_limitMass1=v.m_invMass+v.m_invI*b*b,this.m_limitMass2=d.m_invMass+d.m_invI*c*c,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,m.warmStarting?(this.m_impulse*=m.dtRatio,this.m_limitImpulse1*=m.dtRatio,this.m_limitImpulse2*=m.dtRatio,m=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,c=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,v.m_linearVelocity.x+=v.m_invMass*m,v.m_linearVelocity.y+=v.m_invMass*b,v.m_angularVelocity+=v.m_invI*(h*b-w*m),d.m_linearVelocity.x+=d.m_invMass*c,d.m_linearVelocity.y+=d.m_invMass*k,d.m_angularVelocity+=d.m_invI*(q*k-p*c)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var k=this.m_bodyA,p=this.m_bodyB,d;d=k.m_xf.R;var b=this.m_localAnchor1.x-k.m_sweep.localCenter.x,g=this.m_localAnchor1.y-k.m_sweep.localCenter.y,q=d.col1.x*b+d.col2.x*g,g=d.col1.y*b+d.col2.y*g,b=q;d=p.m_xf.R;var c=this.m_localAnchor2.x-p.m_sweep.localCenter.x,m=this.m_localAnchor2.y-p.m_sweep.localCenter.y,q=d.col1.x*c+d.col2.x*m,m=d.col1.y*c+d.col2.y*m,c=q,l=q=d=0,h=0;d=h=d=h=l=q=d=0,this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(d=k.m_linearVelocity.x+-k.m_angularVelocity*g,q=k.m_linearVelocity.y+k.m_angularVelocity*b,l=p.m_linearVelocity.x+-p.m_angularVelocity*m,h=p.m_linearVelocity.y+p.m_angularVelocity*c,d=-(this.m_u1.x*d+this.m_u1.y*q)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*h),h=this.m_pulleyMass*-d,d=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+h),h=this.m_impulse-d,d=-h*this.m_u1.x,q=-h*this.m_u1.y,l=-this.m_ratio*h*this.m_u2.x,h=-this.m_ratio*h*this.m_u2.y,k.m_linearVelocity.x+=k.m_invMass*d,k.m_linearVelocity.y+=k.m_invMass*q,k.m_angularVelocity+=k.m_invI*(b*q-g*d),p.m_linearVelocity.x+=p.m_invMass*l,p.m_linearVelocity.y+=p.m_invMass*h,p.m_angularVelocity+=p.m_invI*(c*h-m*l)),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(d=k.m_linearVelocity.x+-k.m_angularVelocity*g,q=k.m_linearVelocity.y+k.m_angularVelocity*b,d=-(this.m_u1.x*d+this.m_u1.y*q),h=-this.m_limitMass1*d,d=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+h),h=this.m_limitImpulse1-d,d=-h*this.m_u1.x,q=-h*this.m_u1.y,k.m_linearVelocity.x+=k.m_invMass*d,k.m_linearVelocity.y+=k.m_invMass*q,k.m_angularVelocity+=k.m_invI*(b*q-g*d)),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(l=p.m_linearVelocity.x+-p.m_angularVelocity*m,h=p.m_linearVelocity.y+p.m_angularVelocity*c,d=-(this.m_u2.x*l+this.m_u2.y*h),h=-this.m_limitMass2*d,d=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+h),h=this.m_limitImpulse2-d,l=-h*this.m_u2.x,h=-h*this.m_u2.y,p.m_linearVelocity.x+=p.m_invMass*l,p.m_linearVelocity.y+=p.m_invMass*h,p.m_angularVelocity+=p.m_invI*(c*h-m*l))},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(){var y=this.m_bodyA,D=this.m_bodyB,m,b=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,v=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,E=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,C=0,B=0,x=0,q=0,A=m=0,w=0,g=0,z=A=g=m=A=m=0;return this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(m=y.m_xf.R,C=this.m_localAnchor1.x-y.m_sweep.localCenter.x,B=this.m_localAnchor1.y-y.m_sweep.localCenter.y,A=m.col1.x*C+m.col2.x*B,B=m.col1.y*C+m.col2.y*B,C=A,m=D.m_xf.R,x=this.m_localAnchor2.x-D.m_sweep.localCenter.x,q=this.m_localAnchor2.y-D.m_sweep.localCenter.y,A=m.col1.x*x+m.col2.x*q,q=m.col1.y*x+m.col2.y*q,x=A,m=y.m_sweep.c.x+C,A=y.m_sweep.c.y+B,w=D.m_sweep.c.x+x,g=D.m_sweep.c.y+q,this.m_u1.Set(m-b,A-v),this.m_u2.Set(w-E,g-k),m=this.m_u1.Length(),A=this.m_u2.Length(),m>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/m):this.m_u1.SetZero(),A>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/A):this.m_u2.SetZero(),m=this.m_constant-m-this.m_ratio*A,z=Math.max(z,-m),m=Box2D.Common.Math.b2Math.Clamp(m+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),g=-this.m_pulleyMass*m,m=-g*this.m_u1.x,A=-g*this.m_u1.y,w=-this.m_ratio*g*this.m_u2.x,g=-this.m_ratio*g*this.m_u2.y,y.m_sweep.c.x+=y.m_invMass*m,y.m_sweep.c.y+=y.m_invMass*A,y.m_sweep.a+=y.m_invI*(C*A-B*m),D.m_sweep.c.x+=D.m_invMass*w,D.m_sweep.c.y+=D.m_invMass*g,D.m_sweep.a+=D.m_invI*(x*g-q*w),y.SynchronizeTransform(),D.SynchronizeTransform()),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(m=y.m_xf.R,C=this.m_localAnchor1.x-y.m_sweep.localCenter.x,B=this.m_localAnchor1.y-y.m_sweep.localCenter.y,A=m.col1.x*C+m.col2.x*B,B=m.col1.y*C+m.col2.y*B,C=A,m=y.m_sweep.c.x+C,A=y.m_sweep.c.y+B,this.m_u1.Set(m-b,A-v),m=this.m_u1.Length(),m>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/m,this.m_u1.y*=1/m):this.m_u1.SetZero(),m=this.m_maxLength1-m,z=Math.max(z,-m),m=Box2D.Common.Math.b2Math.Clamp(m+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),g=-this.m_limitMass1*m,m=-g*this.m_u1.x,A=-g*this.m_u1.y,y.m_sweep.c.x+=y.m_invMass*m,y.m_sweep.c.y+=y.m_invMass*A,y.m_sweep.a+=y.m_invI*(C*A-B*m),y.SynchronizeTransform()),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(m=D.m_xf.R,x=this.m_localAnchor2.x-D.m_sweep.localCenter.x,q=this.m_localAnchor2.y-D.m_sweep.localCenter.y,A=m.col1.x*x+m.col2.x*q,q=m.col1.y*x+m.col2.y*q,x=A,w=D.m_sweep.c.x+x,g=D.m_sweep.c.y+q,this.m_u2.Set(w-E,g-k),A=this.m_u2.Length(),A>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/A,this.m_u2.y*=1/A):this.m_u2.SetZero(),m=this.m_maxLength2-A,z=Math.max(z,-m),m=Box2D.Common.Math.b2Math.Clamp(m+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),g=-this.m_limitMass2*m,w=-g*this.m_u2.x,g=-g*this.m_u2.y,D.m_sweep.c.x+=D.m_invMass*w,D.m_sweep.c.y+=D.m_invMass*g,D.m_sweep.a+=D.m_invI*(x*g-q*w),D.SynchronizeTransform()),z<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1,Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.b2ContactImpulse.prototype.Reset=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.Contacts.b2ContactListNode=function(a){this.contact=a,this.previous=this.next=null},Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[],Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(b){if(0<Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length){var a=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();return a.next=null,a.previous=null,a.contact=b,a}return new Box2D.Dynamics.Contacts.b2ContactListNode(b)},Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(a){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(a)},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var a=0;a<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;a++){this.contactFirstNodes[a]=null}this.contactLastNodes=[];for(a=0;a<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;a++){this.contactLastNodes[a]=null}this.contactNodeLookup={},this.contactCount=0},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(a){return this.contactFirstNodes[a]},Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(b){var a=b.ID;if(null==this.contactNodeLookup[a]){this.contactNodeLookup[a]=[];for(var c=0;c<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;c++){this.contactNodeLookup[a][c]=null}this.CreateNode(b,a,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts),this.contactCount++}},Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(b,a,c){a?this.CreateNode(b,b.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(b.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts),c?this.CreateNode(b,b.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(b.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(b){b=b.ID;if(null!=this.contactNodeLookup[b]){for(var a=0;a<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;a++){this.RemoveNode(b,a)}delete this.contactNodeLookup[b],this.contactCount--}},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(d,b){var f=this.contactNodeLookup[d];if(null!=f){var c=f[b];if(null!=c){f[b]=null;var f=c.GetPreviousNode(),a=c.GetNextNode();null==f?this.contactFirstNodes[b]=a:f.SetNextNode(a),null==a?this.contactLastNodes[b]=f:a.SetPreviousNode(f),Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(c)}}},Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(b,a,c){a=this.contactNodeLookup[a],null==a[c]&&(a[c]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(b),b=this.contactLastNodes[c],null!=b?(b.SetNextNode(a[c]),a[c].SetPreviousNode(b)):this.contactFirstNodes[c]=a[c],this.contactLastNodes[c]=a[c])},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount},Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2},Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment.prototype.TestSegment=function(p,x,g,b){var k=g.p1,y=g.p2.x-k.x,d=g.p2.y-k.y,g=this.p2.y-this.p1.y,w=-(this.p2.x-this.p1.x),v=100*Number.MIN_VALUE,m=-(y*g+d*w);if(m>v){var h=k.x-this.p1.x,q=k.y-this.p1.y,k=h*g+q*w;if(0<=k&&k<=b*m&&(b=-y*q+d*h,-v*m<=b&&b<=m*(1+v))){return k/=m,b=Math.sqrt(g*g+w*w),p[0]=k,x.Set(g/b,w/b),!0}}return !1},Box2D.Collision.b2Segment.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},Box2D.Collision.b2Segment.prototype.ExtendForward=function(b){var a=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,b=Math.min(0<a?(b.upperBound.x-this.p1.x)/a:0>a?(b.lowerBound.x-this.p1.x)/a:Number.POSITIVE_INFINITY,0<c?(b.upperBound.y-this.p1.y)/c:0>c?(b.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+a*b,this.p2.y=this.p1.y+c*b},Box2D.Collision.b2Segment.prototype.ExtendBackward=function(b){var a=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,b=Math.min(0<a?(b.upperBound.x-this.p2.x)/a:0>a?(b.lowerBound.x-this.p2.x)/a:Number.POSITIVE_INFINITY,0<c?(b.upperBound.y-this.p2.y)/c:0>c?(b.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+a*b,this.p1.y=this.p2.y+c*b},Box2D.Dynamics.Joints.b2MouseJoint=function(c){Box2D.Dynamics.Joints.b2Joint.call(this,c),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.m_localAnchor=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_mass=new Box2D.Common.Math.b2Mat22,this.m_C=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target.SetV(c.target);var a=this.m_target.x-this.m_bodyB.m_xf.position.x,d=this.m_target.y-this.m_bodyB.m_xf.position.y,b=this.m_bodyB.m_xf.R;this.m_localAnchor.x=a*b.col1.x+d*b.col1.y,this.m_localAnchor.y=a*b.col2.x+d*b.col2.y,this.m_maxForce=c.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=c.frequencyHz,this.m_dampingRatio=c.dampingRatio,this.m_gamma=this.m_beta=0},goog.inherits(Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorA=function(){return Box2D.Common.Math.b2Vec2.Get(this.m_target.x,this.m_target.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse.x,a*this.m_impulse.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetTarget=function(){return this.m_target},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetFrequency=function(a){void 0===a&&(a=0),this.m_frequencyHz=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetDampingRatio=function(a){void 0===a&&(a=0),this.m_dampingRatio=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.InitVelocityConstraints=function(f){var b=this.m_bodyB,g=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,a=g*d*d;this.m_gamma=f.dt*(2*g*this.m_dampingRatio*d+f.dt*a),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=f.dt*a*this.m_gamma;var a=b.m_xf.R,g=this.m_localAnchor.x-b.m_sweep.localCenter.x,d=this.m_localAnchor.y-b.m_sweep.localCenter.y,c=a.col1.x*g+a.col2.x*d,d=a.col1.y*g+a.col2.y*d,g=c,a=b.m_invMass,c=b.m_invI;this.K1.col1.x=a,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=a,this.K2.col1.x=c*d*d,this.K2.col2.x=-c*g*d,this.K2.col1.y=-c*g*d,this.K2.col2.y=c*g*g,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+g-this.m_target.x,this.m_C.y=b.m_sweep.c.y+d-this.m_target.y,b.m_angularVelocity*=0.98,this.m_impulse.x*=f.dtRatio,this.m_impulse.y*=f.dtRatio,b.m_linearVelocity.x+=a*this.m_impulse.x,b.m_linearVelocity.y+=a*this.m_impulse.y,b.m_angularVelocity+=c*(g*this.m_impulse.y-d*this.m_impulse.x)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolveVelocityConstraints=function(g){var c=this.m_bodyB,k,f=0,b=0;k=c.m_xf.R;var d=this.m_localAnchor.x-c.m_sweep.localCenter.x,h=this.m_localAnchor.y-c.m_sweep.localCenter.y,f=k.col1.x*d+k.col2.x*h,h=k.col1.y*d+k.col2.y*h,d=f,f=c.m_linearVelocity.x+-c.m_angularVelocity*h,a=c.m_linearVelocity.y+c.m_angularVelocity*d;k=this.m_mass,f=f+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,b=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,a=-(k.col1.x*f+k.col2.x*b),b=-(k.col1.y*f+k.col2.y*b),k=this.m_impulse.x,f=this.m_impulse.y,this.m_impulse.x+=a,this.m_impulse.y+=b,g=g.dt*this.m_maxForce,this.m_impulse.LengthSquared()>g*g&&this.m_impulse.Multiply(g/this.m_impulse.Length()),a=this.m_impulse.x-k,b=this.m_impulse.y-f,c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*b,c.m_angularVelocity+=c.m_invI*(d*b-h*a)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolvePositionConstraints=function(){return !0},Box2D.Dynamics.b2BodyListNode=function(a){this.body=a,this.previous=this.next=null},Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body},Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Common.b2Color=function(b,a,c){this._r=255*Box2D.Common.Math.b2Math.Clamp(b,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(a,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(c,0,1)},Box2D.Common.b2Color.prototype.Set=function(b,a,c){this._r=255*Box2D.Common.Math.b2Math.Clamp(b,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(a,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(c,0,1)},Box2D.Common.b2Color.prototype.GetColor=function(){return this._r<<16|this._g<<8|this._b},Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var a=0;a<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;a++){this.bodyFirstNodes[a]=null}this.bodyLastNodes=[];for(a=0;a<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;a++){this.bodyLastNodes[a]=null}this.bodyNodeLookup={},this.bodyCount=0},Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(a){return this.bodyFirstNodes[a]},Box2D.Dynamics.b2BodyList.prototype.AddBody=function(b){var a=b.ID;null==this.bodyNodeLookup[a]&&(this.CreateNode(b,a,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(b),b.m_lists.push(this),this.bodyCount++)},Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(d){var b=d.GetType(),f=d.ID,c=d.IsAwake(),a=d.IsActive();b==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(d,f,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(f,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies),b!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(d,f,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(f,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies),b!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&a&&c?this.CreateNode(d,f,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(f,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies),c?this.CreateNode(d,f,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(f,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies),a?this.CreateNode(d,f,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(f,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)},Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(b){var a=b.ID;if(null!=this.bodyNodeLookup[a]){goog.array.remove(b.m_lists,this);for(b=0;b<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;b++){this.RemoveNode(a,b)}delete this.bodyNodeLookup[a],this.bodyCount--}},Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(c,a){var d=this.bodyNodeLookup[c];if(null!=d){var b=d[a];null!=b&&(d[a]=null,d=b.GetPreviousNode(),b=b.GetNextNode(),null==d?this.bodyFirstNodes[a]=b:d.SetNextNode(b),null==b?this.bodyLastNodes[a]=d:b.SetPreviousNode(d))}},Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(d,b,f){var c=this.bodyNodeLookup[b];if(null==c){for(var c=[],a=0;a<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;a++){c[a]=null}this.bodyNodeLookup[b]=c}null==c[f]&&(c[f]=new Box2D.Dynamics.b2BodyListNode(d),d=this.bodyLastNodes[f],null!=d?d.SetNextNode(c[f]):this.bodyFirstNodes[f]=c[f],c[f].SetPreviousNode(d),this.bodyLastNodes[f]=c[f])},Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount},Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5},Box2D.Dynamics.Controllers={},Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++,this.m_world=null,this.bodyList=new Box2D.Dynamics.b2BodyList},Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.Draw=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(a){this.bodyList.AddBody(a),a.AddController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(a){this.bodyList.RemoveBody(a),a.RemoveController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);a;a=a.GetNextNode()){this.RemoveBody(a.body)}},Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0,Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.A=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(c){for(var c=Box2D.Common.Math.b2Vec2.Get(this.A.x*c.dt,this.A.y*c.dt),a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);a;a=a.GetNextNode()){var d=a.body,b=d.GetLinearVelocity(),b=Box2D.Common.Math.b2Vec2.Get(b.x+c.x,b.y+c.y);d.SetLinearVelocity(b),Box2D.Common.Math.b2Vec2.Free(b)}Box2D.Common.Math.b2Vec2.Free(c)},Box2D.Dynamics.Contacts.b2PolygonContact=function(b,a){Box2D.Dynamics.Contacts.b2Contact.call(this,b,a)},goog.inherits(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(b,a){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,b,a)},Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){var b=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,b,this.m_fixtureA.GetBody().m_xf,a,this.m_fixtureB.GetBody().m_xf)},Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Dynamics.b2Island=function(b,a){this.m_listener=b,this.m_contactSolver=a,this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[],this.impulse=new Box2D.Dynamics.b2ContactImpulse},Box2D.Dynamics.b2Island.prototype.Reset=function(b,a){this.m_listener=b,this.m_contactSolver=a},Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Solve=function(b,a,c){this._InitializeVelocities(b,a),this.m_contactSolver.Initialize(b,this.m_contacts,this.m_contacts.length),this._SolveVelocityConstraints(b),this._SolveBodies(b),this._SolvePositionConstraints(b),this.Report(this.m_contactSolver.m_constraints),c&&this._SleepIfTired(b)},Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(f,b){for(var g=0;g<this.m_dynamicBodies.length;g++){var d=this.m_dynamicBodies[g],a=b.x,c=b.y;d._pc_gravityX!=undefined&&(a=d._pc_gravityX),d._pc_gravityY!=undefined&&(c=d._pc_gravityY),d.m_linearVelocity.x+=f.dt*(a+d.m_invMass*d.m_force.x),d.m_linearVelocity.y+=f.dt*(c+d.m_invMass*d.m_force.y),d.m_angularVelocity+=f.dt*d.m_invI*d.m_torque,d.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-f.dt*d.m_linearDamping,0,1)),d.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-f.dt*d.m_angularDamping,0,1)}},Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(b){this.m_contactSolver.InitVelocityConstraints(b);for(var a=0;a<this.m_joints.length;a++){this.m_joints[a].InitVelocityConstraints(b)}for(a=0;a<b.velocityIterations;a++){for(var c=0;c<this.m_joints.length;c++){this.m_joints[c].SolveVelocityConstraints(b)}this.m_contactSolver.SolveVelocityConstraints()}for(b=0;b<this.m_joints.length;b++){this.m_joints[b].FinalizeVelocityConstraints()}this.m_contactSolver.FinalizeVelocityConstraints()},Box2D.Dynamics.b2Island.prototype._SolveBodies=function(d){for(var b=0;b<this.m_nonStaticBodies.length;++b){var f=this.m_nonStaticBodies[b],c=d.dt*f.m_linearVelocity.x,a=d.dt*f.m_linearVelocity.y;c*c+a*a>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(f.m_linearVelocity.Normalize(),f.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*d.inv_dt,f.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*d.inv_dt),c=d.dt*f.m_angularVelocity,c*c>Box2D.Common.b2Settings.b2_maxRotationSquared&&(f.m_angularVelocity=0>f.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*d.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*d.inv_dt),f.m_sweep.c0.SetV(f.m_sweep.c),f.m_sweep.a0=f.m_sweep.a,f.m_sweep.c.x+=d.dt*f.m_linearVelocity.x,f.m_sweep.c.y+=d.dt*f.m_linearVelocity.y,f.m_sweep.a+=d.dt*f.m_angularVelocity,f.SynchronizeTransform()}},Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(f){for(var b=0;b<f.positionIterations;b++){for(var g=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),d=!0,a=0;a<this.m_joints.length;a++){var c=this.m_joints[a].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),d=d&&c}if(g&&d){break}}},Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(c){for(var a=Number.MAX_VALUE,d=0;d<this.m_nonStaticBodies.length;d++){var b=this.m_nonStaticBodies[d];!b.m_allowSleep||Math.abs(b.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(b.m_linearVelocity,b.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?a=b.m_sleepTime=0:(b.m_sleepTime+=c.dt,a=Math.min(a,b.m_sleepTime))}if(a>=Box2D.Common.b2Settings.b2_timeToSleep){for(c=0;c<this.m_bodies.length;c++){this.m_bodies[c].SetAwake(!1)}}},Box2D.Dynamics.b2Island.prototype.SolveTOI=function(f){var b=0,h=0;this.m_contactSolver.Initialize(f,this.m_contacts,this.m_contacts.length);for(var d=this.m_contactSolver,b=0;b<this.m_joints.length;++b){this.m_joints[b].InitVelocityConstraints(f)}for(b=0;b<f.velocityIterations;++b){d.SolveVelocityConstraints();for(h=0;h<this.m_joints.length;++h){this.m_joints[h].SolveVelocityConstraints(f)}}for(b=0;b<this.m_nonStaticBodies.length;++b){var h=this.m_nonStaticBodies[b],a=f.dt*h.m_linearVelocity.x,c=f.dt*h.m_linearVelocity.y;a*a+c*c>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(h.m_linearVelocity.Normalize(),h.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*f.inv_dt,h.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*f.inv_dt),a=f.dt*h.m_angularVelocity,a*a>Box2D.Common.b2Settings.b2_maxRotationSquared&&(h.m_angularVelocity=0>h.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*f.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*f.inv_dt),h.m_sweep.c0.SetV(h.m_sweep.c),h.m_sweep.a0=h.m_sweep.a,h.m_sweep.c.x+=f.dt*h.m_linearVelocity.x,h.m_sweep.c.y+=f.dt*h.m_linearVelocity.y,h.m_sweep.a+=f.dt*h.m_angularVelocity,h.SynchronizeTransform()}for(b=0;b<f.positionIterations;++b){a=d.SolvePositionConstraints(0.75),c=!0;for(h=0;h<this.m_joints.length;++h){var g=this.m_joints[h].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),c=c&&g}if(a&&c){break}}this.Report(d.m_constraints)},Box2D.Dynamics.b2Island.prototype.Report=function(d){if(null!=this.m_listener){for(var b=0;b<this.m_contacts.length;++b){var f=this.m_contacts[b],c=d[b];this.impulse.Reset();for(var a=0;a<c.pointCount;++a){this.impulse.normalImpulses[a]=c.points[a].normalImpulse,this.impulse.tangentImpulses[a]=c.points[a].tangentImpulse}this.m_listener.PostSolve(f,this.impulse)}}},Box2D.Dynamics.b2Island.prototype.AddBody=function(a){this.m_bodies.push(a),a.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(a),a.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(a))},Box2D.Dynamics.b2Island.prototype.AddContact=function(a){this.m_contacts.push(a)},Box2D.Dynamics.b2Island.prototype.AddJoint=function(a){this.m_joints.push(a)},Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null,this.poolCount=0},Box2D.Collision.b2DynamicTreePair=function(b,a){this.fixtureA=b,this.fixtureB=a},Box2D.Collision.b2DynamicTreePair._freeCache=[],Box2D.Collision.b2DynamicTreePair.Get=function(b,a){if(0<Box2D.Collision.b2DynamicTreePair._freeCache.length){var c=Box2D.Collision.b2DynamicTreePair._freeCache.pop();return c.fixtureA=b,c.fixtureB=a,c}return new Box2D.Collision.b2DynamicTreePair(b,a)},Box2D.Collision.b2DynamicTreePair.Free=function(a){null!=a&&Box2D.Collision.b2DynamicTreePair._freeCache.push(a)},Box2D.Dynamics.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1,this.m_drawFlags=0,this.m_originX=0,this.m_originY=0,this.m_ctx=null},Box2D.Dynamics.b2DebugDraw.prototype.SetOrigin=function(b,a){this.m_originX=b,this.m_originY=a},Box2D.Dynamics.b2DebugDraw.prototype.Clear=function(){},Box2D.Dynamics.b2DebugDraw.prototype._color=function(b,a){return"rgba("+((b&16711680)>>16)+","+((b&65280)>>8)+","+(b&255)+","+a+")"},Box2D.Dynamics.b2DebugDraw.prototype.SetFlags=function(a){this.m_drawFlags=a},Box2D.Dynamics.b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},Box2D.Dynamics.b2DebugDraw.prototype.AppendFlags=function(a){this.m_drawFlags|=a},Box2D.Dynamics.b2DebugDraw.prototype.ClearFlags=function(a){this.m_drawFlags&=~a},Box2D.Dynamics.b2DebugDraw.prototype.SetSprite=function(a){this.m_ctx=a},Box2D.Dynamics.b2DebugDraw.prototype.GetSprite=function(){return this.m_ctx},Box2D.Dynamics.b2DebugDraw.prototype.SetDrawScale=function(a){this.m_drawScale=a},Box2D.Dynamics.b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},Box2D.Dynamics.b2DebugDraw.prototype.SetLineThickness=function(a){this.m_lineThickness=a,this.m_ctx.strokeWidth=a},Box2D.Dynamics.b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},Box2D.Dynamics.b2DebugDraw.prototype.SetAlpha=function(a){this.m_alpha=a},Box2D.Dynamics.b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},Box2D.Dynamics.b2DebugDraw.prototype.SetFillAlpha=function(a){this.m_fillAlpha=a},Box2D.Dynamics.b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},Box2D.Dynamics.b2DebugDraw.prototype.SetXFormScale=function(a){this.m_xformScale=a},Box2D.Dynamics.b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},function(a){a.prototype.DrawPolygon=function(f,c,g){if(c){var d=this.m_ctx,b=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(g.GetColor(),this.m_alpha),d.moveTo(f[0].x*b-this.m_originX,f[0].y*b-this.m_originY);for(g=1;g<c;g++){d.lineTo(f[g].x*b-this.m_originX,f[g].y*b-this.m_originY)}d.lineTo(f[0].x*b-this.m_originX,f[0].y*b-this.m_originY),d.closePath(),d.stroke()}},a.prototype.DrawSolidPolygon=function(f,c,g){if(c){var d=this.m_ctx,b=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(g.GetColor(),this.m_alpha),d.fillStyle=this._color(g.GetColor(),this.m_fillAlpha),d.moveTo(f[0].x*b-this.m_originX,f[0].y*b-this.m_originY);for(g=1;g<c;g++){d.lineTo(f[g].x*b-this.m_originX,f[g].y*b-this.m_originY)}d.lineTo(f[0].x*b-this.m_originX,f[0].y*b-this.m_originY),d.closePath(),d.fill(),d.stroke()}},a.prototype.DrawCircle=function(f,c,g){if(c){var d=this.m_ctx,b=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(g.GetColor(),this.m_alpha),d.arc(f.x*b-this.m_originX,f.y*b-this.m_originY,c*b,0,2*Math.PI,!0),d.closePath(),d.stroke()}},a.prototype.DrawSolidCircle=function(h,d,l,g){if(d){var c=this.m_ctx,f=this.m_drawScale,k=h.x*f-this.m_originX,b=h.y*f-this.m_originY;c.moveTo(0,0),c.beginPath(),c.strokeStyle=this._color(g.GetColor(),this.m_alpha),c.fillStyle=this._color(g.GetColor(),this.m_fillAlpha),c.arc(k,b,d*f,0,2*Math.PI,!0),c.moveTo(k,b),c.lineTo((h.x+l.x*d)*f-this.m_originX,(h.y+l.y*d)*f-this.m_originY),c.closePath(),c.fill(),c.stroke()}},a.prototype.DrawSegment=function(f,c,g){var d=this.m_ctx,b=this.m_drawScale;d.strokeStyle=this._color(g.GetColor(),this.m_alpha),d.beginPath(),d.moveTo(f.x*b-this.m_originX,f.y*b-this.m_originY),d.lineTo(c.x*b-this.m_originX,c.y*b-this.m_originY),d.closePath(),d.stroke()},a.prototype.DrawTransform=function(c){var b=this.m_ctx,d=this.m_drawScale;b.beginPath(),b.strokeStyle=this._color(16711680,this.m_alpha),b.moveTo(c.position.x*d-this.m_originX,c.position.y*d-this.m_originY),b.lineTo((c.position.x+this.m_xformScale*c.R.col1.x)*d-this.m_originX,(c.position.y+this.m_xformScale*c.R.col1.y)*d-this.m_originY),b.strokeStyle=this._color(65280,this.m_alpha),b.moveTo(c.position.x*d-this.m_originX,c.position.y*d-this.m_originY),b.lineTo((c.position.x+this.m_xformScale*c.R.col2.x)*d-this.m_originX,(c.position.y+this.m_xformScale*c.R.col2.y)*d-this.m_originY),b.closePath(),b.stroke()}}(Box2D.Dynamics.b2DebugDraw),Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32,Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.iContactFilter=function(){},Box2D.Dynamics.iContactFilter.prototype.ShouldCollide=function(){},Box2D.Dynamics.b2ContactFilter=function(){},Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(c,a){var d=c.GetFilterData(),b=a.GetFilterData();return d.groupIndex==b.groupIndex&&0!=d.groupIndex?0<d.groupIndex:0!=(d.maskBits&b.categoryBits)&&0!=(d.categoryBits&b.maskBits)},Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.Joints.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.target=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=0.7},goog.inherits(Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2MouseJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2MouseJoint(this)},Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={},this.m_freeContacts={},this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(b,a,c){this.m_freeContacts[a]=this.m_freeContacts[a]||{},this.m_freeContacts[a][c]=this.m_freeContacts[a][c]||[],this.m_registers[a]=this.m_registers[a]||{},this.m_registers[a][c]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[a][c].ctor=b,this.m_registers[a][c].primary=!0,a!=c&&(this.m_registers[c]=this.m_registers[c]||{},this.m_registers[c][a]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[c][a].ctor=b,this.m_registers[c][a].primary=!1)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(f,b){var g=f.GetShape().GetTypeName(),d=b.GetShape().GetTypeName(),a=this.m_registers[g][d],c=a.ctor;return null!=c?a.primary?0<this.m_freeContacts[g][d].length?(g=this.m_freeContacts[g][d].pop(),g.Reset(f,b),g):new c(f,b):0<this.m_freeContacts[d][g].length?(g=this.m_freeContacts[d][g].pop(),g.Reset(b,f),g):new c(b,f):null},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(b){var a=b.GetFixtureA().GetShape().GetTypeName(),c=b.GetFixtureB().GetShape().GetTypeName();this.m_freeContacts[a][c].push(b)},Box2D.Dynamics.b2ContactListener=function(){},Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener,Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree,this.m_moveBuffer=[],this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(b,a){var c=this.m_tree.CreateProxy(b,a);return this.BufferMove(c),c},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(a){this.UnBufferMove(a),this.m_tree.DestroyProxy(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(b,a,c){this.m_tree.MoveProxy(b,a,c)&&this.BufferMove(b)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(c,a){var d=this.m_tree.GetFatAABB(c),b=this.m_tree.GetFatAABB(a);return d.TestOverlap(b)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(a){this.lastQueryFixtureB=this.lastQueryFixtureA=null;for(this.updatePairsCallback=a;0<this.m_moveBuffer.length;){this.queryProxy=this.m_moveBuffer.pop(),this.m_tree.Query(this.QueryCallback,this.m_tree.GetFatAABB(this.queryProxy),this)}this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.QueryCallback=function(a){return a!=this.queryProxy.fixture&&(this.queryProxy.fixture!=this.lastQueryFixtureA||a!=this.lastQueryFixtureB)&&(this.queryProxy.fixture!=this.lastQueryFixtureB||a!=this.lastQueryFixtureA)&&(this.updatePairsCallback(this.queryProxy.fixture,a),this.lastQueryFixtureA=this.queryProxy.fixture,this.lastQueryFixtureB=a),!0},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(b,a){this.m_tree.Query(b,a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(b,a){this.m_tree.RayCast(b,a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(a){this.m_tree.Rebalance(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(a){this.m_moveBuffer.push(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(a){goog.array.remove(this.m_moveBuffer,a)},Box2D.Collision.b2DynamicTreeBroadPhase.__implements={},Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0,Box2D.Dynamics.b2ContactManager=function(a){this.m_world=a,this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory,this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase},Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(c,a){var d=c.GetBody(),b=a.GetBody();if(d!=b&&b.ShouldCollide(d)&&this.m_contactFilter.ShouldCollide(c,a)){for(d=b.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);d;d=d.GetNextNode()){if(b=d.contact.GetFixtureA(),b==c){if(b=d.contact.GetFixtureB(),b==a){return}}else{if(b==a&&(b=d.contact.GetFixtureB(),b==c)){return}}}this.m_contactFactory.Create(c,a)}},Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var a=this;this.m_broadPhase.UpdatePairs(function(b,c){a.AddPair(b,c)})},Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(b){var a=b.GetFixtureA(),c=b.GetFixtureB(),a=a.GetBody(),c=c.GetBody();b.IsTouching()&&this.m_contactListener.EndContact(b),0<b.m_manifold.m_pointCount&&(a.SetAwake(!0),c.SetAwake(!0)),b.RemoveFromLists(),this.m_contactFactory.Destroy(b)},Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var f=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);f;f=f.GetNextNode()){var b=f.contact,g=b.GetFixtureA(),d=b.GetFixtureB(),a=g.GetBody(),c=d.GetBody();if(a.IsAwake()||c.IsAwake()){if(b.IsFiltering()){if(!c.ShouldCollide(a)){this.Destroy(b);continue}if(!this.m_contactFilter.ShouldCollide(g,d)){this.Destroy(b);continue}b.ClearFiltering()}this.m_broadPhase.TestOverlap(g.m_proxy,d.m_proxy)?b.Update(this.m_contactListener):this.Destroy(b)}}},Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint,Box2D.Dynamics.Joints.b2DistanceJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(a){return Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(a){this.m_length=a},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(m){var v,d=0,b=this.m_bodyA,h=this.m_bodyB;v=b.m_xf.R;var w=this.m_localAnchor1.x-b.m_sweep.localCenter.x,c=this.m_localAnchor1.y-b.m_sweep.localCenter.y,d=v.col1.x*w+v.col2.x*c,c=v.col1.y*w+v.col2.y*c,w=d;v=h.m_xf.R;var q=this.m_localAnchor2.x-h.m_sweep.localCenter.x,p=this.m_localAnchor2.y-h.m_sweep.localCenter.y,d=v.col1.x*q+v.col2.x*p,p=v.col1.y*q+v.col2.y*p,q=d;this.m_u.x=h.m_sweep.c.x+q-b.m_sweep.c.x-w,this.m_u.y=h.m_sweep.c.y+p-b.m_sweep.c.y-c,d=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),d>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.SetZero(),v=w*this.m_u.y-c*this.m_u.x;var k=q*this.m_u.y-p*this.m_u.x;v=b.m_invMass+b.m_invI*v*v+h.m_invMass+h.m_invI*k*k,this.m_mass=0!=v?1/v:0;if(0<this.m_frequencyHz){var d=d-this.m_length,k=2*Math.PI*this.m_frequencyHz,g=this.m_mass*k*k;this.m_gamma=m.dt*(2*this.m_mass*this.m_dampingRatio*k+m.dt*g),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*m.dt*g*this.m_gamma,this.m_mass=v+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}m.warmStarting?(this.m_impulse*=m.dtRatio,m=this.m_impulse*this.m_u.x,v=this.m_impulse*this.m_u.y,b.m_linearVelocity.x-=b.m_invMass*m,b.m_linearVelocity.y-=b.m_invMass*v,b.m_angularVelocity-=b.m_invI*(w*v-c*m),h.m_linearVelocity.x+=h.m_invMass*m,h.m_linearVelocity.y+=h.m_invMass*v,h.m_angularVelocity+=h.m_invI*(q*v-p*m)):this.m_impulse=0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var f=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,b=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,g=this.m_bodyA.m_xf.R.col1.x*f+this.m_bodyA.m_xf.R.col2.x*b,b=this.m_bodyA.m_xf.R.col1.y*f+this.m_bodyA.m_xf.R.col2.y*b,f=g,d=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,a=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,g=this.m_bodyB.m_xf.R.col1.x*d+this.m_bodyB.m_xf.R.col2.x*a,a=this.m_bodyB.m_xf.R.col1.y*d+this.m_bodyB.m_xf.R.col2.y*a,d=g,c=-this.m_mass*(this.m_u.x*(this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*a-(this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*b))+this.m_u.y*(this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*d-(this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*f))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=c,g=c*this.m_u.x,c*=this.m_u.y,this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*g,this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*c,this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(f*c-b*g),this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*g,this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*c,this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(d*c-a*g)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(){if(0<this.m_frequencyHz){return !0}var g=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,c=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,k=this.m_bodyA.m_xf.R.col1.x*g+this.m_bodyA.m_xf.R.col2.x*c,c=this.m_bodyA.m_xf.R.col1.y*g+this.m_bodyA.m_xf.R.col2.y*c,g=k,f=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,b=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,k=this.m_bodyB.m_xf.R.col1.x*f+this.m_bodyB.m_xf.R.col2.x*b,b=this.m_bodyB.m_xf.R.col1.y*f+this.m_bodyB.m_xf.R.col2.y*b,f=k,d=this.m_bodyB.m_sweep.c.x+f-this.m_bodyA.m_sweep.c.x-g,h=this.m_bodyB.m_sweep.c.y+b-this.m_bodyA.m_sweep.c.y-c,k=Math.sqrt(d*d+h*h),d=d/k,h=h/k,k=Box2D.Common.Math.b2Math.Clamp(k-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),a=-this.m_mass*k;return this.m_u.Set(d,h),d=a*this.m_u.x,h=a*this.m_u.y,this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*d,this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*h,this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(g*h-c*d),this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*d,this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*h,this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(f*h-b*d),this.m_bodyA.SynchronizeTransform(),this.m_bodyB.SynchronizeTransform(),Math.abs(k)<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(c,a,d,b){this.bodyA=c,this.bodyB=a,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(b)),c=b.x-d.x,d=b.y-d.y,this.length=Math.sqrt(c*c+d*d),this.dampingRatio=this.frequencyHz=0},Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)},Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1),this.density=this.offset=0,this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},goog.inherits(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity());for(var k=Box2D.Common.Math.b2Vec2.Get(0,0),p=Box2D.Common.Math.b2Vec2.Get(0,0),d=Box2D.Common.Math.b2Vec2.Get(0,0),b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);b;b=b.GetNextNode()){p.Set(0,0),k.Set(0,0);for(var g=b.body,q=0,c=0,m=g.GetFixtureList().GetFirstNode();m;m=m.GetNextNode()){d.Set(0,0);var l=m.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,g.GetTransform(),d),q=q+l;k.x+=l*d.x,k.y+=l*d.y;var h=0,h=1,c=c+l*h;p.x+=l*d.x*h,p.y+=l*d.y*h}q<Number.MIN_VALUE||(k.x/=q,k.y/=q,p.x/=c,p.y/=c,c=this.gravity.GetNegative(),c.Multiply(this.density*q),g.ApplyForce(c,p),Box2D.Common.Math.b2Vec2.Free(c),c=g.GetLinearVelocityFromWorldPoint(k),c.Subtract(this.velocity),c.Multiply(-this.linearDrag*q),g.ApplyForce(c,k),Box2D.Common.Math.b2Vec2.Free(c),g.ApplyTorque(-g.GetInertia()/g.GetMass()*q*g.GetAngularVelocity()*this.angularDrag))}Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(p),Box2D.Common.Math.b2Vec2.Free(k)},Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Draw=function(b){var a=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset+1000*this.normal.y,this.normal.y*this.offset-1000*this.normal.x),c=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset-1000*this.normal.y,this.normal.y*this.offset+1000*this.normal.x);b.DrawSegment(a,c,Box2D.Dynamics.Controllers.b2BuoyancyController.color),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(c)},Box2D.Dynamics.Controllers.b2BuoyancyController.color=new Box2D.Common.b2Color(0,0,1),Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.G=1,this.invSqr=!0},goog.inherits(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(){var k=null,p=null,d=0,b=null,g=null,q=0,c=0,m=0,q=null;if(this.invSqr){for(var l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode()){for(var k=l.body,p=k.GetWorldCenter(),d=k.GetMass(),h=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);h;h=h.GetNextNode()){if(b=h.body,k.IsAwake()||b.IsAwake()){g=b.GetWorldCenter(),q=g.x-p.x,c=g.y-p.y,m=q*q+c*c,m<Number.MIN_VALUE||(q=Box2D.Common.Math.b2Vec2.Get(q,c),q.Multiply(this.G/m/Math.sqrt(m)*d*b.GetMass()),k.IsAwake()&&k.ApplyForce(q,p),q.Multiply(-1),b.IsAwake()&&b.ApplyForce(q,g),Box2D.Common.Math.b2Vec2.Free(q))}}}}else{for(l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode()){k=bodyNode.body,p=k.GetWorldCenter(),d=k.GetMass();for(h=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);h;h=h.GetNextNode()){if(b=bodyNode.body,k.IsAwake()||b.IsAwake()){g=b.GetWorldCenter(),q=g.x-p.x,c=g.y-p.y,m=q*q+c*c,m<Number.MIN_VALUE||(q=Box2D.Common.Math.b2Vec2.Get(q,c),q.Multiply(this.G/m*d*b.GetMass()),k.IsAwake()&&k.ApplyForce(q,p),q.Multiply(-1),b.IsAwake()&&b.ApplyForce(q,g),Box2D.Common.Math.b2Vec2.Free(q))}}}}},Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_points=[];for(var a=this.m_pointCount=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++){this.m_points[a]=Box2D.Common.Math.b2Vec2.Get(0,0)}},Box2D.Collision.b2WorldManifold.prototype.Initialize=function(v,z,g,b,m){if(0!=v.m_pointCount){var A=0,d,y,x=0,q=0,k=0,w=0,p=0;d=0;switch(v.m_type){case Box2D.Collision.b2Manifold.e_circles:y=z.R,d=v.m_localPoint,A=z.position.x+y.col1.x*d.x+y.col2.x*d.y,z=z.position.y+y.col1.y*d.x+y.col2.y*d.y,y=b.R,d=v.m_points[0].m_localPoint,v=b.position.x+y.col1.x*d.x+y.col2.x*d.y,b=b.position.y+y.col1.y*d.x+y.col2.y*d.y,d=v-A,y=b-z,x=d*d+y*y,x>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(x=Math.sqrt(x),this.m_normal.x=d/x,this.m_normal.y=y/x):(this.m_normal.x=1,this.m_normal.y=0),d=z+g*this.m_normal.y,b-=m*this.m_normal.y,this.m_points[0].x=0.5*(A+g*this.m_normal.x+(v-m*this.m_normal.x)),this.m_points[0].y=0.5*(d+b);break;case Box2D.Collision.b2Manifold.e_faceA:y=z.R,d=v.m_localPlaneNormal,x=y.col1.x*d.x+y.col2.x*d.y,q=y.col1.y*d.x+y.col2.y*d.y,y=z.R,d=v.m_localPoint,k=z.position.x+y.col1.x*d.x+y.col2.x*d.y,w=z.position.y+y.col1.y*d.x+y.col2.y*d.y,this.m_normal.x=x,this.m_normal.y=q;for(A=0;A<v.m_pointCount;A++){y=b.R,d=v.m_points[A].m_localPoint,p=b.position.x+y.col1.x*d.x+y.col2.x*d.y,d=b.position.y+y.col1.y*d.x+y.col2.y*d.y,this.m_points[A].x=p+0.5*(g-(p-k)*x-(d-w)*q-m)*x,this.m_points[A].y=d+0.5*(g-(p-k)*x-(d-w)*q-m)*q}break;case Box2D.Collision.b2Manifold.e_faceB:y=b.R,d=v.m_localPlaneNormal,x=y.col1.x*d.x+y.col2.x*d.y,q=y.col1.y*d.x+y.col2.y*d.y,y=b.R,d=v.m_localPoint,k=b.position.x+y.col1.x*d.x+y.col2.x*d.y,w=b.position.y+y.col1.y*d.x+y.col2.y*d.y,this.m_normal.x=-x,this.m_normal.y=-q;for(A=0;A<v.m_pointCount;A++){y=z.R,d=v.m_points[A].m_localPoint,p=z.position.x+y.col1.x*d.x+y.col2.x*d.y,d=z.position.y+y.col1.y*d.x+y.col2.y*d.y,this.m_points[A].x=p+0.5*(m-(p-k)*x-(d-w)*q-g)*x,this.m_points[A].y=d+0.5*(m-(p-k)*x-(d-w)*q-g)*q}}}},Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(R,F,K){for(this.m_constraintCount=K;this.m_constraints.length<this.m_constraintCount;){this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint}for(R=0;R<K;R++){var H=F[R],N=H.m_fixtureA,G=H.m_fixtureB,J=N.m_shape.m_radius,C=G.m_shape.m_radius,W=N.GetBody(),Q=G.GetBody(),M=H.GetManifold(),U=Box2D.Common.b2Settings.b2MixFriction(N.GetFriction(),G.GetFriction()),O=Box2D.Common.b2Settings.b2MixRestitution(N.GetRestitution(),G.GetRestitution()),I=W.m_linearVelocity.x,T=W.m_linearVelocity.y,B=Q.m_linearVelocity.x,L=Q.m_linearVelocity.y,P=W.m_angularVelocity,q=Q.m_angularVelocity;Box2D.Common.b2Settings.b2Assert(0<M.m_pointCount),Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(M,W.m_xf,J,Q.m_xf,C),G=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x,H=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y,N=this.m_constraints[R],N.bodyA=W,N.bodyB=Q,N.manifold=M,N.normal.x=G,N.normal.y=H,N.pointCount=M.m_pointCount,N.friction=U,N.restitution=O,N.localPlaneNormal.x=M.m_localPlaneNormal.x,N.localPlaneNormal.y=M.m_localPlaneNormal.y,N.localPoint.x=M.m_localPoint.x,N.localPoint.y=M.m_localPoint.y,N.radius=J+C,N.type=M.m_type;for(J=0;J<N.pointCount;++J){U=M.m_points[J],C=N.points[J],C.normalImpulse=U.m_normalImpulse,C.tangentImpulse=U.m_tangentImpulse,C.localPoint.SetV(U.m_localPoint);var U=C.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[J].x-W.m_sweep.c.x,O=C.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[J].y-W.m_sweep.c.y,V=C.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[J].x-Q.m_sweep.c.x,A=C.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[J].y-Q.m_sweep.c.y,D=U*H-O*G,k=V*H-A*G,D=D*D,k=k*k;C.normalMass=1/(W.m_invMass+Q.m_invMass+W.m_invI*D+Q.m_invI*k);var z=W.m_mass*W.m_invMass+Q.m_mass*Q.m_invMass,z=z+(W.m_mass*W.m_invI*D+Q.m_mass*Q.m_invI*k);C.equalizedMass=1/z,k=H,z=-G,D=U*z-O*k,k=V*z-A*k,D*=D,k*=k,C.tangentMass=1/(W.m_invMass+Q.m_invMass+W.m_invI*D+Q.m_invI*k),C.velocityBias=0,U=N.normal.x*(B+-q*A-I- -P*O)+N.normal.y*(L+q*V-T-P*U),U<-Box2D.Common.b2Settings.b2_velocityThreshold&&(C.velocityBias+=-N.restitution*U)}2==N.pointCount&&(L=N.points[0],B=N.points[1],M=W.m_invMass,W=W.m_invI,I=Q.m_invMass,Q=Q.m_invI,T=L.rA.x*H-L.rA.y*G,L=L.rB.x*H-L.rB.y*G,P=B.rA.x*H-B.rA.y*G,B=B.rB.x*H-B.rB.y*G,G=M+I+W*T*T+Q*L*L,H=M+I+W*P*P+Q*B*B,Q=M+I+W*T*P+Q*L*B,G*G<100*(G*H-Q*Q)?(N.K.col1.Set(G,Q),N.K.col2.Set(Q,H),N.K.GetInverse(N.normalMass)):N.pointCount=1)}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(H){for(var q=0;q<this.m_constraintCount;++q){var A=this.m_constraints[q],x=A.bodyA,D=A.bodyB,w=x.m_invMass,z=x.m_invI,k=D.m_invMass,K=D.m_invI,G=A.normal.x,C=A.normal.y,J=C,E=-G,y=0,I=0;if(H.warmStarting){I=A.pointCount;for(y=0;y<I;++y){var b=A.points[y];b.normalImpulse*=H.dtRatio,b.tangentImpulse*=H.dtRatio;var B=b.normalImpulse*G+b.tangentImpulse*J,F=b.normalImpulse*C+b.tangentImpulse*E;x.m_angularVelocity-=z*(b.rA.x*F-b.rA.y*B),x.m_linearVelocity.x-=w*B,x.m_linearVelocity.y-=w*F,D.m_angularVelocity+=K*(b.rB.x*F-b.rB.y*B),D.m_linearVelocity.x+=k*B,D.m_linearVelocity.y+=k*F}}else{I=A.pointCount;for(y=0;y<I;++y){x=A.points[y],x.normalImpulse=0,x.tangentImpulse=0}}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;a++){this.SolveVelocityConstraints_Constraint(this.m_constraints[a])}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(g){for(var l=g.normal.x,d=g.normal.y,b=0;b<g.pointCount;b++){Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(g,g.points[b])}if(1==g.pointCount){var b=g.points[0],f=b.normalImpulse-b.normalMass*((g.bodyB.m_linearVelocity.x-g.bodyB.m_angularVelocity*b.rB.y-g.bodyA.m_linearVelocity.x+g.bodyA.m_angularVelocity*b.rA.y)*l+(g.bodyB.m_linearVelocity.y+g.bodyB.m_angularVelocity*b.rB.x-g.bodyA.m_linearVelocity.y-g.bodyA.m_angularVelocity*b.rA.x)*d-b.velocityBias),f=0<f?f:0,m=f-b.normalImpulse,c=m*l,d=m*d;g.bodyA.m_linearVelocity.x-=g.bodyA.m_invMass*c,g.bodyA.m_linearVelocity.y-=g.bodyA.m_invMass*d,g.bodyA.m_angularVelocity-=g.bodyA.m_invI*(b.rA.x*d-b.rA.y*c),g.bodyB.m_linearVelocity.x+=g.bodyB.m_invMass*c,g.bodyB.m_linearVelocity.y+=g.bodyB.m_invMass*d,g.bodyB.m_angularVelocity+=g.bodyB.m_invI*(b.rB.x*d-b.rB.y*c),b.normalImpulse=f}else{for(var b=g.points[0],f=g.points[1],m=b.normalImpulse,c=f.normalImpulse,k=(g.bodyB.m_linearVelocity.x-g.bodyB.m_angularVelocity*b.rB.y-g.bodyA.m_linearVelocity.x+g.bodyA.m_angularVelocity*b.rA.y)*l+(g.bodyB.m_linearVelocity.y+g.bodyB.m_angularVelocity*b.rB.x-g.bodyA.m_linearVelocity.y-g.bodyA.m_angularVelocity*b.rA.x)*d-b.velocityBias,d=(g.bodyB.m_linearVelocity.x-g.bodyB.m_angularVelocity*f.rB.y-g.bodyA.m_linearVelocity.x+g.bodyA.m_angularVelocity*f.rA.y)*l+(g.bodyB.m_linearVelocity.y+g.bodyB.m_angularVelocity*f.rB.x-g.bodyA.m_linearVelocity.y-g.bodyA.m_angularVelocity*f.rA.x)*d-f.velocityBias,k=k-(g.K.col1.x*m+g.K.col2.x*c),d=d-(g.K.col1.y*m+g.K.col2.y*c);;){l=-(g.normalMass.col1.x*k+g.normalMass.col2.x*d);if(0<=l){var h=-(g.normalMass.col1.y*k+g.normalMass.col2.y*d);if(0<=h){this.SolveVelocityConstraints_ConstraintPointUpdate(g,b,f,l-m,h-c),b.normalImpulse=l,f.normalImpulse=h;break}}l=-b.normalMass*k;if(0<=l&&0<=g.K.col1.y*l+d){this.SolveVelocityConstraints_ConstraintPointUpdate(g,b,f,l-m,-c),b.normalImpulse=l,f.normalImpulse=0;break}l=-f.normalMass*d;if(0<=l&&0<=g.K.col2.x*l+k){this.SolveVelocityConstraints_ConstraintPointUpdate(g,b,f,-m,l-c),b.normalImpulse=0,f.normalImpulse=l;break}if(0<=k&&0<=d){this.SolveVelocityConstraints_ConstraintPointUpdate(g,b,f,-m,-c),b.normalImpulse=0,f.normalImpulse=0;break}break}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(f,b){var g=f.normal.y,d=-f.normal.x,a=f.friction*b.normalImpulse,a=Box2D.Common.Math.b2Math.Clamp(b.tangentImpulse-b.tangentMass*((f.bodyB.m_linearVelocity.x-f.bodyB.m_angularVelocity*b.rB.y-f.bodyA.m_linearVelocity.x+f.bodyA.m_angularVelocity*b.rA.y)*g+(f.bodyB.m_linearVelocity.y+f.bodyB.m_angularVelocity*b.rB.x-f.bodyA.m_linearVelocity.y-f.bodyA.m_angularVelocity*b.rA.x)*d),-a,a),c=a-b.tangentImpulse,g=c*g,d=c*d;f.bodyA.m_linearVelocity.x-=f.bodyA.m_invMass*g,f.bodyA.m_linearVelocity.y-=f.bodyA.m_invMass*d,f.bodyA.m_angularVelocity-=f.bodyA.m_invI*(b.rA.x*d-b.rA.y*g),f.bodyB.m_linearVelocity.x+=f.bodyB.m_invMass*g,f.bodyB.m_linearVelocity.y+=f.bodyB.m_invMass*d,f.bodyB.m_angularVelocity+=f.bodyB.m_invI*(b.rB.x*d-b.rB.y*g),b.tangentImpulse=a},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(f,b,h,d,a){var c=d*f.normal.x,d=d*f.normal.y,g=a*f.normal.x,a=a*f.normal.y;f.bodyA.m_linearVelocity.x-=f.bodyA.m_invMass*(c+g),f.bodyA.m_linearVelocity.y-=f.bodyA.m_invMass*(d+a),f.bodyA.m_angularVelocity-=f.bodyA.m_invI*(b.rA.x*d-b.rA.y*c+h.rA.x*a-h.rA.y*g),f.bodyB.m_linearVelocity.x+=f.bodyB.m_invMass*(c+g),f.bodyB.m_linearVelocity.y+=f.bodyB.m_invMass*(d+a),f.bodyB.m_angularVelocity+=f.bodyB.m_invI*(b.rB.x*d-b.rB.y*c+h.rB.x*a-h.rB.y*g),b.normalImpulse=0,h.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var f=0;f<this.m_constraintCount;++f){for(var b=this.m_constraints[f],g=b.manifold,d=0;d<b.pointCount;++d){var a=g.m_points[d],c=b.points[d];a.m_normalImpulse=c.normalImpulse,a.m_tangentImpulse=c.tangentImpulse}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(H){void 0===H&&(H=0);for(var q=0,A=0;A<this.m_constraintCount;A++){var x=this.m_constraints[A],D=x.bodyA,w=x.bodyB,z=D.m_mass*D.m_invMass,k=D.m_mass*D.m_invI,K=w.m_mass*w.m_invMass,G=w.m_mass*w.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(x);for(var C=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,J=0;J<x.pointCount;J++){var E=x.points[J],y=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[J],I=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[J],b=y.x-D.m_sweep.c.x,B=y.y-D.m_sweep.c.y,F=y.x-w.m_sweep.c.x,y=y.y-w.m_sweep.c.y,q=q<I?q:I,I=Box2D.Common.Math.b2Math.Clamp(H*(I+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),I=-E.equalizedMass*I,E=I*C.x,I=I*C.y;D.m_sweep.c.x-=z*E,D.m_sweep.c.y-=z*I,D.m_sweep.a-=k*(b*I-B*E),D.SynchronizeTransform(),w.m_sweep.c.x+=K*E,w.m_sweep.c.y+=K*I,w.m_sweep.a+=G*(F*I-y*E),w.SynchronizeTransform()}}return q>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(H){void 0===H&&(H=0);for(var q=0,A=0;A<this.m_constraintCount;A++){var x=this.m_constraints[A],D=x.bodyA,w=x.bodyB,z=D.m_mass*D.m_invMass,k=D.m_mass*D.m_invI,K=w.m_mass*w.m_invMass,G=w.m_mass*w.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(x);for(var C=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,J=0;J<x.pointCount;J++){var E=x.points[J],y=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[J],I=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[J],b=y.x-D.m_sweep.c.x,B=y.y-D.m_sweep.c.y,F=y.x-w.m_sweep.c.x,y=y.y-w.m_sweep.c.y;I<q&&(q=I),0!=H&&Box2D.Common.Math.b2Math.Clamp(H*(I+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),I=0*-E.equalizedMass,E=I*C.x,I*=C.y,D.m_sweep.c.x-=z*E,D.m_sweep.c.y-=z*I,D.m_sweep.a-=k*(b*I-B*E),D.SynchronizeTransform(),w.m_sweep.c.x+=K*E,w.m_sweep.c.y+=K*I,w.m_sweep.a+=G*(F*I-y*E),w.SynchronizeTransform()}}return q>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2ControllerListNode=function(a){this.controller=a,this.previous=this.next=null},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerLastNode=this.controllerFirstNode=null,this.controllerNodeLookup={},this.controllerCount=0},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode},Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(b){var a=b.ID;if(null==this.controllerNodeLookup[a]){var b=new Box2D.Dynamics.Controllers.b2ControllerListNode(b),c=this.controllerLastNode;null!=c?c.SetNextNode(b):this.controllerFirstNode=b,b.SetPreviousNode(c),this.controllerLastNode=b,this.controllerNodeLookup[a]=b,this.controllerCount++}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(b){var b=b.ID,a=this.controllerNodeLookup[b];if(null!=a){var c=a.GetPreviousNode(),a=a.GetNextNode();null==c?this.controllerFirstNode=a:c.SetNextNode(a),null==a?this.controllerLastNode=c:a.SetPreviousNode(c),delete this.controllerNodeLookup[b],this.controllerCount--}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount},Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.shape=null,this.friction=0.2,this.density=this.restitution=0,this.isSensor=!1},Box2D.Dynamics.b2Body=function(b,a){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++,this.m_xf=new Box2D.Common.Math.b2Transform,this.m_xf.position.SetV(b.position),this.m_xf.R.Set(b.angle),this.m_sweep=new Box2D.Common.Math.b2Sweep,this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=b.angle,this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y,this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity=b.linearVelocity.Copy(),this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_bullet=b.bullet,this.m_fixedRotation=b.fixedRotation,this.m_allowSleep=b.allowSleep,this.m_awake=b.awake,this.m_active=b.active,this.m_world=a,this.m_userData=null,this.m_jointList=null,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_controllerCount=0,this.m_angularVelocity=b.angularVelocity,this.m_linearDamping=b.linearDamping,this.m_angularDamping=b.angularDamping,this.m_sleepTime=this.m_torque=0,this.m_type=b.type,this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=b.inertiaScale,this.fixtureList=new Box2D.Dynamics.b2FixtureList,this.m_lists=[]},Box2D.Dynamics.b2Body.prototype.CreateFixture=function(a){return Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),a=new Box2D.Dynamics.b2Fixture(this,this.m_xf,a),this.m_active&&a.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),this.fixtureList.AddFixture(a),a.m_body=this,0<a.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,a},Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(b,a){var c=new Box2D.Dynamics.b2FixtureDef;return c.shape=b,c.density=a,this.CreateFixture(c)},Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity),Box2D.Common.Math.b2Vec2.Free(this.m_force)},Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(b){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.fixtureList.RemoveFixture(b);for(var a=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){(b==a.contact.GetFixtureA()||b==a.contact.GetFixtureB())&&this.m_world.m_contactManager.Destroy(a.contact)}this.m_active&&b.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),b.Destroy(),this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(c,a){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.m_xf.R.Set(a),this.m_xf.position.SetV(c);var d=this.m_xf.R,b=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*b.x+d.col2.x*b.y,this.m_sweep.c.y=d.col1.y*b.x+d.col2.y*b.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=a,d=this.m_world.m_contactManager.m_broadPhase;for(b=this.fixtureList.GetFirstNode();b;b=b.GetNextNode()){b.fixture.Synchronize(d,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2Body.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf},Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position},Box2D.Dynamics.b2Body.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},Box2D.Dynamics.b2Body.prototype.SetAngle=function(a){this.SetPositionAndAngle(this.GetPosition(),a)},Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},Box2D.Dynamics.b2Body.prototype.GetUserData=function(){return this.m_userData},Box2D.Dynamics.b2Body.prototype.SetUserData=function(a){this.m_userData=a},Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(a){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(a)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(a){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=a)},Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var a=new Box2D.Dynamics.b2BodyDef;return a.type=this.GetType(),a.allowSleep=this.m_allowSleep,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=this.m_fixedRotation,a.bullet=this.m_bullet,a.active=this.m_active,a.awake=this.m_awake,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position.SetV(this.GetPosition()),a},Box2D.Dynamics.b2Body.prototype.ApplyForce=function(b,a){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=b.x,this.m_force.y+=b.y,this.m_torque+=(a.x-this.m_sweep.c.x)*b.y-(a.y-this.m_sweep.c.y)*b.x)},Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(a){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=a)},Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(b,a){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*b.x,this.m_linearVelocity.y+=this.m_invMass*b.y,this.m_angularVelocity+=this.m_invI*((a.x-this.m_sweep.c.x)*b.y-(a.y-this.m_sweep.c.y)*b.x))},Box2D.Dynamics.b2Body.prototype.Split=function(f){for(var b=this.GetLinearVelocity().Copy(),h=this.GetAngularVelocity(),d=this.GetWorldCenter(),a=this.m_world.CreateBody(this.GetDefinition()),c=this.fixtureList.GetFirstNode();c;c=c.GetNextNode()){var g=c.fixture;f(g)&&(this.fixtureList.RemoveFixture(g),a.fixtureList.AddFixture(g))}return this.ResetMassData(),a.ResetMassData(),c=this.GetWorldCenter(),f=a.GetWorldCenter(),g=Box2D.Common.Math.b2Math.SubtractVV(c,d),c=Box2D.Common.Math.b2Math.CrossFV(h,g),Box2D.Common.Math.b2Vec2.Free(g),g=Box2D.Common.Math.b2Math.AddVV(b,c),Box2D.Common.Math.b2Vec2.Free(c),this.SetLinearVelocity(g),Box2D.Common.Math.b2Vec2.Free(g),f=Box2D.Common.Math.b2Math.SubtractVV(f,d),d=Box2D.Common.Math.b2Math.CrossFV(h,f),Box2D.Common.Math.b2Vec2.Free(f),f=Box2D.Common.Math.b2Math.AddVV(b,d),Box2D.Common.Math.b2Vec2.Free(d),a.SetLinearVelocity(f),Box2D.Common.Math.b2Vec2.Free(f),Box2D.Common.Math.b2Vec2.Free(b),this.SetAngularVelocity(h),a.SetAngularVelocity(h),this.SynchronizeFixtures(),a.SynchronizeFixtures(),a},Box2D.Dynamics.b2Body.prototype.Merge=function(b){for(var a=b.fixtureList.GetFirstNode();a;a=a.GetNextNode()){this.fixtureList.AddFixture(a.fixture),b.fixtureList.RemoveFixture(a.fixture)}b.ResetMassData(),this.ResetMassData(),this.SynchronizeFixtures()},Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass},Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I},Box2D.Dynamics.b2Body.prototype.GetMassData=function(a){return a||(a=Box2D.Collision.Shapes.b2MassData.Get()),a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter),a},Box2D.Dynamics.b2Body.prototype.SetMassData=function(b){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked());if(this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=b.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<b.I&&!this.m_fixedRotation&&(this.m_I=b.I-this.m_mass*(b.center.x*b.center.x+b.center.y*b.center.y),this.m_invI=1/this.m_I);var a=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(b.center),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-a.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-a.x),Box2D.Common.Math.b2Vec2.Free(a)}},Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_type!=Box2D.Dynamics.b2BodyDef.b2_kinematicBody){for(var b=Box2D.Common.Math.b2Vec2.Get(0,0),a=this.fixtureList.GetFirstNode();a;a=a.GetNextNode()){var c=a.fixture;0!=c.m_density&&(c=c.GetMassData(),this.m_mass+=c.mass,b.x+=c.center.x*c.mass,b.y+=c.center.y*c.mass,this.m_I+=c.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,b.x*=this.m_invMass,b.y*=this.m_invMass):this.m_invMass=this.m_mass=1,0<this.m_I&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(b.x*b.x+b.y*b.y),this.m_I*=this.m_inertiaScale,Box2D.Common.b2Settings.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,a=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(b),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-a.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-a.x),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(a)}},Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(b){var a=this.m_xf.R,b=Box2D.Common.Math.b2Vec2.Get(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);return b.x+=this.m_xf.position.x,b.y+=this.m_xf.position.y,b},Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(a){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,a)},Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(a){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,a)},Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(a){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,a)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(a){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(b){var a=this.m_xf.R,b=Box2D.Common.Math.b2Vec2.Get(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);return b.x+=this.m_xf.position.x,b.y+=this.m_xf.position.y,a=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(b.x-this.m_sweep.c.x)),Box2D.Common.Math.b2Vec2.Free(b),a},Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(a){this.m_linearDamping=a},Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(a){this.m_angularDamping=a},Box2D.Dynamics.b2Body.prototype.SetType=function(a){if(this.m_type!=a){this.m_type=a,this.ResetMassData(),this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(a=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){a.contact.FlagForFiltering()}for(a=0;a<this.m_lists.length;a++){this.m_lists[a].UpdateBody(this)}}},Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.b2Body.prototype.SetBullet=function(a){this.m_bullet=a},Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet},Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(a){(this.m_allowSleep=a)||this.SetAwake(!0)},Box2D.Dynamics.b2Body.prototype.SetAwake=function(a){if(this.m_awake!=a){this.m_awake=a,this.m_sleepTime=0,a||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0);for(a=0;a<this.m_lists.length;a++){this.m_lists[a].UpdateBody(this)}}},Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake},Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(a){this.m_fixedRotation=a,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation},Box2D.Dynamics.b2Body.prototype.SetActive=function(b){if(b!=this.m_active){if(b){this.m_active=!0;for(var b=this.m_world.m_contactManager.m_broadPhase,a=this.fixtureList.GetFirstNode();a;a=a.GetNextNode()){a.fixture.CreateProxy(b,this.m_xf)}}else{this.m_active=!1,b=this.m_world.m_contactManager.m_broadPhase;for(a=this.fixtureList.GetFirstNode();a;a=a.GetNextNode()){a.fixture.DestroyProxy(b)}for(b=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);b;b=b.GetNextNode()){this.m_world.m_contactManager.Destroy(b.contact)}}for(b=0;b<this.m_lists.length;b++){this.m_lists[b].UpdateBody(this)}}},Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active},Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep},Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList},Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2Body.prototype.AddController=function(a){this.controllerList.AddController(a)},Box2D.Dynamics.b2Body.prototype.RemoveController=function(a){this.controllerList.RemoveController(a)},Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world},Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var b=Box2D.Dynamics.b2Body.s_xf1;b.R.Set(this.m_sweep.a0);var a=b.R,c=this.m_sweep.localCenter;b.position.x=this.m_sweep.c0.x-(a.col1.x*c.x+a.col2.x*c.y),b.position.y=this.m_sweep.c0.y-(a.col1.y*c.x+a.col2.y*c.y),a=this.m_world.m_contactManager.m_broadPhase;for(c=this.fixtureList.GetFirstNode();c;c=c.GetNextNode()){c.fixture.Synchronize(a,b,this.m_xf)}},Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var b=this.m_xf.R,a=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(b.col1.x*a.x+b.col2.x*a.y),this.m_xf.position.y=this.m_sweep.c.y-(b.col1.y*a.x+b.col2.y*a.y)},Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(b){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&b.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody){return !1}for(var a=this.m_jointList;a;a=a.next){if(a.other==b&&0==a.joint.m_collideConnected){return !1}}return !0},Box2D.Dynamics.b2Body.prototype.Advance=function(a){this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.Dynamics.b2Body.NEXT_ID=0,Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World=function(b,a){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this),this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver,this.m_newFixture=this.m_isLocked=!1,this.m_debugDraw=this.m_destructionListener=null,this.bodyList=new Box2D.Dynamics.b2BodyList,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.m_jointList=null,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_jointCount=0,this.m_continuousPhysics=this.m_warmStarting=!0,this.m_allowSleep=a,this.m_gravity=b,this.m_inv_dt0=0,this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef),this.mainTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.islandTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.island=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver)},Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE,Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},Box2D.Dynamics.b2World.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},Box2D.Dynamics.b2World.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},Box2D.Dynamics.b2World.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(d){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=d;for(var f=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);f;f=f.GetNextNode()){for(var c=f.body.GetFixtureList().GetFirstNode();c;c=c.GetNextNode()){var a=c.fixture;a.m_proxy=d.CreateProxy(b.GetFatAABB(a.m_proxy),a)}}},Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},Box2D.Dynamics.b2World.prototype.CreateBody=function(a){return Box2D.Common.b2Settings.b2Assert(!this.IsLocked()),a=new Box2D.Dynamics.b2Body(a,this),this.bodyList.AddBody(a),a},Box2D.Dynamics.b2World.prototype.DestroyBody=function(b){Box2D.Common.b2Settings.b2Assert(!this.IsLocked());for(var a=b.m_jointList;a;){var c=a,a=a.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(a=b.GetControllerList().GetFirstNode();a;a=a.GetNextNode()){a.controller.RemoveBody(b)}for(a=b.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){this.m_contactManager.Destroy(a.contact)}for(a=b.GetFixtureList().GetFirstNode();a;a=a.GetNextNode()){this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(a.fixture),b.DestroyFixture(a.fixture)}b.Destroy(),this.bodyList.RemoveBody(b)},Box2D.Dynamics.b2World.prototype.CreateJoint=function(c){var a=Box2D.Dynamics.Joints.b2Joint.Create(c);a.m_prev=null;if(a.m_next=this.m_jointList){this.m_jointList.m_prev=a}this.m_jointList=a,this.m_jointCount++,a.m_edgeA.joint=a,a.m_edgeA.other=a.m_bodyB,a.m_edgeA.prev=null;if(a.m_edgeA.next=a.m_bodyA.m_jointList){a.m_bodyA.m_jointList.prev=a.m_edgeA}a.m_bodyA.m_jointList=a.m_edgeA,a.m_edgeB.joint=a,a.m_edgeB.other=a.m_bodyA,a.m_edgeB.prev=null;if(a.m_edgeB.next=a.m_bodyB.m_jointList){a.m_bodyB.m_jointList.prev=a.m_edgeB}a.m_bodyB.m_jointList=a.m_edgeB;var d=c.bodyA,b=c.bodyB;if(!c.collideConnected){for(c=b.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);c;c=c.GetNextNode()){c.contact.GetOther(b)==d&&c.contact.FlagForFiltering()}}return a},Box2D.Dynamics.b2World.prototype.DestroyJoint=function(c){var a=c.m_collideConnected;c.m_prev&&(c.m_prev.m_next=c.m_next),c.m_next&&(c.m_next.m_prev=c.m_prev),c==this.m_jointList&&(this.m_jointList=c.m_next);var d=c.m_bodyA,b=c.m_bodyB;d.SetAwake(!0),b.SetAwake(!0),c.m_edgeA.prev&&(c.m_edgeA.prev.next=c.m_edgeA.next),c.m_edgeA.next&&(c.m_edgeA.next.prev=c.m_edgeA.prev),c.m_edgeA==d.m_jointList&&(d.m_jointList=c.m_edgeA.next),c.m_edgeA.prev=null,c.m_edgeA.next=null,c.m_edgeB.prev&&(c.m_edgeB.prev.next=c.m_edgeB.next),c.m_edgeB.next&&(c.m_edgeB.next.prev=c.m_edgeB.prev),c.m_edgeB==b.m_jointList&&(b.m_jointList=c.m_edgeB.next),c.m_edgeB.prev=null,c.m_edgeB.next=null,this.m_jointCount--;if(!a){for(c=b.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);c;c=c.GetNextNode()){c.contact.GetOther(b)==d&&c.contact.FlagForFiltering()}}},Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2World.prototype.AddController=function(a){if(null!==a.m_world&&a.m_world!=this){throw Error("Controller can only be a member of one world")}return this.controllerList.AddController(a),a.m_world=this,a},Box2D.Dynamics.b2World.prototype.RemoveController=function(a){this.controllerList.RemoveController(a),a.m_world=null,a.Clear()},Box2D.Dynamics.b2World.prototype.CreateController=function(a){return this.AddController(a)},Box2D.Dynamics.b2World.prototype.DestroyController=function(a){this.RemoveController(a)},Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(a){this.m_warmStarting=a},Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(a){this.m_continuousPhysics=a},Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()},Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount},Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()},Box2D.Dynamics.b2World.prototype.SetGravity=function(a){this.m_gravity=a},Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity},Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody},Box2D.Dynamics.b2World.prototype.Step=function(b,a,c){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_isLocked=!0,this.mainTimeStep.Reset(b,this.m_inv_dt0*b,a,c,this.m_warmStarting),this.m_contactManager.Collide(),0<this.mainTimeStep.dt&&(this.Solve(this.mainTimeStep),this.m_continuousPhysics&&this.SolveTOI(this.mainTimeStep),this.m_inv_dt0=this.mainTimeStep.inv_dt),this.m_isLocked=!1},Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);a;a=a.GetNextNode()){a.body.m_force.SetZero(),a.body.m_torque=0}},Box2D.Dynamics.b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){this.m_debugDraw.Clear();var k=this.m_debugDraw.GetFlags();if(k&Box2D.Dynamics.b2DebugDraw.e_shapeBit){for(var p=Box2D.Dynamics.b2World.s_color_inactive,d=Box2D.Dynamics.b2World.s_color_static,b=Box2D.Dynamics.b2World.s_color_kinematic,g=Box2D.Dynamics.b2World.s_color_dynamic_sleeping,q=Box2D.Dynamics.b2World.s_color_dynamic_awake,c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode()){for(var m=c.body,l=m.GetFixtureList().GetFirstNode();l;l=l.GetNextNode()){var h=l.fixture,h=h.GetShape();m.IsActive()?m.GetType()==Box2D.Dynamics.b2BodyDef.b2_staticBody?this.DrawShape(h,m.m_xf,d):m.GetType()==Box2D.Dynamics.b2BodyDef.b2_kinematicBody?this.DrawShape(h,m.m_xf,b):m.IsAwake()?this.DrawShape(h,m.m_xf,q):this.DrawShape(h,m.m_xf,g):this.DrawShape(h,m.m_xf,p)}}}if(k&Box2D.Dynamics.b2DebugDraw.e_jointBit){for(c=this.m_jointList;c;c=c.m_next){this.DrawJoint(c)}}if(k&Box2D.Dynamics.b2DebugDraw.e_controllerBit){for(c=this.controllerList.GetFirstNode();c;c=c.GetNextNode()){c.controller.Draw(this.m_debugDraw)}}if(k&Box2D.Dynamics.b2DebugDraw.e_pairBit){c=Box2D.Dynamics.b2World.s_pairColor;for(l=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);l;l=l.GetNextNode()){p=l.contact.GetFixtureA(),m=l.contact.GetFixtureB(),p=p.GetAABB().GetCenter(),m=m.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(p,m,c),Box2D.Common.Math.b2Vec2.Free(p),Box2D.Common.Math.b2Vec2.Free(m)}}if(k&Box2D.Dynamics.b2DebugDraw.e_aabbBit){p=Box2D.Dynamics.b2World.s_aabbColor;for(c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.activeBodies);c;c=c.GetNextNode()){m=c.body;for(l=m.GetFixtureList().GetFirstNode();l;l=l.GetNextNode()){h=l.fixture,m=this.m_contactManager.m_broadPhase.GetFatAABB(h.m_proxy),m=[Box2D.Common.Math.b2Vec2.Get(m.lowerBound.x,m.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(m.upperBound.x,m.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(m.upperBound.x,m.upperBound.y),Box2D.Common.Math.b2Vec2.Get(m.lowerBound.x,m.upperBound.y)],this.m_debugDraw.DrawPolygon(m,4,p),Box2D.Common.Math.b2Vec2.Free(m[0]),Box2D.Common.Math.b2Vec2.Free(m[1]),Box2D.Common.Math.b2Vec2.Free(m[2]),Box2D.Common.Math.b2Vec2.Free(m[3])}}}if(k&Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit){for(c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode()){m=c.body,Box2D.Dynamics.b2World.s_xf.R=m.m_xf.R,Box2D.Dynamics.b2World.s_xf.position=m.GetWorldCenter(),this.m_debugDraw.DrawTransform(Box2D.Dynamics.b2World.s_xf)}}}},Box2D.Dynamics.b2World.prototype.QueryAABB=function(b,a){this.m_contactManager.m_broadPhase.Query(b,a)},Box2D.Dynamics.b2World.prototype.QueryPoint=function(b,a){var c=Box2D.Collision.b2AABB.Get();c.lowerBound.Set(a.x-Box2D.Common.b2Settings.b2_linearSlop,a.y-Box2D.Common.b2Settings.b2_linearSlop),c.upperBound.Set(a.x+Box2D.Common.b2Settings.b2_linearSlop,a.y+Box2D.Common.b2Settings.b2_linearSlop),this.m_contactManager.m_broadPhase.Query(function(d){return d.TestPoint(a)?b(d):!0},c),Box2D.Collision.b2AABB.Free(c)},Box2D.Dynamics.b2World.prototype.RayCast=function(f,b,g){var d=this.m_contactManager.m_broadPhase,a=new Box2D.Collision.b2RayCastOutput,c=new Box2D.Collision.b2RayCastInput(b,g,1);d.RayCast(function(k,h){if(h.RayCast(a,k)){var l=1-a.fraction,l=Box2D.Common.Math.b2Vec2.Get(l*b.x+a.fraction*g.x,l*b.y+a.fraction*g.y),e=f(h,l,a.normal,a.fraction);return Box2D.Common.Math.b2Vec2.Free(l),e}return k.maxFraction},c)},Box2D.Dynamics.b2World.prototype.RayCastOne=function(b,a){var c=null;return this.RayCast(function(h,f,g,d){return c=h,d},b,a),c},Box2D.Dynamics.b2World.prototype.RayCastAll=function(b,a){var c=[];return this.RayCast(function(d){return c.push(d),1},b,a),c},Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked},Box2D.Dynamics.b2World.prototype.Solve=function(f){for(var b=this.controllerList.GetFirstNode();b;b=b.GetNextNode()){b.controller.Step(f)}b=this.island,b.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var h=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);h;h=h.GetNextNode()){h.body.m_islandFlag=!1}for(var d=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);d;d=d.GetNextNode()){d.contact.m_islandFlag=!1}for(h=this.m_jointList;h;h=h.m_next){h.m_islandFlag=!1}for(h=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);h;h=h.GetNextNode()){if(d=h.body,!d.m_islandFlag){b.Clear();var a=[];a.push(d);for(d.m_islandFlag=!0;0<a.length;){var c=a.pop();b.AddBody(c),c.IsAwake()||c.SetAwake(!0);if(c.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(d=c.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);d;d=d.GetNextNode()){var g=d.contact;g.m_islandFlag||(b.AddContact(g),g.m_islandFlag=!0,g=g.GetOther(c),g.m_islandFlag||(a.push(g),g.m_islandFlag=!0))}for(d=c.m_jointList;d;d=d.next){!d.joint.m_islandFlag&&d.other.IsActive()&&(b.AddJoint(d.joint),d.joint.m_islandFlag=!0,d.other.m_islandFlag||(a.push(d.other),d.other.m_islandFlag=!0))}}}b.Solve(f,this.m_gravity,this.m_allowSleep)}}for(h=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);h;h=h.GetNextNode()){h.body.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2World.prototype.SolveTOI=function(f){var b=this.island;b.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var h=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);h;h=h.GetNextNode()){var d=h.body;d.m_islandFlag=!1,d.m_sweep.t0=0}for(var a=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){a.contact.m_islandFlag=!1,a.contact.m_toi=null}for(h=this.m_jointList;h;h=h.m_next){h.m_islandFlag=!1}for(;;){var h=this._SolveTOI2(f),c=h.minContact,h=h.minTOI;if(null===c||Box2D.Dynamics.b2World.MAX_TOI<h){break}a=c.m_fixtureA.GetBody(),d=c.m_fixtureB.GetBody(),Box2D.Dynamics.b2World.s_backupA.Set(a.m_sweep),Box2D.Dynamics.b2World.s_backupB.Set(d.m_sweep),a.Advance(h),d.Advance(h),c.Update(this.m_contactManager.m_contactListener),c.m_toi=null;if(c.IsSensor()||!c.IsEnabled()){a.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),d.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),a.SynchronizeTransform(),d.SynchronizeTransform()}else{if(c.IsTouching()){a.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(a=d),b.Clear(),c=new goog.structs.Queue,c.enqueue(a);for(a.m_islandFlag=!0;0<c.size;){if(d=c.dequeue(),b.AddBody(d),d.IsAwake()||d.SetAwake(!0),d.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(a=d.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);a&&b.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;a=a.GetNextNode()){var g=a.contact;g.m_islandFlag||(b.AddContact(g),g.m_islandFlag=!0,g=g.GetOther(d),g.m_islandFlag||(g.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(g.Advance(h),g.SetAwake(!0),c.enqueue(g)),g.m_islandFlag=!0))}for(d=d.m_jointList;d;d=d.next){b.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&!d.joint.m_islandFlag&&d.other.IsActive()&&(b.AddJoint(d.joint),d.joint.m_islandFlag=!0,d.other.m_islandFlag||(d.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(d.other.Advance(h),d.other.SetAwake(!0),c.enqueue(d.other)),d.other.m_islandFlag=!0))}}}this.islandTimeStep.Reset((1-h)*f.dt,0,f.velocityIterations,f.positionIterations,!1),b.SolveTOI(this.islandTimeStep);for(h=0;h<b.m_bodies.length;h++){if(b.m_bodies[h].m_islandFlag=!1,b.m_bodies[h].IsAwake()&&b.m_bodies[h].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){b.m_bodies[h].SynchronizeFixtures();for(a=b.m_bodies[h].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){a.contact.m_toi=null}}}for(h=0;h<b.m_contactCount;h++){b.m_contacts[h].m_islandFlag=!1,b.m_contacts[h].m_toi=null}for(h=0;h<b.m_jointCount;h++){b.m_joints[h].m_islandFlag=!1}this.m_contactManager.FindNewContacts()}}}},Box2D.Dynamics.b2World.prototype._SolveTOI2=function(g){for(var c=null,k=1,f=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);f;f=f.GetNextNode()){var b=f.contact;if(!this._SolveTOI2SkipContact(g,b)){var d=1;if(null!=b.m_toi){d=b.m_toi}else{if(b.IsTouching()){d=1}else{var d=b.m_fixtureA.GetBody(),h=b.m_fixtureB.GetBody(),a=d.m_sweep.t0;d.m_sweep.t0<h.m_sweep.t0?(a=h.m_sweep.t0,d.m_sweep.Advance(a)):h.m_sweep.t0<d.m_sweep.t0&&(a=d.m_sweep.t0,h.m_sweep.Advance(a)),d=b.ComputeTOI(d.m_sweep,h.m_sweep),Box2D.Common.b2Settings.b2Assert(0<=d&&1>=d),0<d&&1>d&&(d=(1-d)*a+d)}b.m_toi=d}Number.MIN_VALUE<d&&d<k&&(c=b,k=d)}}return{minContact:c,minTOI:k}},Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(c,a){var d=a.m_fixtureA.GetBody(),b=a.m_fixtureB.GetBody();return d.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&!!d.IsAwake()||b.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&!!b.IsAwake()?!1:!0},Box2D.Dynamics.b2World.prototype.DrawJoint=function(c){if(c instanceof Box2D.Dynamics.Joints.b2DistanceJoint||c instanceof Box2D.Dynamics.Joints.b2MouseJoint){var a=c.GetAnchorA(),d=c.GetAnchorB();this.m_debugDraw.DrawSegment(a,d,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(d)}else{if(c instanceof Box2D.Dynamics.Joints.b2PulleyJoint){var a=c.GetAnchorA(),d=c.GetAnchorB(),b=c.GetGroundAnchorA(),c=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(b,a,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(c,d,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(b,c,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c)}else{a=c.GetAnchorA(),d=c.GetAnchorB(),c.GetBodyA()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(c.GetBodyA().m_xf.position,a,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(a,d,Box2D.Dynamics.b2World.s_jointColor),c.GetBodyB()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(c.GetBodyB().m_xf.position,d,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(d)}}},Box2D.Dynamics.b2World.prototype.DrawShape=function(f,b,g){if(f instanceof Box2D.Collision.Shapes.b2CircleShape){var d=Box2D.Common.Math.b2Math.MulX(b,f.m_p);this.m_debugDraw.DrawSolidCircle(d,f.m_radius,b.R.col1,g),Box2D.Common.Math.b2Vec2.Free(d)}else{if(f instanceof Box2D.Collision.Shapes.b2PolygonShape){for(var d=0,a=f.GetVertexCount(),f=f.GetVertices(),c=[],d=0;d<a;d++){c[d]=Box2D.Common.Math.b2Math.MulX(b,f[d])}this.m_debugDraw.DrawSolidPolygon(c,a,g);for(d=0;d<a;d++){Box2D.Common.Math.b2Vec2.Free(c[d])}}else{f instanceof Box2D.Collision.Shapes.b2EdgeShape&&(d=Box2D.Common.Math.b2Math.MulX(b,f.GetVertex1()),b=Box2D.Common.Math.b2Math.MulX(b,f.GetVertex2()),this.m_debugDraw.DrawSegment(d,b,g),Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(b))}}},Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_jointColor=new Box2D.Common.b2Color(0.5,0.8,0.8),Box2D.Dynamics.b2World.s_color_inactive=new Box2D.Common.b2Color(0.5,0.5,0.3),Box2D.Dynamics.b2World.s_color_static=new Box2D.Common.b2Color(0.3,0.3,0.3),Box2D.Dynamics.b2World.s_color_kinematic=new Box2D.Common.b2Color(0.5,0.5,0.9),Box2D.Dynamics.b2World.s_color_dynamic_sleeping=new Box2D.Common.b2Color(0.6,0.6,0.6),Box2D.Dynamics.b2World.s_color_dynamic_awake=new Box2D.Common.b2Color(0.6,0.9,0.6),Box2D.Dynamics.b2World.s_pairColor=new Box2D.Common.b2Color(0.3,0.9,0.9),Box2D.Dynamics.b2World.s_aabbColor=new Box2D.Common.b2Color(0,0,0.8),Box2D.generateCallback=function(b,a){return function(){a.apply(b,arguments)}},Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.T=new Box2D.Common.Math.b2Mat22,this.maxTimestep=0},goog.inherits(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(b,a){this.T.col1.x=-b,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-a,this.maxTimestep=0<b||0<a?1/Math.max(b,a):0},Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(d){d=d.dt;if(!(d<=Number.MIN_VALUE)){d>this.maxTimestep&&0<this.maxTimestep&&(d=this.maxTimestep);for(var b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);b;b=b.GetNextNode()){var f=b.body,c=f.GetLocalVector(f.GetLinearVelocity()),a=Box2D.Common.Math.b2Math.MulMV(this.T,c);Box2D.Common.Math.b2Vec2.Free(c),c=f.GetWorldVector(a),Box2D.Common.Math.b2Vec2.Free(a),a=Box2D.Common.Math.b2Vec2.Get(f.GetLinearVelocity().x+c.x*d,f.GetLinearVelocity().y+c.y*d),Box2D.Common.Math.b2Vec2.Free(c),f.SetLinearVelocity(a),Box2D.Common.Math.b2Vec2.Free(a)}}},Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.F=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(){for(var b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);b;b=b.GetNextNode()){var a=b.body;a.ApplyForce(this.F,a.GetWorldCenter())}},Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(f,b,h,d,a,c,g){void 0===g&&(g=0),this.bodyA=f,this.bodyB=b,this.groundAnchorA.SetV(h),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(a),this.localAnchorB=this.bodyB.GetLocalPoint(c),f=a.x-h.x,h=a.y-h.y,this.lengthA=Math.sqrt(f*f+h*h),h=c.x-d.x,d=c.y-d.y,this.lengthB=Math.sqrt(h*h+d*d),this.ratio=g,g=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=g-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(g-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)},function(d){var a={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},g=function(k,h,l){return k[h]||l&&(k[h]={})},c=function(k){var h=typeof k;return h&&(h=="function"||h=="object")},b=function(n,y,k){var x=n?n.split(a.dot):[],w=x.length,r=d.isArray(y)?y:[y||window],m,v,q,e=0,t;if(w==0){return r[0]}while(m=r[e++]){for(q=0;q<w-1&&c(m);q++){m=g(m,x[q],k)}if(c(m)){v=g(m,x[q],k);if(v!==undefined){return k===!1&&delete m[x[q]],v}}}},f=d.String=d.extend(d.String||{},{getObject:b,capitalize:function(k,h){return k.charAt(0).toUpperCase()+k.substr(1)},camelize:function(h){return h=f.classize(h),h.charAt(0).toLowerCase()+h.substr(1)},classize:function(l,m){var k=l.split(a.undHash),h=0;for(;h<k.length;h++){k[h]=f.capitalize(k[h])}return k.join(m||"")},niceName:function(h){f.classize(parts[i]," ")},underscore:function(h){return h.replace(a.colons,"/").replace(a.words,"$1_$2").replace(a.lowUp,"$1_$2").replace(a.dash,"_").toLowerCase()},sub:function(l,m,k){var h=[];return h.push(l.replace(a.replacer,function(q,p){var r=b(p,m,typeof k=="boolean"?!k:k),n=typeof r;return n!=="object"&&n!=="function"||n===null?""+r:(h.push(r),"")})),h.length<=1?h[0]:h}})}(jQuery),function(m){var v=!1,d=m.makeArray,b=m.isFunction,h=m.isArray,w=m.extend,c=function(o){if(!o||typeof o!="object"){return o}if(o instanceof Array){var f=[];for(var s=0;s<o.length;s++){f[s]=c(o[s])}return f}var l={};for(var a in o){l[a]=c(o[a])}return l},q=function(f,a){return f.concat(d(a))},p=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,k=function(l,f,o){o=o||l;for(var a in l){o[a]=b(l[a])&&b(f[a])&&p.test(l[a])?function(r,s){return function(){var n=this._super,e;return this._super=f[r],e=s.apply(this,arguments),this._super=n,e}}(a,l[a]):l[a]}},g=m.Class=function(){if(arguments.length){return g.extend.apply(g,arguments)}};w(g,{callback:function(l){var a=d(arguments),f;return l=a.shift(),h(l)||(l=[l]),f=this,function(){var r=q(a,arguments),u,n=l.length,t=0,e;for(;t<n;t++){e=l[t];if(!e){continue}u=typeof e=="string",u&&f._set_called&&(f.called=e),r=(u?f[e]:e).apply(f,r||[]),t<n-1&&(r=!h(r)||r._use_call?[r]:r)}return r}},getObject:m.String.getObject,newInstance:function(){var f=this.rawInstance(),a;f.setup&&(a=f.setup.apply(f,arguments));for(var l in f.__proto__){f[l]=c(f[l])}return f.init&&f.init.apply(f,h(a)?a:arguments),f},setup:function(f,a){return this.defaults=w(!0,{},f.defaults,this.defaults),this._types==undefined&&(this._types=[]),this._types.push(this.fullName),this._fullTypeName==undefined&&(this._fullTypeName="|"),this._fullTypeName+=this.fullName+"|",arguments},rawInstance:function(){v=!0;var a=new this;return v=!1,a},extend:function(y,o,f){function C(){if(v){return}return this.constructor!==C&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}typeof y!="string"&&(f=o,o=y,y=null),f||(f=o,o=null),f=f||{};var t=this,B=this.prototype,A,u,l,z;this.isA=function(a){return this._fullTypeName.indexOf("|"+a+"|")!=-1},v=!0,z=new this,v=!1,k(f,B,z);for(A in this){this.hasOwnProperty(A)&&(C[A]=c(this[A]))}k(o,this,C);if(y){var s=y.split(/\./),u=s.pop();s.length>0&&(current=g.getObject(s.join("."),window,!0),l=current),current[u]=C}w(C,{prototype:z,namespace:l,shortName:u,constructor:C,fullName:y}),C.prototype.Class=C.prototype.constructor=C;var x=C.setup.apply(C,q([t],arguments));return C.init&&C.init.apply(C,x||[]),C}}),g.prototype.callback=g.callback}(jQuery),gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1,this.isiPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1,this.isiPhone4=this.pixelRatio==2&&this.isiPhone,this.isiPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1,this.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")!=-1,this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1,this.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")!=-1,this.isOpera=navigator.userAgent.toLowerCase().indexOf("opera")!=-1,this.isTouch=window.ontouchstart!=="undefined",window.performance!=undefined&&(this.hasMemoryProfiling=window.performance.memory),/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var a=new Audio;a.canPlayType("audio/ogg")&&(this.canPlayOgg=!0),a.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0),a.canPlayType("audio/x-wav")&&(this.canPlayWav=!0),this.requestAnimFrame=function(){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d,c){window.setTimeout(d,16,Date.now())};return function(c,d){b.apply(window,[c,d])}}()},canPlay:function(a){return a.toLowerCase()==="mp3"&&this.canPlayMP3?!0:a.toLowerCase()==="ogg"&&this.canPlayOgg?!0:a.toLowerCase()==="wav"&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{}),window.gamecore={},gamecore.Class=$.Class,gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(c,a,d){var b="";c&&(b=":"+c),console.log(this.fullName+b+" ["+a+"] "+d)},warn:function(a){this.log(null,this.WARN,a)},debug:function(a){this.log(null,this.DEBUG,a)},error:function(a){this.log(null,this.ERROR,a)},info:function(a){this.log(null,this.INFO,a)},assert:function(b,a){if(!a){throw b}}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++,this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(a){this.Class.log(this.objectId,this.Class.WARN,a)},debug:function(a){this.Class.log(this.objectId,this.Class.DEBUG,a)},error:function(a){this.Class.log(this.objectId,this.Class.ERROR,a)},info:function(a){this.Class.log(this.objectId,this.Class.INFO,a)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}}),gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable},add:function(b,a){var c=this.hashtable.get(b);c==null&&(c=new pc.LinkedList,this.hashtable.put(b,c)),c.add(a)},remove:function(b,a){var c=this.hashtable.get(b);if(c==null){throw"No list for a key in hashlist when removing"}c.remove(a)},get:function(a){return this.hashtable.get(a)}}),gamecore.Hashtable=function(){function q(c){var d;if(typeof c=="string"){return c}if(typeof c.hashCode==B){return d=c.hashCode(),typeof d=="string"?d:q(d)}if(typeof c.toString==B){return c.toString()}try{return String(c)}catch(a){return Object.prototype.toString.call(c)}}function b(c,a){return c.equals(a)}function y(a,c){return typeof c.equals==B?c.equals(a):a===c}function I(a){return function(c){if(c===null){throw new Error("null is not a valid "+a)}if(typeof c=="undefined"){throw new Error(a+" must not be undefined")}}}function E(d,a,f,c){this[0]=d,this.entries=[],this.addEntry(a,f),c!==null&&(this.getEqualityFunction=function(){return c})}function z(a){return function(d){var f=this.entries.length,e,c=this.getEqualityFunction(d);while(f--){e=this.entries[f];if(c(d,e[0])){switch(a){case A:return !0;case x:return e;case D:return[f,e[1]]}}}return !1}}function g(a){return function(d){var f=d.length;for(var e=0,c=this.entries.length;e<c;++e){d[f+e]=this.entries[e][a]}}}function C(d,a){var f=d.length,c;while(f--){c=d[f];if(a===c[0]){return f}}return null}function F(c,a){var d=c[a];return d&&d instanceof E?d:null}function w(n,d){var m=this,o=[],a={},u=typeof n==B?n:q,e=typeof d==B?d:null;this.put=function(p,f){k(p),G(f);var v=u(p),l,c,h=null;return l=F(a,v),l?(c=l.getEntryForKey(p),c?(h=c[1],c[1]=f):l.addEntry(p,f)):(l=new E(v,p,f,e),o[o.length]=l,a[v]=l),h},this.get=function(h){k(h);var c=u(h),l=F(a,c);if(l){var f=l.getEntryForKey(h);if(f){return f[1]}}return null},this.containsKey=function(f){k(f);var c=u(f),h=F(a,c);return h?h.containsKey(f):!1},this.containsValue=function(f){G(f);var c=o.length;while(c--){if(o[c].containsValue(f)){return !0}}return !1},this.clear=function(){o.length=0,a={}},this.isEmpty=function(){return !o.length};var t=function(c){return function(){var f=[],h=o.length;while(h--){o[h][c](f)}return f}};this.keys=t("keys"),this.values=t("values"),this.entries=t("getEntries"),this.remove=function(l){k(l);var p=u(l),h,c=null,f=F(a,p);return f&&(c=f.removeEntryForKey(l),c!==null&&(f.entries.length||(h=C(o,p),H(o,h),delete a[p]))),c},this.size=function(){var f=0,c=o.length;while(c--){f+=o[c].entries.length}return f},this.each=function(h){var c=m.entries(),l=c.length,f;while(l--){f=c[l],h(f[0],f[1])}},this.putAll=function(M,p){var c=M.entries(),v,h,L,K,J=c.length,s=typeof p==B;while(J--){v=c[J],h=v[0],L=v[1],s&&(K=m.get(h))&&(L=p(h,K,L)),m.put(h,L)}},this.clone=function(){var c=new w(n,d);return c.putAll(m),c},this.toString=function(){var h="",c=this.keys();for(var l=0;l<c.length;l++){var f=this.get(c[l]);h+=c[l].toString()+" = "+f.toString()+"\n"}return h}}var B="function",H=typeof Array.prototype.splice==B?function(c,a){c.splice(a,1)}:function(f,c){var h,d,a;if(c===f.length-1){f.length=c}else{h=f.slice(c+1),f.length=c;for(d=0,a=h.length;d<a;++d){f[c+d]=h[d]}}},k=I("key"),G=I("value"),A=0,x=1,D=2;return E.prototype={getEqualityFunction:function(a){return typeof a.equals==B?b:y},getEntryForKey:z(x),getEntryAndIndexForKey:z(D),removeEntryForKey:function(a){var c=this.getEntryAndIndexForKey(a);return c?(H(this.entries,c[0]),c[1]):null},addEntry:function(c,a){this.entries[this.entries.length]=[c,a]},keys:g(0),values:g(1),getEntries:function(d){var a=d.length;for(var f=0,c=this.entries.length;f<c;++f){d[a+f]=this.entries[f].slice(0)}},containsKey:z(A),containsValue:function(c){var a=this.entries.length;while(a--){if(c===this.entries[a][1]){return !0}}return !1}},w}(),gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:!0,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}}),gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super(),this.objToNodeMap=new gamecore.Hashtable},getNode:function(a){return this.objToNodeMap.get(a.getUniqueId())},addNode:function(b){var a=new gamecore.LinkedNode;return a.obj=b,a.prevLinked=null,a.nextLinked=null,a.free=!1,this.objToNodeMap.put(b.getUniqueId(),a),a},add:function(b){var a=this.getNode(b);if(a==null){a=this.addNode(b)}else{if(a.free==0){throw"Attempting to add object: "+b.getUniqueId()+" twice to list "+this.getUniqueId()}a.obj=b,a.free=!1,a.nextLinked=null,a.prevLinked=null}if(this.first==null){this.first=a,this.last=a,a.nextLinked=null,a.prevLinked=null}else{if(this.last==null){throw"Hmm, no last in the list -- that shouldn't happen here"}this.last.nextLinked=a,a.prevLinked=this.last,this.last=a,a.nextLinked=null}this.count++,this.showDebug&&this.dump("after add")},has:function(b){var a=this.getNode(b);return a!=null&&a.free!=1},moveUp:function(d){this.dump("before move up");var b=this.getNode(d);if(!b){throw"Oops, trying to move an object that isn't in the list"}if(b.prevLinked==null){return}var f=b.prevLinked,c=f.prevLinked;b==this.last&&(this.last=f);var a=b.nextLinked;c&&(c.nextLinked=b),b.nextLinked=f,b.prevLinked=f.prevLinked,f.nextLinked=a,f.prevLinked=b,this.first==f&&(this.first=b)},moveDown:function(b){var a=this.getNode(b);if(!a){throw"Oops, trying to move an object that isn't in the list"}if(a.nextLinked==null){return}var c=a.nextLinked;this.moveUp(c.obj),this.last==c&&(this.last=a)},sort:function(c){var a=[],d=this.first;while(d){a.push(d.object()),d=d.next()}this.clear(),a.sort(c);for(var b=0;b<a.length;b++){this.add(a[b])}},remove:function(b){this.showDebug&&this.dump("before remove of "+b);var a=this.getNode(b);return a==null||a.free==1?!1:(a.prevLinked!=null&&(a.prevLinked.nextLinked=a.nextLinked),a.nextLinked!=null&&(a.nextLinked.prevLinked=a.prevLinked),a.prevLinked==null&&(this.first=a.nextLinked),a.nextLinked==null&&(this.last=a.prevLinked),a.free=!0,a.prevLinked=null,a.nextLinked=null,this.count--,this.showDebug&&this.dump("after remove"),!0)},clear:function(){var a=this.first;while(a!=null){a.free=!0,a=a.nextLinked}this.first=null,this.count=0},length:function(){return this.count},dump:function(b){this.debug("===================="+b+"=====================");var a=this.first;while(a!=null){this.debug("{"+a.obj.toString()+"} previous="+(a.prevLinked?a.prevLinked.obj:"NULL")),a=a.next()}this.debug("==================================="),this.debug("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}),gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(a){this.description=a,this.start(),this.Class.history.push(this)},start:function(){this.timeStart=Date.now(),this.memStart=gamecore.Device.getUsedHeap()},end:function(){return this.timeEnd=Date.now(),this.timeDelta=this.timeEnd-this.timeStart,this.memEnd=gamecore.Device.getUsedHeap(),this.memEnd<this.memStart?this.memDelta=0:this.memDelta=this.memEnd-this.memStart,this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(this.memDelta==0?"unknown":this.memDelta)+" byte(s)"}}),gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable,totalPooled:0,totalUsed:0,acquire:function(b){var a=this.getPool(b);if(a==undefined||a==null){a=new gamecore.Pool(b,this.INITIAL_POOL_SIZE),this.pools.put(b.fullName,a)}return a.acquire()},release:function(b){var a=this.pools.get(b.Class.fullName);if(a==undefined){throw"Oops, trying to release an object of type "+b.Class.fullName+" but no pool exists. Did you new an object instead of using create."}a.release(b)},getPool:function(a){return this.pools.get(a.fullName)},getStats:function(){var d="",b=this.pools.keys();for(var f=0;f<b.length;f++){var c=b[f],a=this.pools.get(c);d+=c+": "+a.getStats()+"\n"}return d}},{freeList:null,expansion:1,traces:null,init:function(b,a){this._super(),this.classType=b,this.freeList=[],this.expand(a)},startTracing:function(){if(this.tracing){return}this.tracing=!0,this.traces?this.traces.clear():this.traces=new gamecore.Hashtable},stopTracing:function(){this.tracing=!1},expand:function(b){gamecore.Pool.totalPooled+=b;for(var a=0;a<b;a++){this.freeList.push(new this.classType)}},getFreeCount:function(){return this.freeList.length},acquire:function(){this.freeList.length<=0&&(this.expansion=Math.round(this.expansion*1.2)+1,this.expand(this.expansion));if(this.tracing){var b=printStackTrace(),a=b.length-1;while(b[a].indexOf("Class.addTo")==0&&a>0){a--}var c=this.traces.get(b[a]);c==null?this.traces.put(b[a],{value:1}):c.value++}return this.freeList.pop()},release:function(a){this.freeList.push(a)},getStats:function(){var b=this.Class.fullName+" stats: "+this.freeList.length+" free.\n";if(this.tracing){b+="TRACING\n";var a=this.traces.keys();for(var c in a){b+=a[c]+" ("+this.traces.get(a[c]).value+")\n"}}return b},dump:function(a){this.info("================== "+a+" ==================="),this.info("FREE"),this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}}),gamecore.DualPool=gamecore.Pool.extend("gamecore.DualPool",{acquire:function(b){var a=this.getPool(b);if(a==undefined||a==null){a=new gamecore.DualPool(b,this.INITIAL_POOL_SIZE),this.pools.put(b.fullName,a)}return a.acquire()},getStats:function(){var d="",b=this.pools.keys();for(var f=0;f<b.length;f++){var c=b[f],a=this.pools.get(c);d+=c+" (free: "+a.freeList.length()+" used: "+a.usedList.length()+")\n"}return d}},{freeList:null,usedList:null,init:function(b,a){this.classType=b,this.usedList=new gamecore.LinkedList,this.freeList=new gamecore.LinkedList,this.expand(a)},expand:function(b){gamecore.Pool.totalPooled+=b;for(var a=0;a<b;a++){this.freeList.add(new this.classType)}},returnObj:null,acquire:function(){this.freeList.first==null&&this.expand(Math.round(this.size()/5)+1),this.returnObj=this.freeList.first.obj,this.freeList.remove(this.returnObj),this.returnObj.destroyed=!1,this.usedList.add(this.returnObj);if(this.tracing){var b=printStackTrace(),a=b.length-1;while(b[a].indexOf("Class.addTo")==0&&a>0){a--}var c=this.traces.get(b[a]);c==null?this.traces.put(b[a],{value:1}):c.value++}return this.returnObj},release:function(a){this.freeList.add(a),this.usedList.remove(a)},dump:function(a){this.info("================== "+a+" ==================="),this.info("FREE"),this.freeList.dump(),this.info("USED"),this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}}),gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(){return gamecore.Pool.acquire(this)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.Pool.release(this)},onRelease:function(){}}),gamecore.DualPooled=gamecore.Base("gamecore.DualPooled",{create:function(){return gamecore.DualPool.acquire(this)},getPool:function(){return gamecore.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.DualPool.release(this)},onRelease:function(){}}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(b,a){return b=b||this.createException(),a=a||this.mode(b),a==="other"?this.other(arguments.callee):this[a](b)},createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return a.arguments&&a.stack?"chrome":typeof a.message=="string"&&typeof window!="undefined"&&window.opera?a.stacktrace?a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":a.stack?a.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":a.stack?"firefox":"other"},instrumentFunction:function(c,a,d){c=c||window;var b=c[a];c[a]=function(){return d.call(this,printStackTrace().slice(4)),c[a]._instrumented.apply(this,arguments)},c[a]._instrumented=b},deinstrumentFunction:function(b,a){b[a].constructor===Function&&b[a]._instrumented&&b[a]._instrumented.constructor===Function&&(b[a]=b[a]._instrumented)},chrome:function(b){var a=(b.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return a.pop(),a},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(k){var p="{anonymous}",d=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,b=k.stacktrace.split("\n"),g=[];for(var q=0,c=b.length;q<c;q+=2){var m=d.exec(b[q]);if(m){var l=m[4]+":"+m[1]+":"+m[2],h=m[3]||"global code";h=h.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,p),g.push(h+"@"+l+" -- "+b[q+1].replace(/^\s+/,""))}}return g},opera10b:function(g){var c=/^(.*)@(.+):(\d+)$/,k=g.stacktrace.split("\n"),f=[];for(var b=0,d=k.length;b<d;b++){var h=c.exec(k[b]);if(h){var a=h[1]?h[1]+"()":"global code";f.push(a+"@"+h[2]+":"+h[3])}}return f},opera10a:function(g){var l="{anonymous}",d=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,b=g.stacktrace.split("\n"),f=[];for(var m=0,c=b.length;m<c;m+=2){var k=d.exec(b[m]);if(k){var h=k[3]||l;f.push(h+"()@"+k[2]+":"+k[1]+" -- "+b[m+1].replace(/^\s+/,""))}}return f},opera9:function(g){var c="{anonymous}",k=/Line (\d+).*script (?:in )?(\S+)/i,f=g.message.split("\n"),b=[];for(var d=2,h=f.length;d<h;d+=2){var a=k.exec(f[d]);a&&b.push(c+"()@"+a[2]+":"+a[1]+" -- "+f[d+1].replace(/^\s+/,""))}return b},other:function(f){var b="{anonymous}",h=/function\s*([\w\-$]+)?\s*\(/i,d=[],a,c,g=10;while(f&&f.arguments&&d.length<g){a=h.test(f.toString())?RegExp.$1||b:b,c=Array.prototype.slice.call(f.arguments||[]),d[d.length]=a+"("+this.stringifyArguments(c)+")",f=f.caller}return d},stringifyArguments:function(d){var b=[],f=Array.prototype.slice;for(var c=0;c<d.length;++c){var a=d[c];a===undefined?b[c]="undefined":a===null?b[c]="null":a.constructor&&(a.constructor===Array?a.length<3?b[c]="["+this.stringifyArguments(a)+"]":b[c]="["+this.stringifyArguments(f.call(a,0,1))+"..."+this.stringifyArguments(f.call(a,-1))+"]":a.constructor===Object?b[c]="#object":a.constructor===Function?b[c]="#function":a.constructor===String?b[c]='"'+a+'"':a.constructor===Number&&(b[c]=a))}return b.join(",")},sourceCache:{},ajax:function(b){var a=this.createXMLHTTPObject();if(a){try{return a.open("GET",b,!1),a.send(null),a.responseText}catch(c){}}return""},createXMLHTTPObject:function(){var c,a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var d=0;d<a.length;d++){try{return c=a[d](),this.createXMLHTTPObject=a[d],c}catch(b){}}},isSameDomain:function(a){return typeof location!="undefined"&&a.indexOf(location.hostname)!==-1},getSource:function(a){return a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n")),this.sourceCache[a]},guessAnonymousFunctions:function(m){for(var v=0;v<m.length;++v){var d=/\{anonymous\}\(.*\)@(.*)/,b=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,h=m[v],w=d.exec(h);if(w){var c=b.exec(w[1]);if(c){var q=c[1],p=c[2],k=c[3]||0;if(q&&this.isSameDomain(q)&&p){var g=this.guessAnonymousFunction(q,p,k);m[v]=h.replace("{anonymous}",g)}}}}return m},guessAnonymousFunction:function(d,b,f){var c;try{c=this.findFunctionName(this.getSource(d),b)}catch(a){c="getSource failed with url: "+d+", exception: "+a.toString()}return c},findFunctionName:function(m,v){var d=/function\s+([^(]*?)\s*\(([^)]*)\)/,b=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,h=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,w="",c,q=Math.min(v,20),p,k;for(var g=0;g<q;++g){c=m[v-g-1],k=c.indexOf("//"),k>=0&&(c=c.substr(0,k));if(c){w=c+w,p=b.exec(w);if(p&&p[1]){return p[1]}p=d.exec(w);if(p&&p[1]){return p[1]}p=h.exec(w);if(p&&p[1]){return p[1]}}}return"(?)"}},function(e,t){function u(e){var t=o[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++){t[e[n]]=!0}return t}function c(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(l,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:s.isNumeric(r)?parseFloat(r):f.test(r)?s.parseJSON(r):r}catch(o){}s.data(e,n,r)}else{r=t}}return r}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t])){continue}if(t!=="toJSON"){return !1}}return !0}function p(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",u=s._data(e,r);u&&(n==="queue"||!s._data(e,i))&&(n==="mark"||!s._data(e,o))&&setTimeout(function(){!s._data(e,i)&&!s._data(e,o)&&(s.removeData(e,r,!0),u.fire())},0)}function H(){return !1}function B(){return !0}function W(e){return !e||!e.parentNode||e.parentNode.nodeType===11}function X(e,t,n){t=t||0;if(s.isFunction(t)){return s.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n})}if(t.nodeType){return s.grep(e,function(e,r){return e===t===n})}if(typeof t=="string"){var r=s.grep(e,function(e){return e.nodeType===1});if(q.test(t)){return s.filter(t,r,!n)}t=s.filter(t,r)}return s.grep(e,function(e,r){return s.inArray(e,t)>=0===n})}function V(e){var t=$.split("|"),n=e.createDocumentFragment();if(n.createElement){while(t.length){n.createElement(t.pop())}}return n}function at(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e,t){if(t.nodeType!==1||!s.hasData(e)){return}var n,r,i,o=s._data(e),u=s._data(t,o),a=o.events;if(a){delete u.handle,u.events={};for(n in a){for(r=0,i=a[n].length;r<i;r++){s.event.add(t,n+(a[n][r].namespace?".":"")+a[n][r].namespace,a[n][r],a[n][r].data)}}}u.data&&(u.data=s.extend({},u.data))}function lt(e,t){var n;if(t.nodeType!==1){return}t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase();if(n==="object"){t.outerHTML=e.outerHTML}else{if(n!=="input"||e.type!=="checkbox"&&e.type!=="radio"){if(n==="option"){t.selected=e.defaultSelected}else{if(n==="input"||n==="textarea"){t.defaultValue=e.defaultValue}}}else{e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)}}t.removeAttribute(s.expando)}function ct(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function ht(e){if(e.type==="checkbox"||e.type==="radio"){e.defaultChecked=e.checked}}function pt(e){var t=(e.nodeName||"").toLowerCase();t==="input"?ht(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&s.grep(e.getElementsByTagName("input"),ht)}function dt(e){var t=n.createElement("div");return ut.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function vt(e,t){t.src?s.ajax({url:t.src,async:!1,dataType:"script"}):s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(st,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)}function Lt(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?xt:Tt,o=0,u=i.length;if(r>0){if(n!=="border"){for(;o<u;o++){n||(r-=parseFloat(s.css(e,"padding"+i[o]))||0),n==="margin"?r+=parseFloat(s.css(e,n+i[o]))||0:r-=parseFloat(s.css(e,"border"+i[o]+"Width"))||0}}return r+"px"}r=Nt(e,t,t);if(r<0||r==null){r=e.style[t]||0}r=parseFloat(r)||0;if(n){for(;o<u;o++){r+=parseFloat(s.css(e,"padding"+i[o]))||0,n!=="padding"&&(r+=parseFloat(s.css(e,"border"+i[o]+"Width"))||0),n==="margin"&&(r+=parseFloat(s.css(e,n+i[o]))||0)}}return r+"px"}function Gt(e){return function(t,n){typeof t!="string"&&(n=t,t="*");if(s.isFunction(n)){var r=t.toLowerCase().split(Rt),i=0,o=r.length,u,a,f;for(;i<o;i++){u=r[i],f=/^\+/.test(u),f&&(u=u.substr(1)||"*"),a=e[u]=e[u]||[],a[f?"unshift":"push"](n)}}}}function Yt(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u=e[s],a=0,f=u?u.length:0,l=e===Xt,c;for(;a<f&&(l||!c);a++){c=u[a](n,r,i),typeof c=="string"&&(!l||o[c]?c=t:(n.dataTypes.unshift(c),c=Yt(e,n,r,i,c,o)))}return(l||!c)&&!o["*"]&&(c=Yt(e,n,r,i,"*",o)),c}function Zt(e,n){var r,i,o=s.ajaxSettings.flatOptions||{};for(r in n){n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r])}i&&s.extend(!0,e,i)}function en(e,t,n,r){if(s.isArray(t)){s.each(t,function(t,i){n||Ot.test(e)?r(e,i):en(e+"["+(typeof i=="object"||s.isArray(i)?t:"")+"]",i,n,r)})}else{if(!n&&t!=null&&typeof t=="object"){for(var i in t){en(e+"["+i+"]",t[i],n,r)}}else{r(e,t)}}}function tn(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o){a in r&&(n[o[a]]=r[a])}while(s[0]==="*"){s.shift(),u===t&&(u=e.mimeType||n.getResponseHeader("content-type"))}if(u){for(a in i){if(i[a]&&i[a].test(u)){s.unshift(a);break}}}if(s[0] in r){f=s[0]}else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f){return f!==s[0]&&s.unshift(f),r[f]}}function nn(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},o,u,a=r.length,f,l=r[0],c,h,p,d,v;for(o=1;o<a;o++){if(o===1){for(u in e.converters){typeof u=="string"&&(i[u.toLowerCase()]=e.converters[u])}}c=l,l=r[o];if(l==="*"){l=c}else{if(c!=="*"&&c!==l){h=c+" "+l,p=i[h]||i["* "+l];if(!p){v=t;for(d in i){f=d.split(" ");if(f[0]===c||f[0]==="*"){v=i[f[1]+" "+l];if(v){d=i[d],d===!0?p=v:v===!0&&(p=d);break}}}}!p&&!v&&s.error("No conversion from "+h.replace(" "," to ")),p!==!0&&(n=p?p(n):v(d(n)))}}}return n}function fn(){try{return new e.XMLHttpRequest}catch(t){}}function ln(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function bn(){return setTimeout(wn,0),yn=s.now()}function wn(){yn=t}function En(e,t){var n={};return s.each(gn.concat.apply([],gn.slice(0,t)),function(){n[this]=e}),n}function Sn(e){if(!cn[e]){var t=n.body,r=s("<"+e+">").appendTo(t),i=r.css("display");r.remove();if(i==="none"||i===""){hn||(hn=n.createElement("iframe"),hn.frameBorder=hn.width=hn.height=0),t.appendChild(hn);if(!pn||!hn.createElement){pn=(hn.contentWindow||hn.contentDocument).document,pn.write((n.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),pn.close()}r=pn.createElement(e),pn.body.appendChild(r),i=s.css(r,"display"),t.removeChild(hn)}cn[e]=i}return cn[e]}function Nn(e){return s.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=e.document,r=e.navigator,i=e.location,s=function(){function H(){if(i.isReady){return}try{n.documentElement.doScroll("left")}catch(e){setTimeout(H,1);return}i.ready()}var i=function(e,t){return new i.fn.init(e,t,u)},s=e.jQuery,o=e.$,u,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,E=/-([a-z]|[0-9])/ig,S=/^-ms-/,x=function(e,t){return(t+"").toUpperCase()},T=r.userAgent,N,C,k,L=Object.prototype.toString,A=Object.prototype.hasOwnProperty,O=Array.prototype.push,M=Array.prototype.slice,_=String.prototype.trim,D=Array.prototype.indexOf,P={};return i.fn=i.prototype={constructor:i,init:function(e,r,s){var o,u,f,l;if(!e){return this}if(e.nodeType){return this.context=this[0]=e,this.length=1,this}if(e==="body"&&!r&&n.body){return this.context=n,this[0]=n.body,this.selector=e,this.length=1,this}if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?o=[null,e,null]:o=a.exec(e);if(o&&(o[1]||!r)){if(o[1]){return r=r instanceof i?r[0]:r,l=r?r.ownerDocument||r:n,f=h.exec(e),f?i.isPlainObject(r)?(e=[n.createElement(f[1])],i.fn.attr.call(e,r,!0)):e=[l.createElement(f[1])]:(f=i.buildFragment([o[1]],[l]),e=(f.cacheable?i.clone(f.fragment):f.fragment).childNodes),i.merge(this,e)}u=n.getElementById(o[2]);if(u&&u.parentNode){if(u.id!==o[2]){return s.find(e)}this.length=1,this[0]=u}return this.context=n,this.selector=e,this}return !r||r.jquery?(r||s).find(e):this.constructor(r).find(e)}return i.isFunction(e)?s.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),i.makeArray(e,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return M.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();return i.isArray(e)?O.apply(r,e):i.merge(r,e),r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return i.each(this,e,t)},ready:function(e){return i.bindReady(),C.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(M.apply(this,arguments),"slice",M.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:O,sort:[].sort,splice:[].splice},i.fn.init.prototype=i.fn,i.extend=i.fn.extend=function(){var e,n,r,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!i.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++){if((e=arguments[f])!=null){for(n in e){r=a[n],s=e[n];if(a===s){continue}c&&s&&(i.isPlainObject(s)||(o=i.isArray(s)))?(o?(o=!1,u=r&&i.isArray(r)?r:[]):u=r&&i.isPlainObject(r)?r:{},a[n]=i.extend(c,u,s)):s!==t&&(a[n]=s)}}}return a},i.extend({noConflict:function(t){return e.$===i&&(e.$=o),t&&e.jQuery===i&&(e.jQuery=s),i},isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(e){if(e===!0&&!--i.readyWait||e!==!0&&!i.isReady){if(!n.body){return setTimeout(i.ready,1)}i.isReady=!0;if(e!==!0&&--i.readyWait>0){return}C.fireWith(n,[i]),i.fn.trigger&&i(n).trigger("ready").off("ready")}},bindReady:function(){if(C){return}C=i.Callbacks("once memory");if(n.readyState==="complete"){return setTimeout(i.ready,1)}if(n.addEventListener){n.addEventListener("DOMContentLoaded",k,!1),e.addEventListener("load",i.ready,!1)}else{if(n.attachEvent){n.attachEvent("onreadystatechange",k),e.attachEvent("onload",i.ready);var t=!1;try{t=e.frameElement==null}catch(r){}n.documentElement.doScroll&&t&&H()}}},isFunction:function(e){return i.type(e)==="function"},isArray:Array.isArray||function(e){return i.type(e)==="array"},isWindow:function(e){return e&&typeof e=="object"&&"setInterval" in e},isNumeric:function(e){return !isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):P[L.call(e)]||"object"},isPlainObject:function(e){if(!e||i.type(e)!=="object"||e.nodeType||i.isWindow(e)){return !1}try{if(e.constructor&&!A.call(e,"constructor")&&!A.call(e.constructor.prototype,"isPrototypeOf")){return !1}}catch(n){return !1}var r;for(r in e){}return r===t||A.call(e,r)},isEmptyObject:function(e){for(var t in e){return !1}return !0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!t){return null}t=i.trim(t);if(e.JSON&&e.JSON.parse){return e.JSON.parse(t)}if(p.test(t.replace(d,"@").replace(v,"]").replace(m,""))){return(new Function("return "+t))()}i.error("Invalid JSON: "+t)},parseXML:function(n){var r,s;try{e.DOMParser?(s=new DOMParser,r=s.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&i.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&f.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(S,"ms-").replace(E,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var s,o=0,u=e.length,a=u===t||i.isFunction(e);if(r){if(a){for(s in e){if(n.apply(e[s],r)===!1){break}}}else{for(;o<u;){if(n.apply(e[o++],r)===!1){break}}}}else{if(a){for(s in e){if(n.call(e[s],s,e[s])===!1){break}}}else{for(;o<u;){if(n.call(e[o],o,e[o++])===!1){break}}}}return e},trim:_?function(e){return e==null?"":_.call(e)}:function(e){return e==null?"":e.toString().replace(l,"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var r=i.type(e);e.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(e)?O.call(n,e):i.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(D){return D.call(t,e,n)}r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++){if(n in t&&t[n]===e){return n}}}return -1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number"){for(var s=n.length;i<s;i++){e[r++]=n[i]}}else{while(n[i]!==t){e[r++]=n[i++]}}return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++){i=!!t(e[s],s),n!==i&&r.push(e[s])}return r},map:function(e,n,r){var s,o,u=[],a=0,f=e.length,l=e instanceof i||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||i.isArray(e));if(l){for(;a<f;a++){s=n(e[a],a,r),s!=null&&(u[u.length]=s)}}else{for(o in e){s=n(e[o],o,r),s!=null&&(u[u.length]=s)}}return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var r=e[n];n=e,e=r}if(!i.isFunction(e)){return t}var s=M.call(arguments,2),o=function(){return e.apply(n,s.concat(M.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||i.guid++,o},access:function(e,n,r,s,o,u){var a=e.length;if(typeof n=="object"){for(var f in n){i.access(e,f,n[f],s,o,r)}return e}if(r!==t){s=!u&&s&&i.isFunction(r);for(var l=0;l<a;l++){o(e[l],n,s?r.call(e[l],l,o(e[l],n)):r,u)}return e}return a?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=g.exec(e)||y.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&w.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}i.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,s){return s&&s instanceof i&&!(s instanceof e)&&(s=e(s)),i.fn.init.call(this,r,s,t)},e.fn.init.prototype=e.fn;var t=e(n);return e},browser:{}}),i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){P["[object "+t+"]"]=t.toLowerCase()}),N=i.uaMatch(T),N.browser&&(i.browser[N.browser]=!0,i.browser.version=N.version),i.browser.webkit&&(i.browser.safari=!0),f.test(" ")&&(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),u=i(n),n.addEventListener?k=function(){n.removeEventListener("DOMContentLoaded",k,!1),i.ready()}:n.attachEvent&&(k=function(){n.readyState==="complete"&&(n.detachEvent("onreadystatechange",k),i.ready())}),i}(),o={};s.Callbacks=function(e){e=e?o[e]||u(e):{};var n=[],r=[],i,a,f,l,c,h=function(t){var r,i,o,u,a;for(r=0,i=t.length;r<i;r++){o=t[r],u=s.type(o),u==="array"?h(o):u==="function"&&(!e.unique||!d.has(o))&&n.push(o)}},p=function(t,s){s=s||[],i=!e.memory||[t,s],a=!0,c=f||0,f=0,l=n.length;for(;n&&c<l;c++){if(n[c].apply(t,s)===!1&&e.stopOnFalse){i=!0;break}}a=!1,n&&(e.once?i===!0?d.disable():n=[]:r&&r.length&&(i=r.shift(),d.fireWith(i[0],i[1])))},d={add:function(){if(n){var e=n.length;h(arguments),a?l=n.length:i&&i!==!0&&(f=e,p(i[0],i[1]))}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++){for(var s=0;s<n.length;s++){if(t[r]===n[s]){a&&s<=l&&(l--,s<=c&&c--),n.splice(s--,1);if(e.unique){break}}}}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++){if(e===n[t]){return !0}}}return !1},empty:function(){return n=[],this},disable:function(){return n=r=i=t,this},disabled:function(){return !n},lock:function(){return r=t,(!i||i===!0)&&d.disable(),this},locked:function(){return !r},fireWith:function(t,n){return r&&(a?e.once||r.push([t,n]):(!e.once||!i)&&p(t,n)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return !!i}};return d};var a=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),n=s.Callbacks("once memory"),r=s.Callbacks("memory"),i="pending",o={resolve:t,reject:n,notify:r},u={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return a.done(e).fail(t).progress(n),this},always:function(){return a.done.apply(a,arguments).fail.apply(a,arguments),this},pipe:function(e,t,n){return s.Deferred(function(r){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],o;s.isFunction(n)?a[e](function(){o=n.apply(this,arguments),o&&s.isFunction(o.promise)?o.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===a?r:this,[o])}):a[e](r[i])})}).promise()},promise:function(e){if(e==null){e=u}else{for(var t in u){e[t]=u[t]}}return e}},a=u.promise({}),f;for(f in o){a[f]=o[f].fire,a[f+"With"]=o[f].fireWith}return a.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(a,a),a},when:function(e){function c(e){return function(n){t[e]=arguments.length>1?a.call(arguments,0):n,--o||f.resolveWith(f,t)}}function h(e){return function(t){i[e]=arguments.length>1?a.call(arguments,0):t,f.notifyWith(l,i)}}var t=a.call(arguments,0),n=0,r=t.length,i=new Array(r),o=r,u=r,f=r<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),l=f.promise();if(r>1){for(;n<r;n++){t[n]&&t[n].promise&&s.isFunction(t[n].promise)?t[n].promise().then(c(n),f.reject,h(n)):--o}o||f.resolveWith(f,t)}else{f!==e&&f.resolveWith(f,r?[e]:[])}return l}}),s.support=function(){var t,r,i,o,u,a,f,l,c,h,p,d,v,m=n.createElement("div"),g=n.documentElement;m.setAttribute("className","t"),m.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",r=m.getElementsByTagName("*"),i=m.getElementsByTagName("a")[0];if(!r||!r.length||!i){return{}}o=n.createElement("select"),u=o.appendChild(n.createElement("option")),a=m.getElementsByTagName("input")[0],t={leadingWhitespace:m.firstChild.nodeType===3,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:i.getAttribute("href")==="/a",opacity:/^0.55/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:a.value==="on",optSelected:u.selected,getSetAttribute:m.className!=="t",enctype:!!n.createElement("form").enctype,html5Clone:n.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!u.disabled;try{delete m.test}catch(y){t.deleteExpando=!1}!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",function(){t.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick")),a=n.createElement("input"),a.value="t",a.setAttribute("type","radio"),t.radioValue=a.value==="t",a.setAttribute("checked","checked"),m.appendChild(a),l=n.createDocumentFragment(),l.appendChild(m.lastChild),t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,l.removeChild(a),l.appendChild(m),m.innerHTML="",e.getComputedStyle&&(f=n.createElement("div"),f.style.width="0",f.style.marginRight="0",m.style.width="2px",m.appendChild(f),t.reliableMarginRight=(parseInt((e.getComputedStyle(f,null)||{marginRight:0}).marginRight,10)||0)===0);if(m.attachEvent){for(d in {submit:1,change:1,focusin:1}){p="on"+d,v=p in m,v||(m.setAttribute(p,"return;"),v=typeof m[p]=="function"),t[d+"Bubbles"]=v}}return l.removeChild(m),l=o=u=f=m=a=null,s(function(){var e,r,i,o,u,a,f,l,h,p,d,g=n.getElementsByTagName("body")[0];if(!g){return}f=1,l="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",h="visibility:hidden;border:0;",p="style='"+l+"border:5px solid #000;padding:0;'",d="<div "+p+"><div></div></div><table "+p+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",e=n.createElement("div"),e.style.cssText=h+"width:0;height:0;position:static;top:0;margin-top:"+f+"px",g.insertBefore(e,g.firstChild),m=n.createElement("div"),e.appendChild(m),m.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",c=m.getElementsByTagName("td"),v=c[0].offsetHeight===0,c[0].style.display="",c[1].style.display="none",t.reliableHiddenOffsets=v&&c[0].offsetHeight===0,m.innerHTML="",m.style.width=m.style.paddingLeft="1px",s.boxModel=t.boxModel=m.offsetWidth===2,typeof m.style.zoom!="undefined"&&(m.style.display="inline",m.style.zoom=1,t.inlineBlockNeedsLayout=m.offsetWidth===2,m.style.display="",m.innerHTML="<div style='width:4px;'></div>",t.shrinkWrapBlocks=m.offsetWidth!==2),m.style.cssText=l+h,m.innerHTML=d,r=m.firstChild,i=r.firstChild,u=r.nextSibling.firstChild.firstChild,a={doesNotAddBorder:i.offsetTop!==5,doesAddBorderForTableAndCells:u.offsetTop===5},i.style.position="fixed",i.style.top="20px",a.fixedPosition=i.offsetTop===20||i.offsetTop===15,i.style.position=i.style.top="",r.style.overflow="hidden",r.style.position="relative",a.subtractsBorderForOverflowNotVisible=i.offsetTop===-5,a.doesNotIncludeMarginInBodyOffset=g.offsetTop!==f,g.removeChild(e),m=e=null,s.extend(t,a)}),t}();var f=/^(?:\{.*\}|\[.*\])$/,l=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?s.cache[e[s.expando]]:e[s.expando],!!e&&!h(e)},data:function(e,n,r,i){if(!s.acceptData(e)){return}var o,u,a,f=s.expando,l=typeof n=="string",c=e.nodeType,h=c?s.cache:e,p=c?e[f]:e[f]&&f,d=n==="events";if((!p||!h[p]||!d&&!i&&!h[p].data)&&l&&r===t){return}p||(c?e[f]=p=++s.uuid:p=f),h[p]||(h[p]={},c||(h[p].toJSON=s.noop));if(typeof n=="object"||typeof n=="function"){i?h[p]=s.extend(h[p],n):h[p].data=s.extend(h[p].data,n)}return o=u=h[p],i||(u.data||(u.data={}),u=u.data),r!==t&&(u[s.camelCase(n)]=r),d&&!u[n]?o.events:(l?(a=u[n],a==null&&(a=u[s.camelCase(n)])):a=u,a)},removeData:function(e,t,n){if(!s.acceptData(e)){return}var r,i,o,u=s.expando,a=e.nodeType,f=a?s.cache:e,l=a?e[u]:u;if(!f[l]){return}if(t){r=n?f[l]:f[l].data;if(r){s.isArray(t)||(t in r?t=[t]:(t=s.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,o=t.length;i<o;i++){delete r[t[i]]}if(!(n?h:s.isEmptyObject)(r)){return}}}if(!n){delete f[l].data;if(!h(f[l])){return}}s.support.deleteExpando||!f.setInterval?delete f[l]:f[l]=null,a&&(s.support.deleteExpando?delete e[u]:e.removeAttribute?e.removeAttribute(u):e[u]=null)},_data:function(e,t,n){return s.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t){return t!==!0&&e.getAttribute("classid")===t}}return !0}}),s.fn.extend({data:function(e,n){var r,i,o,u=null;if(typeof e=="undefined"){if(this.length){u=s.data(this[0]);if(this[0].nodeType===1&&!s._data(this[0],"parsedAttrs")){i=this[0].attributes;for(var a=0,f=i.length;a<f;a++){o=i[a].name,o.indexOf("data-")===0&&(o=s.camelCase(o.substring(5)),c(this[0],o,u[o]))}s._data(this[0],"parsedAttrs",!0)}}return u}return typeof e=="object"?this.each(function(){s.data(this,e)}):(r=e.split("."),r[1]=r[1]?"."+r[1]:"",n===t?(u=this.triggerHandler("getData"+r[1]+"!",[r[0]]),u===t&&this.length&&(u=s.data(this[0],e),u=c(this[0],e,u)),u===t&&r[1]?this.data(r[0]):u):this.each(function(){var t=s(this),i=[r[0],n];t.triggerHandler("setData"+r[1]+"!",i),s.data(this,e,n),t.triggerHandler("changeData"+r[1]+"!",i)}))},removeData:function(e){return this.each(function(){s.removeData(this,e)})}}),s.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",s._data(e,t,(s._data(e,t)||0)+1))},_unmark:function(e,t,n){e!==!0&&(n=t,t=e,e=!1);if(t){n=n||"fx";var r=n+"mark",i=e?0:(s._data(t,r)||1)-1;i?s._data(t,r,i):(s.removeData(t,r,!0),p(t,n,"mark"))}},queue:function(e,t,n){var r;if(e){return t=(t||"fx")+"queue",r=s._data(e,t),n&&(!r||s.isArray(n)?r=s._data(e,t,s.makeArray(n)):r.push(n)),r||[]}},dequeue:function(e,t){t=t||"fx";var n=s.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift()),r&&(t==="fx"&&n.unshift("inprogress"),s._data(e,t+".run",i),r.call(e,function(){s.dequeue(e,t)},i)),n.length||(s.removeData(e,t+"queue "+t+".run",!0),p(e,t,"queue"))}}),s.fn.extend({queue:function(e,n){return typeof e!="string"&&(n=e,e="fx"),n===t?s.queue(this[0],e):this.each(function(){var t=s.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&s.dequeue(this,e)})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){return e=s.fx?s.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function h(){--u||r.resolveWith(i,[i])}typeof e!="string"&&(n=e,e=t),e=e||"fx";var r=s.Deferred(),i=this,o=i.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--){if(c=s.data(i[o],a,t,!0)||(s.data(i[o],f,t,!0)||s.data(i[o],l,t,!0))&&s.data(i[o],a,s.Callbacks("once memory"),!0)){u++,c.add(h)}}return h(),r.promise()}});var d=/[\n\t\r]/g,v=/\s+/,m=/\r/g,g=/^(?:button|input)$/i,y=/^(?:button|input|object|select|textarea)$/i,b=/^a(?:rea)?$/i,w=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,E=s.support.getSetAttribute,S,x,T;s.fn.extend({attr:function(e,t){return s.access(this,e,t,!0,s.attr)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,e,t,!0,s.prop)},removeProp:function(e){return e=s.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,u,a;if(s.isFunction(e)){return this.each(function(t){s(this).addClass(e.call(this,t,this.className))})}if(e&&typeof e=="string"){t=e.split(v);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1){if(!i.className&&t.length===1){i.className=e}else{o=" "+i.className+" ";for(u=0,a=t.length;u<a;u++){~o.indexOf(" "+t[u]+" ")||(o+=t[u]+" ")}i.className=s.trim(o)}}}}return this},removeClass:function(e){var n,r,i,o,u,a,f;if(s.isFunction(e)){return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))})}if(e&&typeof e=="string"||e===t){n=(e||"").split(v);for(r=0,i=this.length;r<i;r++){o=this[r];if(o.nodeType===1&&o.className){if(e){u=(" "+o.className+" ").replace(d," ");for(a=0,f=n.length;a<f;a++){u=u.replace(" "+n[a]+" "," ")}o.className=s.trim(u)}else{o.className=""}}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return s.isFunction(e)?this.each(function(n){s(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,o=0,u=s(this),a=t,f=e.split(v);while(i=f[o++]){a=r?a:!u.hasClass(i),u[a?"addClass":"removeClass"](i)}}else{if(n==="undefined"||n==="boolean"){this.className&&s._data(this,"__className__",this.className),this.className=this.className||e===!1?"":s._data(this,"__className__")||""}}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++){if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(d," ").indexOf(t)>-1){return !0}}return !1},val:function(e){var n,r,i,o=this[0];if(!arguments.length){if(o){return n=s.valHooks[o.nodeName.toLowerCase()]||s.valHooks[o.type],n&&"get" in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,typeof r=="string"?r.replace(m,""):r==null?"":r)}return}return i=s.isFunction(e),this.each(function(r){var o=s(this),u;if(this.nodeType!==1){return}i?u=e.call(this,r,o.val()):u=e,u==null?u="":typeof u=="number"?u+="":s.isArray(u)&&(u=s.map(u,function(e){return e==null?"":e+""})),n=s.valHooks[this.nodeName.toLowerCase()]||s.valHooks[this.type];if(!n||!("set" in n)||n.set(this,u,"value")===t){this.value=u}})}}),s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return !t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,u=[],a=e.options,f=e.type==="select-one";if(o<0){return null}n=f?o:0,r=f?o+1:a.length;for(;n<r;n++){i=a[n];if(i.selected&&(s.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!s.nodeName(i.parentNode,"optgroup"))){t=s(i).val();if(f){return t}u.push(t)}}return f&&!u.length&&a.length?s(a[o]).val():u},set:function(e,t){var n=s.makeArray(t);return s(e).find("option").each(function(){this.selected=s.inArray(s(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var o,u,a,f=e.nodeType;if(!e||f===3||f===8||f===2){return}if(i&&n in s.attrFn){return s(e)[n](r)}if(typeof e.getAttribute=="undefined"){return s.prop(e,n,r)}a=f!==1||!s.isXMLDoc(e),a&&(n=n.toLowerCase(),u=s.attrHooks[n]||(w.test(n)?x:S));if(r!==t){if(r===null){s.removeAttr(e,n);return}return u&&"set" in u&&a&&(o=u.set(e,r,n))!==t?o:(e.setAttribute(n,""+r),r)}return u&&"get" in u&&a&&(o=u.get(e,n))!==null?o:(o=e.getAttribute(n),o===null?t:o)},removeAttr:function(e,t){var n,r,i,o,u=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(v),o=r.length;for(;u<o;u++){i=r[u],i&&(n=s.propFix[i]||i,s.attr(e,i,""),e.removeAttribute(E?i:n),w.test(i)&&n in e&&(e[n]=!1))}}},attrHooks:{type:{set:function(e,t){if(g.test(e.nodeName)&&e.parentNode){s.error("type property can't be changed")}else{if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},value:{get:function(e,t){return S&&s.nodeName(e,"button")?S.get(e,t):t in e?e.value:null},set:function(e,t,n){if(S&&s.nodeName(e,"button")){return S.set(e,t,n)}e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2){return}return u=a!==1||!s.isXMLDoc(e),u&&(n=s.propFix[n]||n,o=s.propHooks[n]),r!==t?o&&"set" in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get" in o&&(i=o.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):y.test(e.nodeName)||b.test(e.nodeName)&&e.href?0:t}}}}),s.attrHooks.tabindex=s.propHooks.tabIndex,x={get:function(e,n){var r,i=s.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?s.removeAttr(e,n):(r=s.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},E||(T={name:!0,id:!0},S=s.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(T[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,r){var i=e.getAttributeNode(r);return i||(i=n.createAttribute(r),e.setAttributeNode(i)),i.nodeValue=t+""}},s.attrHooks.tabindex.set=S.set,s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,n){if(n===""){return e.setAttribute(t,"auto"),n}}})}),s.attrHooks.contenteditable={get:S.get,set:function(e,t,n){t===""&&(t="false"),S.set(e,t,n)}}),s.support.hrefNormalized||s.each(["href","src","width","height"],function(e,n){s.attrHooks[n]=s.extend(s.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),s.support.style||(s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),s.support.optSelected||(s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),s.support.enctype||(s.propFix.enctype="encoding"),s.support.checkOn||s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t)){return e.checked=s.inArray(s(e).val(),t)>=0}}})});var N=/^(?:textarea|input|select)$/i,C=/^([^\.]*)?(?:\.(.+))?$/,k=/\bhover(\.\S+)?\b/,L=/^key/,A=/^(?:mouse|contextmenu)|click/,O=/^(?:focusinfocus|focusoutblur)$/,M=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,_=function(e){var t=M.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},D=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},P=function(e){return s.event.special.hover?e:e.replace(k,"mouseenter$1 mouseleave$1")};s.event={add:function(e,n,r,i,o){var u,a,f,l,c,h,p,d,v,m,g,y;if(e.nodeType===3||e.nodeType===8||!n||!r||!(u=s._data(e))){return}r.handler&&(v=r,r=v.handler),r.guid||(r.guid=s.guid++),f=u.events,f||(u.events=f={}),a=u.handle,a||(u.handle=a=function(e){return typeof s=="undefined"||!!e&&s.event.triggered===e.type?t:s.event.dispatch.apply(a.elem,arguments)},a.elem=e),n=s.trim(P(n)).split(" ");for(l=0;l<n.length;l++){c=C.exec(n[l])||[],h=c[1],p=(c[2]||"").split(".").sort(),y=s.event.special[h]||{},h=(o?y.delegateType:y.bindType)||h,y=s.event.special[h]||{},d=s.extend({type:h,origType:c[1],data:i,handler:r,guid:r.guid,selector:o,quick:_(o),namespace:p.join(".")},v),g=f[h];if(!g){g=f[h]=[],g.delegateCount=0;if(!y.setup||y.setup.call(e,i,p,a)===!1){e.addEventListener?e.addEventListener(h,a,!1):e.attachEvent&&e.attachEvent("on"+h,a)}}y.add&&(y.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),o?g.splice(g.delegateCount++,0,d):g.push(d),s.event.global[h]=!0}e=null},global:{},remove:function(e,t,n,r,i){var o=s.hasData(e)&&s._data(e),u,a,f,l,c,h,p,d,v,m,g,y;if(!o||!(d=o.events)){return}t=s.trim(P(t||"")).split(" ");for(u=0;u<t.length;u++){a=C.exec(t[u])||[],f=l=a[1],c=a[2];if(!f){for(f in d){s.event.remove(e,f+t[u],n,r,!0)}continue}v=s.event.special[f]||{},f=(r?v.delegateType:v.bindType)||f,g=d[f]||[],h=g.length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<g.length;p++){y=g[p],(i||l===y.origType)&&(!n||n.guid===y.guid)&&(!c||c.test(y.namespace))&&(!r||r===y.selector||r==="**"&&y.selector)&&(g.splice(p--,1),y.selector&&g.delegateCount--,v.remove&&v.remove.call(e,y))}g.length===0&&h!==g.length&&((!v.teardown||v.teardown.call(e,c)===!1)&&s.removeEvent(e,f,o.handle),delete d[f])}s.isEmptyObject(d)&&(m=o.handle,m&&(m.elem=null),s.removeData(e,["events","handle"],!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,o){if(!i||i.nodeType!==3&&i.nodeType!==8){var u=n.type||n,a=[],f,l,c,h,p,d,v,m,g,y;if(O.test(u+s.event.triggered)){return}u.indexOf("!")>=0&&(u=u.slice(0,-1),l=!0),u.indexOf(".")>=0&&(a=u.split("."),u=a.shift(),a.sort());if((!i||s.event.customEvent[u])&&!s.event.global[u]){return}n=typeof n=="object"?n[s.expando]?n:new s.Event(u,n):new s.Event(u),n.type=u,n.isTrigger=!0,n.exclusive=l,n.namespace=a.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+a.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=u.indexOf(":")<0?"on"+u:"";if(!i){f=s.cache;for(c in f){f[c].events&&f[c].events[u]&&s.event.trigger(n,r,f[c].handle.elem,!0)}return}n.result=t,n.target||(n.target=i),r=r!=null?s.makeArray(r):[],r.unshift(n),v=s.event.special[u]||{};if(v.trigger&&v.trigger.apply(i,r)===!1){return}g=[[i,v.bindType||u]];if(!o&&!v.noBubble&&!s.isWindow(i)){y=v.delegateType||u,h=O.test(y+u)?i:i.parentNode,p=null;for(;h;h=h.parentNode){g.push([h,y]),p=h}p&&p===i.ownerDocument&&g.push([p.defaultView||p.parentWindow||e,y])}for(c=0;c<g.length&&!n.isPropagationStopped();c++){h=g[c][0],n.type=g[c][1],m=(s._data(h,"events")||{})[n.type]&&s._data(h,"handle"),m&&m.apply(h,r),m=d&&h[d],m&&s.acceptData(h)&&m.apply(h,r)===!1&&n.preventDefault()}return n.type=u,!o&&!n.isDefaultPrevented()&&(!v._default||v._default.apply(i.ownerDocument,r)===!1)&&(u!=="click"||!s.nodeName(i,"a"))&&s.acceptData(i)&&d&&i[u]&&(u!=="focus"&&u!=="blur"||n.target.offsetWidth!==0)&&!s.isWindow(i)&&(p=i[d],p&&(i[d]=null),s.event.triggered=u,i[u](),s.event.triggered=t,p&&(i[d]=p)),n.result}return},dispatch:function(n){n=s.event.fix(n||e.event);var r=(s._data(this,"events")||{})[n.type]||[],i=r.delegateCount,o=[].slice.call(arguments,0),u=!n.exclusive&&!n.namespace,a=[],f,l,c,h,p,d,v,m,g,y,b;o[0]=n,n.delegateTarget=this;if(i&&!n.target.disabled&&(!n.button||n.type!=="click")){h=s(this),h.context=this.ownerDocument||this;for(c=n.target;c!=this;c=c.parentNode||this){d={},m=[],h[0]=c;for(f=0;f<i;f++){g=r[f],y=g.selector,d[y]===t&&(d[y]=g.quick?D(c,g.quick):h.is(y)),d[y]&&m.push(g)}m.length&&a.push({elem:c,matches:m})}}r.length>i&&a.push({elem:this,matches:r.slice(i)});for(f=0;f<a.length&&!n.isPropagationStopped();f++){v=a[f],n.currentTarget=v.elem;for(l=0;l<v.matches.length&&!n.isImmediatePropagationStopped();l++){g=v.matches[l];if(u||!n.namespace&&!g.namespace||n.namespace_re&&n.namespace_re.test(g.namespace)){n.data=g.data,n.handleObj=g,p=((s.event.special[g.origType]||{}).handle||g.handler).apply(v.elem,o),p!==t&&(n.result=p,p===!1&&(n.preventDefault(),n.stopPropagation()))}}}return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var i,s,o,u=r.button,a=r.fromElement;return e.pageX==null&&r.clientX!=null&&(i=e.target.ownerDocument||n,s=i.documentElement,o=i.body,e.pageX=r.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=r.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?r.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[s.expando]){return e}var r,i,o=e,u=s.event.fixHooks[e.type]||{},a=u.props?this.props.concat(u.props):this.props;e=s.Event(o);for(r=a.length;r;){i=a[--r],e[i]=o[i]}return e.target||(e.target=o.srcElement||n),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),u.filter?u.filter(e,o):e},special:{ready:{setup:s.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){s.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=s.extend(new s.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?s.event.trigger(i,null,t):s.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},s.event.handle=s.event.dispatch,s.removeEvent=n.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},s.Event=function(e,t){if(!(this instanceof s.Event)){return new s.Event(e,t)}e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?B:H):this.type=e,t&&s.extend(this,t),this.timeStamp=e&&e.timeStamp||s.now(),this[s.expando]=!0},s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=this.originalEvent;if(!e){return}e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e){return}e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B,this.stopPropagation()},isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H},s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){s.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,o=i.selector,u;if(!r||r!==n&&!s.contains(n,r)){e.type=i.origType,u=i.handler.apply(this,arguments),e.type=t}return u}}}),s.support.submitBubbles||(s.event.special.submit={setup:function(){if(s.nodeName(this,"form")){return !1}s.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=s.nodeName(n,"input")||s.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(s.event.add(r,"submit._submit",function(e){this.parentNode&&!e.isTrigger&&s.event.simulate("submit",this.parentNode,e,!0)}),r._submit_attached=!0)})},teardown:function(){if(s.nodeName(this,"form")){return !1}s.event.remove(this,"._submit")}}),s.support.changeBubbles||(s.event.special.change={setup:function(){if(N.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){s.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),s.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,s.event.simulate("change",this,e,!0))})}return !1}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;N.test(t.nodeName)&&!t._change_attached&&(s.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&s.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox"){return e.handleObj.handler.apply(this,arguments)}},teardown:function(){return s.event.remove(this,"._change"),N.test(this.nodeName)}}),s.support.focusinBubbles||s.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,i=function(e){s.event.simulate(t,e.target,s.event.fix(e),!0)};s.event.special[t]={setup:function(){r++===0&&n.addEventListener(e,i,!0)},teardown:function(){--r===0&&n.removeEventListener(e,i,!0)}}}),s.fn.extend({on:function(e,n,r,i,o){var u,a;if(typeof e=="object"){typeof n!="string"&&(r=n,n=t);for(a in e){this.on(a,n,r,e[a],o)}return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1){i=H}else{if(!i){return this}}return o===1&&(u=i,i=function(e){return s().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=s.guid++)),this.each(function(){s.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on.call(this,e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return s(e.delegateTarget).off(i.namespace?i.type+"."+i.namespace:i.type,i.selector,i.handler),this}if(typeof e=="object"){for(var o in e){this.off(o,n,e[o])}return this}if(n===!1||typeof n=="function"){r=n,n=t}return r===!1&&(r=H),this.each(function(){s.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return s(this.context).on(e,this.selector,t,n),this},die:function(e,t){return s(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){return s.event.trigger(e,t,this[0],!0)}},toggle:function(e){var t=arguments,n=e.guid||s.guid++,r=0,i=function(n){var i=(s._data(this,"lastToggle"+e.guid)||0)%r;return s._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length){t[r++].guid=n}return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),s.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){s.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},s.attrFn&&(s.attrFn[t]=!0),L.test(t)&&(s.event.fixHooks[t]=s.event.keyHooks),A.test(t)&&(s.event.fixHooks[t]=s.event.mouseHooks)}),function(){function S(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}f.nodeType===1&&!o&&(f[r]=n,f.sizset=u);if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}i[u]=l}}}function x(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1){o||(f[r]=n,f.sizset=u);if(typeof t!="string"){if(f===t){l=!0;break}}else{if(h.filter(t,[f]).length>0){l=f;break}}}f=f[e]}i[u]=l}}}var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,u=!1,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){return a=!1,0});var h=function(t,r,i,s){i=i||[],r=r||n;var u=r;if(r.nodeType!==1&&r.nodeType!==9){return[]}if(!t||typeof t!="string"){return i}var a,f,l,c,p,m,g,b,w=!0,E=h.isXML(r),S=[],x=t;do{e.exec(""),a=e.exec(x);if(a){x=a[3],S.push(a[1]);if(a[2]){c=a[3];break}}}while(a);if(S.length>1&&v.exec(t)){if(S.length===2&&d.relative[S[0]]){f=T(S[0]+S[1],r,s)}else{f=d.relative[S[0]]?[r]:h(S.shift(),r);while(S.length){t=S.shift(),d.relative[t]&&(t+=S.shift()),f=T(t,f,s)}}}else{!s&&S.length>1&&r.nodeType===9&&!E&&d.match.ID.test(S[0])&&!d.match.ID.test(S[S.length-1])&&(p=h.find(S.shift(),r,E),r=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]);if(r){p=s?{expr:S.pop(),set:y(s)}:h.find(S.pop(),S.length!==1||S[0]!=="~"&&S[0]!=="+"||!r.parentNode?r:r.parentNode,E),f=p.expr?h.filter(p.expr,p.set):p.set,S.length>0?l=y(f):w=!1;while(S.length){m=S.pop(),g=m,d.relative[m]?g=S.pop():m="",g==null&&(g=r),d.relative[m](l,g,E)}}else{l=S=[]}}l||(l=f),l||h.error(m||t);if(o.call(l)==="[object Array]"){if(!w){i.push.apply(i,l)}else{if(r&&r.nodeType===1){for(b=0;l[b]!=null;b++){l[b]&&(l[b]===!0||l[b].nodeType===1&&h.contains(r,l[b]))&&i.push(f[b])}}else{for(b=0;l[b]!=null;b++){l[b]&&l[b].nodeType===1&&i.push(f[b])}}}}else{y(l,i)}return c&&(h(c,u,i,s),h.uniqueSort(i)),i};h.uniqueSort=function(e){if(w){u=a,e.sort(w);if(u){for(var t=1;t<e.length;t++){e[t]===e[t-1]&&e.splice(t--,1)}}}return e},h.matches=function(e,t){return h(e,null,null,t)},h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0},h.find=function(e,t,n){var r,i,s,o,u,a;if(!e){return[]}for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1],o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,""),r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}return r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]),{set:r,expr:e}},h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter){if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u],c=s[1],o=!1,s.splice(1,1);if(c.substr(c.length-1)==="\\"){continue}y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s){o=a=!0}else{if(s===!0){continue}}}if(s){for(p=0;(f=y[p])!=null;p++){f&&(a=l(f,s,p,y),v=i^a,r&&a!=null?v?o=!0:y[p]=!1:v&&(g.push(f),o=!0))}}if(a!==t){r||(y=g),e=e.replace(d.match[u],"");if(!o){return[]}break}}}if(e===m){if(o!=null){break}h.error(e)}m=e}return y},h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9){if(typeof e.textContent=="string"){return e.textContent}if(typeof e.innerText=="string"){return e.innerText.replace(l,"")}for(e=e.firstChild;e;e=e.nextSibling){i+=p(e)}}else{if(r===3||r===4){return e.nodeValue}}}else{for(t=0;n=e[t];t++){n.nodeType!==8&&(i+=p(n))}}return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++){if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1){}e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++){n=e[i],n&&(e[i]=r?n.parentNode:n.parentNode===t)}r&&h.filter(t,e,!0)}},"":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("parentNode",t,s,e,r,n)},"~":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("previousSibling",t,s,e,r,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++){r[i].getAttribute("name")===e[1]&&n.push(r[i])}return n.length===0?null:n}},TAG:function(e,t){if(typeof t.getElementsByTagName!="undefined"){return t.getElementsByTagName(e[1])}}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s){return e}for(var o=0,u;(u=t[o])!=null;o++){u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1))}return !1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else{e[2]&&h.error(e[0])}return e[0]=i++,e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");return !s&&d.attrMap[o]&&(e[1]=d.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(f,""),e[2]==="~="&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(t,n,r,i,s){if(t[1]==="not"){if(!((e.exec(t[3])||"").length>1||/^\w/.test(t[3]))){var o=h.filter(t[3],n,r,!0^s);return r||i.push.apply(i,o),!1}t[3]=h(t[3],null,null,n)}else{if(d.match.POS.test(t[0])||d.match.CHILD.test(t[0])){return !0}}return t},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(e,t,n){return !!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s){return s(e,n,t,r)}if(i==="contains"){return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0}if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++){if(o[u]===e){return !1}}return !0}h.error(i)},CHILD:function(e,t){var n,i,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling){if(c.nodeType===1){return !1}}if(l==="first"){return !0}c=e;case"last":while(c=c.nextSibling){if(c.nodeType===1){return !1}}return !0;case"nth":n=t[2],i=t[3];if(n===1&&i===0){return !0}s=t[0],o=e.parentNode;if(o&&(o[r]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling){c.nodeType===1&&(c.nodeIndex=++a)}o[r]=s}return f=e.nodeIndex-i,n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s){return s(e,n,t,r)}}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match){d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m))}var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(n.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]"){Array.prototype.push.apply(r,e)}else{if(typeof e.length=="number"){for(var i=e.length;n<i;n++){r.push(e[n])}}else{for(;e[n];n++){r.push(e[n])}}}return r}}var w,E;n.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(u=!0,0):!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1}:(w=function(e,t){if(e===t){return u=!0,0}if(e.sourceIndex&&t.sourceIndex){return e.sourceIndex-t.sourceIndex}var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a){return E(e,t)}if(!o){return -1}if(!a){return 1}while(f){i.unshift(f),f=f.parentNode}f=a;while(f){s.unshift(f),f=f.parentNode}n=i.length,r=s.length;for(var l=0;l<n&&l<r;l++){if(i[l]!==s[l]){return E(i[l],s[l])}}return l===n?E(e,s[l],-1):E(i[l],t,1)},E=function(e,t,n){if(e===t){return n}var r=e.nextSibling;while(r){if(r===t){return -1}r=r.nextSibling}return 1}),function(){var e=n.createElement("div"),r="script"+(new Date).getTime(),i=n.documentElement;e.innerHTML="<a name='"+r+"'/>",i.insertBefore(e,i.firstChild),n.getElementById(r)&&(d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}),i.removeChild(e),i=e=null}(),function(){var e=n.createElement("div");e.appendChild(n.createComment("")),e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++){n[i].nodeType===1&&r.push(n[i])}n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),n.querySelectorAll&&function(){var e=h,t=n.createElement("div"),r="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}h=function(t,i,s,o){i=i||n;if(!o&&!h.isXML(i)){var u=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(u&&(i.nodeType===1||i.nodeType===9)){if(u[1]){return y(i.getElementsByTagName(t),s)}if(u[2]&&d.find.CLASS&&i.getElementsByClassName){return y(i.getElementsByClassName(u[2]),s)}}if(i.nodeType===9){if(t==="body"&&i.body){return y([i.body],s)}if(u&&u[3]){var a=i.getElementById(u[3]);if(!a||!a.parentNode){return y([],s)}if(a.id===u[3]){return y([a],s)}}try{return y(i.querySelectorAll(t),s)}catch(f){}}else{if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var l=i,c=i.getAttribute("id"),p=c||r,v=i.parentNode,m=/^\s*[+~]/.test(t);c?p=p.replace(/'/g,"\\$&"):i.setAttribute("id",p),m&&v&&(i=i.parentNode);try{if(!m||v){return y(i.querySelectorAll("[id='"+p+"'] "+t),s)}}catch(g){}finally{c||l.removeAttribute("id")}}}}return e(t,i,s,o)};for(var i in e){h[i]=e[i]}t=null}(),function(){var e=n.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(n.createElement("div"),"div"),i=!1;try{t.call(n.documentElement,"[test!='']:sizzle")}catch(s){i=!0}h.matchesSelector=function(e,n){n=n.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e)){try{if(i||!d.match.PSEUDO.test(n)&&!/!=/.test(n)){var s=t.call(e,n);if(s||!r||e.document&&e.document.nodeType!==11){return s}}}catch(o){}}return h(n,null,null,[e]).length>0}}}(),function(){var e=n.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n){return t.getElementsByClassName(e[1])}},e=null}(),n.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:n.documentElement.compareDocumentPosition?h.contains=function(e,t){return !!(e.compareDocumentPosition(t)&16)}:h.contains=function(){return !1},h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var T=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e)){s+=r[0],e=e.replace(d.match.PSEUDO,"")}e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++){h(e,o[u],i,n)}return h.filter(s,i)};h.attr=s.attr,h.selectors.attrMap={},s.find=h,s.expr=h.selectors,s.expr[":"]=s.expr.filters,s.unique=h.uniqueSort,s.text=h.getText,s.isXMLDoc=h.isXML,s.contains=h.contains}();var j=/Until$/,F=/^(?:parents|prevUntil|prevAll)/,I=/,/,q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,U=s.expr.match.POS,z={children:!0,contents:!0,next:!0,prev:!0};s.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string"){return s(e).filter(function(){for(n=0,r=t.length;n<r;n++){if(s.contains(t[n],this)){return !0}}})}var i=this.pushStack("","find",e),o,u,a;for(n=0,r=this.length;n<r;n++){o=i.length,s.find(e,this[n],i);if(n>0){for(u=o;u<i.length;u++){for(a=0;a<o;a++){if(i[a]===i[u]){i.splice(u--,1);break}}}}}return i},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++){if(s.contains(this,t[e])){return !0}}})},not:function(e){return this.pushStack(X(this,e,!1),"not",e)},filter:function(e){return this.pushStack(X(this,e,!0),"filter",e)},is:function(e){return !!e&&(typeof e=="string"?U.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,o=this[0];if(s.isArray(e)){var u=1;while(o&&o.ownerDocument&&o!==t){for(r=0;r<e.length;r++){s(o).is(e[r])&&n.push({selector:e[r],elem:o,level:u})}o=o.parentNode,u++}return n}var a=U.test(e)||typeof e!="string"?s(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){o=this[r];while(o){if(a?a.index(o)>-1:s.find.matchesSelector(o,e)){n.push(o);break}o=o.parentNode;if(!o||!o.ownerDocument||o===t||o.nodeType===11){break}}}return n=n.length>1?s.unique(n):n,this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?s.inArray(this[0],s(e)):s.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),r=s.merge(this.get(),n);return this.pushStack(W(n[0])||W(r[0])?r:s.unique(r))},andSelf:function(){return this.add(this.prevObject)}}),s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,n){return s.dir(e,"parentNode",n)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,n){return s.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return s.dir(e,"previousSibling",n)},siblings:function(e){return s.sibling(e.parentNode.firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(n,r){var i=s.map(this,t,n);return j.test(e)||(r=n),r&&typeof r=="string"&&(i=s.filter(r,i)),i=this.length>1&&!z[e]?s.unique(i):i,(this.length>1||I.test(r))&&F.test(e)&&(i=i.reverse()),this.pushStack(i,e,R.call(arguments).join(","))}}),s.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&o.nodeType!==9&&(r===t||o.nodeType!==1||!s(o).is(r))){o.nodeType===1&&i.push(o),o=o[n]}return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n]){if(e.nodeType===1&&++i===t){break}}return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){e.nodeType===1&&e!==t&&n.push(e)}return n}});var $="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",J=/ jQuery\d+="(?:\d+|null)"/g,K=/^\s+/,Q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,Y=/<tbody/i,Z=/<|&#?\w+;/,et=/<(?:script|style)/i,tt=/<(?:script|object|embed|option|style)/i,nt=new RegExp("<(?:"+$+")","i"),rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/\/(java|ecma)script/i,st=/^\s*<!(?:\[CDATA\[|\-\-)/,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ut=V(n);ot.optgroup=ot.option,ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td,s.support.htmlSerialize||(ot._default=[1,"div<div>","</div>"]),s.fn.extend({text:function(e){return s.isFunction(e)?this.each(function(t){var n=s(this);n.text(e.call(this,t,n.text()))}):typeof e!="object"&&e!==t?this.empty().append((this[0]&&this[0].ownerDocument||n).createTextNode(e)):s.text(this)},wrapAll:function(e){if(s.isFunction(e)){return this.each(function(t){s(this).wrapAll(e.call(this,t))})}if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){return s.isFunction(e)?this.each(function(t){s(this).wrapInner(e.call(this,t))}):this.each(function(){var t=s(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=s.isFunction(e);return this.each(function(n){s(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){s.nodeName(this,"body")||s(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)})}if(arguments.length){var e=s.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)})}if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,s.clean(arguments)),e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++){if(!e||s.filter(e,[r]).length){!t&&r.nodeType===1&&(s.cleanData(r.getElementsByTagName("*")),s.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r)}}return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&s.cleanData(t.getElementsByTagName("*"));while(t.firstChild){t.removeChild(t.firstChild)}}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return s.clone(this,e,t)})},html:function(e){if(e===t){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(J,""):null}if(typeof e=="string"&&!et.test(e)&&(s.support.leadingWhitespace||!K.test(e))&&!ot[(G.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Q,"<$1></$2>");try{for(var n=0,r=this.length;n<r;n++){this[n].nodeType===1&&(s.cleanData(this[n].getElementsByTagName("*")),this[n].innerHTML=e)}}catch(i){this.empty().append(e)}}else{s.isFunction(e)?this.each(function(t){var n=s(this);n.html(e.call(this,t,n.html()))}):this.empty().append(e)}return this},replaceWith:function(e){return this[0]&&this[0].parentNode?s.isFunction(e)?this.each(function(t){var n=s(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=s(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;s(this).remove(),t?s(t).before(e):s(n).append(e)})):this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,o,u,a,f=e[0],l=[];if(!s.support.checkClone&&arguments.length===3&&typeof f=="string"&&rt.test(f)){return this.each(function(){s(this).domManip(e,n,r,!0)})}if(s.isFunction(f)){return this.each(function(i){var o=s(this);e[0]=f.call(this,i,n?o.html():t),o.domManip(e,n,r)})}if(this[0]){a=f&&f.parentNode,s.support.parentNode&&a&&a.nodeType===11&&a.childNodes.length===this.length?i={fragment:a}:i=s.buildFragment(e,this,l),u=i.fragment,u.childNodes.length===1?o=u=u.firstChild:o=u.firstChild;if(o){n=n&&s.nodeName(o,"tr");for(var c=0,h=this.length,p=h-1;c<h;c++){r.call(n?at(this[c],o):this[c],i.cacheable||h>1&&c<p?s.clone(u,!0,!0):u)}}l.length&&s.each(l,vt)}return this}}),s.buildFragment=function(e,t,r){var i,o,u,a,f=e[0];return t&&t[0]&&(a=t[0].ownerDocument||t[0]),a.createDocumentFragment||(a=n),e.length===1&&typeof f=="string"&&f.length<512&&a===n&&f.charAt(0)==="<"&&!tt.test(f)&&(s.support.checkClone||!rt.test(f))&&(s.support.html5Clone||!nt.test(f))&&(o=!0,u=s.fragments[f],u&&u!==1&&(i=u)),i||(i=a.createDocumentFragment(),s.clean(e,a,i,r)),o&&(s.fragments[f]=u?i:1),{fragment:i,cacheable:o}},s.fragments={},s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(n){var r=[],i=s(n),o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&i.length===1){return i[t](this[0]),this}for(var u=0,a=i.length;u<a;u++){var f=(u>0?this.clone(!0):this).get();s(i[u])[t](f),r=r.concat(f)}return this.pushStack(r,e,i.selector)}}),s.extend({clone:function(e,t,n){var r,i,o,u=s.support.html5Clone||!nt.test("<"+e.nodeName)?e.cloneNode(!0):dt(e);if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){lt(e,u),r=ct(e),i=ct(u);for(o=0;r[o];++o){i[o]&&lt(r[o],i[o])}}if(t){ft(e,u);if(n){r=ct(e),i=ct(u);for(o=0;r[o];++o){ft(r[o],i[o])}}}return r=i=null,u},clean:function(e,t,r,i){var o;t=t||n,typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||n);var u=[],a;for(var f=0,l;(l=e[f])!=null;f++){typeof l=="number"&&(l+="");if(!l){continue}if(typeof l=="string"){if(!Z.test(l)){l=t.createTextNode(l)}else{l=l.replace(Q,"<$1></$2>");var c=(G.exec(l)||["",""])[1].toLowerCase(),h=ot[c]||ot._default,p=h[0],d=t.createElement("div");t===n?ut.appendChild(d):V(t).appendChild(d),d.innerHTML=h[1]+l+h[2];while(p--){d=d.lastChild}if(!s.support.tbody){var v=Y.test(l),m=c==="table"&&!v?d.firstChild&&d.firstChild.childNodes:h[1]==="<table>"&&!v?d.childNodes:[];for(a=m.length-1;a>=0;--a){s.nodeName(m[a],"tbody")&&!m[a].childNodes.length&&m[a].parentNode.removeChild(m[a])}}!s.support.leadingWhitespace&&K.test(l)&&d.insertBefore(t.createTextNode(K.exec(l)[0]),d.firstChild),l=d.childNodes}}var g;if(!s.support.appendChecked){if(l[0]&&typeof(g=l.length)=="number"){for(a=0;a<g;a++){pt(l[a])}}else{pt(l)}}l.nodeType?u.push(l):u=s.merge(u,l)}if(r){o=function(e){return !e.type||it.test(e.type)};for(f=0;u[f];f++){if(i&&s.nodeName(u[f],"script")&&(!u[f].type||u[f].type.toLowerCase()==="text/javascript")){i.push(u[f].parentNode?u[f].parentNode.removeChild(u[f]):u[f])}else{if(u[f].nodeType===1){var y=s.grep(u[f].getElementsByTagName("script"),o);u.splice.apply(u,[f+1,0].concat(y))}r.appendChild(u[f])}}}return u},cleanData:function(e){var t,n,r=s.cache,i=s.event.special,o=s.support.deleteExpando;for(var u=0,a;(a=e[u])!=null;u++){if(a.nodeName&&s.noData[a.nodeName.toLowerCase()]){continue}n=a[s.expando];if(n){t=r[n];if(t&&t.events){for(var f in t.events){i[f]?s.event.remove(a,f):s.removeEvent(a,f,t.handle)}t.handle&&(t.handle.elem=null)}o?delete a[s.expando]:a.removeAttribute&&a.removeAttribute(s.expando),delete r[n]}}}});var mt=/alpha\([^)]*\)/i,gt=/opacity=([^)]*)/,yt=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,wt=/^-?\d/,Et=/^([\-+])=([\-+.\de]+)/,St={position:"absolute",visibility:"hidden",display:"block"},xt=["Left","Right"],Tt=["Top","Bottom"],Nt,Ct,kt;s.fn.css=function(e,n){return arguments.length===2&&n===t?this:s.access(this,e,n,!0,function(e,n,r){return r!==t?s.style(e,n,r):s.css(e,n)})},s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Nt(e,"opacity","opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var o,u,a=s.camelCase(n),f=e.style,l=s.cssHooks[a];n=s.cssProps[a]||a;if(r===t){return l&&"get" in l&&(o=l.get(e,!1,i))!==t?o:f[n]}u=typeof r,u==="string"&&(o=Et.exec(r))&&(r=+(o[1]+1)*+o[2]+parseFloat(s.css(e,n)),u="number");if(r==null||u==="number"&&isNaN(r)){return}u==="number"&&!s.cssNumber[a]&&(r+="px");if(!l||!("set" in l)||(r=l.set(e,r))!==t){try{f[n]=r}catch(c){}}},css:function(e,n,r){var i,o;n=s.camelCase(n),o=s.cssHooks[n],n=s.cssProps[n]||n,n==="cssFloat"&&(n="float");if(o&&"get" in o&&(i=o.get(e,!0,r))!==t){return i}if(Nt){return Nt(e,n)}},swap:function(e,t,n){var r={};for(var i in t){r[i]=e.style[i],e.style[i]=t[i]}n.call(e);for(i in t){e.style[i]=r[i]}}}),s.curCSS=s.css,s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,n,r){var i;if(n){return e.offsetWidth!==0?Lt(e,t,r):(s.swap(e,St,function(){i=Lt(e,t,r)}),i)}},set:function(e,t){if(!bt.test(t)){return t}t=parseFloat(t);if(t>=0){return t+"px"}}}}),s.support.opacity||(s.cssHooks.opacity={get:function(e,t){return gt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",o=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&s.trim(o.replace(mt,""))===""){n.removeAttribute("filter");if(r&&!r.filter){return}}n.filter=mt.test(o)?o.replace(mt,i):o+" "+i}}),s(function(){s.support.reliableMarginRight||(s.cssHooks.marginRight={get:function(e,t){var n;return s.swap(e,{display:"inline-block"},function(){t?n=Nt(e,"margin-right","marginRight"):n=e.style.marginRight}),n}})}),n.defaultView&&n.defaultView.getComputedStyle&&(Ct=function(e,t){var n,r,i;return t=t.replace(yt,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&(n=i.getPropertyValue(t),n===""&&!s.contains(e.ownerDocument.documentElement,e)&&(n=s.style(e,t))),n}),n.documentElement.currentStyle&&(kt=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;return s===null&&o&&(i=o[t])&&(s=i),!bt.test(s)&&wt.test(s)&&(n=o.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),o.left=t==="fontSize"?"1em":s||0,s=o.pixelLeft+"px",o.left=n,r&&(e.runtimeStyle.left=r)),s===""?"auto":s}),Nt=Ct||kt,s.expr&&s.expr.filters&&(s.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"},s.expr.filters.visible=function(e){return !s.expr.filters.hidden(e)});var At=/%20/g,Ot=/\[\]$/,Mt=/\r?\n/g,_t=/#.*$/,Dt=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Pt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ht=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Bt=/^(?:GET|HEAD)$/,jt=/^\/\//,Ft=/\?/,It=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,qt=/^(?:select|textarea)/i,Rt=/\s+/,Ut=/([?&])_=[^&]*/,zt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Wt=s.fn.load,Xt={},Vt={},$t,Jt,Kt=["*/"]+["*"];try{$t=i.href}catch(Qt){$t=n.createElement("a"),$t.href="",$t=$t.href}Jt=zt.exec($t.toLowerCase())||[],s.fn.extend({load:function(e,n,r){if(typeof e!="string"&&Wt){return Wt.apply(this,arguments)}if(!this.length){return this}var i=e.indexOf(" ");if(i>=0){var o=e.slice(i,e.length);e=e.slice(0,i)}var u="GET";n&&(s.isFunction(n)?(r=n,n=t):typeof n=="object"&&(n=s.param(n,s.ajaxSettings.traditional),u="POST"));var a=this;return s.ajax({url:e,type:u,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),a.html(o?s("<div>").append(n.replace(It,"")).find(o):n)),r&&a.each(r,[n,t,e])}}),this},serialize:function(){return s.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?s.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||qt.test(this.nodeName)||Pt.test(this.type))}).map(function(e,t){var n=s(this).val();return n==null?null:s.isArray(n)?s.map(n,function(e,n){return{name:t.name,value:e.replace(Mt,"\r\n")}}):{name:t.name,value:n.replace(Mt,"\r\n")}}).get()}}),s.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){s.fn[t]=function(e){return this.on(t,e)}}),s.each(["get","post"],function(e,n){s[n]=function(e,r,i,o){return s.isFunction(r)&&(o=o||i,i=r,r=t),s.ajax({type:n,url:e,data:r,success:i,dataType:o})}}),s.extend({getScript:function(e,n){return s.get(e,t,n,"script")},getJSON:function(e,t,n){return s.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Zt(e,s.ajaxSettings):(t=e,e=s.ajaxSettings),Zt(e,t),e},ajaxSettings:{url:$t,isLocal:Ht.test(Jt[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Kt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":s.parseJSON,"text xml":s.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Gt(Xt),ajaxTransport:Gt(Vt),ajax:function(e,n){function S(e,n,c,h){if(y===2){return}y=2,m&&clearTimeout(m),v=t,p=h||"",E.readyState=e>0?4:0;var d,g,w,S=n,x=c?tn(r,E,c):t,T,N;if(e>=200&&e<300||e===304){if(r.ifModified){if(T=E.getResponseHeader("Last-Modified")){s.lastModified[l]=T}if(N=E.getResponseHeader("Etag")){s.etag[l]=N}}if(e===304){S="notmodified",d=!0}else{try{g=nn(r,x),S="success",d=!0}catch(C){S="parsererror",w=C}}}else{w=S;if(!S||e){S="error",e<0&&(e=0)}}E.status=e,E.statusText=""+(n||S),d?u.resolveWith(i,[g,S,E]):u.rejectWith(i,[E,S,w]),E.statusCode(f),f=t,b&&o.trigger("ajax"+(d?"Success":"Error"),[E,r,d?g:w]),a.fireWith(i,[E,S]),b&&(o.trigger("ajaxComplete",[E,r]),--s.active||s.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r=s.ajaxSetup({},n),i=r.context||r,o=i!==r&&(i.nodeType||i instanceof s)?s(i):s.event,u=s.Deferred(),a=s.Callbacks("once memory"),f=r.statusCode||{},l,c={},h={},p,d,v,m,g,y=0,b,w,E={readyState:0,setRequestHeader:function(e,t){if(!y){var n=e.toLowerCase();e=h[n]=h[n]||e,c[e]=t}return this},getAllResponseHeaders:function(){return y===2?p:null},getResponseHeader:function(e){var n;if(y===2){if(!d){d={};while(n=Dt.exec(p)){d[n[1].toLowerCase()]=n[2]}}n=d[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return y||(r.mimeType=e),this},abort:function(e){return e=e||"abort",v&&v.abort(e),S(0,e),this}};u.promise(E),E.success=E.done,E.error=E.fail,E.complete=a.add,E.statusCode=function(e){if(e){var t;if(y<2){for(t in e){f[t]=[f[t],e[t]]}}else{t=e[E.status],E.then(t,t)}}return this},r.url=((e||r.url)+"").replace(_t,"").replace(jt,Jt[1]+"//"),r.dataTypes=s.trim(r.dataType||"*").toLowerCase().split(Rt),r.crossDomain==null&&(g=zt.exec(r.url.toLowerCase()),r.crossDomain=!(!g||g[1]==Jt[1]&&g[2]==Jt[2]&&(g[3]||(g[1]==="http:"?80:443))==(Jt[3]||(Jt[1]==="http:"?80:443)))),r.data&&r.processData&&typeof r.data!="string"&&(r.data=s.param(r.data,r.traditional)),Yt(Xt,r,n,E);if(y===2){return !1}b=r.global,r.type=r.type.toUpperCase(),r.hasContent=!Bt.test(r.type),b&&s.active++===0&&s.event.trigger("ajaxStart");if(!r.hasContent){r.data&&(r.url+=(Ft.test(r.url)?"&":"?")+r.data,delete r.data),l=r.url;if(r.cache===!1){var x=s.now(),T=r.url.replace(Ut,"$1_="+x);r.url=T+(T===r.url?(Ft.test(r.url)?"&":"?")+"_="+x:"")}}(r.data&&r.hasContent&&r.contentType!==!1||n.contentType)&&E.setRequestHeader("Content-Type",r.contentType),r.ifModified&&(l=l||r.url,s.lastModified[l]&&E.setRequestHeader("If-Modified-Since",s.lastModified[l]),s.etag[l]&&E.setRequestHeader("If-None-Match",s.etag[l])),E.setRequestHeader("Accept",r.dataTypes[0]&&r.accepts[r.dataTypes[0]]?r.accepts[r.dataTypes[0]]+(r.dataTypes[0]!=="*"?", "+Kt+"; q=0.01":""):r.accepts["*"]);for(w in r.headers){E.setRequestHeader(w,r.headers[w])}if(!r.beforeSend||r.beforeSend.call(i,E,r)!==!1&&y!==2){for(w in {success:1,error:1,complete:1}){E[w](r[w])}v=Yt(Vt,r,n,E);if(!v){S(-1,"No Transport")}else{E.readyState=1,b&&o.trigger("ajaxSend",[E,r]),r.async&&r.timeout>0&&(m=setTimeout(function(){E.abort("timeout")},r.timeout));try{y=1,v.send(c,S)}catch(N){if(!(y<2)){throw N}S(-1,N)}}return E}return E.abort(),!1},param:function(e,n){var r=[],i=function(e,t){t=s.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=s.ajaxSettings.traditional);if(s.isArray(e)||e.jquery&&!s.isPlainObject(e)){s.each(e,function(){i(this.name,this.value)})}else{for(var o in e){en(o,e[o],n,i)}}return r.join("&").replace(At,"+")}}),s.extend({active:0,lastModified:{},etag:{}});var rn=s.now(),sn=/(\=)\?(&|$)|\?\?/i;s.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return s.expando+"_"+rn++}}),s.ajaxPrefilter("json jsonp",function(t,n,r){var i=t.contentType==="application/x-www-form-urlencoded"&&typeof t.data=="string";if(t.dataTypes[0]==="jsonp"||t.jsonp!==!1&&(sn.test(t.url)||i&&sn.test(t.data))){var o,u=t.jsonpCallback=s.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a=e[u],f=t.url,l=t.data,c="$1"+u+"$2";return t.jsonp!==!1&&(f=f.replace(sn,c),t.url===f&&(i&&(l=l.replace(sn,c)),t.data===l&&(f+=(/\?/.test(f)?"&":"?")+t.jsonp+"="+u))),t.url=f,t.data=l,e[u]=function(e){o=[e]},r.always(function(){e[u]=a,o&&s.isFunction(a)&&e[u](o[0])}),t.converters["script json"]=function(){return o||s.error(u+" was not called"),o[0]},t.dataTypes[0]="json","script"}}),s.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return s.globalEval(e),e}}}),s.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),s.ajaxTransport("script",function(e){if(e.crossDomain){var r,i=n.head||n.getElementsByTagName("head")[0]||n.documentElement;return{send:function(s,o){r=n.createElement("script"),r.async="async",e.scriptCharset&&(r.charset=e.scriptCharset),r.src=e.url,r.onload=r.onreadystatechange=function(e,n){if(n||!r.readyState||/loaded|complete/.test(r.readyState)){r.onload=r.onreadystatechange=null,i&&r.parentNode&&i.removeChild(r),r=t,n||o(200,"success")}},i.insertBefore(r,i.firstChild)},abort:function(){r&&r.onload(0,1)}}}});var on=e.ActiveXObject?function(){for(var e in an){an[e](0,1)}}:!1,un=0,an;s.ajaxSettings.xhr=e.ActiveXObject?function(){return !this.isLocal&&fn()||ln()}:fn,function(e){s.extend(s.support,{ajax:!!e,cors:!!e&&"withCredentials" in e})}(s.ajaxSettings.xhr()),s.support.ajax&&s.ajaxTransport(function(n){if(!n.crossDomain||s.support.cors){var r;return{send:function(i,o){var u=n.xhr(),a,f;n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async);if(n.xhrFields){for(f in n.xhrFields){u[f]=n.xhrFields[f]}}n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(f in i){u.setRequestHeader(f,i[f])}}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var f,l,c,h,p;try{if(r&&(i||u.readyState===4)){r=t,a&&(u.onreadystatechange=s.noop,on&&delete an[a]);if(i){u.readyState!==4&&u.abort()}else{f=u.status,c=u.getAllResponseHeaders(),h={},p=u.responseXML,p&&p.documentElement&&(h.xml=p),h.text=u.responseText;try{l=u.statusText}catch(d){l=""}!f&&n.isLocal&&!n.crossDomain?f=h.text?200:404:f===1223&&(f=204)}}}catch(v){i||o(-1,v)}h&&o(f,l,h,c)},!n.async||u.readyState===4?r():(a=++un,on&&(an||(an={},s(e).unload(on)),an[a]=r),u.onreadystatechange=r)},abort:function(){r&&r(0,1)}}}});var cn={},hn,pn,dn=/^(?:toggle|show|hide)$/,vn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,mn,gn=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],yn;s.fn.extend({show:function(e,t,n){var r,i;if(e||e===0){return this.animate(En("show",3),e,t,n)}for(var o=0,u=this.length;o<u;o++){r=this[o],r.style&&(i=r.style.display,!s._data(r,"olddisplay")&&i==="none"&&(i=r.style.display=""),i===""&&s.css(r,"display")==="none"&&s._data(r,"olddisplay",Sn(r.nodeName)))}for(o=0;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(i===""||i==="none"){r.style.display=s._data(r,"olddisplay")||""}}}return this},hide:function(e,t,n){if(e||e===0){return this.animate(En("hide",3),e,t,n)}var r,i,o=0,u=this.length;for(;o<u;o++){r=this[o],r.style&&(i=s.css(r,"display"),i!=="none"&&!s._data(r,"olddisplay")&&s._data(r,"olddisplay",i))}for(o=0;o<u;o++){this[o].style&&(this[o].style.display="none")}return this},_toggle:s.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";return s.isFunction(e)&&s.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()}):this.animate(En("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){function o(){i.queue===!1&&s._mark(this);var t=s.extend({},i),n=this.nodeType===1,r=n&&s(this).is(":hidden"),o,u,a,f,l,c,h,p,d;t.animatedProperties={};for(a in e){o=s.camelCase(a),a!==o&&(e[o]=e[a],delete e[a]),u=e[o],s.isArray(u)?(t.animatedProperties[o]=u[1],u=e[o]=u[0]):t.animatedProperties[o]=t.specialEasing&&t.specialEasing[o]||t.easing||"swing";if(u==="hide"&&r||u==="show"&&!r){return t.complete.call(this)}n&&(o==="height"||o==="width")&&(t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],s.css(this,"display")==="inline"&&s.css(this,"float")==="none"&&(!s.support.inlineBlockNeedsLayout||Sn(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}t.overflow!=null&&(this.style.overflow="hidden");for(a in e){f=new s.fx(this,t,a),u=e[a],dn.test(u)?(d=s._data(this,"toggle"+a)||(u==="toggle"?r?"show":"hide":0),d?(s._data(this,"toggle"+a,d==="show"?"hide":"show"),f[d]()):f[u]()):(l=vn.exec(u),c=f.cur(),l?(h=parseFloat(l[2]),p=l[3]||(s.cssNumber[a]?"":"px"),p!=="px"&&(s.style(this,a,(h||1)+p),c=(h||1)/f.cur()*c,s.style(this,a,c+p)),l[1]&&(h=(l[1]==="-="?-1:1)*h+c),f.custom(c,h,p)):f.custom(c,u,""))}return !0}var i=s.speed(t,n,r);return s.isEmptyObject(e)?this.each(i.complete,[!1]):(e=s.extend({},e),i.queue===!1?this.each(o):this.queue(i.queue,o))},stop:function(e,n,r){return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function u(e,t,n){var i=t[n];s.removeData(e,n,!0),i.stop(r)}var t,n=!1,i=s.timers,o=s._data(this);r||s._unmark(!0,this);if(e==null){for(t in o){o[t]&&o[t].stop&&t.indexOf(".run")===t.length-4&&u(this,o,t)}}else{o[t=e+".run"]&&o[t].stop&&u(this,o,t)}for(t=i.length;t--;){i[t].elem===this&&(e==null||i[t].queue===e)&&(r?i[t](!0):i[t].saveState(),n=!0,i.splice(t,1))}(!r||!n)&&s.dequeue(this,e)})}}),s.each({slideDown:En("show",1),slideUp:En("hide",1),slideToggle:En("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),s.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?s.extend({},e):{complete:n||!n&&t||s.isFunction(e)&&e,duration:e,easing:n&&t||t&&!s.isFunction(t)&&t};r.duration=s.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in s.fx.speeds?s.fx.speeds[r.duration]:s.fx.speeds._default;if(r.queue==null||r.queue===!0){r.queue="fx"}return r.old=r.complete,r.complete=function(e){s.isFunction(r.old)&&r.old.call(this),r.queue?s.dequeue(this,r.queue):e!==!1&&s._unmark(this)},r},easing:{linear:function(e,t,n,r){return n+r*e},swing:function(e,t,n,r){return(-Math.cos(e*Math.PI)/2+0.5)*r+n}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),s.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function u(e){return i.step(e)}var i=this,o=s.fx;this.startTime=yn||bn(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(s.cssNumber[this.prop]?"":"px"),u.queue=this.options.queue,u.elem=this.elem,u.saveState=function(){i.options.hide&&s._data(i.elem,"fxshow"+i.prop)===t&&s._data(i.elem,"fxshow"+i.prop,i.start)},u()&&s.timers.push(u)&&!mn&&(mn=setInterval(o.tick,o.interval))},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),s(this.elem).show()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=yn||bn(),o=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties){a.animatedProperties[t]!==!0&&(o=!1)}if(o){a.overflow!=null&&!s.support.shrinkWrapBlocks&&s.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]}),a.hide&&s(u).hide();if(a.hide||a.show){for(t in a.animatedProperties){s.style(u,t,a.orig[t]),s.removeData(u,"fxshow"+t,!0),s.removeData(u,"toggle"+t,!0)}}r=a.complete,r&&(a.complete=!1,r.call(u))}return !1}return a.duration==Infinity?this.now=i:(n=i-this.startTime,this.state=n/a.duration,this.pos=s.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},s.extend(s.fx,{tick:function(){var e,t=s.timers,n=0;for(;n<t.length;n++){e=t[n],!e()&&t[n]===e&&t.splice(n--,1)}t.length||s.fx.stop()},interval:13,stop:function(){clearInterval(mn),mn=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),s.each(["width","height"],function(e,t){s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now)+e.unit)}}),s.expr&&s.expr.filters&&(s.expr.filters.animated=function(e){return s.grep(s.timers,function(t){return e===t.elem}).length});var xn=/^t(?:able|d|h)$/i,Tn=/^(?:body|html)$/i;"getBoundingClientRect" in n.documentElement?s.fn.offset=function(e){var t=this[0],n;if(e){return this.each(function(t){s.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return s.offset.bodyOffset(t)}try{n=t.getBoundingClientRect()}catch(r){}var i=t.ownerDocument,o=i.documentElement;if(!n||!s.contains(o,t)){return n?{top:n.top,left:n.left}:{top:0,left:0}}var u=i.body,a=Nn(i),f=o.clientTop||u.clientTop||0,l=o.clientLeft||u.clientLeft||0,c=a.pageYOffset||s.support.boxModel&&o.scrollTop||u.scrollTop,h=a.pageXOffset||s.support.boxModel&&o.scrollLeft||u.scrollLeft,p=n.top+c-f,d=n.left+h-l;return{top:p,left:d}}:s.fn.offset=function(e){var t=this[0];if(e){return this.each(function(t){s.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return s.offset.bodyOffset(t)}var n,r=t.offsetParent,i=t,o=t.ownerDocument,u=o.documentElement,a=o.body,f=o.defaultView,l=f?f.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,h=t.offsetLeft;while((t=t.parentNode)&&t!==a&&t!==u){if(s.support.fixedPosition&&l.position==="fixed"){break}n=f?f.getComputedStyle(t,null):t.currentStyle,c-=t.scrollTop,h-=t.scrollLeft,t===r&&(c+=t.offsetTop,h+=t.offsetLeft,s.support.doesNotAddBorder&&(!s.support.doesAddBorderForTableAndCells||!xn.test(t.nodeName))&&(c+=parseFloat(n.borderTopWidth)||0,h+=parseFloat(n.borderLeftWidth)||0),i=r,r=t.offsetParent),s.support.subtractsBorderForOverflowNotVisible&&n.overflow!=="visible"&&(c+=parseFloat(n.borderTopWidth)||0,h+=parseFloat(n.borderLeftWidth)||0),l=n}if(l.position==="relative"||l.position==="static"){c+=a.offsetTop,h+=a.offsetLeft}return s.support.fixedPosition&&l.position==="fixed"&&(c+=Math.max(u.scrollTop,a.scrollTop),h+=Math.max(u.scrollLeft,a.scrollLeft)),{top:c,left:h}},s.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return s.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(s.css(e,"marginTop"))||0,n+=parseFloat(s.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=s.css(e,"position");r==="static"&&(e.style.position="relative");var i=s(e),o=i.offset(),u=s.css(e,"top"),a=s.css(e,"left"),f=(r==="absolute"||r==="fixed")&&s.inArray("auto",[u,a])>-1,l={},c={},h,p;f?(c=i.position(),h=c.top,p=c.left):(h=parseFloat(u)||0,p=parseFloat(a)||0),s.isFunction(t)&&(t=t.call(e,n,o)),t.top!=null&&(l.top=t.top-o.top+h),t.left!=null&&(l.left=t.left-o.left+p),"using" in t?t.using.call(e,l):i.css(l)}},s.fn.extend({position:function(){if(!this[0]){return null}var e=this[0],t=this.offsetParent(),n=this.offset(),r=Tn.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(s.css(e,"marginTop"))||0,n.left-=parseFloat(s.css(e,"marginLeft"))||0,r.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||n.body;while(e&&!Tn.test(e.nodeName)&&s.css(e,"position")==="static"){e=e.offsetParent}return e})}}),s.each(["Left","Top"],function(e,n){var r="scroll"+n;s.fn[r]=function(n){var i,o;return n===t?(i=this[0],i?(o=Nn(i),o?"pageXOffset" in o?o[e?"pageYOffset":"pageXOffset"]:s.support.boxModel&&o.document.documentElement[r]||o.document.body[r]:i[r]):null):this.each(function(){o=Nn(this),o?o.scrollTo(e?s(o).scrollLeft():n,e?n:s(o).scrollTop()):this[r]=n})}}),s.each(["Height","Width"],function(e,n){var r=n.toLowerCase();s.fn["inner"+n]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,r,"padding")):this[r]():null},s.fn["outer"+n]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,r,e?"margin":"border")):this[r]():null},s.fn[r]=function(e){var i=this[0];if(!i){return e==null?null:this}if(s.isFunction(e)){return this.each(function(t){var n=s(this);n[r](e.call(this,t,n[r]()))})}if(s.isWindow(i)){var o=i.document.documentElement["client"+n],u=i.document.body;return i.document.compatMode==="CSS1Compat"&&o||u&&u["client"+n]||o}if(i.nodeType===9){return Math.max(i.documentElement["client"+n],i.body["scroll"+n],i.documentElement["scroll"+n],i.body["offset"+n],i.documentElement["offset"+n])}if(e===t){var a=s.css(i,r),f=parseFloat(a);return s.isNumeric(f)?f:a}return this.css(r,typeof e=="string"?e:e+"px")}}),e.jQuery=e.$=s,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return s})}(window);var Sylvester={version:"0.1.3",precision:0.000001};Vector.prototype={e:function(a){return a<1||a>this.elements.length?null:this.elements[a-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(b){var a=this.elements.length,c=b.elements||b;if(a!=c.length){return !1}do{if(Math.abs(this.elements[a-1]-c[a-1])>Sylvester.precision){return !1}}while(--a);return !0},dup:function(){return Vector.create(this.elements)},map:function(b){var a=[];return this.each(function(d,c){a.push(b(d,c))}),Vector.create(a)},each:function(c){var a=this.elements.length,d=a,b;do{b=d-a,c(this.elements[b],b+1)}while(--a)},toUnitVector:function(){var a=this.modulus();return a===0?this.dup():this.map(function(b){return b/a})},angleFrom:function(g){var l=g.elements||g,d=this.elements.length,b=d,f;if(d!=l.length){return null}var m=0,c=0,k=0;this.each(function(a,o){m+=a*l[o-1],c+=a*a,k+=l[o-1]*l[o-1]}),c=Math.sqrt(c),k=Math.sqrt(k);if(c*k===0){return null}var h=m/(c*k);return h<-1&&(h=-1),h>1&&(h=1),Math.acos(h)},isParallelTo:function(b){var a=this.angleFrom(b);return a===null?null:a<=Sylvester.precision},isAntiparallelTo:function(b){var a=this.angleFrom(b);return a===null?null:Math.abs(a-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(b){var a=this.dot(b);return a===null?null:Math.abs(a)<=Sylvester.precision},add:function(b){var a=b.elements||b;return this.elements.length!=a.length?null:this.map(function(c,d){return c+a[d-1]})},subtract:function(b){var a=b.elements||b;return this.elements.length!=a.length?null:this.map(function(c,d){return c-a[d-1]})},multiply:function(a){return this.map(function(b){return b*a})},x:function(a){return this.multiply(a)},dot:function(d){var b=d.elements||d,f,c=0,a=this.elements.length;if(a!=b.length){return null}do{c+=this.elements[a-1]*b[a-1]}while(--a);return c},cross:function(b){var a=b.elements||b;if(this.elements.length!=3||a.length!=3){return null}var c=this.elements;return Vector.create([c[1]*a[2]-c[2]*a[1],c[2]*a[0]-c[0]*a[2],c[0]*a[1]-c[1]*a[0]])},max:function(){var c=0,a=this.elements.length,d=a,b;do{b=d-a,Math.abs(this.elements[b])>Math.abs(c)&&(c=this.elements[b])}while(--a);return c},indexOf:function(d){var b=null,f=this.elements.length,c=f,a;do{a=c-f,b===null&&this.elements[a]==d&&(b=a+1)}while(--f);return b},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},distanceFrom:function(c){if(c.anchor){return c.distanceFrom(this)}var a=c.elements||c;if(a.length!=this.elements.length){return null}var d=0,b;return this.each(function(g,f){b=g-a[f-1],d+=b*b}),Math.sqrt(d)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(g,c){var k,f,b,d,h;switch(this.elements.length){case 2:k=c.elements||c;if(k.length!=2){return null}f=Matrix.Rotation(g).elements,b=this.elements[0]-k[0],d=this.elements[1]-k[1];return Vector.create([k[0]+f[0][0]*b+f[0][1]*d,k[1]+f[1][0]*b+f[1][1]*d]);break;case 3:if(!c.direction){return null}var a=c.pointClosestTo(this).elements;f=Matrix.Rotation(g,c.direction).elements,b=this.elements[0]-a[0],d=this.elements[1]-a[1],h=this.elements[2]-a[2];return Vector.create([a[0]+f[0][0]*b+f[0][1]*d+f[0][2]*h,a[1]+f[1][0]*b+f[1][1]*d+f[1][2]*h,a[2]+f[2][0]*b+f[2][1]*d+f[2][2]*h]);break;default:return null}},reflectionIn:function(c){if(c.anchor){var a=this.elements.slice(),d=c.pointClosestTo(a).elements;return Vector.create([d[0]+(d[0]-a[0]),d[1]+(d[1]-a[1]),d[2]+(d[2]-(a[2]||0))])}var b=c.elements||c;return this.elements.length!=b.length?null:this.map(function(g,f){return b[f-1]+(b[f-1]-g)})},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){return this.elements=(a.elements||a).slice(),this}},Vector.create=function(b){var a=new Vector;return a.setElements(b)},Vector.i=Vector.create([1,0,0]),Vector.j=Vector.create([0,1,0]),Vector.k=Vector.create([0,0,1]),Vector.Random=function(b){var a=[];do{a.push(Math.random())}while(--b);return Vector.create(a)},Vector.Zero=function(b){var a=[];do{a.push(0)}while(--b);return Vector.create(a)},Matrix.prototype={e:function(b,a){return b<1||b>this.elements.length||a<1||a>this.elements[0].length?null:this.elements[b-1][a-1]},row:function(a){return a>this.elements.length?null:Vector.create(this.elements[a-1])},col:function(d){if(d>this.elements[0].length){return null}var b=[],f=this.elements.length,c=f,a;do{a=c-f,b.push(this.elements[a][d-1])}while(--f);return Vector.create(b)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(g){var c=g.elements||g;typeof c[0][0]=="undefined"&&(c=Matrix.create(c).elements);if(this.elements.length!=c.length||this.elements[0].length!=c[0].length){return !1}var k=this.elements.length,f=k,b,d,h=this.elements[0].length,a;do{b=f-k,d=h;do{a=h-d;if(Math.abs(this.elements[b][a]-c[b][a])>Sylvester.precision){return !1}}while(--d)}while(--k);return !0},dup:function(){return Matrix.create(this.elements)},map:function(g){var c=[],k=this.elements.length,f=k,b,d,h=this.elements[0].length,a;do{b=f-k,d=h,c[b]=[];do{a=h-d,c[b][a]=g(this.elements[b][a],b+1,a+1)}while(--d)}while(--k);return Matrix.create(c)},isSameSizeAs:function(b){var a=b.elements||b;return typeof a[0][0]=="undefined"&&(a=Matrix.create(a).elements),this.elements.length==a.length&&this.elements[0].length==a[0].length},add:function(b){var a=b.elements||b;return typeof a[0][0]=="undefined"&&(a=Matrix.create(a).elements),this.isSameSizeAs(a)?this.map(function(d,f,c){return d+a[f-1][c-1]}):null},subtract:function(b){var a=b.elements||b;return typeof a[0][0]=="undefined"&&(a=Matrix.create(a).elements),this.isSameSizeAs(a)?this.map(function(d,f,c){return d-a[f-1][c-1]}):null},canMultiplyFromLeft:function(b){var a=b.elements||b;return typeof a[0][0]=="undefined"&&(a=Matrix.create(a).elements),this.elements[0].length==a.length},multiply:function(x){if(!x.elements){return this.map(function(a){return a*x})}var B=x.modulus?!0:!1,k=x.elements||x;typeof k[0][0]=="undefined"&&(k=Matrix.create(k).elements);if(!this.canMultiplyFromLeft(k)){return null}var b=this.elements.length,q=b,C,g,A=k[0].length,z,w=this.elements[0].length,m=[],y,v,d;do{C=q-b,m[C]=[],g=A;do{z=A-g,y=0,v=w;do{d=w-v,y+=this.elements[C][d]*k[d][z]}while(--v);m[C][z]=y}while(--g)}while(--b);var k=Matrix.create(m);return B?k.col(1):k},x:function(a){return this.multiply(a)},minor:function(m,v,d,b){var h=[],w=d,c,q,p,k=this.elements.length,g=this.elements[0].length;do{c=d-w,h[c]=[],q=b;do{p=b-q,h[c][p]=this.elements[(m+c-1)%k][(v+p-1)%g]}while(--q)}while(--w);return Matrix.create(h)},transpose:function(){var f=this.elements.length,b=this.elements[0].length,h=[],d=b,a,c,g;do{a=b-d,h[a]=[],c=f;do{g=f-c,h[a][g]=this.elements[g][a]}while(--c)}while(--d);return Matrix.create(h)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var f=0,b=this.elements.length,h=b,d,a,c=this.elements[0].length,g;do{d=h-b,a=c;do{g=c-a,Math.abs(this.elements[d][g])>Math.abs(f)&&(f=this.elements[d][g])}while(--a)}while(--b);return f},indexOf:function(g){var c=null,k=this.elements.length,f=k,b,d,h=this.elements[0].length,a;do{b=f-k,d=h;do{a=h-d;if(this.elements[b][a]==g){return{i:b+1,j:a+1}}}while(--d)}while(--k);return null},diagonal:function(){if(!this.isSquare){return null}var c=[],a=this.elements.length,d=a,b;do{b=d-a,c.push(this.elements[b][b])}while(--a);return Vector.create(c)},toRightTriangular:function(){var g=this.dup(),l,d=this.elements.length,b=d,f,m,c=this.elements[0].length,k;do{f=b-d;if(g.elements[f][f]==0){for(j=f+1;j<b;j++){if(g.elements[j][f]!=0){l=[],m=c;do{k=c-m,l.push(g.elements[f][k]+g.elements[j][k])}while(--m);g.elements[f]=l;break}}}if(g.elements[f][f]!=0){for(j=f+1;j<b;j++){var h=g.elements[j][f]/g.elements[f][f];l=[],m=c;do{k=c-m,l.push(k<=f?0:g.elements[j][k]-g.elements[f][k]*h)}while(--m);g.elements[j]=l}}}while(--d);return g},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare()){return null}var d=this.toRightTriangular(),b=d.elements[0][0],f=d.elements.length-1,c=f,a;do{a=c-f+1,b*=d.elements[a][a]}while(--f);return b},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&this.determinant()===0},trace:function(){if(!this.isSquare()){return null}var c=this.elements[0][0],a=this.elements.length-1,d=a,b;do{b=d-a+1,c+=this.elements[b][b]}while(--a);return c},tr:function(){return this.trace()},rank:function(){var g=this.toRightTriangular(),c=0,k=this.elements.length,f=k,b,d,h=this.elements[0].length,a;do{b=f-k,d=h;do{a=h-d;if(Math.abs(g.elements[b][a])>Sylvester.precision){c++;break}}while(--d)}while(--k);return c},rk:function(){return this.rank()},augment:function(k){var p=k.elements||k;typeof p[0][0]=="undefined"&&(p=Matrix.create(p).elements);var d=this.dup(),b=d.elements[0].length,g=d.elements.length,q=g,c,m,l=p[0].length,h;if(g!=p.length){return null}do{c=q-g,m=l;do{h=l-m,d.elements[c][b+h]=p[c][h]}while(--m)}while(--g);return d},inverse:function(){if(!this.isSquare()||this.isSingular()){return null}var p=this.elements.length,x=p,g,b,k=this.augment(Matrix.I(p)).toRightTriangular(),y,d=k.elements[0].length,w,v,m,h=[],q;do{g=p-1,v=[],y=d,h[g]=[],m=k.elements[g][g];do{w=d-y,q=k.elements[g][w]/m,v.push(q),w>=x&&h[g].push(q)}while(--y);k.elements[g]=v;for(b=0;b<g;b++){v=[],y=d;do{w=d-y,v.push(k.elements[b][w]-k.elements[g][w]*k.elements[b][g])}while(--y);k.elements[b]=v}}while(--p);return Matrix.create(h)},inv:function(){return this.inverse()},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},inspect:function(){var c=[],a=this.elements.length,d=a,b;do{b=d-a,c.push(Vector.create(this.elements[b]).inspect())}while(--a);return c.join("\n")},setElements:function(k){var p,d=k.elements||k;if(typeof d[0][0]!="undefined"){var b=d.length,g=b,q,c,m;this.elements=[];do{p=g-b,q=d[p].length,c=q,this.elements[p]=[];do{m=c-q,this.elements[p][m]=d[p][m]}while(--q)}while(--b);return this}var l=d.length,h=l;this.elements=[];do{p=h-l,this.elements.push([d[p]])}while(--l);return this}},Matrix.create=function(b){var a=new Matrix;return a.setElements(b)},Matrix.I=function(f){var b=[],g=f,d,a,c;do{d=g-f,b[d]=[],a=g;do{c=g-a,b[d][c]=d==c?1:0}while(--a)}while(--f);return Matrix.create(b)},Matrix.Diagonal=function(d){var b=d.length,f=b,c,a=Matrix.I(b);do{c=f-b,a.elements[c][c]=d[c]}while(--b);return a},Matrix.Rotation=function(k,p){if(!p){return Matrix.create([[Math.cos(k),-Math.sin(k)],[Math.sin(k),Math.cos(k)]])}var d=p.dup();if(d.elements.length!=3){return null}var b=d.modulus(),g=d.elements[0]/b,q=d.elements[1]/b,c=d.elements[2]/b,m=Math.sin(k),l=Math.cos(k),h=1-l;return Matrix.create([[h*g*g+l,h*g*q-m*c,h*g*c+m*q],[h*g*q+m*c,h*q*q+l,h*q*c-m*g],[h*g*c-m*q,h*q*c+m*g,h*c*c+l]])},Matrix.RotationX=function(b){var a=Math.cos(b),c=Math.sin(b);return Matrix.create([[1,0,0],[0,a,-c],[0,c,a]])},Matrix.RotationY=function(b){var a=Math.cos(b),c=Math.sin(b);return Matrix.create([[a,0,c],[0,1,0],[-c,0,a]])},Matrix.RotationZ=function(b){var a=Math.cos(b),c=Math.sin(b);return Matrix.create([[a,-c,0],[c,a,0],[0,0,1]])},Matrix.Random=function(b,a){return Matrix.Zero(b,a).map(function(){return Math.random()})},Matrix.Zero=function(f,b){var h=[],d=f,a,c,g;do{a=f-d,h[a]=[],c=b;do{g=b-c,h[a][g]=0}while(--c)}while(--d);return Matrix.create(h)},Line.prototype={eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(b){var a=b.elements||b;return Line.create([this.anchor.elements[0]+a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.direction)},isParallelTo:function(b){if(b.normal){return b.isParallelTo(this)}var a=this.direction.angleFrom(b.direction);return Math.abs(a)<=Sylvester.precision||Math.abs(a-Math.PI)<=Sylvester.precision},distanceFrom:function(p){if(p.normal){return p.distanceFrom(this)}if(p.direction){if(this.isParallelTo(p)){return this.distanceFrom(p.anchor)}var x=this.direction.cross(p.direction).toUnitVector().elements,g=this.anchor.elements,b=p.anchor.elements;return Math.abs((g[0]-b[0])*x[0]+(g[1]-b[1])*x[1]+(g[2]-b[2])*x[2])}var k=p.elements||p,g=this.anchor.elements,y=this.direction.elements,d=k[0]-g[0],w=k[1]-g[1],v=(k[2]||0)-g[2],m=Math.sqrt(d*d+w*w+v*v);if(m===0){return 0}var h=(d*y[0]+w*y[1]+v*y[2])/m,q=1-h*h;return Math.abs(m*Math.sqrt(q<0?0:q))},contains:function(b){var a=this.distanceFrom(b);return a!==null&&a<=Sylvester.precision},liesIn:function(a){return a.contains(this)},intersects:function(a){return a.normal?a.intersects(this):!this.isParallelTo(a)&&this.distanceFrom(a)<=Sylvester.precision},intersectionWith:function(K){if(K.normal){return K.intersectionWith(this)}if(!this.intersects(K)){return null}var x=this.anchor.elements,D=this.direction.elements,A=K.anchor.elements,G=K.direction.elements,z=D[0],C=D[1],w=D[2],O=G[0],J=G[1],F=G[2],M=x[0]-A[0],H=x[1]-A[1],B=x[2]-A[2],L=-z*M-C*H-w*B,q=O*M+J*H+F*B,E=z*z+C*C+w*w,I=O*O+J*J+F*F,k=z*O+C*J+w*F,N=(L*I/E+k*q)/(I-k*k);return Vector.create([x[0]+N*z,x[1]+N*C,x[2]+N*w])},pointClosestTo:function(K){if(K.direction){if(this.intersects(K)){return this.intersectionWith(K)}if(this.isParallelTo(K)){return null}var x=this.direction.elements,D=K.direction.elements,A=x[0],G=x[1],z=x[2],C=D[0],w=D[1],O=D[2],J=z*C-A*O,F=A*w-G*C,M=G*O-z*w,H=Vector.create([J*O-F*w,F*C-M*O,M*w-J*C]),B=Plane.create(K.anchor,H);return B.intersectionWith(this)}var B=K.elements||K;if(this.contains(B)){return Vector.create(B)}var L=this.anchor.elements,x=this.direction.elements,A=x[0],G=x[1],z=x[2],q=L[0],E=L[1],I=L[2],J=A*(B[1]-E)-G*(B[0]-q),F=G*((B[2]||0)-I)-z*(B[1]-E),M=z*(B[0]-q)-A*((B[2]||0)-I),k=Vector.create([G*J-z*M,z*F-A*J,A*M-G*F]),N=this.distanceFrom(B)/k.modulus();return Vector.create([B[0]+k.elements[0]*N,B[1]+k.elements[1]*N,(B[2]||0)+k.elements[2]*N])},rotate:function(y,D){typeof D.direction=="undefined"&&(D=Line.create(D.to3D(),Vector.k));var m=Matrix.Rotation(y,D.direction).elements,b=D.pointClosestTo(this.anchor).elements,v=this.anchor.elements,E=this.direction.elements,k=b[0],C=b[1],B=b[2],x=v[0],q=v[1],A=v[2],w=x-k,g=q-C,z=A-B;return Line.create([k+m[0][0]*w+m[0][1]*g+m[0][2]*z,C+m[1][0]*w+m[1][1]*g+m[1][2]*z,B+m[2][0]*w+m[2][1]*g+m[2][2]*z],[m[0][0]*E[0]+m[0][1]*E[1]+m[0][2]*E[2],m[1][0]*E[0]+m[1][1]*E[1]+m[1][2]*E[2],m[2][0]*E[0]+m[2][1]*E[1]+m[2][2]*E[2]])},reflectionIn:function(z){if(z.normal){var F=this.anchor.elements,m=this.direction.elements,b=F[0],w=F[1],G=F[2],k=m[0],E=m[1],C=m[2],y=this.anchor.reflectionIn(z).elements,q=b+k,B=w+E,x=G+C,g=z.pointClosestTo([q,B,x]).elements,A=[g[0]+(g[0]-q)-y[0],g[1]+(g[1]-B)-y[1],g[2]+(g[2]-x)-y[2]];return Line.create(y,A)}if(z.direction){return this.rotate(Math.PI,z)}var D=z.elements||z;return Line.create(this.anchor.reflectionIn([D[0],D[1],D[2]||0]),this.direction)},setVectors:function(b,a){b=Vector.create(b),a=Vector.create(a),b.elements.length==2&&b.elements.push(0),a.elements.length==2&&a.elements.push(0);if(b.elements.length>3||a.elements.length>3){return null}var c=a.modulus();return c===0?null:(this.anchor=b,this.direction=Vector.create([a.elements[0]/c,a.elements[1]/c,a.elements[2]/c]),this)}},Line.create=function(b,a){var c=new Line;return c.setVectors(b,a)},Line.X=Line.create(Vector.Zero(3),Vector.i),Line.Y=Line.create(Vector.Zero(3),Vector.j),Line.Z=Line.create(Vector.Zero(3),Vector.k),Plane.prototype={eql:function(a){return this.contains(a.anchor)&&this.isParallelTo(a)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(b){var a=b.elements||b;return Plane.create([this.anchor.elements[0]+a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.normal)},isParallelTo:function(b){var a;return b.normal?(a=this.normal.angleFrom(b.normal),Math.abs(a)<=Sylvester.precision||Math.abs(Math.PI-a)<=Sylvester.precision):b.direction?this.normal.isPerpendicularTo(b.direction):null},isPerpendicularTo:function(b){var a=this.normal.angleFrom(b.normal);return Math.abs(Math.PI/2-a)<=Sylvester.precision},distanceFrom:function(d){if(this.intersects(d)||this.contains(d)){return 0}if(d.anchor){var b=this.anchor.elements,f=d.anchor.elements,c=this.normal.elements;return Math.abs((b[0]-f[0])*c[0]+(b[1]-f[1])*c[1]+(b[2]-f[2])*c[2])}var a=d.elements||d,b=this.anchor.elements,c=this.normal.elements;return Math.abs((b[0]-a[0])*c[0]+(b[1]-a[1])*c[1]+(b[2]-(a[2]||0))*c[2])},contains:function(d){if(d.normal){return null}if(d.direction){return this.contains(d.anchor)&&this.contains(d.anchor.add(d.direction))}var b=d.elements||d,f=this.anchor.elements,c=this.normal.elements,a=Math.abs(c[0]*(f[0]-b[0])+c[1]*(f[1]-b[1])+c[2]*(f[2]-(b[2]||0)));return a<=Sylvester.precision},intersects:function(a){return typeof a.direction=="undefined"&&typeof a.normal=="undefined"?null:!this.isParallelTo(a)},intersectionWith:function(B){if(!this.intersects(B)){return null}if(B.direction){var H=B.anchor.elements,q=B.direction.elements,b=this.anchor.elements,y=this.normal.elements,I=(y[0]*(b[0]-H[0])+y[1]*(b[1]-H[1])+y[2]*(b[2]-H[2]))/(y[0]*q[0]+y[1]*q[1]+y[2]*q[2]);return Vector.create([H[0]+q[0]*I,H[1]+q[1]*I,H[2]+q[2]*I])}if(B.normal){var k=this.normal.cross(B.normal).toUnitVector(),y=this.normal.elements,H=this.anchor.elements,G=B.normal.elements,E=B.anchor.elements,A=Matrix.Zero(2,2),x=0;while(A.isSingular()){x++,A=Matrix.create([[y[x%3],y[(x+1)%3]],[G[x%3],G[(x+1)%3]]])}var D=A.inverse().elements,z=y[0]*H[0]+y[1]*H[1]+y[2]*H[2],g=G[0]*E[0]+G[1]*E[1]+G[2]*E[2],C=[D[0][0]*z+D[0][1]*g,D[1][0]*z+D[1][1]*g],F=[];for(var w=1;w<=3;w++){F.push(x==w?0:C[(w+(5-x)%3)%3])}return Line.create(F,k)}},pointClosestTo:function(d){var b=d.elements||d,f=this.anchor.elements,c=this.normal.elements,a=(f[0]-b[0])*c[0]+(f[1]-b[1])*c[1]+(f[2]-(b[2]||0))*c[2];return Vector.create([b[0]+c[0]*a,b[1]+c[1]*a,(b[2]||0)+c[2]*a])},rotate:function(y,D){var m=Matrix.Rotation(y,D.direction).elements,b=D.pointClosestTo(this.anchor).elements,v=this.anchor.elements,E=this.normal.elements,k=b[0],C=b[1],B=b[2],x=v[0],q=v[1],A=v[2],w=x-k,g=q-C,z=A-B;return Plane.create([k+m[0][0]*w+m[0][1]*g+m[0][2]*z,C+m[1][0]*w+m[1][1]*g+m[1][2]*z,B+m[2][0]*w+m[2][1]*g+m[2][2]*z],[m[0][0]*E[0]+m[0][1]*E[1]+m[0][2]*E[2],m[1][0]*E[0]+m[1][1]*E[1]+m[1][2]*E[2],m[2][0]*E[0]+m[2][1]*E[1]+m[2][2]*E[2]])},reflectionIn:function(z){if(z.normal){var F=this.anchor.elements,m=this.normal.elements,b=F[0],w=F[1],G=F[2],k=m[0],E=m[1],C=m[2],y=this.anchor.reflectionIn(z).elements,q=b+k,B=w+E,x=G+C,g=z.pointClosestTo([q,B,x]).elements,A=[g[0]+(g[0]-q)-y[0],g[1]+(g[1]-B)-y[1],g[2]+(g[2]-x)-y[2]];return Plane.create(y,A)}if(z.direction){return this.rotate(Math.PI,z)}var D=z.elements||z;return Plane.create(this.anchor.reflectionIn([D[0],D[1],D[2]||0]),this.normal)},setVectors:function(x,B,k){x=Vector.create(x),x=x.to3D();if(x===null){return null}B=Vector.create(B),B=B.to3D();if(B===null){return null}if(typeof k=="undefined"){k=null}else{k=Vector.create(k),k=k.to3D();if(k===null){return null}}var b=x.elements[0],q=x.elements[1],C=x.elements[2],g=B.elements[0],A=B.elements[1],z=B.elements[2],w,m;if(k!==null){var y=k.elements[0],v=k.elements[1],d=k.elements[2];w=Vector.create([(A-q)*(d-C)-(z-C)*(v-q),(z-C)*(y-b)-(g-b)*(d-C),(g-b)*(v-q)-(A-q)*(y-b)]),m=w.modulus();if(m===0){return null}w=Vector.create([w.elements[0]/m,w.elements[1]/m,w.elements[2]/m])}else{m=Math.sqrt(g*g+A*A+z*z);if(m===0){return null}w=Vector.create([B.elements[0]/m,B.elements[1]/m,B.elements[2]/m])}return this.anchor=x,this.normal=w,this}},Plane.create=function(c,a,d){var b=new Plane;return b.setVectors(c,a,d)},Plane.XY=Plane.create(Vector.Zero(3),Vector.k),Plane.YZ=Plane.create(Vector.Zero(3),Vector.i),Plane.ZX=Plane.create(Vector.Zero(3),Vector.j),Plane.YX=Plane.XY,Plane.ZY=Plane.YZ,Plane.XZ=Plane.ZX;var $V=Vector.create,$M=Matrix.create,$L=Line.create,$P=Plane.create;pc.Game=pc.Base.extend("pc.Game",{},{scenes:null,activeScenes:null,paused:!1,init:function(b,a){this._super(),this.scenes=new pc.LinkedList,this.activeScenes=new pc.LinkedList,pc.device.devMode&&(pc.device.input.bindAction(this,"physics debug","F5"),pc.device.input.bindAction(this,"pool dump","F4"))},process:function(){if(this.paused){return}var a=this.getFirstActiveScene();while(a){a.object().process(),a=a.next()}return !0},onAction:function(f){f==="pool dump"&&(console.log(pc.Pool.getStats()),gamecore.Pool.getPool(pc.Point).startTracing());if(f==="physics debug"){var b=this.getFirstScene();while(b){var g=b.object().getFirstActiveLayer();while(g){var d=g.object();if(d.Class.isA("pc.EntityLayer")){var a=d.systemManager.systems.first;while(a){var c=a.object();c.Class.isA("pc.systems.Physics")&&c.setDebug(!c.debug),a=a.next()}}g=g.next()}b=b.next()}}},addScene:function(a){this.scenes.add(a),this.activeScenes.add(a),this.onSceneAdded(a)},onSceneAdded:function(a){},removeScene:function(a){this.scenes.remove(a),this.activeScenes.remove(a),this.onSceneRemoved(a)},onSceneRemoved:function(a){},activateScene:function(a){if(a.active){return}this.activeScenes.add(a),a.active=!0,this.onSceneActivated(a),a.onActivated()},onSceneActivated:function(a){},deactivateScene:function(a){if(!a.active){return}this.activeScenes.remove(a),a.active=!1,this.onSceneDeactivated(a),a.onDeactivated()},onSceneDeactivated:function(a){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){this.paused=!0;var a=this.getFirstScene();while(a){a.object().pause(),a=a.next()}},isActive:function(){return !0},resume:function(){this.paused=!1;var a=this.getFirstScene();while(a){a.object().resume(),a=a.next()}},togglePauseResume:function(){pc.system.game.paused?pc.system.game.resume():pc.system.game.pause()},reset:function(){var a=this.getFirstScene();while(a){a.obj.reset(),a=a.next()}this.scenes.clear(),this.activeScenes.clear(),this.onReady()},onReady:function(){},onResize:function(b,a){var c=this.getFirstActiveScene();while(c){c.obj.onResize(b,a),c=c.next()}},getScreenRect:function(){return pc.Rect.create(0,0,pc.device.canvasWidth,pc.device.canvasHeight)}}),pc.Hashmap=pc.Base.extend("pc.Hashmap",{},{length:0,items:{},put:function(b,a){if(!pc.valid(b)){throw"invaid key"}this.items[b]=a,this.length++},get:function(a){return this.items[a]},hasKey:function(a){return this.items.hasOwnProperty(a)},remove:function(a){this.hasKey(a)&&(this.length--,delete this.items[a])},keys:function(){var b=[];for(var a in this.items){b.push(a)}return b},values:function(){var b=[];for(var a in this.items){b.push(this.items[a])}return b},clear:function(){this.items={},this.length=0}}),pc.Image=pc.Base.extend("pc.Image",{},{width:0,height:0,image:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,translateX:0,translateY:0,init:function(c,a,d,b){this._super(),this.name=c,this.src=pc.device.loader.makeUrl(a),this.image=new Image,this.onLoadCallback=d,this.onErrorCallback=b,this.image.onload=this.onLoad.bind(this),this.image.onerror=this.onError.bind(this),this.scaleX=1,this.scaleY=1,this.alpha=1,pc.device.loader.started&&this.load()},setScale:function(b,a){this.scaleX=b,this.scaleY=a},setCompositeOperation:function(a){this.compositeOperation=a},load:function(b,a){this.onLoadCallback=b,this.onErrorCallback=a,this.loaded&&b&&this.onLoadCallback(this),this.image.onload=this.onLoad.bind(this),this.image.onerror=this.onError.bind(this),this.image.src=this.src},reload:function(){this.loaded=!1,this.load()},draw:function(p,x,g,b,k,y,d,w){this.compositeOperation!=null&&(p.globalCompositeOperation=this.compositeOperation);if(arguments.length==3){p.drawImage(this.image,x,g)}else{if(pc.valid(w)){p.save(),this.alpha!=1&&(p.globalAlpha=this.alpha);if(this.scaleX<0||this.scaleY<0){var v=this.scaleY==1?0:this.scaleY,m=this.scaleX==1?0:this.scaleX;p.translate(b+y/2*m,k+d/2*v)}else{p.translate(b+y/2,k+d/2)}p.rotate(w*(Math.PI/180)),p.scale(this.scaleX,this.scaleY),p.drawImage(this.image,x,g,y,d,-y/2,-d/2,y,d),p.restore()}else{p.save(),this.alpha!=1&&(p.globalAlpha=this.alpha);if(this.scaleX<0||this.scaleY<0){var h=this.scaleY==1?0:this.scaleY,q=this.scaleX==1?0:this.scaleX;p.translate(b+-(y/2)*q,k+-(d/2)*h)}else{p.translate(b,k)}p.scale(this.scaleX,this.scaleY),p.drawImage(this.image,x,g,y,d,0,0,y,d),p.restore()}}this.compositeOperation!=null&&(p.globalCompositeOperation="source-over"),pc.device.elementsDrawn++},onLoad:function(){this.loaded=!0,this.width=this.image.width,this.height=this.image.height,this.onLoadCallback&&this.onLoadCallback(this)},onError:function(){this.onErrorCallback&&this.onErrorCallback(this)},expand:function(b,a){this.image.width=this.width+b,this.image.height=this.height+a,this.width=this.image.width,this.height=this.image.height},resize:function(y,D){var m=this.width*y,b=this.height*D,v=document.createElement("canvas");v.width=this.width,v.height=this.height;var E=v.getContext("2d");E.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);var k=E.getImageData(0,0,this.width,this.height),C=document.createElement("canvas");C.width=m,C.height=b;var B=C.getContext("2d"),x=B.getImageData(0,0,m,b);for(var q=0;q<b;q++){for(var A=0;A<m;A++){var w=(Math.floor(q/D)*this.width+Math.floor(A/y))*4,g=(q*m+A)*4;for(var z=0;z<4;z++){x.data[g+z]=k.data[w+z]}}}return B.putImageData(x,0,0),this.image=C,this}}),pc.CanvasImage=pc.Base.extend("pc.CanvasImage",{},{width:0,height:0,canvas:null,loaded:!0,scaleX:1,scaleY:1,init:function(a){this.canvas=a,this.width=a.width,this.height=a.height},draw:function(f,b,h,d,a,c,g){c==undefined||g==undefined||c==0||g==0?f.drawImage(this.canvas,b,h):f.drawImage(this.canvas,b,h,c,g,d*this.scaleX,a*this.scaleY,c*this.scaleX,g*this.scaleY)},setScale:function(b,a){this.scaleX=b,this.scaleY=a}}),pc.ImageTools=pc.Base.extend("pc.ImageTools",{rotate:function(g,l,d,b){var f=document.createElement("canvas");f.width=l*b,f.height=d;var m=f.getContext("2d"),c=l/2,k=d/2;for(var h=0;h<b;h++){m.save(),m.translate(h*l+l/2,d/2),m.rotate(360/b*h*(Math.PI/180)),m.drawImage(g,-(l/2),-(d/2)),m.restore()}return new pc.CanvasImage(f)}},{}),pc.Input=pc.Base("pc.Input",{_eventPos:null,getEventPosition:function(b,a){this._eventPos==null&&(this._eventPos=pc.Point.create(0,0));var c=a;return pc.Tools.isValid(a)||(c=this._eventPos),b.pageX||b.pageY?(c.x=b.pageX,c.y=b.pageY):(c.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop),c}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,init:function(){this._super(),this.stateBindings=new pc.Hashtable,this.states=new pc.Hashtable,this.actionBindings=new pc.Hashtable,this.mousePos=pc.Point.create(0,0)},onReady:function(){pc.device.canvas.addEventListener("touchstart",this._touchStart.bind(this),!0),pc.device.canvas.addEventListener("touchend",this._touchEnd.bind(this),!0),pc.device.canvas.addEventListener("touchmove",this._touchMove.bind(this),!0),pc.device.canvas.addEventListener("mouseup",this._mouseUp.bind(this),!0),pc.device.canvas.addEventListener("mousedown",this._mouseDown.bind(this),!0),pc.device.canvas.addEventListener("mousemove",this._mouseMove.bind(this),!0),pc.device.canvas.addEventListener("mousewheel",this._mouseWheel.bind(this),!0),pc.device.canvas.addEventListener("contextmenu",this._contextMenu.bind(this),!0),window.addEventListener("keydown",this._keyDown.bind(this),!0),window.addEventListener("keyup",this._keyUp.bind(this),!0)},bindState:function(d,b,f,c){if(d.uniqueId==null){throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function"}f=f.toUpperCase();var a=this.stateBindings.get(f);a==null?this.stateBindings.put(f,[{stateName:b,object:d,state:{on:!1,event:null},uiTarget:c}]):a.push({stateName:b,object:d,state:{on:!1,event:null},uiTarget:c}),this.states.put(d.uniqueId+"\\\\"+b,{on:!1,event:null})},_changeState:function(m,v,d){var b=pc.InputType.getName(m);if(b==null){return this.log("Unknown keycode = "+m),!1}var h=this.stateBindings.get(b);if(h==null){return !1}for(var w=0;w<h.length;w++){var c=h[w];if(!c.object.isActive||c.object.isActive()){if(pc.InputType.isPositional(m)){var q=this.Class.getEventPosition(d),p=null;pc.valid(c.uiTarget)?p=c.uiTarget.getScreenRect():p=c.object.getScreenRect?c.object.getScreenRect():null;if(p&&p.containsPoint(q)){var k=this.states.get(c.object.uniqueId+"\\\\"+c.stateName);k.on=v,k.event=d,k.on?this._tracks.push(c):pc.Tools.arrayRemove(this._tracks,c)}}else{var g=this.states.get(c.object.uniqueId+"\\\\"+c.stateName);g.on=v,g.event=d}}}return !0},clearStates:function(f){var b=this.stateBindings.entries();for(var h=0;h<b.length;h++){var d=b[h];for(var a=0;a<d.length;a++){var c=d[a];if(c.object==f){var g=this.states.get(next.object.uniqueId+"\\\\"+next.stateName);g.on=!1,g.event=null,pc.tools.arrayRemove(this._tracks,c)}}}},_tracks:[],_checkState:function(f){for(var b=0;b<this._tracks.length;b++){var h=this._tracks[b],d=this.Class.getEventPosition(f),a=null;pc.valid(h.uiTarget)?a=h.uiTarget.getScreenRect():a=h.object.getScreenRect?h.object.getScreenRect():null;if(a&&!a.containsPoint(d)){var c=this.states.get(h.object.uniqueId+"\\\\"+h.stateName);c.on=!1,c.event=f}else{var g=this.states.get(h.object.uniqueId+"\\\\"+h.stateName);g.on=!0,g.event=f}}},isInputState:function(b,a){var c=this.states.get(b.uniqueId+"\\\\"+a);if(c==null){throw"Ooops, unknown state "+a}return c.on},getInputState:function(b,a){return this.states.get(b.uniqueId+"\\\\"+a)},bindAction:function(d,b,f,c){f=f.toUpperCase();var a=this.actionBindings.get(f);a==null?this.actionBindings.put(f,[{actionName:b,object:d,uiTarget:c}]):a.push({actionName:b,object:d,uiTarget:c})},fireAction:function(g,c){var k=this.actionBindings.get(pc.InputType.getName(g));if(k==null){return !1}for(var f=0;f<k.length;f++){var b=k[f],d=k[f].object;if(!d.isActive||d.isActive()){if(pc.InputType.isPositional(g)){var h=this.Class.getEventPosition(c),a=null;pc.valid(b.uiTarget)?a=b.uiTarget.getScreenRect():a=d.getScreenRect?d.getScreenRect():null,a&&a.containsPoint(h)&&d.onAction(b.actionName,c,h,b.uiTarget)}else{d.onAction(b.actionName)}}}return !0},_lastMouseMove:null,process:function(){this._lastMouseMove&&(this._checkState(this._lastMouseMove),this.fireAction(pc.InputType.MOUSE_MOVE,this._lastMouseMove),this.Class.getEventPosition(this._lastMouseMove,this.mousePos),this._lastMouseMove=null)},_keyDown:function(a){this._changeState(a.keyCode,!0,a)&&a.preventDefault(),this.fireAction(a.keyCode,a)&&a.preventDefault()},_keyUp:function(a){this._changeState(a.keyCode,!1,a)&&a.preventDefault()},_touchStart:function(b){for(var a=0,c=b.touches.length;a<c;a++){this._changeState(pc.InputType.TOUCH,!0,b.touches[a]),this.fireAction(pc.InputType.TOUCH,b.touches[a])}b.preventDefault()},_touchEnd:function(b){this._tracks.length=0;for(var a=0,c=b.changedTouches.length;a<c;a++){this._changeState(pc.InputType.TOUCH,!1,b.changedTouches[a])}b.preventDefault()},_touchMove:function(b){for(var a=0,c=b.touches.length;a<c;a++){this._checkState(b.touches[a])}b.preventDefault()},_mouseUp:function(a){this._tracks.length=0,this._changeState(pc.InputType.MOUSE_LEFT_BUTTON,!1,a),a.preventDefault()},_mouseDown:function(a){a.button==0||a.button==1?(this._changeState(pc.InputType.MOUSE_LEFT_BUTTON,!0,a),this.fireAction(pc.InputType.MOUSE_LEFT_BUTTON,a)):(this._changeState(pc.InputType.MOUSE_RIGHT_BUTTON,!0,a),this.fireAction(pc.InputType.MOUSE_RIGHT_BUTTON,a)),a.preventDefault()},_mouseMove:function(a){this._lastMouseMove=a,a.preventDefault()},_contextMenu:function(a){this._changeState(pc.InputType.MOUSE_RIGHT_BUTTON,!0,a),this.fireAction(pc.InputType.MOUSE_RIGHT_BUTTON,a)},_mouseWheel:function(a){a.wheel>0?this.fireAction(pc.InputType.MOUSE_WHEEL_UP,a):this.fireAction(pc.InputType.MOUSE_WHEEL_DOWN,a),a.preventDefault()}}),pc.InputType=pc.Base.extend("pc.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1000,MOUSE_LEFT_BUTTON:1100,MOUSE_RIGHT_BUTTON:1101,MOUSE_WHEEL_UP:1102,MOUSE_WHEEL_DOWN:1103,MOUSE_MOVE:1104,TOUCH:1000,init:function(){this.nameToCode=new pc.Hashtable,this.codeToName=new pc.Hashtable,this.addInput(8,"BACKSPACE"),this.addInput(9,"TAB"),this.addInput(13,"ENTER"),this.addInput(16,"SHIFT"),this.addInput(17,"CTRL"),this.addInput(18,"ALT"),this.addInput(19,"PAUSE"),this.addInput(20,"CAPS"),this.addInput(27,"ESC"),this.addInput(32,"SPACE"),this.addInput(33,"PAGE_UP"),this.addInput(34,"PAGE_DOWN"),this.addInput(35,"END"),this.addInput(36,"HOME"),this.addInput(37,"LEFT"),this.addInput(38,"UP"),this.addInput(39,"RIGHT"),this.addInput(40,"DOWN"),this.addInput(45,"INSERT"),this.addInput(46,"DELETE");for(var b=48;b<91;b++){var a=String.fromCharCode(b);this.addInput(b,a)}this.addInput(91,"WINDOW_LEFT"),this.addInput(92,"WINDOW_RIGHT"),this.addInput(93,"SELECT"),this.addInput(96,"NUM_0"),this.addInput(97,"NUM_1"),this.addInput(98,"NUM_2"),this.addInput(99,"NUM_3"),this.addInput(100,"NUM_4"),this.addInput(101,"NUM_5"),this.addInput(102,"NUM_6"),this.addInput(103,"NUM_7"),this.addInput(104,"NUM_8"),this.addInput(105,"NUM_9"),this.addInput(106,"*"),this.addInput(107,"+"),this.addInput(109,"-"),this.addInput(110,"."),this.addInput(111,"/"),this.addInput(112,"F1"),this.addInput(113,"F2"),this.addInput(114,"F3"),this.addInput(115,"F4"),this.addInput(116,"F5"),this.addInput(117,"F6"),this.addInput(118,"F7"),this.addInput(119,"F8"),this.addInput(120,"F9"),this.addInput(121,"F10"),this.addInput(122,"F11"),this.addInput(123,"F12"),this.addInput(144,"NUM_LOCK"),this.addInput(145,"SCROLL_LOCK"),this.addInput(186,";"),this.addInput(187,"="),this.addInput(188,","),this.addInput(189,"-"),this.addInput(190,"."),this.addInput(191,"/"),this.addInput(192,"`"),this.addInput(219,"["),this.addInput(220,"\\"),this.addInput(221,"]"),this.addInput(222,"'"),this.addInput(this.TOUCH,"TOUCH"),this.addInput(this.MOUSE_LEFT_BUTTON,"MOUSE_LEFT_BUTTON"),this.addInput(this.MOUSE_RIGHT_BUTTON,"MOUSE_RIGHT_BUTTON"),this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP"),this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN"),this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE")},isPositional:function(a){return a>=this.POSITIONAL_EVENT_START},addInput:function(b,a){this.codeToName.put(b,a),this.nameToCode.put(a,b)},getName:function(a){return this.codeToName.get(a)},getCode:function(a){return this.nameToCode.get(a)}},{}),pc.Layer=pc.Base.extend("pc.Layer",{},{name:null,paused:!1,active:!1,scene:null,zIndex:0,originTrack:null,originTrackXRatio:1,originTrackYRatio:1,origin:null,init:function(b,a){this._super(),this.name=b,this.origin=pc.Point.create(0,0),this._worldPos=pc.Point.create(0,0),this._screenPos=pc.Point.create(0,0),this.zIndex=pc.checked(a,0),this.originTrack=null,this.originTrackXRatio=0,this.originTrackYRatio=0},toString:function(){return""+this.name+" (origin: "+this.origin+", zIndex: "+this.zIndex+")"},release:function(){this.origin.release()},isActive:function(){return this.scene!=null&&!this.scene.active?!1:this.active},setActive:function(){this.scene.setLayerActive(this)},setInactive:function(){this.scene.setLayerInactive(this)},setZIndex:function(a){this.zIndex=a,this.scene&&this.scene.sortLayers()},_worldPos:null,worldPos:function(a){return this._worldPos.x=a.x+this.origin.x,this._worldPos.y=a.y+this.origin.y,this._worldPos},_screenPos:null,screenPos:function(a){return this._screenPos.x=this.worldYToScreen(a.x),this._screenPos.y=this.worldYToScreen(a.y),this._screenPos},screenX:function(a){return a+this.scene.viewPort.x-this.origin.x},screenY:function(a){return a+this.scene.viewPort.y-this.origin.y},getScreenRect:function(){return this.scene.getScreenRect()},draw:function(){},setOriginTrack:function(b,a,c){this.originTrack=b,this.originTrackXRatio=pc.checked(a,1),this.originTrackYRatio=pc.checked(c,1)},setOrigin:function(b,a){return this.origin.x==Math.round(b)&&this.origin.y==Math.round(a)?!1:(this.origin.x=Math.round(b),this.origin.y=Math.round(a),!0)},process:function(){this.originTrack&&this.setOrigin(this.originTrack.origin.x*this.originTrackXRatio,this.originTrack.origin.y*this.originTrackYRatio)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},onResize:function(b,a){},onAddedToScene:function(){},onRemovedFromScene:function(){},onAction:function(c,a,d,b){}}),pc.EntityLayer=pc.Layer("pc.EntityLayer",{loadFromTMX:function(H,q,A){var x=q.getAttribute("name"),D=new pc.EntityLayer(x);H.addLayer(D);var w=q.getElementsByTagName("object");for(var z=0;z<w.length;z++){var k=w[z],K=null,G=parseInt(k.getAttribute("x")),C=parseInt(k.getAttribute("y")),J=parseInt(k.getAttribute("width")),E=parseInt(k.getAttribute("height")),y=k.getElementsByTagName("properties")[0].getElementsByTagName("property"),I={};for(var b=0;b<y.length;b++){var B=y[b].getAttribute("name"),F=y[b].getAttribute("value");I[B]=F,B==="entity"&&(K=F)}K?A.createEntity(D,K,G,C,J,E,I):this.warn('Entity loaded from map with no "entity" type property set. x='+G+" y="+C)}}},{worldSize:null,entityManager:null,systemManager:null,init:function(c,a,d,b){this._super(c),this.entityFactory=b,this.systemManager=new pc.SystemManager,this.entityManager=new pc.EntityManager(this.systemManager),this.entityManager.layer=this,this.systemManager.layer=this,this.worldSize=pc.Dim.create(pc.checked(a,10000),pc.checked(d,10000))},setOrigin:function(b,a){var c=this._super(b,a);return c&&this.systemManager.onOriginChange(b,a),c},getEntityManager:function(){return this.entityManager},getSystemManager:function(){return this.systemManager},addSystem:function(a){this.systemManager.add(a,this.entityManager)},getSystemsByComponentType:function(a){return this.systemManager.getByComponentType(a)},removeSystem:function(a){this.systemManager.remove(a)},process:function(){this._super(),this.systemManager.processAll(),this.entityManager.cleanup()},onResize:function(b,a){this.systemManager.onResize(b,a)}}),pc.TileSet=pc.Base.extend("pc.TileSet",{},{tileSpriteSheet:null,props:null,init:function(b){this.tileSpriteSheet=b,this.props=new Array(b.totalFrames);for(var a=0;a<this.props.length;a++){this.props[a]=new pc.Hashmap}},drawTile:function(c,a,d,b){this.tileSpriteSheet.drawFrame(c,a%this.tileSpriteSheet.framesWide,pc.Math.floor(a/this.tileSpriteSheet.framesWide),d,b)},addProperty:function(b,a,c){this.props[b].put(a,c)},hasProperty:function(b,a){return this.props[b].hasKey(a)},getProperties:function(a){return this.props[a]}}),pc.TileMap=pc.Base.extend("pc.TileMap",{EMPTY_TILE:-1},{tiles:null,tilesWide:0,tilesHigh:0,tileWidth:0,tileHeight:0,tileSet:null,init:function(f,b,g,d,a,c){this.tiles=c,this.tileWidth=pc.Math.round(d),this.tileHeight=pc.Math.round(a),this.tilesWide=pc.Math.round(b),this.tilesHigh=pc.Math.round(g),this.tileSet=f},tileHasProperty:function(c,a,d){var b=this.getTile(c,a);return b>=0?this.tileSet.hasProperty(b,d):!1},generate:function(c){this.tiles=new Array(this.tilesHigh);var a=pc.checked(c,this.Class.EMPTY_TILE);for(var d=0;d<this.tilesHigh;d++){this.tiles[d]=new Array(this.tilesWide);for(var b=0;b<this.tilesWide;b++){this.tiles[d][b]=a}}},paint:function(f,b,h,d,a){for(var c=b;c<b+d;c++){for(var g=f;g<f+h;g++){this.tiles[c][g]=a}}},isOnMap:function(b,a){return b>=0&&b<this.tilesWide&&a>=0&&a<this.tilesHigh},clear:function(c,a,d,b){this.paint(c,a,d,b,this.Class.EMPTY_TILE)},setTile:function(b,a,c){this.tiles[a][b]=c},getTile:function(b,a){return this.isOnMap(b,a)?this.tiles[a][b]:-1},loadFromTMX:function(p,x,g){this.tileWidth=x,this.tileHeight=g,this.tilesWide=parseInt(p.getAttribute("width")),this.tilesHigh=parseInt(p.getAttribute("height"));var b=p.getElementsByTagName("data")[0];if(b.getAttribute("compression")){this.error("map: "+name+": TMX map compression not supported, use base64 encoding");return}if(b.getAttribute("encoding")=="base64"){var k="";for(var y=0;y<b.childNodes.length;y++){k+=b.childNodes[y].nodeValue}k=k.replace(/[^A-Za-z0-9\+\/\=]/g,"");var d=atob(k),w=[];for(var v=0;v<d.length/4;v++){w[v]=0;for(var m=3;m>=0;--m){w[v]+=d.charCodeAt(v*4+m)<<(m<<3)}}}this.tiles=new Array(this.tilesHigh);for(var h=0;h<this.tilesHigh;h++){this.tiles[h]=new Array(this.tilesWide);for(var q=0;q<this.tilesWide;q++){this.tiles[h][q]=w[h*this.tilesWide+q]-1}}}}),pc.TileLayer=pc.Layer.extend("pc.TileLayer",{loadFromTMX:function(f,b,h,d,a){var c=b.getAttribute("name"),g=new pc.TileLayer(c,!0,null,a);g.tileMap.loadFromTMX(b,h,d),f.addLayer(g)}},{tileMap:null,debugShowGrid:!1,prerenders:null,usePrerendering:!0,prerenderSize:512,init:function(c,a,d,b){this._super(c),this.tileMap=pc.checked(d,new pc.TileMap(b)),this.usePrerendering=pc.checked(a,!0),this.tileMap&&this.tileMap.tileWidth>256&&(this.usePrerendering=!1)},setTileMap:function(a){this.tileMap=a,this.usePrerendering&&this.prerender()},prerender:function(){var J=this.tileMap.tilesWide*this.tileMap.tileWidth,w=this.tileMap.tilesHigh*this.tileMap.tileHeight,C=Math.ceil(J/this.prerenderSize),z=Math.ceil(w/this.prerenderSize);this.prerenders=[];for(var F=0;F<z;F++){this.prerenders[F]=[];for(var x=0;x<C;x++){var B=D==C-1?J-D*this.prerenderSize:this.prerenderSize,q=H==z-1?w-H*this.prerenderSize:this.prerenderSize,M=B/this.tileMap.tileWidth+1,I=q/this.tileMap.tileHeight+1,E=x*this.prerenderSize%this.tileMap.tileWidth,L=F*this.prerenderSize%this.tileMap.tileHeight,G=Math.floor(x*this.prerenderSize/this.tileMap.tileWidth),A=Math.floor(F*this.prerenderSize/this.tileMap.tileHeight),K=document.createElement("canvas");K.width=B,K.height=q;var k=K.getContext("2d");for(var D=0;D<M;D++){for(var H=0;H<I;H++){if(D+G<this.tileMap.tilesWide&&H+A<this.tileMap.tilesHigh){var b=this.tileMap.getTile(D+G,H+A);b>=0&&this.tileMap.tileSet.drawTile(k,b,D*this.tileMap.tileWidth-E,H*this.tileMap.tileHeight-L)}}}this.prerenders[F][x]=K}}},draw:function(){this._super();if(!this.tileMap||!this.tileMap.tilesWide){return}this.usePrerendering?this.drawPrerendered():this.drawTiled()},drawTiled:function(){var k=Math.floor(this.origin.x/this.tileMap.tileWidth);k<0&&(k=0);var p=Math.floor(this.origin.y/this.tileMap.tileHeight);p<0&&(p=0);var d=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-k+2;k+d>=this.tileMap.tilesWide-1&&(d=this.tileMap.tilesWide-1-k);var b=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-p+2;p+b>=this.tileMap.tilesHigh-1&&(b=this.tileMap.tilesHigh-1-p);for(var g=p,q=p+b;g<q+1;g++){var c=this.screenY(g*this.tileMap.tileHeight);for(var m=k,l=k+d;m<l;m++){var h=this.tileMap.tiles[g][m];h>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,h,this.screenX(m*this.tileMap.tileWidth),c),this.debugShowGrid&&(pc.device.ctx.save(),pc.device.ctx.strokeStyle="#222222",pc.device.ctx.strokeRect(this.screenX(m*this.tileMap.tileWidth),this.screenY(g*this.tileMap.tileHeight),this.tileMap.tileWidth,this.tileMap.tileHeight),pc.device.ctx.restore())}}},drawPrerendered:function(){this.prerenders||this.prerender();var g=-this.origin.x+this.scene.viewPort.x,c=-this.origin.y+this.scene.viewPort.y,k=Math.max(Math.floor(this.origin.x/this.prerenderSize),0),f=Math.max(Math.floor(this.origin.y/this.prerenderSize),0),b=k+Math.ceil((this.origin.x+this.scene.viewPort.w)/this.prerenderSize),d=f+Math.ceil((this.origin.y+this.scene.viewPort.h)/this.prerenderSize);b=Math.min(b,this.prerenders[0].length),d=Math.min(d,this.prerenders.length);for(var h=f;h<d;h++){for(var a=k;a<b;a++){pc.device.ctx.drawImage(this.prerenders[h%this.prerenders.length][a%this.prerenders[0].length],g+a*this.prerenderSize,c+h*this.prerenderSize)}}}}),pc.Loader=pc.Base.extend("pc.Loader",{},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},resources:new pc.Hashtable,loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",started:!1,finished:!1,_noCacheString:"",init:function(){this._super()},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},setBaseUrl:function(a){this.baseUrl=a},setListener:function(b,a){this.loadingListener=b,this.loadedListener=a},add:function(a){this.resources.put(a.name.toLowerCase(),{resource:a,state:this.State.QUEUED}),this.info("Adding resource "+a.src+" to the queue.")},get:function(b){var a=this.resources.get(b.toLowerCase());return a||this.warn("Attempting to get a resource that hasn't been added: "+b),a},start:function(d,b){this.setListener(d,b),this.progress=0,this.errored=0;var f=this.resources.keys();for(var c=0;c<f.length;c++){var a=this.resources.get(f[c]);a.state==this.State.QUEUED&&(a.resource.load(this.onLoad.bind(this),this.onError.bind(this)),a.state=this.State.LOADING,this.totalBeingLoaded++)}this.info("Started loading "+this.totalBeingLoaded+" resource(s).")},makeUrl:function(a){return this.baseUrl+a+this._noCacheString},onLoad:function(b){var a=this.resources.get(b.name);a.state=this.State.READY,this.progress++,this.loadingListener!=null&&this.loadingListener(Math.round(this.progress/this.totalBeingLoaded*100)),this.info(b.name+" loaded ("+Math.round(this.progress/this.totalBeingLoaded*100)+"% done)"),this.checkAllDone()},onError:function(b){var a=this.resources.get(b.name);a.state=this.State.FAILED,this.progress++,this.errored++,this.loadingListener!=null&&this.loadingListener(this.progress/this.totalBeingLoaded),this.warn(b.name+" ("+b.src+") failed."),this.checkAllDone()},checkAllDone:function(){this.progress>=this.totalBeingLoaded&&(this.finished=!0,this.loadedListener(this.progress,this.errored),this.progress=0,this.errored=0,this.totalBeingLoaded=0)}}),pc.Math=pc.Base("pc.Math",{RADIAN_TO_DEGREE:180/Math.PI,DEGREE_TO_RADIAN:Math.PI/180,PI:Math.PI,round:Math.round,random:Math.random,floor:Math.floor,sqr:function(a){return a*a},rand:function(b,a){return pc.Math.round(pc.Math.random()*(a-b)+b)},randFloat:function(b,a){return pc.Math.random()*(a-b)+b},rotate:function(b,a){var c=b+a;while(c>359){c-=359}while(c<0){c=359+c}return c},angleDiff:function(c,a,d){if(!d){var b=c-a;return b<0&&(b+=360),b}return a<c&&(a+=360),a-c},isClockwise:function(b,a){return b>a?Math.abs(b-a)<a+(360-b):b+(360-a)<Math.abs(a-b)},isFacingRight:function(a){return a>270||a<90?!0:!1},radToDeg:function(a){return a*pc.Math.RADIAN_TO_DEGREE},degToRad:function(a){return a*pc.Math.DEGREE_TO_RADIAN},angleFromVector:function(b,a){var c=pc.Math.radToDeg(Math.atan2(a,b));return c<0&&(c+=360),c},vectorFromAngle:function(b){var a=Math.cos(pc.Math.degToRad(b)),c=Math.sin(pc.Math.degToRad(b));return pc.Math.create(a,c)},isPointInRect:function(f,b,g,d,a,c){return f>=g&&f<=g+a&&b>=d&&b<=d+c},isRectInRect:function(g,c,k,f,b,d,h,a){return pc.Math.isPointInRect(g,c,b,d,h,a)?pc.Math.isPointInRect(g+k,c,b,d,h,a)?pc.Math.isPointInRect(g,c+f,b,d,h,a)?pc.Math.isPointInRect(g+k,c+f,b,d,h,a):!1:!1:!1},isRectColliding:function(g,c,k,f,b,d,h,a){return !(c+f<d||c>d+a||g+k<b||g>b+h)},limit:function(b,a,c){return b<a?a:b>c?c:b},limitAdd:function(c,a,d,b){return c+a<d?d:c+a>b?b:c+a}},{}),pc.Rect=pc.Pooled("pc.Rect",{create:function(d,b,f,c){var a=this._super();return a.x=d,a.y=b,a.w=f,a.h=c,a}},{x:0,y:0,w:0,h:0,containsRect:function(g,c,k,f,b,d,h,a){return pc.Math.isPointInRect(g,c,b,d,h,a)?pc.Math.isPointInRect(g+k,c,b,d,h,a)?pc.Math.isPointInRect(g,c+f,b,d,h,a)?pc.Math.isPointInRect(g+k,c+f,b,d,h,a):!1:!1:!1},containsPoint:function(a){return a.x>=this.x&&a.x<=this.x+this.w&&a.y>=this.y&&a.y<=this.y+this.h},overlaps:function(g,l,d,b,f){var m=d,c=b;if(pc.valid(f)&&f!=0){var k=Math.sin(pc.Math.degToRad(f)),h=Math.cos(pc.Math.degToRad(f));k<0&&(k=-k),h<0&&(h=-h),m=b*k+d*h,c=b*h+d*k}return !(this.y+this.h<l||this.y>l+c||this.x+this.w<g||this.x>g+m)},toString:function(){return this.x+" x "+this.y+" by "+this.w+" x "+this.h}}),pc.Point=pc.Pooled("pc.Point",{create:function(b,a){var c=this._super();return c.x=b,c.y=a,c}},{x:0,y:0,match:function(a){this.x=a.x,this.y=a.y},set:function(a){this.match(a)},setXY:function(b,a){return this.x=b,this.y=a,this},add:function(b,a){return this.x+=b,this.y+=a,this},subtract:function(b,a){return this.x-=b,this.y-=a,this},dirTo:function(f){var b=Math.abs(f.x-this.x),g=Math.abs(f.y-this.y);b==0&&(b=1),g==0&&(g=1);var d=g/b,a=Math.atan(d),c=pc.Math.radToDeg(a);return f.x<this.x?f.y<this.y?c+180:90-c+90:f.y<this.y?90-c+270:c},rotate:function(d,b){var f=$V([this.x,this.y]),c=$V([b.x,b.y]),a=f.rotate(pc.Math.degToRad(d),c);return this.x=a.elements[0],this.y=a.elements[1],this},moveInDir:function(b,a){return this.x+=a*Math.cos(pc.Math.degToRad(b)),this.y+=a*Math.sin(pc.Math.degToRad(b)),this},moveTowards:function(b,a){this.moveInDir(this.dirTo(b),a)},distance:function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))},toString:function(){return this.x+"x"+this.y}}),pc.Dim=pc.Point,pc.Vector=pc.Point,function(a){a.pc={}}(window),pc.VERSION="0.33",pc.JSLoader=function(){this.progress=0,this.canvasId=null,this.current=0,this.baseUrl="",this.started=!1,this.finished=!1,this._noCacheString="",this.gameClass=null,this.resources=[],this.setDisableCache=function(){this._noCacheString="?nocache="+Date.now()},this.setBaseUrl=function(a){this.baseUrl=a},this.makeUrl=function(a){return this.baseUrl+a+this._noCacheString},this.add=function(a){this.resources.push(this.makeUrl(a))},this.start=function(b,a){this.current=0,this.canvasId=b,this.gameClass=a,this.loadNextScript()},this.loadNextScript=function(){var b=this.resources[this.current],a=document.createElement("script");a.type="text/javascript",a.src=b,a.onload=this.checkAllDone.bind(this),a.onerror=function(){throw"Could not load javascript file: "+a.src},document.getElementsByTagName("head")[0].appendChild(a)},this.checkAllDone=function(){this.resources.length-1==this.current?(this.finished=!0,pc.device.boot(this.canvasId,this.gameClass)):(this.current++,this.loadNextScript())}},pc.start=function(f,b,g,d){var a=new pc.JSLoader;a.setBaseUrl("/playcraftjs/lib/"),a.add("ext/jquery171.js"),a.add("ext/gamecore.js/src/class.js"),a.add("ext/gamecore.js/src/gamecore.js"),a.add("ext/gamecore.js/src/jhashtable.js"),a.add("ext/gamecore.js/src/device.js"),a.add("ext/gamecore.js/src/perf.js"),a.add("ext/gamecore.js/src/linkedlist.js"),a.add("ext/gamecore.js/src/hashlist.js"),a.add("ext/gamecore.js/src/stacktrace.js"),a.add("ext/gamecore.js/src/pooled.js"),a.add("ext/base64.js"),a.add("ext/sylvester.js"),a.add("ext/box2dweb.2.1a-pc.js"),a.add("boot.js"),a.add("input.js"),a.add("hashmap.js"),a.add("tools.js"),a.add("color.js"),a.add("debug.js"),a.add("device.js"),a.add("sound.js"),a.add("layer.js"),a.add("entity.js"),a.add("sprite.js"),a.add("spritesheet.js"),a.add("math.js"),a.add("image.js"),a.add("scene.js"),a.add("game.js"),a.add("loader.js"),a.add("dataresource.js"),a.add("components/component.js"),a.add("components/physics.js"),a.add("components/alpha.js"),a.add("components/joint.js"),a.add("components/expiry.js"),a.add("components/originshifter.js"),a.add("components/debuginfo.js"),a.add("components/spatial.js"),a.add("components/overlay.js"),a.add("components/clip.js"),a.add("components/activator.js"),a.add("components/input.js"),a.add("components/fade.js"),a.add("components/drawing.js"),a.add("components/sprite.js"),a.add("components/layout.js"),a.add("components/particleemitter.js"),a.add("systems/system.js"),a.add("es/entitymanager.js"),a.add("es/systemmanager.js"),a.add("systems/entitysystem.js"),a.add("systems/physics.js"),a.add("systems/effects.js"),a.add("systems/particles.js"),a.add("systems/input.js"),a.add("systems/expiry.js"),a.add("systems/activation.js"),a.add("systems/render.js"),a.add("systems/layout.js"),a.setBaseUrl(g);for(var c=0;c<d.length;c++){a.add(d[c])}a.start(f,b)},pc.Scene=pc.Base.extend("pc.Scene",{},{name:null,layersByName:null,layers:null,activeLayers:null,paused:!1,active:!0,viewPort:null,viewPortCenter:null,offset:null,init:function(a){this._super(),this.name=a,this.layersByName=new pc.Hashtable,this.layers=new pc.LinkedList,this.activeLayers=new pc.LinkedList,this.offset=pc.Point.create(0,0),this.viewPort=pc.Rect.create(0,0,0,0),this.viewPortCenter=pc.Point.create(0,0),this.setViewPort(0,0,pc.device.canvasWidth,pc.device.canvasHeight),pc.device.started&&this.onReady()},onReady:function(){var a=this.layers.first;while(a){a.obj.onReady(),a=a.next()}},onActivated:function(){},onDeactivated:function(){},onResize:function(b,a){var c=this.layers.first;while(c){c.obj.onResize(b,a),c=c.next()}},setViewPort:function(c,a,d,b){this.viewPort.x=c,this.viewPort.y=a,this.viewPort.w=d,this.viewPort.h=b,this.viewPortCenter.x=this.viewPort.w/2,this.viewPortCenter.y=this.viewPort.h/2},getScreenRect:function(){return this.viewPort},sortLayers:function(){this.activeLayers.sort(function(b,a){return b.zIndex-a.zIndex})},onAction:function(b,a,c){},isActive:function(){return this.active},get:function(a){return this.layersByName.get(a)},addLayer:function(a){return this.layersByName.put(a.name,a),this.layers.add(a),this.activeLayers.add(a),a.active=!0,a.scene=this,a.onAddedToScene(),this.sortLayers(),a},removeLayer:function(a){this.layersByName.remove(a.name),this.layers.remove(a),this.activeLayers.remove(a),a.active=!1,a.scene=null,a.onRemovedFromScene()},setLayerActive:function(a){this.activeLayers.add(a),this.sortLayers(),a.active=!0},setLayerInactive:function(a){this.activeLayers.remove(a),a.active=!1},getFirstActiveLayer:function(){return this.activeLayers.first},getFirstLayer:function(){return this.layers.first},startTime:0,process:function(){var a=this.activeLayers.first;while(a){a.obj.paused||(a.obj.process(),this.startTime=Date.now(),a.obj.draw(),pc.device.lastDrawMS+=Date.now()-this.startTime),a=a.next()}},pause:function(){this.paused=!0;var a=this.activeLayers.first;while(a){a.obj.pause(),a=a.next()}},resume:function(){this.paused=!1;var a=this.activeLayers.first;while(a){a.obj.resume(),a=a.next()}},reset:function(){var a=this.layers.first;while(a){a.obj.reset(),a=a.next()}this.layers.clear(),this.activeLayers.clear()},entitiesUnderXY:function(c,a){var d=[],b=this.layers.first;while(b){d.push(b.obj.entitiesUnderXY(c,a)),b=b.next()}},loadFromTMX:function(aa,J){var Q=pc.device.parseXML(aa.data),M=Q.getElementsByTagName("map")[0],W=parseInt(M.getAttribute("tilewidth")),K=parseInt(M.getAttribute("tileheight")),P=Q.getElementsByTagName("tileset")[0],H=P.getAttribute("name"),ae=P.getAttribute("width"),Z=P.getAttribute("height"),U=pc.device.loader.get(H);pc.assert(U,"Unable to locate tile image resource: "+H+". It must match the tileset name in tiled.");var ac=pc.device.loader.get(H).resource,X=new pc.SpriteSheet({image:ac,frameWidth:W,frameHeight:K}),O=new pc.TileSet(X),ab=Q.getElementsByTagName("tile");for(var G=0;G<ab.length;G++){var R=ab[G],Y=parseInt(R.getAttribute("id"))+1,B=R.getElementsByTagName("properties")[0],ad=B.getElementsByTagName("property");for(var F=0;F<ad.length;F++){var I=ad[F],z=I.getAttribute("name"),D=I.getAttribute("value");O.addProperty(Y,z,D)}}var q=Q.getElementsByTagName("layer");for(var A=0;A<q.length;A++){pc.TileLayer.loadFromTMX(this,q[A],W,K,O)}var L=Q.getElementsByTagName("objectgroup");for(var V=0;V<L.length;V++){pc.EntityLayer.loadFromTMX(this,L[V],J)}}}),pc.Sound=pc.Base.extend("pc.Sound",{},{sounds:[],src:null,name:null,numLoaded:0,loaded:!1,errored:!1,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(g,c,k,f,b,d){this._super(),this.name=g,this.channels=f;var h=!1;for(var a=0;a<k.length;a++){if(pc.device.canPlay(k[a])){this.src=pc.device.loader.makeUrl(c+"."+k[a]),h=!0;break}}h?pc.device.loader.started&&this.load(b,d):this.errored=!0},pause:function(){if(!this.canPlay()){return}for(var b=0,a=this.sounds.length;b<a;b++){this.sounds[b].pause()}},stop:function(){if(!this.canPlay()){return}this.pause()},setVolume:function(b){if(!this.canPlay()){return}for(var a=0,c=this.sounds.length;a<c;a++){this.sounds[a].volume=b}},setPlayPosition:function(b){if(!this.canPlay()){return}for(var a=0,c=this.sounds.length;a<c;a++){this.sounds[a].currentTime=b}},load:function(c,a){this.onLoadCallback=c,this.onErrorCallback=a;if(this.loaded&&c){this.onLoadCallback(this);return}for(var d=0;d<this.channels;d++){var b=new Audio;b.preload="auto",b.addEventListener("canplaythrough",this.onLoad.bind(this),!1),b.addEventListener("error",this.onError.bind(this),!1),b.onerror=this.onError.bind(this),b.src=this.src,this.sounds.push(b),pc.device.isAppMobi&&this.onLoad(null)}},reload:function(){this.loaded=!1,this.errored=!1,this.load()},onLoad:function(a){this.numLoaded++,pc.device.isAppMobi||a.target.removeEventListener("canplaythrough",this.onLoad.bind(this),!1),this.numLoaded==this.channels&&(this.loaded=!0,this.errored=!1,this.onLoadCallback&&this.onLoadCallback(this))},onError:function(){this.errored=!0,this.loaded=!1,this.onErrorCallback&&this.onErrorCallback(this)},play:function(b){if(!this.canPlay()){return}for(var a=0,c=this.sounds.length;a<c;a++){if(this.sounds[a].paused||this.sounds[a].ended){return b&&(this.sounds[a].loop=!0),this.sounds[a].play(),this.sounds[a]}}this.warn(this.name+" - all channels are in use")},canPlay:function(){return this.loaded&&pc.device.soundEnabled&&!this.errored}}),pc.Sprite=pc.Pooled.extend("pc.Sprite",{create:function(b){var a=this._super();return a.config(b),a}},{currentFrame:0,currentAnim:null,spriteSheet:null,acDelta:0,animSpeedOffset:0,currentAnimName:null,alpha:1,scaleX:1,scaleY:1,active:!0,hold:!1,loopCount:0,compositeOperation:null,init:function(a){this._super(),this.config(a)},config:function(a){this.spriteSheet=pc.checked(a,null),this.spriteSheet&&this.reset()},reset:function(){this.currentFrame=0,this.alpha=1,this.loopCount=0,this.scaleX=1,this.scaleY=1,this.active=!0,this.hold=!1,this.spriteSheet.animations.size()>0?(this.currentAnim=this.spriteSheet.animations.get(this.spriteSheet.animations.keys()[0]),this.currentFrame=0):this.currentAnim=null},setSpriteSheet:function(a){this.spriteSheet=a,this.reset()},setScale:function(b,a){this.scaleX=b,this.scaleY=a},setCompositeOperation:function(a){this.compositeOperation=a},draw:function(c,a,d,b){this.alpha!=1&&(this.spriteSheet.alpha=this.alpha),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation(this.compositeOperation),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),this.spriteSheet.draw(c,this,a,d,b),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(1,1),this.alpha!=1&&(this.spriteSheet.alpha=1),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation("source-over")},drawFrame:function(f,b,g,d,a,c){this.alpha!=1&&(this.spriteSheet.alpha=this.alpha),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation(this.compositeOperation),this.spriteSheet.drawFrame(f,b,g,d,a,c),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(1,1),this.alpha!=1&&(this.spriteSheet.alpha=1),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation("source-over")},update:function(a){if(this.currentAnim==null||!this.active||this.hold){return}this.spriteSheet.update(this,a)},setAnimation:function(c,a,d){var b=pc.checked(d,!0);if(!b&&this.currentAnim.name===c){return}this.currentAnim=this.spriteSheet.animations.get(c),this.currentFrame=0,this.loopCount=0,this.active=!0,this.held=!1,this.animSpeedOffset=pc.checked(a,0),this.currentAnimName=c},setAnimationSpeedOffset:function(a){this.animSpeedOffset=a},setCurrentFrame:function(a){this.currentFrame=a},getAnimation:function(){return this.currentAnimName},setAlpha:function(a){this.alpha=a},addAlpha:function(a){this.alpha+=a,this.alpha>1&&(this.alpha=1)},subAlpha:function(a){this.alpha-=a,this.alpha<0&&(this.alpha=0)}}),pc.SpriteSheet=pc.Base.extend("pc.SpriteSheet",{},{image:null,frameWidth:0,frameHeight:0,framesWide:1,framesHigh:1,scaleX:1,scaleY:1,sourceX:0,sourceY:0,alpha:1,useRotation:!1,compositeOperation:null,totalFrames:0,animations:null,frameXPos:null,frameYPos:null,init:function(b){this._super();if(!pc.checked(b.image)){throw"No image supplied"}this.image=b.image,pc.valid(b.frameWidth)?this.frameWidth=b.frameWidth:pc.valid(b.framesWide)&&b.framesWide>0?this.frameWidth=this.image.width/b.framesWide:this.frameWidth=this.image.width,pc.valid(b.frameHeight)?this.frameHeight=b.frameHeight:pc.valid(b.framesHigh)&&b.framesHigh>0?this.frameHeight=this.image.height/b.framesHigh:this.frameHeight=this.image.height,this.framesWide=pc.checked(b.framesWide,this.image.width/this.frameWidth),this.framesHigh=pc.checked(b.framesHigh,this.image.height/this.frameHeight),this.scaleX=pc.checked(b.scaleX,1),this.scaleY=pc.checked(b.scaleY,1),this.sourceX=pc.checked(b.sourceX,0),this.sourceY=pc.checked(b.sourceY,0),this.alpha=pc.checked(b.alpha,1),this.useRotation=pc.checked(b.useRotation,!0),this.totalFrames=this.framesWide*this.framesHigh,this.animations=new pc.Hashtable,this.frameXPos=[];for(var a=0;a<this.framesWide;a++){this.frameXPos.push(a*this.frameWidth)}this.frameYPos=[];for(var c=0;c<this.framesHigh;c++){this.frameYPos.push(c*this.frameHeight)}},addAnimation:function(b){if(!pc.valid(b.name)){throw"Animation requires a name for reference"}b.frameX=pc.checked(b.frameX,0),b.frameY=pc.checked(b.frameY,0),b.directions=pc.checked(b.directions,1),b.time=pc.checked(b.time,1000),b.loops=pc.checked(b.loops,0),b.holdOnEnd=pc.checked(b.holdOnEnd,!1),b.dirAcross=pc.checked(b.dirAcross,!1),b.scaleX=pc.checked(b.scaleX,1),b.scaleY=pc.checked(b.scaleY,1),b.offsetX=pc.checked(b.offsetX,0),b.offsetY=pc.checked(b.offsetY,0),b.framesWide=pc.checked(b.framesWide,this.framesWide),b.framesHigh=pc.checked(b.framesHigh,this.framesHigh),b.frameCount=pc.checked(b.frameCount,this.framesWide*this.framesHigh),b.frameCount==0&&(b.frameCount=pc.checked(b.frameCount,this.framesWide*this.framesHigh));if(!pc.valid(b.frames)){var a=b.frameX+b.frameY*b.framesWide;b.frames=[];for(var c=a;c<a+b.frameCount;c++){b.frames.push([c%b.framesWide,Math.floor(c/b.framesWide)])}}b.frameRate=b.time/b.frames.length,b.degreesPerDir=360/b.directions,this.animations.put(b.name,b)},setAnimation:function(b,a,c){b.currentAnim=this.animations.get(a),b.currentAnim==null&&this.warn("attempt to set unknown animation ["+a+"]"),b.currentFrame=0,b.held=!1,b.animSpeedOffset=pc.checked(c,0)},hasAnimation:function(a){return this.animations.get(a)!=null},setScale:function(b,a){this.scaleX=b,this.scaleY=a},setCompositeOperation:function(a){this.compositeOperation=a},dirTmp:0,draw:function(f,b,h,d,a){if(!this.image.loaded||b==null||!b.active){return}(this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(this.scaleX,this.scaleY),b.alpha!=1&&(this.image.alpha=b.alpha),this.compositeOperation!=null&&this.image.setCompositeOperation(this.compositeOperation);if(b.currentAnim==null){(this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(this.scaleX,this.scaleY),this.image.draw(f,this.sourceX,this.sourceY,Math.round(h),Math.round(d),this.frameWidth,this.frameHeight,this.useRotation?a:0)}else{var c=0,g=0;(b.currentAnim.scaleX!=1||b.currentAnim.scaleY!=1||this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(b.currentAnim.scaleX*this.scaleX,b.currentAnim.scaleY*this.scaleY),this.useRotation?(c=b.currentAnim.frames[b.currentFrame][0],g=b.currentAnim.frames[b.currentFrame][1],this.image.draw(f,this.sourceX+this.frameXPos[c],this.sourceY+this.frameYPos[g],b.currentAnim.offsetX+pc.Math.round(h),b.currentAnim.offsetY+pc.Math.round(d),this.frameWidth,this.frameHeight,a)):(this.dirTmp=Math.round(a/b.currentAnim.degreesPerDir),this.dirTmp>b.currentAnim.directions-1&&(this.dirTmp=0),c=b.currentAnim.frames[b.currentFrame][1]+this.dirTmp,g=b.currentAnim.frames[b.currentFrame][0],b.currentAnim.directions==1&&(g=b.currentAnim.frames[b.currentFrame][1],c=b.currentAnim.frames[b.currentFrame][0]),this.image.draw(f,this.sourceX+this.frameXPos[c],this.sourceY+this.frameYPos[g],b.currentAnim.offsetX+pc.Math.round(h),b.currentAnim.offsetY+pc.Math.round(d),this.frameWidth,this.frameHeight),(b.currentAnim.scaleX!=1||b.currentAnim.scaleY!=1||this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(b.currentAnim.scaleX*this.scaleX,b.currentAnim.scaleY*this.scaleY))}(this.image.scaleX!=1||this.image.scaleY!=1)&&this.image.setScale(1,1),b.alpha!=1&&(this.image.alpha=1),this.compositeOperation!=null&&this.image.setCompositeOperation("source-over")},drawFrame:function(f,b,g,d,a,c){if(!this.image.loaded){return}this.alpha<1&&(f.globalAlpha=this.alpha),(this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(this.scaleX,this.scaleY),this.compositeOperation!=null&&this.image.setCompositeOperation(this.compositeOperation),this.image.draw(f,this.sourceX+this.frameXPos[b],this.sourceY+this.frameYPos[g],pc.Math.round(d),pc.Math.round(a),this.frameWidth,this.frameHeight,c),(this.image.scaleX!=1||this.image.scaleY!=1)&&this.image.setScale(1,1),this.alpha<1&&(f.globalAlpha=1),this.compositeOperation!=null&&this.image.setCompositeOperation("source-over")},drawAllFrames:function(d,b,f){for(var c=0;c<this.framesHigh;c++){for(var a=0;a<this.framesWide;a++){this.drawFrame(d,a,c,b+a*this.frameWidth,f+c*this.frameHeight)}}},update:function(b,a){if(b.currentAnim==null||!b.active||b.held){return}if(b.currentAnim.frames.length<=1){return}b.acDelta>b.currentAnim.frameRate+b.animSpeedOffset?(b.currentFrame++,b.currentFrame>=b.currentAnim.frames.length&&(b.loopCount++,b.currentAnim.loops&&b.loopCount>=b.currentAnim.loops&&(b.currentAnim.holdOnEnd?(b.held=!0,b.currentFrame&&b.currentFrame--):b.active=!1),b.held||(b.currentFrame=0)),b.acDelta-=b.currentAnim.frameRate):b.acDelta+=a},reset:function(){this.image=null,this.animations=null}}),pc.systems.Activation=pc.systems.EntitySystem.extend("pc.systems.Activation",{},{init:function(a){this._super(["activator"],a)},onEntityAdded:function(a){a.active=!1},process:function(f){var b=f.getComponent("activator");if(f.active&&b.stayActive){return}b._cacheLayer||(b.layer?b._cacheLayer=f.layer.scene.get(b.layer):b._cacheLayer=f.layer);var h=b._cacheLayer.getEntityManager().getTagged(b.tag);if(!h){return}var d=h.first;while(d){var a=f.getComponent("spatial"),c=d.object().getComponent("spatial"),g=a.getCenterPos().distance(c.getCenterPos());f.active?g>=b.range&&(f.active=!1):g<b.range&&(f.active=!0),d=d.next()}}}),pc.systems.Effects=pc.systems.EntitySystem.extend("pc.systems.Effects",{FadeState:{NOT_STARTED:0,DELAYING:1,FADING_IN:2,HOLDING:3,FADING_OUT:4,DONE:5}},{init:function(){this._super(["fade"])},processAll:function(){var c=this.entities.first;while(c){var a=c.obj;if(a.active){var d=a.getComponent("fade");if(d){var b=a.getComponent("alpha");b||(b=a.addComponent(pc.components.Alpha.create({}))),d.state!=this.Class.FadeState.DONE&&(this.fade(b,d)||a.removeComponent(d))}}c=c.next()}},fade:function(b,a){var c=pc.device.now-a.startTime;switch(a.state){case this.Class.FadeState.NOT_STARTED:a.startTime=pc.device.now,a.startDelay>0?(a.state=this.Class.FadeState.DELAYING,a.timeLimit=a.startDelay,b.setAlpha(0)):a.fadeInTime>0?(a.state=this.Class.FadeState.FADING_IN,a.timeLimit=a.fadeInTime,b.setAlpha(0)):a.holdTime>0?(a.state=this.Class.FadeState.HOLDING,a.timeLimit=a.holdTime):a.fadeOutTime>0&&(a.state=this.Class.FadeState.FADING_OUT,a.timeLimit=a.fadeOutTime);break;case this.Class.FadeState.DELAYING:c>a.timeLimit&&(a.timeLimit=a.fadeInTime,a.startTime=pc.device.now,a.state=this.Class.FadeState.FADING_IN);break;case this.Class.FadeState.FADING_IN:b.addAlpha(pc.device.elapsed*(100/a.timeLimit)/100),c>a.timeLimit&&(a.timeLimit=a.holdTime,a.startTime=pc.device.now,a.state=this.Class.FadeState.HOLDING);break;case this.Class.FadeState.HOLDING:c>a.timeLimit&&(a.timeLimit=a.fadeOutTime,a.startTime=pc.device.now,a.state=this.Class.FadeState.FADING_OUT);break;case this.Class.FadeState.FADING_OUT:if(c>a.timeLimit){a.loopsSoFar++;if(a.loops>1||a.loops==0){a.startTime=pc.device.now,a.timeLimit=a.fadeInTime,a.state=this.Class.FadeState.FADING_IN,a.timeLimit>0&&b.setAlpha(0)}if(a.loopsSoFar>=a.loops){return a.state=this.Class.FadeState.DONE,a.timeLimit>0&&b.setAlpha(0),!1}}else{b.subAlpha(pc.device.elapsed*(100/a.timeLimit)/100)}}return !0}}),pc.systems.EntitySystem=pc.systems.System.extend("pc.systems.EntitySystem",{},{componentTypes:null,entities:null,suicides:null,init:function(b,a){this._super(b,a),this.entities=new pc.LinkedList,this.suicides=new pc.LinkedList},addIfMatched:function(b){for(var a=0;a<this.componentTypes.length;a++){if(b.hasComponentOfType(this.componentTypes[a])){this.entities.add(b),this.onEntityAdded(b);return}}},add:function(a){if(this.entities.has(a)){return}this.entities.add(a),this.onEntityAdded(a)},remove:function(a){this.entities.remove(a)&&this.onEntityRemoved(a)},removeIfNotMatched:function(b){for(var a=0;a<this.componentTypes.length;a++){if(b.hasComponentOfType(this.componentTypes[a])){return}}this.remove(b)},processAll:function(){var a=this.entities.first;while(a){this.process(a.obj),a=a.next()}a=this.suicides.first;while(a){this.remove(a.obj),a=a.next()}this.suicides.clear()},process:function(a){},suicide:function(a){this.suicides.add(a)},onEntityAdded:function(a){},onEntityRemoved:function(a){},onComponentAdded:function(b,a){},onComponentRemoved:function(b,a){}}),pc.systems.Expiration=pc.systems.EntitySystem.extend("pc.systems.Expiration",{},{init:function(){this._super(["expiry"])},process:function(b){var a=b.getComponent("expiry");a.decrease(pc.device.elapsed),a.hasExpired()&&b.remove()}}),pc.systems.Input=pc.systems.EntitySystem.extend("pc.systems.Input",{},{init:function(){this._super(["input"])},process:function(d){var b=d.getComponent("input");if(!b._bound){for(var f=0;f<b.states.length;f++){var c=b.states[f][1];for(var a=0;a<c.length;a++){pc.device.input.bindState(d,b.states[f][0],c[a])}}b._bound=!0}},onAction:function(b,a){},isInputState:function(b,a){if(b.getComponent("input")._bound){return pc.device.input.isInputState(b,a)}}}),pc.systems.Layout=pc.systems.EntitySystem.extend("pc.systems.Layout",{},{margin:null,init:function(a){this._super(["layout"]),this.margin={},pc.checked(a)&&pc.checked(a.margin)?(this.margin.left=pc.checked(a.margin.left,0),this.margin.right=pc.checked(a.margin.right,0),this.margin.top=pc.checked(a.margin.top,0),this.margin.bottom=pc.checked(a.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0)},getAnchorLocation:function(b,a){if(b==="left"){if(a==="top"){return"top-left"}if(a==="middle"){return"middle-left"}if(a==="bottom"){return"bottom-left"}}if(b==="center"){if(a==="top"){return"top-center"}if(a==="middle"){return"middle-center"}if(a==="bottom"){return"bottom-center"}}if(b==="right"){if(a==="top"){return"top-right"}if(a==="middle"){return"middle-right"}if(a==="bottom"){return"bottom-right"}}},doLayout:function(){var x=new pc.HashList,B=this.entities.first;while(B){var k=B.obj,b=k.getComponent("spatial");b||k.addComponent(pc.components.Spatial({}));var q=k.getComponent("layout"),C=this.getAnchorLocation(q.horizontal,q.vertical);x.add(C,B.obj),B=B.next()}var g=x.hashtable.keys();for(var A=0;A<g.length;A++){var z=g[A],w=x.get(g[A]),m=this.getEntityDimensions(w),y=this.margin.left,v=this.margin.top;switch(z){case"top-left":break;case"middle-left":v+=this.layer.getScreenRect().h/2-m.y/2;break;case"bottom-left":v=this.layer.getScreenRect().h-m.y-this.margin.bottom;break;case"top-center":y+=this.layer.getScreenRect().w/2-m.x/2;break;case"middle-center":y+=this.layer.getScreenRect().w/2-m.x/2,v+=this.layer.getScreenRect().h/2-m.y/2;break;case"bottom-center":y=this.layer.getScreenRect().w/2-m.x/2-this.margin.bottom,v+=this.layer.getScreenRect().h-m.y;break;case"top-right":y+=this.layer.getScreenRect().w-m.x;break;case"middle-right":y+=this.layer.getScreenRect().w-m.x,v+=this.layer.getScreenRect().h/2-m.y/2;break;case"bottom-right":y+=this.layer.getScreenRect().w-m.x,v=this.layer.getScreenRect().h-m.y-this.margin.bottom}var d=w.first;while(d){k=d.obj,b=k.getComponent("spatial"),q=k.getComponent("layout"),v+=q.margin.top;switch(z){case"top-left":case"middle-left":case"bottom-left":y=q.margin.left+this.margin.left;break;case"top-center":case"middle-center":case"bottom-center":y=q.margin.left+this.layer.getScreenRect().w/2-b.dim.x/2;break;case"top-right":case"middle-right":case"bottom-right":y=this.layer.getScreenRect().w-b.dim.x-q.margin.right-this.margin.right}b.pos.x=y,b.pos.y=v,v+=b.dim.y+q.margin.bottom,d=d.next()}}},_entityDim:null,getEntityDimensions:function(c){this._entityDim||(this._entityDim=new pc.Dim),this._entityDim.x=0,this._entityDim.y=0;var a=c.first;while(a){var d=a.obj.getComponent("spatial"),b=a.obj.getComponent("layout");d&&(this._entityDim.x+=b.margin.left+d.dim.x+b.margin.right,this._entityDim.y+=b.margin.top+d.dim.y+b.margin.bottom),a=a.nextLinked}return this._entityDim},onResize:function(b,a){this.doLayout()},onEntityAdded:function(a){this._super(),this.doLayout()},onEntityRemoved:function(a){this._super(),this.doLayout()},onComponentAdded:function(b,a){this._super(),this.doLayout()}}),pc.systems.Particles=pc.systems.EntitySystem.extend("pc.systems.Particles",{},{init:function(){this._super(["emitter"])},_drawStartTime:0,process:function(k){if(!k.active){return}var p=k.getComponent("emitter"),d=k.getComponent("spatial");d||(d=k.addComponent(new pc.components.Spatial({})));if(p){if(!p.active){return}if(p.emitting&&Date.now()-p._lastEmitTime>p.delay&&(p.shots==0||p._shotCount<p.shots)){for(var b=0;b<p.burst;b++){var g=0;p.spriteSheet.animations.size()==0&&(g=pc.Math.rand(0,p.spriteSheet.framesHigh*p.spriteSheet.framesWide-1)),p._particles.add(pc._Particle.create(d.pos.x+p.offsetX+pc.Math.rand(-(p.rangeX/2),p.rangeX/2),d.pos.y+p.offsetY+pc.Math.rand(-(p.rangeY/2),p.rangeY/2),pc.Math.rotate(p.relativeAngle?d.dir:0,pc.Math.rand(p.angleMin,p.angleMax)),pc.Math.randFloat(p.thrustMin,p.thrustMax),pc.Math.randFloat(p.lifeMin,p.lifeMax),pc.Math.randFloat(p.spinMin,p.spinMax),pc.Math.randFloat(p.scaleXMin,p.scaleXMax),pc.Math.randFloat(p.scaleYMin,p.scaleYMax),p.fadeInTime,p.fadeOutTime,p.alphaMin,p.alphaMax,p.spriteSheet,p.compositeOperation,g))}p._lastEmitTime=Date.now(),p._shotCount++}var q=p._particles.first;while(q){var c=q.obj;pc.device.now-c.start>p.thrustTime&&(c.thrust=0);var m=c.thrust*Math.cos(pc.Math.degToRad(c.dir)),l=c.thrust*Math.sin(pc.Math.degToRad(c.dir));c.velX+=m*(pc.device.elapsed/1000)+p.gravityX,c.velY+=l*(pc.device.elapsed/1000)+p.gravityY,c.velX=pc.Math.limit(c.velX,-p.maxVelX,p.maxVelX),c.velY=pc.Math.limit(c.velY,-p.maxVelY,p.maxVelY),c.x+=c.velX,c.y+=c.velY,c.spin&&(c.rotation=pc.Math.rotate(c.rotation,c.spin*(pc.device.elapsed/1000)));if(c.scaleXRate!=0||c.scaleYRate!=0){c.scaleX+=c.scaleXRate*(pc.device.elapsed/1000),c.scaleY+=c.scaleYRate*(pc.device.elapsed/1000)}c.fadeState==0&&(c.sprite.addAlpha(pc.device.elapsed*(100/c.fadeInTime)/100),pc.device.now-c.fadeStateStart>c.fadeInTime&&(c.fadeState++,c.fadeStateStart=pc.device.now)),c.fadeState==1&&pc.device.now-c.fadeStateStart>c.holdTime&&(c.fadeState++,c.fadeStateStart=pc.device.now);if(c.fadeState==2&&c.fadeOutTime>0){var h=pc.device.elapsed*(100/c.fadeOutTime)/100;c.sprite.subAlpha(h)}(c.alphaMin!=1||c.alphaMax!=1)&&pc.device.now-c.lastAlpha>p.alphaDelay&&(c.sprite.setAlpha(pc.Math.rand(c.alphaMin,c.alphaMax)),c.lastAlpha=pc.device.now),this.drawStartTime=Date.now(),(c.scaleX!=1||c.scaleY!=1)&&p.spriteSheet.setScale(c.scaleX,c.scaleY),c.sprite.currentAnim?(c.sprite.draw(pc.device.ctx,c.x-k.layer.origin.x-k.layer.scene.viewPort.x,c.y-k.layer.origin.y-k.layer.scene.viewPort.y,c.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime,c.sprite.update(pc.device.elapsed)):(c.sprite.drawFrame(pc.device.ctx,c.frame%p.spriteSheet.framesWide,Math.floor(c.frame/p.spriteSheet.framesWide),c.x-k.layer.origin.x-k.layer.scene.viewPort.x,c.y-k.layer.origin.y-k.layer.scene.viewPort.y,p.rotateSprite?c.rotation:c.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime),q=q.next(),pc.device.now-c.start>c.lifetime&&(c.release(),p._particles.remove(c))}p.shots!=0&&p._particles.first==null&&p._shotCount>=p.shots&&(p.active=!1)}}}),pc._Particle=pc.Pooled.extend("pc._Particle",{create:function(z,F,m,b,w,G,k,E,C,y,q,B,x,g,A){var D=this._super();return D.x=z,D.y=F,D.dir=m,D.thrust=b,D.frame=A,D.lifetime=w,D.spin=G,D.scaleXRate=k,D.scaleYRate=E,D.sprite==null?D.sprite=pc.Sprite.create(x):D.sprite.setSpriteSheet(x),D.start=pc.device.now,D.fadeStart=0,D.velX=0,D.velY=0,D.rotation=0,D.alphaMin=q,D.alphaMax=B,D.lastAlpha=pc.device.now,D.scaleX=1,D.fadeInTime=C,D.fadeOutTime=y,D.scaleY=1,D.holdTime=D.lifetime-(D.fadeInTime+D.fadeOutTime),g?D.sprite.setCompositeOperation(g):D.sprite.setCompositeOperation("source-over"),D.fadeState=1,D.fadeStateStart=pc.device.now,D.fadeInTime>0?(D.fadeState=0,D.sprite.setAlpha(0)):D.sprite.setAlpha(1),D}},{x:0,y:0,dir:0,rotation:0,thrust:0,sprite:null,start:0,frame:0,fadeStart:0,velX:0,velY:0,spin:0,scaleXRate:0,scaleYRate:0,scaleX:1,scaleY:1,fadeInTime:0,fadeOutTime:0,fadeStateStart:0,holdTime:0,fadeState:1,alphaMin:1,alphaMax:1,lastAlpha:0}),pc.CollisionShape={RECT:0,CIRCLE:1,POLY:2},pc.BodyType={ENTITY:0,TILE:1},pc.systems.Physics=pc.systems.EntitySystem.extend("pc.systems.Physics",{SCALE:0.1,toP:function(a){return a*this.SCALE},fromP:function(a){return a/this.SCALE}},{world:null,gravity:null,debug:!1,debugDraw:null,init:function(c){this._super(["physics"]),c&&c.gravity?this.gravity=pc.Point.create(pc.checked(c.gravity.x,0),pc.checked(c.gravity.y,0)):this.gravity=pc.Point.create(0,0);var a=new Box2D.Common.Math.b2Vec2(this.gravity.x*this.Class.SCALE,this.gravity.y*this.Class.SCALE);this.world=new Box2D.Dynamics.b2World(a,!0),c&&pc.valid(c.tileCollisionMap)&&(pc.assert(pc.valid(c.tileCollisionMap.tileMap),"A tileMap is required for a tileCollisionMap"),this.addTileCollisionMap(c.tileCollisionMap.tileMap,pc.checked(c.tileCollisionMap.collisionGroup,0),pc.checked(c.tileCollisionMap.collisionCategory,0),pc.checked(c.tileCollisionMap.collisionMask,0)));var d=new Box2D.Dynamics.b2ContactListener;d.BeginContact=this._beginContactListener.bind(this),d.EndContact=this._endContactListener.bind(this),d.PostSolve=this._postSolveListener.bind(this),this.world.SetContactListener(d);var b=Box2D.Dynamics.b2DebugDraw;this.debugDraw=new b,this.debugDraw.SetSprite(pc.device.ctx),this.debugDraw.SetDrawScale(this.Class.SCALE*100),this.debugDraw.SetFillAlpha(0.3),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(b.e_shapeBit|b.e_jointBit|b.e_centerOfMassBit),c&&c.debug==1&&(this.debug=c.debug,this.setDebug(c.debug))},_beginContactListener:function(a){this.onCollisionStart(a.GetFixtureA().GetBody()._pc_bodyType,a.GetFixtureB().GetBody()._pc_bodyType,a.GetFixtureA().GetBody().GetUserData(),a.GetFixtureB().GetBody().GetUserData(),a.GetFixtureA()._pc_type,a.GetFixtureB()._pc_type,a)},_endContactListener:function(a){this.onCollisionEnd(a.GetFixtureA().GetBody()._pc_bodyType,a.GetFixtureB().GetBody()._pc_bodyType,a.GetFixtureA().GetBody().GetUserData(),a.GetFixtureB().GetBody().GetUserData(),a.GetFixtureA()._pc_type,a.GetFixtureB()._pc_type,a)},_postSolveListener:function(b,a){var c=a.normalImpulses[0];this.onCollision(b.GetFixtureA().GetBody()._pc_bodyType,b.GetFixtureB().GetBody()._pc_bodyType,b.GetFixtureA().GetBody().GetUserData(),b.GetFixtureB().GetBody().GetUserData(),c,b.GetFixtureA()._pc_type,b.GetFixtureB()._pc_type,b)},process:function(W){if(!W.active){return}var H=W.getComponent("spatial"),M=W.getComponent("physics"),J=W.getComponent("joint");if(!M._body){var Q=new Box2D.Dynamics.b2BodyDef;Q.type=M.immovable?Box2D.Dynamics.b2BodyDef.b2_staticBody:Q.type=Box2D.Dynamics.b2BodyDef.b2_dynamicBody,Q.position.x=this.Class.toP(H.pos.x+H.dim.x/2),Q.position.y=this.Class.toP(H.pos.y+H.dim.y/2),Q.linearDamping=M.linearDamping,Q.angularDamping=M.angularDamping,Q.isBullet=M.bullet,Q.fixedRotation=M.fixedRotation,M._body=this.world.CreateBody(Q),M._body.SetAngle(pc.Math.degToRad(H.dir)),M._body.SetUserData(W),M._body._pc_bodyType=pc.BodyType.ENTITY,M.gravity&&M.setGravity(M.gravity.x,M.gravity.y),pc.assert(M.shapes.length,"You must specify at least one shapes for a physics entity");for(var I=0;I<M.shapes.length;I++){var L=M.shapes[I],F=(H.dim.x+L.offset.w)*this.Class.SCALE,aa=(H.dim.y+L.offset.h)*this.Class.SCALE,V=F/2,P=aa/2,Y=L.offset.x*this.Class.SCALE/2,R=L.offset.y*this.Class.SCALE/2;pc.assert(V>0&&P>0,"Physics requires a spatial size minimum of 1");var K=new Box2D.Dynamics.b2FixtureDef;K.density=M.density,K.friction=M.friction,K.restitution=M.bounce;switch(L.shape){case pc.CollisionShape.CIRCLE:K.shape=new Box2D.Collision.Shapes.b2CircleShape(F/2),K.shape.SetLocalPosition(Box2D.Common.Math.b2Vec2.Get(L.offset.x*this.Class.SCALE,L.offset.y*this.Class.SCALE));break;case pc.CollisionShape.POLY:var X=[];for(var D=0;D<L.points.length;D++){X.push(new Box2D.Common.Math.b2Vec2((L.offset.x+L.points[D][0])*this.Class.SCALE,(L.offset.y+L.points[D][1])*this.Class.SCALE))}K.shape.SetAsArray(X,X.length);break;default:K.shape=new Box2D.Collision.Shapes.b2PolygonShape,X=[],X.push(Box2D.Common.Math.b2Vec2.Get(-V+Y,-P+R)),X.push(Box2D.Common.Math.b2Vec2.Get(V,-P+R)),X.push(Box2D.Common.Math.b2Vec2.Get(V,P)),X.push(Box2D.Common.Math.b2Vec2.Get(-V+Y,P)),K.shape.SetAsArray(X,X.length)}K.filter.groupIndex=L.collisionGroup,K.filter.categoryBits=L.collisionCategory,K.filter.maskBits=L.collisionMask,K.isSensor=L.sensorOnly;var O=M._body.CreateFixture(K);O._pc_type=L.type,M._fixtures.push(O)}if(M.centerOfMass.x!=0||M.centerOfMass.y!=0||M.mass!=-1){var U=new Box2D.Collision.Shapes.b2MassData;U.center=Box2D.Common.Math.b2Vec2.Get(M.centerOfMass.x*pc.systems.Physics.SCALE,M.centerOfMass.y*pc.systems.Physics.SCALE),M.mass!=-1&&(U.mass=M.mass),U.I=1,M._body.SetMassData(U)}else{U=new Box2D.Collision.Shapes.b2MassData,U.mass=1,U.I=1,M._body.SetMassData(U)}M.force&&M.applyForce(M.force),M.impulse&&M.applyImpulse(M.impulse),M.torque&&M.applyTorque(M.torque),M.turn&&M.applyTurn(M.turn)}if(J&&!J._joint){var A=J.attachTo.getComponent("physics");if(A._body){var Z=null;switch(J.type){case pc.JointType.WELD:Z=new Box2D.Dynamics.Joints.b2WeldJointDef,Z.bodyA=A._body,Z.bodyB=M._body,Z.collideConnected=!1,Z.localAnchorA.Set(J.offset.x*this.Class.SCALE,J.offset.y*this.Class.SCALE),Z.localAnchorB.Set(J.attachmentOffset.x*this.Class.SCALE,J.attachmentOffset.y*this.Class.SCALE),A._body.SetAwake(!0);var C=A._body.GetPosition();M._body.SetPosition({x:C.x+J.offset.x*this.Class.SCALE,y:C.y+J.offset.y*this.Class.SCALE});break;case pc.JointType.DISTANCE:Z=new Box2D.Dynamics.Joints.b2DistanceJointDef,Z.bodyA=A._body,Z.bodyB=M._body,Z.frequency=J.frequency,Z.dampingRatio=J.dampingRatio,Z.collideConnected=!1,Z.length=J.distance,Z.localAnchorA.Set(J.offset.x*this.Class.SCALE,J.offset.y*this.Class.SCALE),Z.localAnchorB.Set(J.attachmentOffset.x*this.Class.SCALE,J.attachmentOffset.y*this.Class.SCALE),A._body.SetAwake(!0),C=A._body.GetPosition(),M._body.SetPosition({x:C.x+J.offset.x*this.Class.SCALE,y:C.y+J.offset.y*this.Class.SCALE});break;case pc.JointType.REVOLUTE:Z=new Box2D.Dynamics.Joints.b2RevoluteJointDef,Z.bodyA=A._body,Z.bodyB=M._body,Z.collideConnected=!1,Z.referenceAngle=J.angle,Z.localAnchorA.Set(J.offset.x*this.Class.SCALE,J.offset.y*this.Class.SCALE),Z.localAnchorB.Set(J.attachmentOffset.x*this.Class.SCALE,J.attachmentOffset.y*this.Class.SCALE),A._body.SetAwake(!0),J.enableLimit&&(Z.enableLimit=J.enableLimit,Z.lowerAngle=pc.Math.degToRad(J.lowerAngleLimit),Z.upperAngle=pc.Math.degToRad(J.upperAngleLimit)),J.enableMotor&&(Z.enableMotor=J.enableMotor,Z.motorSpeed=pc.Math.degToRad(J.motorSpeed),Z.maxMotorTorque=J.maxMotorTorque);var G=A._body.GetPosition();M._body.SetPosition({x:G.x+this.Class.toP(J.offset.x),y:G.y+this.Class.toP(J.offset.y)})}if(!Z){throw"Invalid attachment config"}J._joint=this.world.CreateJoint(Z)}}var q=M._body.GetPosition();H.pos.x=this.Class.fromP(q.x)-H.dim.x/2,H.pos.y=this.Class.fromP(q.y)-H.dim.y/2,H.dir=pc.Math.radToDeg(M._body.GetAngle());if(M.maxSpeed.x>0||M.maxSpeed.y>0){var B=M._body.GetLinearVelocity();if(B.x!=0||B.y!=0){var k=this.Class.toP(M.maxSpeed.x);B.x>0&&B.x>k&&M._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(k,B.y)),B.x<0&&B.x<-k&&M._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(-k,B.y));var z=this.Class.toP(M.maxSpeed.y);B.y>0&&B.y>z&&M._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(B.x,z)),B.y<0&&B.y<-z&&M._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(B.x,-z))}}},onOriginChange:function(b,a){this.debugDraw.SetOrigin(b,a)},processAll:function(){this.world.Step(0.08,10,10),this.world.DrawDebugData(),this.world.ClearForces(),this._super()},onAddedToLayer:function(b){var a=new Box2D.Collision.b2AABB;a.lowerBound.Set(0,0),a.upperBound.Set(this.Class.toP(b.worldSize.x),this.Class.toP(b.worldSize.y))},setDebug:function(a){a?this.world.SetDebugDraw(this.debugDraw):this.world.SetDebugDraw(null),this.debug=a},getEntitiesInArea:function(b){var a=new Box2D.Collision.b2AABB,c=[];return a.lowerBound.Set(b.x,b.y),a.upperBound.Set(b.w,b.h),this.world.QueryAABB(function(d){return c.push(d.GetBody().GetUserData()),!0},a),c},createStaticBody:function(v,z,g,b,m,A,d){var y=this.Class.toP(g/2),x=this.Class.toP(b/2),q=new Box2D.Dynamics.b2FixtureDef,k=new Box2D.Dynamics.b2BodyDef;k.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,q.shape=new Box2D.Collision.Shapes.b2PolygonShape;var w=[];w.push(Box2D.Common.Math.b2Vec2.Get(-y,-x)),w.push(Box2D.Common.Math.b2Vec2.Get(y,-x)),w.push(Box2D.Common.Math.b2Vec2.Get(y,x)),w.push(Box2D.Common.Math.b2Vec2.Get(-y,x)),q.shape.SetAsArray(w,w.length),q.filter.groupIndex=m,q.filter.categoryBits=A,q.filter.maskBits=d,k.position.x=this.Class.toP(v)+y,k.position.y=this.Class.toP(z)+x;var p=this.world.CreateBody(k);p._pc_bodyType=pc.BodyType.TILE,p.CreateFixture(q)},addTileCollisionMap:function(g,c,k,f){for(var b=0;b<g.tilesHigh;b++){var d=0,h=0;for(var a=0;a<g.tilesWide;a++){g.tiles[b][a]>=0?h+=g.tileWidth:(h>0&&(this.createStaticBody(d,b*g.tileHeight,h,g.tileHeight,c,k,f),h=0),d=(a+1)*g.tileWidth)}}},onCollisionStart:function(f,b,h,d,a,c,g){},onCollision:function(g,c,k,f,b,d,h,a){},onCollisionEnd:function(f,b,h,d,a,c,g){},onEntityAdded:function(a){},onEntityRemoved:function(b){var a=b.getComponent("physics");if(a._body){this.world.DestroyBody(a._body);var c=b.getComponent("attachment");c&&this.world.DestroyJoint(c._joint)}},onComponentAdded:function(b,a){},onComponentRemoved:function(b,a){}}),pc.systems.Render=pc.systems.EntitySystem.extend("pc.systems.Render",{},{init:function(){this._super(["sprite","overlay","rect","text"])},processAll:function(){var K=Date.now(),x=this.entities.first;while(x){var D=x.obj;if(D.active){var A=D.getComponent("spatial"),G=D.getComponent("alpha"),z=D.getComponent("clip"),C=D.layer.screenX(A.pos.x),w=D.layer.screenY(A.pos.y);if(D.layer.scene.viewPort.overlaps(C,w,A.dim.x,A.dim.y,0,A.dir)){var O=pc.device.ctx;if(z){O.save(),O.beginPath();if(z.entity){var J=z.entity.getComponent("spatial");O.rect(D.layer.screenX(J.pos.x)+z.x,D.layer.screenY(J.pos.y)+z.y,J.dim.x+z.w,J.dim.y+z.h)}else{O.rect(D.layer.screenX(A.pos.x)+z.x,D.layer.screenY(A.pos.y)+z.y,z.w,z.h)}O.closePath(),O.clip()}var F=D.getComponent("originshifter");if(F){var M=A.pos.x-F._offsetX,H=A.pos.y-F._offsetY;F._offsetX=this.layer.origin.x*F.ratio,F._offsetY=this.layer.origin.y*F.ratio,A.pos.x=M+F._offsetX,A.pos.y=H+F._offsetY}var B=D.getComponent("sprite");B&&(B.sprite.update(pc.device.elapsed),G&&G.level!=1&&G.level!=0&&(B.sprite.alpha=G.level),B.sprite.draw(O,C+B.offset.x,w+B.offset.y,A.dir));var L=D.getComponent("overlay");L&&(L.sprite.update(pc.device.elapsed),G&&(L.sprite.alpha=G.level),L.sprite.draw(O,C,w,A.dir),L.decrease(pc.device.elapsed),L.hasExpired()&&D.removeComponent(L));var q=x.obj.getComponent("rect");q&&(O.save(),O.lineWidth=q.lineWidth,O.fillStyle=q.color.color,G&&(O.globalAlpha=G.level),q.strokeColor&&q.lineWidth&&(O.strokeStyle=q.strokeColor.color),O.translate(C+A.dim.x/2,w+A.dim.y/2),O.rotate(A.dir*(Math.PI/180)),q.cornerRadius>0?(O.beginPath(),O.moveTo(C+A.radius,w),O.lineTo(C+A.dim.x-A.radius,w),O.quadraticCurveTo(C+A.dim.x,w,C+A.dim.x,w+A.radius),O.lineTo(C+A.dim.x,w+A.dim.y-A.radius),O.quadraticCurveTo(C+A.dim.x,w+A.dim.y,C+A.dim.x-A.radius,w+A.dim.y),O.lineTo(C+A.radius,w+A.dim.y),O.quadraticCurveTo(C,w+A.dim.y,C,w+A.dim.y-A.radius),O.lineTo(C,w+A.radius),O.quadraticCurveTo(C,w,C+A.radius,w),O.closePath(),O.fill()):(O.fillRect(-A.dim.x/2,-A.dim.y/2,A.dim.x,A.dim.y),q.strokeColor&&q.lineWidth&&O.strokeRect(-A.dim.x/2,-A.dim.y/2,A.dim.x,A.dim.y)),G&&(O.globalAlpha=1),O.restore(),pc.device.elementsDrawn++);var E=D.getComponent("text");if(E){O.save();var I=0;G&&(O.globalAlpha=G.level),O.font=E._fontCache,O.lineWidth=E.lineWidth;for(var k=0;k<E.text.length;k++){E.color&&(O.fillStyle=E.color.color,O.fillText(E.text[k],C+E.offset.x,w+I+A.dim.y+E.offset.y)),E.strokeColor&&E.lineWidth&&(O.strokeStyle=E.strokeColor.color,O.strokeText(E.text[k],C+E.offset.x,w+I+A.dim.y+E.offset.y)),I+=E.fontHeight*1.1}G&&(O.globalAlpha=1),pc.device.elementsDrawn++,O.restore()}var N=x.obj.getComponent("debuginfo");N&&(O.save(),O.strokeStyle="#5f5",O.strokeRect(C,w,A.dim.x,A.dim.y),O.restore()),z&&O.restore()}}x=x.next()}pc.device.lastDrawMS+=Date.now()-K}}),pc.systems={},pc.systems.System=pc.Base.extend("pc.System",{},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(b,a){this._super(),this.delay=pc.checked(a,0);if(!b instanceof Array){throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system."}this.componentTypes=b},processAll:function(){},onResize:function(){},onOriginChange:function(b,a){},onAddedToLayer:function(a){},onRemovedFromLayer:function(a){}}),pc.Tools=pc.Base.extend("pc.Tools",{checked:function(b,a){return pc.valid(b)?b:a},isValid:function(a){return a!=null&&typeof a!="undefined"},assert:function(b,a){if(!b){throw a}},arrayRemove:function(b,a){for(var c=0;c<b.length;c++){b[c]==a&&b.splice(c,1)}},arrayExclusiveAdd:function(b,a){b.indexOf(a)==-1&&b.push(a)},xmlToJson:function(c,a){var d={toObj:function(m){var h={};if(m.nodeType==1){if(m.attributes.length){for(var l=0;l<m.attributes.length;l++){h[m.attributes[l].nodeName]=(m.attributes[l].nodeValue||"").toString()}}if(m.firstChild){var g=0,k=0,n=!1;for(var f=m.firstChild;f;f=f.nextSibling){f.nodeType==1?n=!0:f.nodeType==3&&f.nodeValue.match(/[^ \f\n\r\t\v]/)?g++:f.nodeType==4&&k++}if(n){if(g<2&&k<2){d.removeWhite(m);for(var f=m.firstChild;f;f=f.nextSibling){f.nodeType==3?h["#text"]=d.escape(f.nodeValue):f.nodeType==4?h["#cdata"]=d.escape(f.nodeValue):h[f.nodeName]?h[f.nodeName] instanceof Array?h[f.nodeName][h[f.nodeName].length]=d.toObj(f):h[f.nodeName]=[h[f.nodeName],d.toObj(f)]:h[f.nodeName]=d.toObj(f)}}else{m.attributes.length?h["#text"]=d.escape(d.innerXml(m)):h=d.escape(d.innerXml(m))}}else{if(g){m.attributes.length?h["#text"]=d.escape(d.innerXml(m)):h=d.escape(d.innerXml(m))}else{if(k){if(k>1){h=d.escape(d.innerXml(m))}else{for(var f=m.firstChild;f;f=f.nextSibling){h["#cdata"]=d.escape(f.nodeValue)}}}}}}!m.attributes.length&&!m.firstChild&&(h=null)}else{m.nodeType==9?h=d.toObj(m.documentElement):alert("unhandled node type: "+m.nodeType)}return h},toJson:function(n,k,m){var h=k?'"'+k+'"':"";if(n instanceof Array){for(var l=0,p=n.length;l<p;l++){n[l]=d.toJson(n[l],"",m+"	")}h+=(k?":[":"[")+(n.length>1?"\n"+m+"	"+n.join(",\n"+m+"	")+"\n"+m:n.join(""))+"]"}else{if(n==null){h+=(k&&":")+"null"}else{if(typeof n=="object"){var g=[];for(var f in n){g[g.length]=d.toJson(n[f],f,m+"	")}h+=(k?":{":"{")+(g.length>1?"\n"+m+"	"+g.join(",\n"+m+"	")+"\n"+m:g.join(""))+"}"}else{typeof n=="string"?h+=(k&&":")+'"'+n.toString()+'"':h+=(k&&":")+n.toString()}}}return h},innerXml:function(h){var f="";if("innerHTML" in h){f=h.innerHTML}else{var k=function(o){var m="";if(o.nodeType==1){m+="<"+o.nodeName;for(var n=0;n<o.attributes.length;n++){m+=" "+o.attributes[n].nodeName+'="'+(o.attributes[n].nodeValue||"").toString()+'"'}if(o.firstChild){m+=">";for(var l=o.firstChild;l;l=l.nextSibling){m+=k(l)}m+="</"+o.nodeName+">"}else{m+="/>"}}else{o.nodeType==3?m+=o.nodeValue:o.nodeType==4&&(m+="<![CDATA["+o.nodeValue+"]]>")}return m};for(var g=h.firstChild;g;g=g.nextSibling){f+=k(g)}}return f},escape:function(f){return f.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(h){h.normalize();for(var f=h.firstChild;f;){if(f.nodeType==3){if(!f.nodeValue.match(/[^ \f\n\r\t\v]/)){var g=f.nextSibling;h.removeChild(f),f=g}else{f=f.nextSibling}}else{f.nodeType==1?(d.removeWhite(f),f=f.nextSibling):f=f.nextSibling}}return h}};c.nodeType==9&&(c=c.documentElement);var b=d.toJson(d.toObj(d.removeWhite(c)),c.nodeName,"	");return"{\n"+a+(a?b.replace(/\t/g,a):b.replace(/\t|\n/g,""))+"\n}"}},{}),pc.tools=new pc.Tools,pc.valid=pc.Tools.isValid,pc.checked=pc.Tools.checked,pc.assert=pc.Tools.assert,pc.ui.BaseElement=pc.Element("pc.ui.BaseElement",{create:function(g,c,k,f,b,d,h){var a=this._super(g,f,b,0,d,h);return a.strokeColor=c,a.fillColor=k,a.fillColor!=null&&a.fillColor.length==3&&(a.fillColor[3]=0),a.strokeColor!=null&&a.strokeColor.length==3&&(a.strokeColor[3]=0),a._updateColorCache(),a}},{strokeColor:null,fillColor:null,alpha:0,strokeColorCache:null,fillColorCache:null,draw:function(b,a,c){this._super(b,a,c),this.strokeColor!=null&&(b.strokeStyle=this.strokeColorCache),this.fillColor!=null&&(b.fillStyle=this.fillColorCache)},setAlpha:function(a){this.alpha=a,this.strokeColor!=null&&(this.strokeColor[3]=a),this.fillColor!=null&&(this.fillColor[3]=a),this._updateColorCache()},addAlpha:function(a){this.alpha+=a,this.strokeColor!=null&&(this.strokeColor[3]+=a),this.fillColor!=null&&(this.fillColor[3]+=a),this._updateColorCache()},getAlpha:function(){return this.alpha},setFillColor:function(a){this.fillColor=a,this._updateColorCache()},setStrokeColor:function(a){this.strokeColor=a,this._updateColorCache()},_updateColorCache:function(){this.strokeColor!=null&&(this.strokeColorCache="rgba("+this.strokeColor[0]+","+this.strokeColor[1]+","+this.strokeColor[2]+","+this.strokeColor[3]+")"),this.fillColor!=null&&(this.fillColorCache="rgba("+this.fillColor[0]+","+this.fillColor[1]+","+this.fillColor[2]+","+this.fillColor[3]+")")}}),pc.ui.Text=pc.ui.BaseElement("pc.ui.Text",{create:function(k,p,d,b,g,q,c,m,l){var h=this._super(k,d,b,q,c,m,l);return h.label=p,h.font=g,h}},{label:null,font:null,strokeColorCache:null,fillColorCache:null,draw:function(b,a,c){b.save(),this._super(b,a,c),b.font=this.font,b.lineWidth=1,this.fillColor!=null&&b.fillText(this.label,this.pos.x+a,this.pos.y+this.dim.y+c),this.strokeColor!=null&&b.strokeText(this.label,this.pos.x+a,this.pos.y+this.dim.y+c),b.restore()}});