Wormhole=pc.Entity.extend("Wormhole",{create:function(b,a,d){var c=this._super(b,a,d,0,64,64,true);c.sprite.setAnimation("spinning",0);return c}},{init:function(){this._super();var a=pc.system.loader.get("wormhole").resource;var b=new pc.SpriteSheet(a,64,64);b.addAnimation("spinning",0,0,null,1000,0);this.setSprite(b)}});PlasmaWeave=pc.Entity.extend("PlasmaWeave",{create:function(b,a,d){var c=this._super(b,a,d,0,80,80,true);c.sprite.setAnimation("spinning",0);c.drawOffsetX=7;c.drawOffsetY=7;return c}},{init:function(){this._super();var a=pc.system.loader.get("plasma-weave").resource;var b=new pc.SpriteSheet(a,80,80);b.addAnimation("spinning",0,0,null,500,0);this.setSprite(b)}});BulletEntity=pc.Entity.extend("BulletEntity",{create:function(e,d,a,i,f,c,h,g){var b=this._super(e,i,f,c,12,12,true);b.velX=h;b.velY=g;b.incVel(8);b.setLifetime(3000);b.enemy=d;b.owner=a;if(d){b.sprite.setAnimation("red",0)}else{b.sprite.setAnimation("blue",0)}return b}},{enemy:false,owner:null,init:function(){this._super();var b=pc.system.loader.get("bullet").resource;var a=new pc.SpriteSheet(b,12,12);a.addAnimation("blue",0,0,[0,1,2],500,0);a.addAnimation("red",0,1,[0,1,2],500,0);this.setSprite(a)}});PulseBall=pc.Entity.extend("PulseBall",{create:function(e,d,a,i,f,c,h,g){var b=this._super(e,i,f,c,6,6,true);b.velX=h;b.velY=g;b.faceVel=true;b.incVel(8);b.setLifetime(3000);b.enemy=d;b.owner=a;return b}},{enemy:false,owner:null,init:function(){this._super();var a=pc.system.loader.get("pulseball").resource;var b=new pc.SpriteSheet(a,6,6);b.addAnimationWithDirections("floating",0,0,[0],1,0,0,true);this.setSprite(b)}});Torpedo=pc.Entity.extend("Torpedo",{create:function(e,d,a,i,f,c,h,g){var b=this._super(e,i,f,c,5,5,true);b.velX=h;b.velY=g;b.faceVel=true;b.incVel(8);b.setLifetime(3000);b.enemy=d;b.owner=a;b.drawOffsetX=13;b.drawOffsetY=13;return b}},{enemy:false,owner:null,init:function(){this._super();var a=pc.system.loader.get("big-bomb").resource;var b=new pc.SpriteSheet(a,30,30);b.addAnimationWithDirections("floating",0,0,null,1,400,0,true);this.setSprite(b)}});PowerupEntity=pc.Entity.extend("PowerupEntity",{total:0,createRandom:function(c){var b=pc.Math.rand(0,SpaceGame.WORLD_WIDTH);var a=pc.Math.rand(0,SpaceGame.WORLD_HEIGHT);this.create(c,b,a,pc.Math.rand(0,359))},create:function(c,a,e,b){var d=this._super(c,a,e,b,12,12,true);d.setVel(0.5);d.setLifetime(6*1000);this.total++;return d}},{enemy:false,init:function(){this._super();var a=pc.system.loader.get("powerup").resource;var b=new pc.SpriteSheet(a,12,12);b.addAnimation("red",0,2,null,900,0);this.setSprite(b)},onRelease:function(){this._super();this.Class.total--}});EnemyBase=pc.Entity.extend("EnemyBase",{FIRE_RATE:1000,STATE_LURKING:0,STATE_ACTIVE:1,STATE_EXPLODING:2,create:function(b,a,d){var c=this._super(b,a,d,0,48,48,true);c.wreckageEmitter=pc.Emitter.create(b,c.pos.x,c.pos.y,c.dir,1,1,3000,15,WreckageParticle);c.hp=100;c.shield=ShieldEffect48.create(b);c.shield.visible=false;c.state=this.STATE_LURKING;c.shieldStartTime=0;return c}},{lastFire:0,lastDirChange:0,state:0,enemy:true,wreckageEmitter:null,hp:0,explosionSound:null,shield:null,shieldHitSound:null,shieldStartTime:0,shieldTime:200,fireSound:null,init:function(){this._super();if(pc.system.soundEnabled){this.explosionSound=pc.system.loader.get("explosion").resource;this.explosionSound.setVolume(0.8);this.shieldHitSound=pc.system.loader.get("shield-hit2").resource;this.shieldHitSound.setVolume(0.3);this.fireSound=pc.system.loader.get("fire2").resource;this.fireSound.setVolume(0.05)}},release:function(){this._super();this.wreckageEmitter.release()},update:function(k){this._super(k);var c=theGame.gameScene.playerShip.pos.distance(this.pos);if(this.state==EnemyBase.STATE_LURKING){if(c<600){this.state=EnemyBase.STATE_ACTIVE}}if(this.shieldStartTime>0){var h=Date.now()-this.shieldStartTime;if(h>this.shieldTime){this.shield.visible=false;this.shieldStartTime=0}}if(this.shield.visible){this.shield.setPos(this.pos.x,this.pos.y)}if(this.state==EnemyBase.STATE_ACTIVE){var i=Date.now()-this.lastDirChange;if(i>50){var d=this.pos.dirTo(theGame.gameScene.playerShip.pos);var e=10;if(pc.Math.isClockwise(d,this.dir)){var b=pc.Math.angleDiff(d,this.dir,false);var g=pc.Math.angleDiff(d,this.dir+e,false);if(g<b){this.dir=pc.Math.rotate(this.dir,e);if(this.sprite.spriteSheet.hasAnimation("turning_right")){if(g>1){this.sprite.setAnimation("turning_right")}else{this.sprite.setAnimation("floating")}}}}else{var a=pc.Math.angleDiff(d,this.dir,true);var f=pc.Math.angleDiff(d,this.dir-e,true);if(f<a){this.dir=pc.Math.rotate(this.dir,-e);if(this.sprite.spriteSheet.hasAnimation("turning_left")){if(f>1){this.sprite.setAnimation("turning_left")}else{this.sprite.setAnimation("floating")}}}}this.lastDirChange=Date.now()}if(this.Class.FIRE_RATE>0){if(c<this.layer.scene.viewPortWidth&&Math.abs(this.dir-d)<20){if(Date.now()-this.lastFire>this.Class.FIRE_RATE){var j=pc.Point.create(this.pos.x+(this.dim.x/2),this.pos.y+(this.dim.y/2));j.moveInDir(this.dir,this.dim.x/2);BulletEntity.create(this.layer,true,this,j.x,j.y,this.dir,this.velX,this.velY);this.lastFire=Date.now();j.release();if(pc.system.soundEnabled){this.fireSound.play()}}}}}else{if(this.wreckageEmitter.emissions==1){this.suicide()}}},onCollisionStart:function(a){this._super(a);if(a.type==pc.Collision.ENTITY_TYPE&&!a.entity.enemy){if(a.entity.Class.fullName!="PowerupEntity"){if(a.entity.Class.fullName=="PulseBall"||a.entity.Class.fullName=="Torpedo"){this.hp-=25;this.shieldStartTime=Date.now();this.shield.visible=true;if(pc.system.soundEnabled){this.shieldHitSound.play()}a.entity.suicide()}if(this.hp<0){this.state=EnemyBase.STATE_EXPLODING;if(pc.system.soundEnabled){this.explosionSound.play()}this.thrust=0;this.setCollidable(false);this.wreckageEmitter.pos.x=this.pos.x;this.wreckageEmitter.pos.y=this.pos.y;this.wreckageEmitter.dir=this.dir;this.wreckageEmitter.setEmitting(true);this.shield.visible=false;this.shieldStartTime=0;if(a.entity.Class.fullName!="Gunstar"){PowerupEntity.create(this.layer,this.pos.x+12,this.pos.y+12,this.dir)}}}}}});EnemyTurret=EnemyBase.extend("EnemyTurret",{FIRE_RATE:500,create:function(b,a,d){var c=this._super(b,a,d);c.shield=ShieldEffect32.create(b);c.shield.visible=false;c.dim.x=32;c.dim.y=32;c.hp=100;return c}},{init:function(){this._super();var b=pc.system.loader.get("enemy-turret").resource;var a=new pc.SpriteSheet(b,32,32);a.addAnimationWithDirections("floating",0,0,[0],16,500,0);this.setSprite(a);this.sprite.setAnimation("floating")}});EnemyShip=EnemyBase.extend("EnemyShip",{FIRE_RATE:0,create:function(b,a,d){var c=this._super(b,a,d,0,48,48,true);c.setMaxVel(2,2);return c}},{init:function(){this._super();var b=pc.system.loader.get("enemy-ship").resource;var a=new pc.SpriteSheet(b,48,48);a.addAnimationWithDirections("floating",0,3,[0],16,500,0);a.addAnimationWithDirections("turning_left",0,4,[0],16,500,0);a.addAnimationWithDirections("turning_right",0,5,[0],16,500,0);this.setSprite(a);this.sprite.setAnimation("floating")},update:function(a){this._super(a);if(this.state==this.Class.STATE_ACTIVE){this.thrust=pc.Math.rand(2,6)}}});GunTurret=pc.Entity("GunTurret",{create:function(a){var b=this._super(a.layer,0,0,0,20,20,false);b.gunstar=a;return b}},{gunstar:null,fireSound:null,init:function(){this._super();var a=new pc.SpriteSheet(pc.system.loader.get("turret-small").resource,20,20);a.addAnimationWithDirections("floating",0,0,[0],16,0,0);this.setSprite(a);this.mousePos=pc.Point.create(0,0);if(pc.system.soundEnabled){this.fireSound=pc.system.loader.get("fire").resource;this.fireSound.setVolume(0.2)}},mousePos:null,update:function(a){this._super(a);this.setPos(this.gunstar.centerPos.x-10,this.gunstar.centerPos.y-10);if(!pc.system.isTouch&&this.isInputState("firing")){this.fire()}if(!pc.system.isTouch&&this.isInputState("firing2")){this.fire2()}},lastFireTime:0,fireDelay:100,fire:function(){var b=Date.now()-this.lastFireTime;if(b>this.fireDelay){if(pc.system.soundEnabled){this.fireSound.play()}var a=pc.Point.create(this.pos.x+6,this.pos.y+6);a.moveInDir(this.dir,5);PulseBall.create(this.layer,false,this,a.x,a.y,this.dir,this.velX,this.velY);a.release();this.lastFireTime=Date.now()}},lastFire2Time:0,fire2Delay:100,fire2:function(){var b=Date.now()-this.lastFire2Time;if(b>this.fire2Delay){if(pc.system.soundEnabled){this.fireSound.play()}var a=pc.Point.create(this.pos.x+12,this.pos.y+12);Torpedo.create(this.layer,false,this,a.x,a.y,this.dir,this.velX,this.velY);a.release();this.lastFire2Time=Date.now()}},onAction:function(a,c,d){if(a==="aiming"){var b=this.getScreenCenterPos();if(b!=null){this.dir=b.dirTo(d);b.release()}}}});ShieldEffect=pc.Element("ShieldEffect",{create:function(b,c,a){return this._super(b,0,0,0,c,a)},generate:function(f,c,i,h,a){var e=document.createElement("canvas");e.width=f;e.height=c;var d=e.getContext("2d");var j=d.createRadialGradient(f/2,c/2,0,f/2,f/2,f/2);j.addColorStop(0,"rgba("+i+","+h+","+a+",0.5)");j.addColorStop(1,"rgba("+i+","+h+","+a+",0.0)");d.fillStyle=j;d.fillRect(0,0,f,c);return new pc.SpriteSheet(new pc.CanvasImage(e))}},{init:function(){this._super()},draw:function(b,a,c){this._super(b,a,c)}});ShieldEffect80=ShieldEffect.extend("ShieldEffect80",{create:function(a){return this._super(a,80,80)}},{init:function(){this._super();var a=new pc.SpriteSheet(pc.system.loader.get("plasma-shield").resource,80,80);a.addAnimationWithDirections("floating",0,0,null,1,500,0);this.setSprite(a)}});ShieldEffect48=ShieldEffect.extend("ShieldEffect48",{create:function(a){return this._super(a,48,48)}},{init:function(){this._super();this.setSprite(ShieldEffect.generate(48,48,251,58,58))}});ShieldEffect32=ShieldEffect.extend("ShieldEffect32",{create:function(a){return this._super(a,32,32)}},{init:function(){this._super();this.setSprite(ShieldEffect.generate(32,32,251,58,58))}});Gunstar=pc.Entity("Gunstar",{STATE_FLYING:0,STATE_EXPLODING:1,STARTING_X:5*64,STARTING_Y:5*64,create:function(a){var b=this._super(a,this.STARTING_X,this.STARTING_Y,0,64,64,true);b.leftExhaust=pc.Emitter.create(a,b.pos.x,b.pos.y,180,1,1,20,1,ExhaustParticle);b.rightExhaust=pc.Emitter.create(a,b.pos.x,b.pos.y,0,1,1,20,1,ExhaustParticle);b.topExhaust=pc.Emitter.create(a,b.pos.x,b.pos.y,270,1,1,20,1,ExhaustParticle);b.bottomExhaust=pc.Emitter.create(a,b.pos.x,b.pos.y,90,1,1,20,1,ExhaustParticle);b.energy=1000;b.maxVelX=2;b.maxVelY=2;b.turret=GunTurret.create(b);b.shield=ShieldEffect80.create(a);b.shield.visible=false;return b}},{leftExhaust:null,rightExhaust:null,topExhaust:null,bottomExhaust:null,explodingSpriteSheet:null,shipSpriteSheet:null,enemy:false,maxEnergy:1000,energy:1000,state:0,turret:null,shield:null,shieldHitSound:null,init:function(){this._super();var b=pc.system.loader.get("gunstar").resource;this.shipSpriteSheet=new pc.SpriteSheet(b,64,64);this.shipSpriteSheet.addAnimationWithDirections("floating",0,0,[0],1,250,0);this.setSprite(this.shipSpriteSheet);if(pc.system.soundEnabled){this.shieldHitSound=pc.system.loader.get("shield-hit").resource;this.shieldHitSound.setVolume(0.3)}var a=pc.system.loader.get("big-explosions").resource;this.explodingSpriteSheet=new pc.SpriteSheet(a,64,64);this.explodingSpriteSheet.addAnimation("exploding",0,7,null,2500,1)},shieldStartTime:0,shieldTime:500,shakeStartTime:0,shakeTime:500,update:function(e){this._super(e);switch(this.state){case Gunstar.STATE_FLYING:this.energy+=e/100;if(this.energy>this.maxEnergy){this.energy=this.maxEnergy}if(this.energy<0){this.energy=0}if(this.shield.visible){this.shield.setPos(this.centerPos.x-(this.shield.dim.x/2),this.centerPos.y-(this.shield.dim.y/2))}var d=20;this.leftExhaust.setPos(this.centerPos.x-12-d,this.centerPos.y-12);this.leftExhaust.setEmitting(false);this.rightExhaust.setPos(this.centerPos.x-12+d,this.centerPos.y-12);this.rightExhaust.setEmitting(false);this.topExhaust.setPos(this.centerPos.x-12,this.centerPos.y-12-d);this.topExhaust.setEmitting(false);this.bottomExhaust.setPos(this.centerPos.x-12,this.centerPos.y-12+d);this.bottomExhaust.setEmitting(false);if(!pc.system.isTouch){this.thrust=0;if(this.isInputState("moving_left")){this.thrust=2;this.dir=180;this.rightExhaust.setEmitting(true);if(this.isInputState("moving_up")){this.dir=225}if(this.isInputState("moving_down")){this.dir=135}}else{if(this.isInputState("moving_right")){this.thrust=2;this.dir=0;this.leftExhaust.setEmitting(true);if(this.isInputState("moving_up")){this.dir=315}if(this.isInputState("moving_down")){this.dir=45}}else{if(this.isInputState("moving_up")){this.dir=270;this.thrust=2}if(this.isInputState("moving_down")){this.dir=90;this.thrust=2}}}if(this.isInputState("moving_up")){this.bottomExhaust.setEmitting(true)}if(this.isInputState("moving_down")){this.topExhaust.setEmitting(true)}}else{if(this.thrust>0){if(this.dir>=100&&this.dir<=260){this.rightExhaust.setEmitting(true)}if(this.dir>=10&&this.dir<=170){this.topExhaust.setEmitting(true)}if(this.dir>=280||this.dir<=80){this.leftExhaust.setEmitting(true)}if(this.dir>=190&&this.dir<=350){this.bottomExhaust.setEmitting(true)}}}break;case Gunstar.STATE_EXPLODING:if(this.sprite.loopCount==1){this.state=Gunstar.STATE_FLYING;this.setSprite(this.shipSpriteSheet);this.setPos(Gunstar.STARTING_X,Gunstar.STARTING_Y);this.thrust=0;this.velX=0;this.velY=0;this.energy=100;this.setCollidable(true);this.turret.setActive(true)}break}if(this.shieldStartTime>0){var c=Date.now()-this.shieldStartTime;if(c>this.shieldTime){this.shield.visible=false;this.shieldStartTime=0}}if(this.shakeStartTime>0){var b=Date.now()-this.shakeStartTime;if(b>this.shakeTime){theGame.gameScene.gameLayer.scene.offsetX=0;theGame.gameScene.gameLayer.scene.offsetY=0;this.shakeStartTime=0}else{var a=(this.shakeTime-b)/this.shakeTime;theGame.gameScene.gameLayer.scene.offsetX=pc.Math.rand(-8*a,8*a);theGame.gameScene.gameLayer.scene.offsetY=pc.Math.rand(-8*a,8*a)}}},onAddedToLayer:function(a){a.addElement(this.turret);a.addElement(this.shield);a.addElement(this.leftExhaust);a.addElement(this.rightExhaust);a.addElement(this.topExhaust);a.addElement(this.bottomExhaust)},onCollisionEnd:function(a){this._super(a)},onCollisionStart:function(a){this._super(a);if(this.state!=Gunstar.STATE_FLYING){return}if(a.type=pc.Collision.ENTITY_TYPE&&a.entity!=null&&a.entity.enemy){if(a.entity.Class.fullName=="EnemyShip"||a.entity.Class.fullName=="BulletEntity"){this.energy-=20;this.shieldStartTime=Date.now();this.shield.visible=true;if(pc.system.soundEnabled){this.shieldHitSound.play()}this.shakeStartTime=Date.now();a.entity.suicide()}else{if(a.entity.Class.fullName=="PowerupEntity"){this.energy=100;a.entity.suicide()}}}if(this.energy<0){this.shieldStartTime=0;this.shield.visible=false;this.state=Gunstar.STATE_EXPLODING;this.setCollidable(false);this.thrust=0;this.energy=this.maxEnergy;this.velX=0;this.velY=0;this.accelX=0;this.accelY=0;this.topExhaust.setEmitting(false);this.leftExhaust.setEmitting(false);this.rightExhaust.setEmitting(false);this.bottomExhaust.setEmitting(false);this.turret.setActive(false);this.setSprite(this.explodingSpriteSheet)}}});DamageParticle=pc.Entity("DamageParticle",{create:function(c,a,i,b,f,e){var h=pc.Math.rotate(b,pc.Math.rand(-120,120));var g=this._super(c,a,i,h,24,24,false);g.incVel(pc.Math.rand(2,4));g.setLifetime(3000);g.getSprite().reset();g.setCollidable(false);return g}},{init:function(){this._super();var a=pc.system.loader.get("small-explosions").resource;var b=new pc.SpriteSheet(a,24,24);b.addAnimationWithDirections("explode3",0,4,null,1,2000,1);this.setSprite(b)}});WreckageParticle=pc.Entity("WreckageParticle",{create:function(c,a,i,b,f,e){var h=pc.Math.rotate(b,pc.Math.rand(-120,120));var g=this._super(c,a,i,h,24,24,false);g.incVel(pc.Math.rand(1,2));g.setLifetime(5000);g.getSprite().reset();g.setCollidable(false);return g}},{init:function(){this._super();var a=pc.system.loader.get("small-explosions").resource;var b=new pc.SpriteSheet(a,24,24);b.addAnimationWithDirections("explode3",0,3,null,1,2000,1);this.setSprite(b)}});ExhaustParticle=pc.Entity("ExhaustParticle",{create:function(c,a,e,b){var d=this._super(c,a,e,b,24,24,false);d.incVel(1.5);d.setLifetime(200);d.setCollidable(false);return d}},{init:function(){this._super();var a=pc.system.loader.get("small-explosions").resource;var b=new pc.SpriteSheet(a,24,24);b.addAnimationWithDirections("explode3",0,3,null,1,100,1);this.setSprite(b)}});SpaceGame=pc.Game("SpaceGame",{LOADING:0,MENU:1,PLAYING:2},{menuScene:null,gameScene:null,starFieldLayer1:null,starFieldLayer2:null,starFieldLayer3:null,menuMusic:null,gameMusic:null,init:function(b,a){this._super(b,a)},onReady:function(){this._super();this.state=this.Class.LOADING;if(pc.system.isAppMobi){pc.system.loader.setBaseUrl("demos/starfrontier/")}else{pc.system.loader.setBaseUrl("/demos/starfrontier/")}pc.system.loader.setDisableCache();pc.system.loader.add(new pc.Image("player-ship","images/ship1.png"));pc.system.loader.add(new pc.Image("enemy-ship","images/enemy1.png"));pc.system.loader.add(new pc.Image("powerup","images/powerup.png"));pc.system.loader.add(new pc.Image("station","images/station32.png"));pc.system.loader.add(new pc.Image("bullet","images/bomb.png"));pc.system.loader.add(new pc.Image("pulseball","images/pulseballsimple.png"));pc.system.loader.add(new pc.Image("stars","images/stars.png"));pc.system.loader.add(new pc.Image("planet1","images/planet_01.png"));pc.system.loader.add(new pc.Image("planet2","images/planet_02.png"));pc.system.loader.add(new pc.Image("stars-dim","images/stars-dim.png"));pc.system.loader.add(new pc.Image("nebula-blobs","images/nebula-blobs.png"));pc.system.loader.add(new pc.Image("small-explosions","images/smallexplosions.png"));pc.system.loader.add(new pc.Image("big-explosions","images/explosions.png"));pc.system.loader.add(new pc.Image("gunstar","images/gunstar-small.png"));pc.system.loader.add(new pc.Image("turret-small","images/turret-small.png"));pc.system.loader.add(new pc.Image("enemy-turret","images/turret1.png"));pc.system.loader.add(new pc.Image("plasma-shield","images/plasmaballfront80.png"));pc.system.loader.add(new pc.Image("big-bomb","images/flareblue16.png"));pc.system.loader.add(new pc.Image("plasma-weave","images/plasmaweave16-dark.png"));pc.system.loader.add(new pc.Image("logo","images/logo.png"));pc.system.loader.add(new pc.Image("poweredby","images/poweredbyplaycraft.png"));if(pc.system.soundEnabled){pc.system.loader.add(new pc.Sound("fire","sounds/lowfire",["ogg","mp3"],10));pc.system.loader.add(new pc.Sound("fire2","sounds/shoot",["ogg","mp3"],10));pc.system.loader.add(new pc.Sound("explosion","sounds/explosion",["ogg","mp3"],3));pc.system.loader.add(new pc.Sound("athmo1","sounds/athmo1",["ogg","mp3"],1));pc.system.loader.add(new pc.Sound("music3","sounds/music3",["ogg","mp3"],1));pc.system.loader.add(new pc.Sound("shield-hit","sounds/shieldimpact",["ogg","mp3"],5));pc.system.loader.add(new pc.Sound("shield-hit2","sounds/shieldimpact2",["ogg","mp3"],5))}pc.system.loader.add(new pc.DataResource("level1","data/level1.tmx"));pc.system.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this))},onLoading:function(a){},onLoaded:function(a,b){this.starFieldLayer1=new StarFieldLayer(0,32*1000,32*1000);this.starFieldLayer2=new StarFieldLayer(1,32*1000,32*1000);this.starFieldLayer3=new StarFieldLayer(2,32*1000,32*1000);this.state=this.Class.PLAYING;if(pc.system.soundEnabled){this.menuMusic=pc.system.loader.get("music3").resource;this.menuMusic.setVolume(0.7);this.gameMusic=pc.system.loader.get("athmo1").resource;this.gameMusic.setVolume(0.7)}this.startMenu()},startMenu:function(){if(this.gameScene){this.deactivateScene(this.gameScene)}if(this.menuScene==null){this.menuScene=new MenuScene();this.addScene(this.menuScene)}else{this.activateScene(this.menuScene)}if(pc.system.soundEnabled){this.gameMusic.stop();this.menuMusic.play(true)}},startGame:function(){if(pc.system.soundEnabled){this.menuMusic.stop();this.gameMusic.play(true)}this.deactivateScene(this.menuScene);if(this.gameScene){this.activateScene(this.gameScene)}else{this.gameScene=new GameScene();this.addScene(this.gameScene)}}});var theGame=new SpaceGame("gameCanvas",30);ControlsLayer=pc.ElementLayer("ControlsLayer",{},{bcs:60,CONTROL_STYLE:"rgba(200, 200, 200, 0.1)",init:function(){this._super("ui",false)},onAddedToScene:function(){this._super();this.bcs*=pc.system.pixelRatio;EnergyBar.create(this,10*pc.system.pixelRatio,10,0,(this.scene.viewPortWidth/6)+6,19);if(pc.system.isTouch){DirControlButton.create(this,10,this.scene.viewPortHeight-(this.bcs*2)-10,0,this.bcs*2,this.bcs*2);FireControlButton.create(this,this.scene.viewPortWidth-(this.bcs*2)-10,this.scene.viewPortHeight-(this.bcs*2)-10,0,this.bcs*2,this.bcs*2)}},onResize:function(b,a){},draw:function(b,a,c){this._super(b,a,c)}});PosControlButton=pc.UIElement("PosControlButton",{},{clickPos:null,init:function(){this._super();theGame.gameScene.input.bindState(this,"pressed","MOUSE_LEFT_BUTTON",this);theGame.gameScene.input.bindState(this,"pressed","TOUCH",this);this.clickPos=pc.Point.create(0,0)},draw:function(c,b,f){var a=this.pos.x-b;var e=this.pos.y-f;var d=this.dim.x;c.fillStyle=this.layer.CONTROL_STYLE;c.beginPath();c.arc(a+(d/2),e+(d/2),d/2,0,pc.Math.PI*2,true);c.closePath();c.fill();c.beginPath();c.arc(a+(d/2),e+(d/2),d/3,0,pc.Math.PI*2,true);c.closePath();c.fill()},update:function(b){this._super(b);var a=this.getInputState("pressed");if(a.on){pc.Input.getEventPosition(a.event,this.clickPos)}this.handleState(a.on,this.clickPos)},handleState:function(a,b){}});DirControlButton=PosControlButton.extend("DirControlButton",{},{handleState:function(a,b){if(a){theGame.gameScene.playerShip.dir=this.centerPos.dirTo(b);theGame.gameScene.playerShip.thrust=2}else{theGame.gameScene.playerShip.thrust=0}}});FireControlButton=PosControlButton.extend("FireControlButton",{},{handleState:function(a,b){if(a){alert("firing");theGame.gameScene.playerShip.turret.dir=this.centerPos.dirTo(b);theGame.gameScene.playerShip.turret.fire()}}});EnergyBar=pc.UIElement("EnergyBar",{},{draw:function(c,b,h){this._super(c,b,h);c.save();var d="#44bb44";if(theGame.gameScene.playerShip.energy<25){d="#dd4444"}var a="#333333";var f=this.dim.x;var e=theGame.gameScene.playerShip.energy/theGame.gameScene.playerShip.maxEnergy;var g=f*e;c.fillStyle=a;c.fillRect(this.pos.x+5-b,this.pos.y+5-h,f+6,this.dim.y);c.fillStyle=d;c.fillRect(this.pos.x+5+3-b,this.pos.y+3+5-h,g,this.dim.y-6);c.restore()}});FireButton=pc.UIElement("FireButton",{},{init:function(){this._super();theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"firing","MOUSE_LEFT_BUTTON",this);theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"firing","TOUCH",this)},draw:function(c,b,f){var a=this.pos.x-b;var e=this.pos.y-f;var d=this.dim.x;c.fillStyle=this.layer.CONTROL_STYLE;c.beginPath();c.arc(a+(d/2),e+(d/2),d/2,0,Math.PI*2,true);c.closePath();c.fill();c.beginPath();c.arc(a+(d/2),e+(d/2),d/3,0,Math.PI*2,true);c.closePath();c.fill()}});TurnLeftArrow=pc.UIElement("TurnLeftArrow",{},{init:function(){this._super();theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"turning_left","MOUSE_LEFT_BUTTON",this);theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"turning_left","TOUCH",this)},draw:function(d,c,g){var b=this.pos.x-c;var f=this.pos.y-g;var e=this.dim.x;var a=this.dim.y;d.fillStyle=this.layer.CONTROL_STYLE;d.beginPath();d.moveTo(b,f+(a/2));d.lineTo(b+e,f);d.lineTo(b+e,f+a);d.lineTo(b,f+(a/2));d.fill();d.closePath()}});TurnRightArrow=pc.UIElement("TurnRightArrow",{},{init:function(){this._super();theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"turning_right","MOUSE_LEFT_BUTTON",this);theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"turning_right","TOUCH",this)},draw:function(d,c,g){var b=this.pos.x-c;var f=this.pos.y-g;var e=this.dim.x;var a=this.dim.y;d.fillStyle=this.layer.CONTROL_STYLE;d.beginPath();d.moveTo(b,f);d.lineTo(b+e,f+(a/2));d.lineTo(b,f+a);d.lineTo(b,f);d.fill();d.closePath()}});ForwardArrow=pc.UIElement("ForwardArrow",{},{init:function(){this._super();theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"forward_thrusting","MOUSE_LEFT_BUTTON",this);theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"forward_thrusting","TOUCH",this)},draw:function(d,c,g){var b=this.pos.x-c;var f=this.pos.y-g;var e=this.dim.x;var a=this.dim.y;d.fillStyle=this.layer.CONTROL_STYLE;d.beginPath();d.moveTo(b+(e/2),f);d.lineTo(b+(e),f+a);d.lineTo(b,f+a);d.lineTo(b+(e/2),f);d.fill();d.closePath()}});ReverseArrow=pc.UIElement("ReverseArrow",{},{init:function(){this._super();theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"backward_thrusting","MOUSE_LEFT_BUTTON",this);theGame.gameScene.input.bindState(theGame.gameScene.playerShip,"backward_thrusting","TOUCH",this)},draw:function(d,c,g){var b=this.pos.x-c;var f=this.pos.y-g;var e=this.dim.x;var a=this.dim.y;d.fillStyle=this.layer.CONTROL_STYLE;d.beginPath();d.moveTo(b,f);d.lineTo(b+(e),f);d.lineTo(b+(e/2),f+a);d.lineTo(b,f);d.fill();d.closePath()}});MenuScene=pc.Scene("MenuScene",{},{starFieldLayer:null,menuLayer:null,init:function(){this._super("menu");this.starFieldLayer1=theGame.starFieldLayer1;this.addLayer(this.starFieldLayer1);this.starFieldLayer2=theGame.starFieldLayer2;this.addLayer(this.starFieldLayer2);this.starFieldLayer3=theGame.starFieldLayer3;this.addLayer(this.starFieldLayer3);this.menuLayer=new MenuLayer();this.addLayer(this.menuLayer)},update:function(a){this._super(a);this.starFieldLayer1.origin.x+=0.25;this.starFieldLayer1.origin.y+=0.25;this.starFieldLayer2.origin.x+=0.5;this.starFieldLayer2.origin.y+=0.5;this.starFieldLayer3.origin.x+=1;this.starFieldLayer3.origin.y+=1}});MenuLayer=pc.ElementLayer("MenuLayer",{},{showingTitle:true,menuOptions:["Continue","New Game","Leaders","Options"],menuElements:[],faders:[],MENU_CONTINUE:0,MENU_NEW_GAME:1,MENU_LEADERS:2,MENU_OPTIONS:3,current:0,menuY:0,menuX:0,fader:null,init:function(){this._super("menu")},onAddedToScene:function(){this.menuY=220+(this.scene.viewPortHeight/8);var e=pc.Element.create(this,this.scene.viewPortWidth/15-10,this.menuY-180,0,388,100);e.setSprite(new pc.SpriteSheet(pc.system.loader.get("logo").resource,388,100));var a=pc.Element.create(this,this.scene.viewPortWidth-410,this.scene.viewPortHeight-109,0,350,79);a.setSprite(new pc.SpriteSheet(pc.system.loader.get("poweredby").resource,350,79));pc.TextElement.create(this,"Version 1.03",[70,70,70,1],[70,70,70,1],"13pt Calibri",this.scene.viewPortWidth/15,this.scene.viewPortHeight-80,200,20);pc.TextElement.create(this,"Copyright 2012 Playcraft Labs, Inc.",[70,70,70,1],[70,70,70,1],"13pt Calibri",this.scene.viewPortWidth/15,this.scene.viewPortHeight-60,200,20);pc.TextElement.create(this,"All rights reserved.",[70,70,70,1],[70,70,70,1],"13pt Calibri",this.scene.viewPortWidth/15,this.scene.viewPortHeight-40,200,20);pc.TextElement.create(this,"Code: Martin Wells   Art: Colin Pyle   Level Design: Blake Wells",[70,70,70,1],[70,70,70,1],"13pt Calibri",this.scene.viewPortWidth/15,this.scene.viewPortHeight-20,200,20);for(var b=0;b<this.menuOptions.length;b++){var c=pc.TextElement.create(this,this.menuOptions[b],[100,100,100,1],[100,100,100,1],"35pt Calibri",this.scene.viewPortWidth/10,this.menuY+(b*50),200,50);this.menuElements.push(c);pc.system.input.bindAction(c,"execute-"+this.menuOptions[b],"MOUSE_LEFT_BUTTON");pc.system.input.bindAction(c,"execute-"+this.menuOptions[b],"TOUCH");var d=pc.FadeEffect.create(500,100,500,999);d.active=false;c.add(d);this.faders.push(d)}this.current=1;this.menuElements[this.current].setFillColor([255,255,255,1]);this.faders[this.current].reset();this.faders[this.current].active=true;if(!pc.system.isTouch){pc.system.input.bindAction(this,"up","UP");pc.system.input.bindAction(this,"down","DOWN");pc.system.input.bindAction(this,"execute","ENTER");pc.system.input.bindAction(this,"execute","SPACE")}},onAction:function(a,b,c){if(a=="execute"){switch(this.current){case this.MENU_CONTINUE:break;case this.MENU_NEW_GAME:theGame.startGame();break;case this.MENU_LEADERS:break;case this.MENU_OPTIONS:break}}if(a=="down"||a=="up"){this.faders[this.current].active=false;this.faders[this.current].element.setAlpha(1);this.menuElements[this.current].setFillColor([150,150,150,1]);if(a=="down"){this.current++}if(a=="up"){this.current--}if(this.current>this.menuOptions.length-1){this.current=0}if(this.current<0){this.current=this.menuOptions.length-1}this.menuElements[this.current].setFillColor([255,255,255,1]);this.faders[this.current].reset();this.faders[this.current].active=true}}});RadarLayer=pc.Layer("RadarLayer",{},{mapCanvas:null,tileLayer:null,entityLayer:null,mapSize:null,init:function(b,a){this._super("radar");this.tileLayer=b;this.entityLayer=a;if(pc.valid(b)&&pc.valid(a)){this.setLayers(b,a)}},setLayers:function(g,f){this.tileLayer=g;this.entityLayer=f;this.mapSize=pc.Dim.create(0,0);var d=Math.floor(pc.system.screen.x/8);var e=Math.floor(pc.system.screen.y/8);if(d>this.tileLayer.tilesWide){d=this.tileLayer.tilesWide}if(e>this.tileLayer.tilesHigh){e=this.tileLayer.tilesHigh}this.mapSize.x=d;this.mapSize.y=e;this.mapCanvas=document.createElement("canvas");this.mapCanvas.width=g.tilesWide;this.mapCanvas.height=g.tilesHigh;var c=this.mapCanvas.getContext("2d");c.fillStyle="rgb(0,0,0)";c.fillRect(0,0,this.mapCanvas.width,this.mapCanvas.height);c.fillStyle="#777777";for(var a=0;a<g.tilesHigh;a++){for(var b=0;b<g.tilesWide;b++){if(g.tileMap[a][b]>=0){c.fillRect(b,a,1,1)}}}},lastBlinkTime:0,blinkDelay:300,blinkOn:true,update:function(b){var a=Date.now()-this.lastBlinkTime;if(a>this.blinkDelay){this.blinkOn=!this.blinkOn;this.lastBlinkTime=Date.now()}},draw:function(o,i,h,l,e){if(this.tileLayer==null||this.entityLayer==null){return}var m=l-this.mapSize.x-16;var j=10;var b=Math.floor(theGame.gameScene.playerShip.pos.x/this.tileLayer.tileWidth);var a=Math.floor(theGame.gameScene.playerShip.pos.y/this.tileLayer.tileHeight);var n=Math.floor(b-(this.mapSize.x/2));var k=Math.floor(a-(this.mapSize.y/2));if(n<0){n=0}if(k<0){k=0}if(n+this.size>this.tileLayer.tilesWide){n=this.tileLayer.tilesWide-this.mapSize.x}if(k+this.size>this.tileLayer.tilesHigh){k=this.tileLayer.tilesHigh-this.mapSize.y}o.strokeStyle="rgb(80,80,80)";o.strokeRect(m,j,this.mapSize.x+4,this.mapSize.y+4);o.drawImage(this.mapCanvas,n,k,this.mapSize.x,this.mapSize.y,m+2,j+2,this.mapSize.x,this.mapSize.y);if(this.blinkOn){o.fillStyle="#ffdb14";o.fillRect(m+b-n-0.1,j+a-k-0.1,3,3)}var f=this.entityLayer.collidableEntities.first;while(f){if(f.obj.Class.fullName=="EnemyShip"||f.obj.Class.fullName=="PowerupEntity"){var g=2;if(f.obj.Class.fullName=="EnemyShip"){o.fillStyle="#ff3838";g=3}else{if(this.blinkOn){o.fillStyle="#63c003"}else{o.fillStyle="#3f7c01"}}var d=Math.floor(f.obj.pos.x/this.tileLayer.tileWidth);var c=Math.floor(f.obj.pos.y/this.tileLayer.tileHeight);if(d>=n&&c>=k&&d<n+this.mapSize.x&&c<k+this.mapSize.y){o.fillRect(m+d-n-0.1,j+c-k-0.1,g,g)}}f=f.nextLinked}}});GameScene=pc.Scene("GameScene",{},{gameLayer:null,playerShip:null,energyBarLayer:null,spaceStationLayer:null,radarLayer:null,state:0,originTarget:null,starFieldLayer1:null,starFieldLayer2:null,starFieldLayer3:null,uiLayer:null,level:1,init:function(){this._super("game")},onReady:function(){this.starFieldLayer1=theGame.starFieldLayer1;this.starFieldLayer2=theGame.starFieldLayer2;this.starFieldLayer3=theGame.starFieldLayer3;this.addLayer(this.starFieldLayer1);this.addLayer(this.starFieldLayer2);this.addLayer(this.starFieldLayer3);this.planetLayer=new PlanetLayer();this.addLayer(this.planetLayer);this.playerShip=Gunstar.create();if(!pc.system.isTouch){pc.system.input.bindState(this.playerShip,"moving_right","RIGHT");pc.system.input.bindState(this.playerShip,"moving_right","D");pc.system.input.bindState(this.playerShip,"moving_left","LEFT");pc.system.input.bindState(this.playerShip,"moving_left","A");pc.system.input.bindState(this.playerShip,"moving_up","UP");pc.system.input.bindState(this.playerShip,"moving_up","W");pc.system.input.bindState(this.playerShip,"moving_down","DOWN");pc.system.input.bindState(this.playerShip,"moving_down","S");pc.system.input.bindState(this.playerShip.turret,"firing2","MOUSE_LEFT_BUTTON");pc.system.input.bindAction(this,"aiming","MOUSE_MOVE");pc.system.input.bindState(this.playerShip.turret,"firing","SPACE");pc.system.input.bindAction(this,"escape","ESC");pc.system.input.bindAction(this,"toggleCollisions","T");pc.system.input.bindAction(this,"toggleDebugGrid","G");pc.system.input.bindAction(this,"toggleSound","M");pc.system.input.bindAction(this,"togglePause","P")}else{}this.uiLayer=new ControlsLayer();this.addLayer(this.uiLayer);this.radarLayer=new RadarLayer();this.addLayer(this.radarLayer);this.startLevel(1)},startLevel:function(c){this.level=c;this.loadFromTMX(pc.system.loader.get("level"+this.level).resource);this.spaceStationLayer=this.get("station");this.gameLayer=this.get("Object Layer 1");this.spaceStationLayer.origin=this.gameLayer.origin;this.gameLayer.addElement(this.playerShip);this.radarLayer.setLayers(this.spaceStationLayer,this.gameLayer);var b=pc.TextElement.create(this.uiLayer,"Level "+this.level,[0,0,0],[200,200,200],"30pt Calibri",(this.viewPortWidth/20),this.viewPortHeight/2);b.add(pc.FadeEffect.create(4000,1000,4000));b.setLifetime(10000);var a=pc.TextElement.create(this.uiLayer,"Discovery",[0,0,0],[120,120,120],"30pt Calibri",(this.viewPortWidth/20),(this.viewPortHeight/2)+30);a.add(pc.FadeEffect.create(4000,1000,4000));a.setLifetime(10000)},onAction:function(a,b,c){if(a==="aiming"){this.playerShip.turret.onAction("aiming",b,c)}if(a==="toggleCollisions"){pc.system.setDebugCollisions(!pc.system.debugCollisions)}if(a==="toggleSound"){pc.system.soundEnabled=(!pc.system.soundEnabled)}if(a==="toggleDebugGrid"){this.spaceStationLayer.debugShowGrid=(!this.spaceStationLayer.debugShowGrid);this.planetLayer.debugShowGrid=(!this.planetLayer.debugShowGrid);this.starFieldLayer.debugShowGrid=(!this.starFieldLayer.debugShowGrid)}if(a==="escape"){theGame.startMenu()}if(a==="dumpPool"){console.log(pc.Pool.getStats())}if(a==="togglePause"){this.togglePauseResume()}},update:function(a){this._super(a);this.gameLayer.origin.x=this.playerShip.centerPos.x-(this.viewPortWidth/2);this.gameLayer.origin.y=this.playerShip.centerPos.y-(this.viewPortHeight/2);this.spaceStationLayer.origin.match(this.gameLayer.origin);this.starFieldLayer1.origin.x=(this.playerShip.pos.x-(this.viewPortWidth/6))/7;this.starFieldLayer1.origin.y=(this.playerShip.pos.y-(this.viewPortHeight/2))/7;this.starFieldLayer2.origin.x=(this.playerShip.pos.x-(this.viewPortWidth/6))/5;this.starFieldLayer2.origin.y=(this.playerShip.pos.y-(this.viewPortHeight/2))/5;this.starFieldLayer3.origin.x=(this.playerShip.pos.x-(this.viewPortWidth/6))/3;this.starFieldLayer3.origin.y=(this.playerShip.pos.y-(this.viewPortHeight/2))/3;this.planetLayer.origin.x=(this.playerShip.pos.x-(this.viewPortWidth/6))/20;this.planetLayer.origin.y=(this.playerShip.pos.y-(this.viewPortHeight/2))/20;return true}});PlanetLayer=pc.Layer.extend("PlanetLayer",{},{planetImage:null,init:function(a){this._super("planets",false);this.planetImage=pc.system.loader.get("planet1").resource;this.planetImage2=pc.system.loader.get("planet2").resource},draw:function(a,c,b,d,e){this.planetImage.draw(a,c-this.origin.x+350,b-this.origin.y+200);this.planetImage2.draw(a,c-this.origin.x+1050,b-this.origin.y+700)}});StarFieldLayer=pc.TiledLayer("StarFieldLayer",{},{starFieldCanvas:null,init:function(f,b,i){var j=256;var g=this.generateStarFieldTiles(f,j,j,4,1);var a=new pc.SpriteSheet(g,j,j,4,1);var h=Math.ceil(b/j)+4;var e=Math.ceil(i/j)+4;this._super("starfield",false,a,h,e,j,j);this.generate(h,e,-1);for(var c=0;c<e;c++){for(var d=0;d<h;d++){this.setTile(d,c,pc.Math.rand(0,3))}}},generateStarFieldTiles:function(j,l,g,m,h){var b=pc.system.loader.get("stars").resource;var k=pc.system.loader.get("stars-dim").resource;var i=pc.system.loader.get("nebula-blobs").resource;var f=new pc.SpriteSheet(b,20,20,4,3);var a=new pc.SpriteSheet(k,20,20,4,3);var c=new pc.SpriteSheet(i,64,64,4,1);this.starFieldCanvas=document.createElement("canvas");this.starFieldCanvas.width=l*m;this.starFieldCanvas.height=g*h;var p=this.starFieldCanvas.getContext("2d");if(j==0){p.fillStyle="#000000";p.fillRect(0,0,this.starFieldCanvas.width,this.starFieldCanvas.height)}for(var d=0;d<h;d++){for(var e=0;e<m;e++){var o=e*l;var n=d*g;switch(j){case 0:this.generateImageField(p,o,n,l,g,a,30,0.8,1,0);break;case 1:this.generateImageField(p,o,n,l,g,f,80,0.8,1,0);break;case 2:this.generateImageField(p,o,n,l,g,c,100,0.2,0.3,100);break}}}return new pc.CanvasImage(this.starFieldCanvas)},generateImageField:function(m,k,j,l,i,q,r,c,a,p){var o=1;var n=1;for(var e=j;e<j+i;e+=n){for(var f=k;f<k+l;f+=o){m.globalAlpha=pc.Math.randFloat(c,a);var h=f+pc.Math.rand(0,r);var g=e+pc.Math.rand(0,r);var d=pc.Math.rand(0,q.framesWide-1);var b=pc.Math.rand(0,q.framesHigh-1);if(pc.Math.isRectInRect(h,g,q.frameWidth,q.frameHeight,k,j,l,i)){q.drawFrame(m,d,b,h,g)}o=pc.Math.rand(r-(r/2),r+(r/2));if(pc.Math.rand(p/2,p)<p/4){o+=p}}n=pc.Math.rand(r-(r/2),r+(r/2));if(pc.Math.rand(0,p)<p/2){n+=p}}}});