var GAMENAME="Roids on Roids";var GAMEVERSION="0.5.8";var GAMETAG=GAMENAME+" v"+GAMEVERSION;PlayerStatus={IDLE:0,DEAD:1,ALIVE:2};CollisionType={NONE:0,BULLETS:1,ENEMY:2,FRIENDLY:4};var Weapon=pc.Base.extend("Weapon",{},{name:"",avail:false,energy:0,lastFired:0,init:function(a,b){this.name=a;this.avail=false;this.energy=b},setAvailable:function(){this.avail=true},setUnavailable:function(){this.avail=false}});var Fighter=pc.Base.extend("Fighter",{},{desc:"",mass:0,maxSpeed:0,thrust:0,jets:0,maxEnergy:1000,bulletSpeed:1000,bulletForce:0,bulletDelay:0,bulletLife:0,weap1:null,weap2:null,weap3:null,regen:0,energy:0,health:0,status:0,numFired:0,numHit:0,init:function(g,h,j,b,c,a,i,e,f,d){this.weap1=new Weapon("Mass_Projector",30);this.weap2=new Weapon("Plasma_Cannons",60);this.weap3=new Weapon("Laser_Pods",90);this.weap4=new Weapon("Gravibombs",120);this.desc=g;this.mass=h;this.regen=j;this.maxSpeed=b;this.thrust=c;this.jets=a;this.bulletSpeed=i;this.bulletForce=e;this.bulletDelay=f;this.bulletLife=d;this.energy=1000;this.health=100;this.status=PlayerStatus.ALIVE},regenerate:function(){this.energy+=this.regen;if(this.energy>this.maxEnergy){this.energy=this.maxEnergy}this.health+=0.01;if(this.health>100){this.health=100}},canFire:function(a){switch(a){case 1:if(this.weap1.avail&&this.energy>this.weap1.energy){return true}else{return false}case 2:if(this.weap2.avail&&this.energy>this.weap2.energy){return true}else{return false}case 3:if(this.weap3.avail&&this.energy>this.weap3.energy){return true}else{return false}case 4:if(this.weap4.avail&&this.energy>this.weap4.energy){return true}else{return false}}},getThrust:function(){return this.thrust}});GamePhysics=pc.systems.Physics.extend("GamePhysics",{},{smokeSheet:null,explosionSound:null,init:function(a){this._super(a);this.smokeSheet=new pc.SpriteSheet({image:pc.device.loader.get("smoke").resource,frameWidth:32,frameHeight:32,framesWide:16,framesHigh:1});this.smokeSheet.addAnimation({name:"smoking",time:1000,loops:1});if(pc.device.soundEnabled){this.explosionSound=pc.device.loader.get("explosion").resource;this.explosionSound.setVolume(0.5)}},onCollisionStart:function(l,f,e,c,k,g,j){function b(o,i){if(!o.hasTag("WALL")){i.layer.scene.Fighter.numHit++;i.layer.scene.score+=i.points;if(o.hasTag("PLAYER")){o.layer.scene.Fighter.health=(o.layer.scene.Fighter.health-(i.points/10));if(o.layer.scene.Fighter.health<1){o.getComponent("physics").setCollisionMask(0);o.getComponent("physics").setLinearVelocity(0,0);o.remove();o.layer.scene.Fighter.status=PlayerStatus.DEAD}}}}if((c.hasTag("ASTEROID-LARGE")||c.hasTag("ASTEROID-MEDIUM")||c.hasTag("ASTEROID-SMALL"))&&(e.hasTag("BULLET")||e.hasTag("PLAYER"))){if(e.hasTag("BULLET")){e.getComponent("physics").setCollisionMask(0);e.getComponent("physics").setLinearVelocity(0,0);e.remove()}this.explosionSound.play(false);if(!c.hasComponentOfType("expiry")){e.layer.scene.asteroidsLeft--;c.getComponent("physics").setCollisionMask(0);c.getComponent("physics").setLinearVelocity(0,0);c.getComponent("sprite").sprite.setSpriteSheet(this.smokeSheet);c.addComponent(pc.components.Expiry.create({lifetime:2500}));var a=c.getComponent("spatial");if(c.hasTag("ASTEROID-LARGE")){var h=pc.Math.rand(2,5+Math.floor(e.layer.scene.level/2));for(var d=0;d<h;d++){var n=0;var m=0;if(a.pos.x<a.dim.x){n+=a.dim.x+1}if(a.pos.y<a.dim.y){m+=a.dim.y+1}if(a.pos.x>pc.device.canvasWidth-a.dim.x){n=-a.dim.x+1}if(a.pos.y>pc.device.canvasHeight-a.dim.y){m=-a.dim.y+1}createEntity(c.layer.scene,c.layer,"asteroid-medium",a.pos.x+n,a.pos.y+m)}e.layer.scene.asteroidsLeft+=h}else{if(c.hasTag("ASTEROID-MEDIUM")){var a=c.getComponent("spatial");var h=pc.Math.rand(2,5+Math.floor(e.layer.scene.level/2));for(var d=0;d<h;d++){var n=0;var m=0;if(a.pos.x<a.dim.x){n+=a.dim.x+1}if(a.pos.y<a.dim.y){m+=a.dim.y+1}if(a.pos.x>pc.device.canvasWidth-a.dim.x){n=-a.dim.x+1}if(a.pos.y>pc.device.canvasHeight-a.dim.y){m=-a.dim.y+1}createEntity(c.layer.scene,c.layer,"asteroid-small",a.pos.x+n,a.pos.y+m)}e.layer.scene.asteroidsLeft+=h}}}b(e,c);e.layer.scene.hudAsteroids.getComponent("text").text[0]="Asteroids Left: "+e.layer.scene.asteroidsLeft}else{if((c.hasTag("BULLET")&&e.hasTag("WALL"))||(c.hasTag("BULLET")&&e.hasTag("WALL"))){c.getComponent("physics").setCollisionMask(0);c.getComponent("physics").setLinearVelocity(0,0);c.remove()}else{if((c.hasTag("ASTEROID-LARGE")||c.hasTag("ASTEROID-MEDIUM")||c.hasTag("ASTEROID-SMALL"))&&e.hasTag("WALL")){var d=0}}}}});DeviceID={APPLE:0,ANDROID:1,PC:2};TheGame=pc.Game.extend("TheGame",{},{device:null,useTouchpad:false,gameScene:null,splashScene:null,loadingScene:null,loadingLayer:null,detectDevice:function(){if(pc.device.isiPhone||pc.device.isiPhone4||pc.device.isiPad){this.device=DeviceID.APPLE;this.useTouchPad=true}else{if(pc.device.isAndroid){this.device=DeviceID.ANDROID;this.useTouchPad=true}else{this.device=DeviceID.PC;this.useTouchPad=false}}},goFullScreen:function(){if(pc.device.canvas){if(pc.device.canvas.requestFullscreen){pc.device.canvas.requestFullscreen()}else{if(pc.device.canvas.mozRequestFullScreen){pc.device.canvas.mozRequestFullScreen()}else{if(pc.device.canvas.webkitRequestFullScreen){pc.device.canvas.webkitRequestFullScreen()}}}}},preloadGraphics:function(){pc.device.loader.add(new pc.Image("titlescreen","images/titlescreen.png"));pc.device.loader.add(new pc.Image("backdrop1","images/backdrop01.png"));pc.device.loader.add(new pc.Image("backdrop2","images/backdrop02.png"));pc.device.loader.add(new pc.Image("backdrop3","images/backdrop03.png"));pc.device.loader.add(new pc.Image("backdrop4","images/backdrop04.png"));pc.device.loader.add(new pc.Image("backdrop5","images/backdrop05.png"));pc.device.loader.add(new pc.Image("backdrop6","images/backdrop06.png"));pc.device.loader.add(new pc.Image("backdrop7","images/backdrop07.png"));pc.device.loader.add(new pc.Image("playership","images/ship5.png"));pc.device.loader.add(new pc.Image("playerdebris","images/ship_debris.png"));pc.device.loader.add(new pc.Image("exhaust","images/exhaust.png"));pc.device.loader.add(new pc.Image("weap1","images/weap1-massprojector.png"));pc.device.loader.add(new pc.Image("weap2","images/weap2-dualplasmacanons.png"));pc.device.loader.add(new pc.Image("weap3","images/weap3-duallaserpods.png"));pc.device.loader.add(new pc.Image("weap4","images/weap4.png"));pc.device.loader.add(new pc.Image("asteroid-large","images/asteroid-large.png"));pc.device.loader.add(new pc.Image("asteroid-medium","images/asteroid-medium.png"));pc.device.loader.add(new pc.Image("asteroid-small","images/asteroid-small.png"));pc.device.loader.add(new pc.Image("smoke","images/smoke1.png"));pc.device.loader.add(new pc.Image("explosions","images/smallexplosions.png"))},preloadAudio:function(){if(pc.device.soundEnabled){pc.device.loader.add(new pc.Sound("fire","sounds/lowfire",["ogg"],32));pc.device.loader.add(new pc.Sound("explosion","sounds/explosion",["ogg"],32));pc.device.loader.add(new pc.Sound("music","sounds/pushthelimits",["ogg"],1))}},onReady:function(){this._super();pc.device.devMode=!pc.packed;this.detectDevice();this.goFullScreen();if(pc.device.devMode){pc.device.loader.setDisableCache()}if(this.useTouchPad){}else{}this.preloadGraphics();this.preloadAudio();this.loadingScene=new pc.Scene();this.loadingLayer=new pc.Layer("loading");this.loadingScene.addLayer(this.loadingLayer);pc.device.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this))},onLoading:function(b){var a=pc.device.ctx;a.clearRect(0,0,pc.device.canvasWidth,pc.device.canvasHeight);a.font="normal 50px Verdana";a.fillStyle="#88f";a.fillText(GAMETAG,40,(pc.device.canvasHeight/2)-50);a.font="normal 18px Verdana";a.fillStyle="#777";a.fillText("Loading: "+b+"%",40,pc.device.canvasHeight/2)},onLoaded:function(){if(this.gameScene===null){this.gameScene=new GameScene();this.addScene(this.gameScene)}}});function createEntity(c,f,h,k,i,b,d){var g=pc.Entity.create(f);switch(h){case"asteroid-small":g.addTag("ASTEROID-SMALL");g.points=100;g.addComponent(pc.components.Sprite.create({currentFrame:pc.Math.rand(0,10),animSpeedOffset:pc.Math.rand(500,1000),spriteSheet:c.smallAsteroidSheet,animationStart:"floating"}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:pc.Math.rand(0,359),w:c.smallAsteroidSheet.frameWidth,h:c.smallAsteroidSheet.frameHeight}));g.addComponent(pc.components.Physics.create({force:20+c.levelBounce,mass:1,bounce:c.levelBounce,shapes:[{shape:pc.CollisionShape.CIRCLE}],collisionCategory:CollisionType.ENEMY,collisionMask:CollisionType.FRIENDLY|CollisionType.ENEMY}));return g;case"asteroid-medium":g.addTag("ASTEROID-MEDIUM");g.points=200;g.addComponent(pc.components.Sprite.create({currentFrame:pc.Math.rand(0,10),animSpeedOffset:pc.Math.rand(500,1000),spriteSheet:c.mediumAsteroidSheet,animationStart:"floating"}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:pc.Math.rand(0,359),w:c.mediumAsteroidSheet.frameWidth,h:c.mediumAsteroidSheet.frameHeight}));g.addComponent(pc.components.Physics.create({force:40+c.levelBounce,mass:2,bounce:c.levelBounce,shapes:[{shape:pc.CollisionShape.CIRCLE}],collisionCategory:CollisionType.ENEMY,collisionMask:CollisionType.FRIENDLY|CollisionType.ENEMY}));return g;case"asteroid-large":g.addTag("ASTEROID-LARGE");g.points=400;var a=0;var j=0;do{a=pc.Math.rand(100,pc.device.canvasWidth-100);j=pc.Math.rand(100,pc.device.canvasHeight-100)}while(pc.Math.isPointInRect(a,j,(pc.device.canvasWidth/2)-100,(pc.device.canvasHeight/2)-100,200,200));g.addComponent(pc.components.Sprite.create({currentFrame:pc.Math.rand(0,10),animSpeedOffset:pc.Math.rand(500,1000),spriteSheet:c.largeAsteroidSheet,animationStart:"floating"}));g.addComponent(pc.components.Spatial.create({x:a,y:j,dir:pc.Math.rand(0,359),w:c.largeAsteroidSheet.frameWidth,h:c.largeAsteroidSheet.frameHeight}));g.addComponent(pc.components.Physics.create({impulse:10+c.levelBounce,mass:3,bounce:c.levelBounce,shapes:[{shape:pc.CollisionShape.CIRCLE}],collisionCategory:CollisionType.ENEMY,collisionMask:CollisionType.FRIENDLY|CollisionType.ENEMY}));return g;case"player":c.Fighter.status=PlayerStatus.ALIVE;g.addTag("PLAYER");g.addComponent(pc.components.Sprite.create({spriteSheet:c.playerSheet,animationStart:"floating"}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:b,w:c.playerSheet.frameWidth,h:c.playerSheet.frameHeight}));g.addComponent(pc.components.Physics.create({maxSpeed:{x:c.Fighter.maxSpeed,y:c.Fighter.maxSpeed},linearDamping:0,mass:c.Fighter.mass,shapes:[{shape:pc.CollisionShape.CIRCLE}],collisionCategory:CollisionType.FRIENDLY,collisionMask:CollisionType.ENEMY}));return g;case"debris":g.addTag("DEBRIS");g.addComponent(pc.components.Sprite.create({spriteSheet:c.playerDebris,animationStart:"floating"}));g.addComponent(pc.components.Spatial.create({x:(pc.device.canvasWidth/2)-300,y:(pc.device.canvasHeight/2)-300,dir:pc.Math.rand(0,359),w:c.playerDebris.frameWidth,h:c.playerSheet.frameHeight}));return g;case"engine":g.addComponent(pc.components.Spatial.create({dir:b,w:24,h:24}));g.addComponent(pc.components.Physics.create({shapes:[{shape:pc.CollisionShape.CIRCLE}]}));g.addComponent(pc.components.ParticleEmitter.create({spriteSheet:c.exhaustSheet,burst:1,delay:10,thrustMin:2,thrustMax:4,thrustTime:250,lifeMin:400,fadeOutTime:800,spinMin:65,rotateSprite:true,emitting:true}));g.addComponent(pc.components.Joint.create({attachedTo:d,type:pc.JointType.REVOLUTE,offset:{x:-40,y:0}}));return g;case"projector":g.addTag("BULLET");g.addComponent(pc.components.Sprite.create({spriteSheet:c.weap1FireSheet,animationStart:"floating"}));g.addComponent(pc.components.Expiry.create({lifetime:3000}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:b,w:c.weap1FireSheet.frameWidth,h:c.weap1FireSheet.frameHeight}));g.addComponent(pc.components.Physics.create({maxSpeed:{x:40,y:40},force:160,shapes:[{offset:{w:-25},shape:pc.CollisionShape.CIRCLE}],collisionCategory:CollisionType.FRIENDLY,collisionMask:CollisionType.ENEMY}));return g;case"plasma":g.addTag("BULLET");g.addComponent(pc.components.Sprite.create({spriteSheet:c.weap2FireSheet,animationStart:"floating"}));g.addComponent(pc.components.Expiry.create({lifetime:300}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:b,w:c.weap2FireSheet.frameWidth,h:c.weap2FireSheet.frameHeight}));g.addComponent(pc.components.Physics.create({maxSpeed:{x:100,y:100},force:150,shapes:[{offset:{w:-2,h:-2},shape:pc.CollisionShape.RECTANGLE}],collisionCategory:CollisionType.FRIENDLY,collisionMask:CollisionType.ENEMY}));0;return g;case"laser":g.addTag("BULLET");g.addComponent(pc.components.Sprite.create({spriteSheet:c.weap3FireSheet,animationStart:"floating"}));g.addComponent(pc.components.Expiry.create({lifetime:6000}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:b,w:c.weap3FireSheet.frameWidth,h:c.weap3FireSheet.frameHeight}));g.addComponent(pc.components.Physics.create({maxSpeed:{x:200,y:200},force:75,shapes:[{offset:{w:0},shape:pc.CollisionShape.RECTANGLE}],collisionCategory:CollisionType.FRIENDLY,collisionMask:CollisionType.ENEMY}));return g;case"gravitron":g.addTag("BULLET");g.addComponent(pc.components.Sprite.create({spriteSheet:c.weap4FireSheet,animationStart:"floating"}));g.addComponent(pc.components.Expiry.create({lifetime:10000}));g.addComponent(pc.components.Spatial.create({x:k,y:i,dir:b,w:c.weap4FireSheet.frameWidth,h:c.weap4FireSheet.frameHeight}));g.addComponent(pc.components.Physics.create({maxSpeed:{x:20,y:20},force:500,shapes:[{offset:{w:-4},shape:pc.CollisionShape.CIRCLE}],collisionCategory:CollisionType.FRIENDLY,collisionMask:CollisionType.ENEMY}));return g;case"instructions":g.addComponent(pc.components.Rect.create({color:"#222222",lineColor:"#888888",lineWidth:3}));g.addComponent(pc.components.Fade.create({startDelay:1000,fadeInTime:3500,holdTime:3000,fadeOutTime:1500}));g.addComponent(pc.components.Text.create({text:["Arrow keys=move","Space=fire","-- DEBUG --","F9=Toggle Debug","F10=Toggle Pool Dump","F11=Toggle Sound"],lineWidth:0,fontHeight:14,offset:{x:25,y:-65}}));g.addComponent(pc.components.Expiry.create({lifetime:8000}));g.addComponent(pc.components.Spatial.create({dir:0,w:170,h:85}));g.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"middle",margin:{right:80}}));return g;case"yourdead":g.addComponent(pc.components.Fade.create({fadeInTime:1500,holdTime:3000,fadeOutTime:1500}));g.addComponent(pc.components.Text.create({color:"#2d2929",strokeColor:"#631212",text:["Your Toast!"],lineWidth:2,fontHeight:80}));g.addComponent(pc.components.Expiry.create({lifetime:6500}));g.addComponent(pc.components.Spatial.create({dir:0,w:280,h:80}));g.addComponent(pc.components.Layout.create({vertical:"center",horizontal:"center"}));return g;return null}}function createWeapon(f,c,d,a,b){var e=(f.weap4FireSheet.frameWidth/2);a.subtract(e,e);a.moveInDir(f.playerSpatial.dir,b);createEntity(f,c,"gravitron",a.x,a.y,this.playerSpatial.dir)}GameScene=pc.Scene.extend("GameScene",{},{lastTimer:0,Fighter:null,Fighter1:null,Fighter2:null,Fighter3:null,Fighter4:null,Fighter5:null,player:null,playerPhysics:null,playerSpatial:null,engine:null,asteroidsLeft:0,level:0,stage:0,score:0,average:0,lastFireTime:0,hudAsteroids:null,hudShipType:null,hudScore:null,hudEnergy:null,hudHealth:null,starsLayer:null,gameLayer:null,hudLayer:null,largeAsteroidSheet:null,mediumAsteroidSheet:null,smallAsteroidSheet:null,playerSheet:null,weap1FireSheet:null,weap2FireSheet:null,weap3FireSheet:null,weap4FireSheet:null,exhaustSheet:null,music:null,musicPlaying:true,fireSound:null,levelBounce:1,weap1LastFired:0,weap2LastFired:0,weap3LastFired:0,weap4LastFired:0,timer:function(b){if(b){this.lastTimer=pc.device.now}else{var a=(pc.device.now-this.lastTimer);return a}},init:function(){this.timer(true);if(pc.device.devMode){this.info("Initializing Game")}this._super();this.Fighter1=new Fighter("Scout",5,1,25,2.5,40,500,50,350,1500);this.Fighter2=new Fighter("Fighter",6,2,35,3,60,750,60,300,1250);this.Fighter3=new Fighter("Frigate",7,3,45,3.5,80,1000,70,250,1000);this.Fighter4=new Fighter("Destroyer",8,4,55,4,100,1250,80,200,750);this.Fighter5=new Fighter("Dreadnaught",9,5,65,4.5,120,1500,90,100,500);this.Fighter=this.Fighter1;if(pc.device.devMode){this.info("Initializing sound")}if(pc.device.soundEnabled){this.fireSound=pc.device.loader.get("fire").resource;this.fireSound.setVolume(0.2);this.music=pc.device.loader.get("music").resource;this.music.setVolume(0.2);this.music.play(true);this.musicPlaying=true}if(pc.device.devMode){this.info("Initializing Sprites")}this.largeAsteroidSheet=new pc.SpriteSheet({image:pc.device.loader.get("asteroid-large").resource,useRotation:true,frameWidth:96,frameHeight:96});this.largeAsteroidSheet.addAnimation({name:"floating",time:900,frameCount:20});this.mediumAsteroidSheet=new pc.SpriteSheet({image:pc.device.loader.get("asteroid-medium").resource,useRotation:true,frameWidth:64,frameHeight:64});this.mediumAsteroidSheet.addAnimation({name:"floating",time:600,frameCount:20});this.smallAsteroidSheet=new pc.SpriteSheet({image:pc.device.loader.get("asteroid-small").resource,useRotation:true,frameWidth:24,frameHeight:24});this.smallAsteroidSheet.addAnimation({name:"floating",time:300,frameCount:20});this.playerSheet=new pc.SpriteSheet({image:pc.device.loader.get("playership").resource,frameWidth:80,frameHeight:80,useRotation:true});this.playerSheet.addAnimation({name:"floating",frameCount:1});this.playerDebris=new pc.SpriteSheet({image:pc.device.loader.get("playerdebris").resource,frameWidth:600,frameHeight:600,useRotation:false});this.playerDebris.addAnimation({name:"floating",frameCount:1});this.weap1FireSheet=new pc.SpriteSheet({image:pc.device.loader.get("weap1").resource,frameWidth:30,frameHeight:30});this.weap1FireSheet.addAnimation({name:"floating",time:500,dirAcross:true});this.weap2FireSheet=new pc.SpriteSheet({image:pc.device.loader.get("weap2").resource,frameWidth:28,frameHeight:28});this.weap2FireSheet.addAnimation({name:"floating",time:400,dirAcross:true});this.weap3FireSheet=new pc.SpriteSheet({image:pc.device.loader.get("weap3").resource,frameWidth:40,frameHeight:40});this.weap3FireSheet.addAnimation({name:"floating",time:20,dirAcross:true});this.weap4FireSheet=new pc.SpriteSheet({image:pc.device.loader.get("weap4").resource,frameWidth:16,frameHeight:16});this.weap4FireSheet.addAnimation({name:"floating",time:100,dirAcross:true});this.exhaustSheet=new pc.SpriteSheet({image:pc.device.loader.get("exhaust").resource,frameWidth:24,frameHeight:24,framesWide:20,framesHigh:1,useRotation:true});this.exhaustSheet.addAnimation({name:"thrusting",time:2000,loops:1});if(pc.device.devMode){this.info("Creating Space Layer")}this.starsLayer=this.addLayer(new StarsLayer("stars layer",1));if(pc.device.devMode){this.info("Creating Game Layer")}this.gameLayer=this.addLayer(new pc.EntityLayer("game layer",10000,10000));if(pc.device.devMode){this.info("Creating HUD Layer")}this.hudLayer=this.addLayer(new HudLayer("hudLayer",1));if(pc.device.devMode){this.info("Initializing Physics Engine")}this.gameLayer.addSystem(new GamePhysics({gravity:{x:0,y:0},debug:pc.device.devMode}));this.gameLayer.addSystem(new pc.systems.Particles());this.gameLayer.addSystem(new pc.systems.Effects());this.gameLayer.addSystem(new pc.systems.Render());this.gameLayer.addSystem(new pc.systems.Expiration());this.gameLayer.addSystem(new pc.systems.Layout());if(pc.device.devMode){this.info("Initializing Player")}this.player=createEntity(this,this.gameLayer,"player",(this.gameLayer.scene.viewPort.w/2)-40,(this.gameLayer.scene.viewPort.h/2)-40,0);this.engine=createEntity(this,this.gameLayer,"engine",(this.gameLayer.scene.viewPort.w/2),(this.gameLayer.scene.viewPort.h/2),0,this.player);this.playerPhysics=this.player.getComponent("physics");this.playerSpatial=this.player.getComponent("spatial");if(pc.device.devMode){this.info("Initializing Boundry Wall")}this.createWall(this.gameLayer,0,0,1,pc.device.canvasHeight);this.createWall(this.gameLayer,0,0,pc.device.canvasWidth,1);this.createWall(this.gameLayer,pc.device.canvasWidth,0,1,pc.device.canvasHeight);this.createWall(this.gameLayer,0,pc.device.canvasHeight,pc.device.canvasWidth,1);this.newLevel();this.starsLayer.setZIndex(1);this.gameLayer.setZIndex(2);this.hudLayer.setZIndex(3);this.initHUD();this.initPlayerInput();pc.device.input.bindAction(this,"Toggle Pause/Help/Resume","ESC");pc.device.input.bindAction(this,"Toggle Sound","F10");if(pc.device.devMode){this.info("Game Initialization Done. ("+this.timer(false)+"ms)")}},initPlayerInput:function(){if(pc.device.devMode){this.info("Initializing Player Input")}pc.device.input.bindState(this,"turning right","D");pc.device.input.bindState(this,"turning right","RIGHT");pc.device.input.bindState(this,"turning left","A");pc.device.input.bindState(this,"turning left","LEFT");pc.device.input.bindState(this,"thrusting","W");pc.device.input.bindState(this,"thrusting","UP");pc.device.input.bindState(this,"reversing","S");pc.device.input.bindState(this,"reversing","DOWN");pc.device.input.bindState(this,"weapon1","1");pc.device.input.bindState(this,"weapon2","2");pc.device.input.bindState(this,"weapon3","3");pc.device.input.bindState(this,"weapon4","4");pc.device.input.bindState(this,"allweapons","5")},initHUD:function(){if(pc.device.devMode){this.info("Initializing HUD")}this.createhudAsteroids();this.createhudShipType();this.createhudScore();this.createhudEnergy();this.createhudHealth()},displayText:function(a){var b=pc.Entity.create(this.gameLayer);b.addComponent(pc.components.Fade.create({fadeInTime:1000,holdTime:1000,fadeOutTime:1500}));b.addComponent(pc.components.Text.create({color:"#e65cba",text:[a],fontHeight:20}));b.addComponent(pc.components.Expiry.create({lifetime:6500}));b.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));b.addComponent(pc.components.Layout.create({vertical:"middle",horizontal:"left",margin:{left:30}}))},createWall:function(c,a,g,b,d){var f=pc.Entity.create(c);f.addTag("WALL");f.addComponent(pc.components.Spatial.create({x:a,y:g,dir:0,w:b,h:d}));f.addComponent(pc.components.Physics.create({immovable:true,collisionCategory:CollisionType.ENEMY,collisionMask:CollisionType.FRIENDLY|CollisionType.ENEMY,bounce:(this.level/10),shapes:[{shape:pc.CollisionShape.RECT}]}))},createStageAlert:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Fade.create({fadeInTime:1000,holdTime:4000,fadeOutTime:2000}));a.addComponent(pc.components.Expiry.create({lifetime:7000}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:44}));if(this.stage==1){a.addComponent(pc.components.Text.create({color:"#000000",strokeColor:"#6666ff",text:["3 Waves to Stage 2"],lineWidth:2,fontHeight:44}))}else{if(this.stage>=2&&this.stage<=4){a.addComponent(pc.components.Text.create({color:"#000000",strokeColor:"#6666ff",text:["Stage "+this.stage+" complete","5 Waves to Stage "+this.stage+1,"Ship upgraded to "+this.Fighter.desc],lineWidth:2,fontHeight:44}))}else{a.addComponent(pc.components.Text.create({color:"#000000",strokeColor:"#6666ff",text:["Stage "+this.stage+" complete","5 Waves to Stage "+this.stage+1],lineWidth:2,fontHeight:44}))}}a.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"center",margin:{bottom:170,left:0}}))},createLevelAlert:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Fade.create({fadeInTime:1000,holdTime:4000,fadeOutTime:2000}));a.addComponent(pc.components.Expiry.create({lifetime:7000}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:44}));a.addComponent(pc.components.Text.create({color:"#000000",strokeColor:"#6666ff",text:["Level "+this.level],lineWidth:2,fontHeight:44}));a.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"center",margin:{bottom:170,left:0}}))},createhudAsteroids:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Text.create({color:"#ffffff",text:["Asteroids Left: "+this.asteroidsLeft],lineWidth:0,fontHeight:20}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));a.addComponent(pc.components.Layout.create({vertical:"top",horizontal:"left",margin:{top:30,left:30}}));this.hudAsteroids=a},createhudShipType:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Text.create({color:"#ffffff",text:["Ship Level: "+this.Fighter.desc],lineWidth:0,fontHeight:20}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));a.addComponent(pc.components.Layout.create({vertical:"top",horizontal:"center",margin:{top:30,left:30}}));this.hudShipType=a},createhudScore:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Text.create({color:"#ffffff",text:["Score: "+this.score],lineWidth:0,fontHeight:20}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));a.addComponent(pc.components.Layout.create({vertical:"top",horizontal:"right",margin:{top:30,right:30}}));this.hudScore=a},createhudEnergy:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Text.create({color:"#ffffff",text:["Energy: "+this.Fighter.energy],lineWidth:0,fontHeight:20}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));a.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"left",margin:{bottom:30,left:30}}));this.hudEnergy=a},createhudHealth:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Text.create({color:"#ffffff",text:["Health: "+this.Fighter.health],lineWidth:0,fontHeight:20}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));a.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"right",margin:{bottom:30,right:30}}));this.hudHealth=a},createLevelComplete:function(){var a=pc.Entity.create(this.gameLayer);a.addComponent(pc.components.Text.create({color:"#ffffff",text:["Level "+this.level+" Complete"],lineWidth:0,fontHeight:20}));a.addComponent(pc.components.Fade.create({fadeInTime:1500,holdTime:2000,fadeOutTime:1500}));a.addComponent(pc.components.Expiry.create({lifetime:6500}));a.addComponent(pc.components.Spatial.create({dir:0,w:170,h:20}));a.addComponent(pc.components.Layout.create({vertical:"middle",horizontal:"center"}))},newLevel:function(){this.level++;this.average=(Math.floor(this.Fighter.numHit/this.Fighter.numFired)*100);this.createLevelAlert();this.Fighter.numHit=0;this.Fighter.numFired=0;var c=this.stage;if(this.level<=3){this.stage=1;this.Fighter=this.Fighter1;this.Fighter.weap1.avail=true}if(this.level>=4&&this.level<=8){this.stage=2;this.Fighter=this.Fighter2;this.Fighter.weap1.avail=true;this.Fighter.weap2.avail=true}if(this.level>=9&&this.level<=13){this.stage=3;this.Fighter=this.Fighter3;this.Fighter.weap1.avail=true;this.Fighter.weap2.avail=true;this.Fighter.weap3.avail=true}if(this.level>=14&&this.level<=18){this.stage=4;this.Fighter=this.Fighter4;this.Fighter.weap1.avail=true;this.Fighter.weap2.avail=true;this.Fighter.weap3.avail=true;this.Fighter.weap4.avail=true}if(this.level>=19&&this.level<=24){this.stage=5;this.Fighter=this.Fighter5}if(this.level>=25&&this.level<=29){this.stage=6}else{if(this.level>=30){this.stage=7}}if(this.stage!==c){this.createStageAlert();this.levelBounce+=0.01;this.starsLayer.setBackdrop(this.stage)}var b=1+this.level;for(var a=0;a<b;a++){createEntity(this,this.gameLayer,"asteroid-large")}this.asteroidsLeft+=b},onAction:function(a,b,d){if(pc.device.devMode){this.info("onAction Event Method")}if(a=="Scout"){this.Fighter=this.Fighter1}if(a=="Fighter"){this.Fighter=this.Fighter2}if(a=="Frigate"){this.Fighter=this.Fighter3}if(a=="Destroyer"){this.Fighter=this.Fighter4}if(a=="Dreadnaught"){this.Fighter=this.Fighter5}if(a==="toggle debug"){var c=this.gameLayer.getSystemsByComponentType("physics").first.object();c.setDebug(!c.debug)}if(a==="toggle music"){if(this.musicPlaying){this.music.stop();this.musicPlaying=false}else{this.music.play();this.musicPlaying=true}}},fireWeap1:function(a){var b=pc.device.now-this.Fighter.weap1.lastFired;if(b>300){this.Fighter.weap1.lastFired=pc.device.now;if(this.Fighter.energy>this.Fighter.weap1.energy){var c=(this.weap1FireSheet.frameWidth/2);this.Fighter.energy=this.Fighter.energy-this.Fighter.weap1.energy;a.subtract(c,c);a.moveInDir(this.playerSpatial.dir,60);createEntity(this,this.gameLayer,"projector",a.x,a.y,this.playerSpatial.dir);this.fireSound.play(false);this.Fighter.numFired++}}},fireWeap2:function(a){var b=pc.device.now-this.Fighter.weap2.lastFired;if(b>50){this.Fighter.weap2.lastFired=pc.device.now;if(this.Fighter.energy>this.Fighter.weap2.energy){var c=(this.weap2FireSheet.frameWidth/2);this.Fighter.energy=this.Fighter.energy-this.Fighter.weap2.energy;a.subtract(c,c);a.moveInDir(this.playerSpatial.dir,40);createEntity(this,this.gameLayer,"plasma",a.x,a.y,this.playerSpatial.dir);this.fireSound.play(false);this.Fighter.numFired++}}},fireWeap3:function(a){var b=pc.device.now-this.Fighter.weap3.lastFired;if(b>200){this.Fighter.weap3.lastFired=pc.device.now;if(this.Fighter.energy>this.Fighter.weap3.energy){var c=(this.weap3FireSheet.frameWidth/2);this.Fighter.energy=this.Fighter.energy-this.Fighter.weap3.energy;a.subtract(c,c);a.moveInDir(this.playerSpatial.dir,30);createEntity(this,this.gameLayer,"laser",a.x,a.y,this.playerSpatial.dir);this.fireSound.play(false);this.Fighter.numFired++}}},fireWeap4:function(a){var b=pc.device.now-this.Fighter.weap4.lastFired;if(b>1200){this.Fighter.weap4.lastFired=pc.device.now;if(this.Fighter.energy>this.Fighter.weap4.energy){var c=(this.weap4FireSheet.frameWidth/2);this.Fighter.energy=this.Fighter.energy-this.Fighter.weap4.energy;a.subtract(c,c);a.moveInDir(this.playerSpatial.dir,30);createEntity(this,this.gameLayer,"gravitron",a.x,a.y-35,this.playerSpatial.dir);createEntity(this,this.gameLayer,"gravitron",a.x,a.y+35,this.playerSpatial.dir);this.fireSound.play(false);this.Fighter.numFired++}}},fireWeapAll:function(a){this.fireWeap1(a);this.fireWeap2(a);this.fireWeap3(a);this.fireWeap4(a)},process:function(){if(!pc.device.loader.finished){return}if(this.Fighter.status==PlayerStatus.DEAD){createEntity(this,this.gameLayer,"debris");this.Fighter.status=PlayerStatus.IDLE}else{if(this.Fighter.status==PlayerStatus.IDLE){var c=0}else{this.Fighter.regenerate();if(!this.asteroidsLeft){this.newLevel()}var b=pc.device.input.isInputState(this,"turning left");if(pc.device.input.isInputState(this,"turning left")){this.playerPhysics.applyTurn(-this.Fighter.jets)}else{if(pc.device.input.isInputState(this,"turning right")){this.playerPhysics.applyTurn(this.Fighter.jets)}else{this.playerPhysics.applyTurn(0)}}if(pc.device.input.isInputState(this,"thrusting")){this.playerPhysics.applyForce(this.Fighter.thrust);this.engine.getComponent("emitter").emitting=true}else{if(pc.device.input.isInputState(this,"reversing")){this.playerPhysics.applyForce(-this.Fighter.thrust)}else{this.engine.getComponent("emitter").emitting=false}}var a=this.playerSpatial.getCenterPos();if(this.Fighter.canFire(1)){if(pc.device.input.isInputState(this,"weapon1")){this.fireWeap1(a)}}if(this.Fighter.canFire(2)){if(pc.device.input.isInputState(this,"weapon2")){this.fireWeap2(a)}}if(this.Fighter.canFire(3)){if(pc.device.input.isInputState(this,"weapon3")){this.fireWeap3(a)}}if(this.Fighter.canFire(4)){if(pc.device.input.isInputState(this,"weapon4")){this.fireWeap4(a)}}if(this.Fighter.canFire(1)&&this.Fighter.canFire(2)&&this.Fighter.canFire(3)&&this.Fighter.canFire(4)){if(pc.device.input.isInputState(this,"allweapons")){this.fireWeapAll(a)}}this.hudShipType.getComponent("text").text[0]="Ship Type: "+this.Fighter.desc;this.hudScore.getComponent("text").text[0]="Score: "+this.score;this.hudEnergy.getComponent("text").text[0]="Energy: "+Math.floor(this.Fighter.energy)+" (Bounce:"+this.levelBounce+")";this.hudHealth.getComponent("text").text[0]="Health: "+Math.floor(this.Fighter.health)}}this._super()}});HudLayer=pc.Layer.extend("hudLayer",{},{sheetEnergy:null,sheetEnergyBars:null,sheetArmor:null,sheetArmorBars:null,hudEnergy:null,hudEnergyBars:null,hudArmor:null,hudArmorBars:null,selected:0,saved:0,init:function(){this._super("hudLayer",1)},createHudEnergy:function(){this.sheetEnergy=new pc.SpriteSheet({image:pc.device.loader.get("hudEnergy").resource});this.hudEnergy=pc.Entity.create(this);this.hudEnergy.addComponent(pc.components.Sprite.create({spriteSheet:this.sheetEnergy}));this.hudEnergy.addComponent(pc.components.Spatial.create({x:x,y:y,dir:dir,w:this.sheetEnergy.frameWidth,h:this.sheetEnergy.frameHeight}));this.hudEnergy.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"left",margin:{bottom:30,left:30}}));this.sheetEnergyBars=new pc.SpriteSheet({image:pc.device.loader.get("hudEnergyBars").resource});this.hudEnergyBars=pc.Entity.create(this);this.hudEnergyBars.addComponent(pc.components.Sprite.create({spriteSheet:this.sheetEnergyBars}));this.hudEnergyBars.addComponent(pc.components.Spatial.create({x:x,y:y,dir:dir,w:this.sheetEnergyBars.frameWidth,h:this.sheetEnergyBars.frameHeight}));this.hudEnergyBars.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"left",margin:{bottom:60,left:30}}))},createHudArmor:function(){this.sheetArmor=new pc.SpriteSheet({image:pc.device.loader.get("hudArmor").resource});this.hudArmor=pc.Entity.create(this);this.hudArmor.addComponent(pc.components.Sprite.create({spriteSheet:this.sheetArmor}));this.hudArmor.addComponent(pc.components.Spatial.create({x:x,y:y,dir:dir,w:this.sheetArmor.frameWidth,h:this.sheetArmor.frameHeight}));this.hudArmor.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"right",margin:{bottom:30,right:30}}));this.sheetArmorBars=new pc.SpriteSheet({image:pc.device.loader.get("hudArmorBars").resource});this.hudArmorBars=pc.Entity.create(this);this.hudArmorBars.addComponent(pc.components.Sprite.create({spriteSheet:this.sheetArmorBars}));this.hudArmorBars.addComponent(pc.components.Spatial.create({x:x,y:y,dir:dir,w:this.sheetArmorBars.frameWidth,h:this.sheetArmorBars.frameHeight}));this.hudArmorBars.addComponent(pc.components.Layout.create({vertical:"bottom",horizontal:"right",margin:{bottom:60,right:30}}))},draw:function(){},process:function(){}});SceneID={PUBLISHER:0,TITLE:1,CREDITS:2};SplashScene=pc.Scene.extend("splashScene",{},{publisherLayer:null,titleLayer:null,currentScene:SceneID.TITLE,btnLaunch:null,btnHelp:null,btnFeedback:null,btnExit:null,init:function(){this._super();this.btnLaunch=pc.Rect.create(700,464,1320,540);this.btnHelp=pc.Rect.create(700,580,910,660);this.btnFeedback=pc.Rect.create(700,688,1210,748);this.btnExit=pc.Rect.create(700,792,900,856);this.titleLayer=this.addLayer(new TitleLayer("titleLayer",1));pc.device.input.bindState(this,"select","SPACE")},onReady:function(){},onAction:function(a,b,c){},process:function(){if(pc.device.input.isInputState(this,"select")){pc.device.game.deactivateScene(this)}this._super()}});PublisherLayer=pc.Layer.extend("publisherLayer",{},{background:null,init:function(){this._super("splashLayer",1);this.background=pc.device.loader.get("publisher").resource},draw:function(){this.background.draw(pc.device.ctx,0,0)},process:function(){}});TitleLayer=pc.Layer.extend("titleLayer",{},{background:null,init:function(){this._super("titleLayer",1);this.background=pc.device.loader.get("titlescreen").resource},draw:function(){this.background.draw(pc.device.ctx,0,0)},process:function(){}});StarsLayer=pc.Layer.extend("starsLayer",{},{background:null,selected:0,saved:0,init:function(){this._super("starsLayer",1);this.setBackdrop(1)},setBackdrop:function(a){if(this.selected!=a){if(a<1){a=1}if(a>7){a=7}this.selected=a;var b="backdrop"+this.selected;this.background=pc.device.loader.get(b).resource}},draw:function(){this.background.draw(pc.device.ctx,0,0)},process:function(){}});